
<html>
<head>
<title>guestfish</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel='stylesheet' href='pod.css' type='text/css' />
</head>
<body>


<ul id="index">
  <li><a href="#name">NAME</a></li>
  <li><a href="#synopsis">SYNOPSIS</a></li>
  <li><a href="#warning">WARNING</a></li>
  <li><a href="#description">DESCRIPTION</a></li>
  <li><a href="#examples">EXAMPLES</a>
    <ul>
      <li><a href="#as-an-interactive-shell">As an interactive shell</a></li>
      <li><a href="#from-shell-scripts">From shell scripts</a></li>
      <li><a href="#on-one-command-line">On one command line</a></li>
      <li><a href="#mount-disks-automatically">Mount disks automatically</a></li>
      <li><a href="#as-a-script-interpreter">As a script interpreter</a></li>
      <li><a href="#start-with-a-prepared-disk">Start with a prepared disk</a></li>
      <li><a href="#remote-drives">Remote drives</a></li>
      <li><a href="#remote-control">Remote control</a></li>
    </ul>
  </li>
  <li><a href="#options">OPTIONS</a></li>
  <li><a href="#commands-on-command-line">COMMANDS ON COMMAND LINE</a></li>
  <li><a href="#using-launch-or-run-">USING launch (OR run)</a></li>
  <li><a href="#opening-disks-for-read-and-write">OPENING DISKS FOR READ AND WRITE</a></li>
  <li><a href="#quoting">QUOTING</a>
    <ul>
      <li><a href="#escape-sequences-in-double-quoted-arguments">ESCAPE SEQUENCES IN DOUBLE QUOTED ARGUMENTS</a></li>
    </ul>
  </li>
  <li><a href="#optional-arguments">OPTIONAL ARGUMENTS</a></li>
  <li><a href="#numbers">NUMBERS</a>
    <ul>
      <li><a href="#size-suffix">SIZE SUFFIX</a></li>
      <li><a href="#octal-and-hexadecimal-numbers">OCTAL AND HEXADECIMAL NUMBERS</a></li>
    </ul>
  </li>
  <li><a href="#wildcards-and-globbing">WILDCARDS AND GLOBBING</a></li>
  <li><a href="#comments">COMMENTS</a></li>
  <li><a href="#running-commands-locally">RUNNING COMMANDS LOCALLY</a>
    <ul>
      <li><a href="#local-commands-with-inline-execution">LOCAL COMMANDS WITH INLINE EXECUTION</a></li>
    </ul>
  </li>
  <li><a href="#pipes">PIPES</a></li>
  <li><a href="#home-directories">HOME DIRECTORIES</a></li>
  <li><a href="#encrypted-disks">ENCRYPTED DISKS</a></li>
  <li><a href="#windows-paths">WINDOWS PATHS</a></li>
  <li><a href="#uploading-and-downloading-files">UPLOADING AND DOWNLOADING FILES</a></li>
  <li><a href="#exit-on-error-behaviour">EXIT ON ERROR BEHAVIOUR</a></li>
  <li><a href="#remote-control-guestfish-over-a-socket">REMOTE CONTROL GUESTFISH OVER A SOCKET</a>
    <ul>
      <li><a href="#controlling-multiple-guestfish-processes">CONTROLLING MULTIPLE GUESTFISH PROCESSES</a></li>
      <li><a href="#remote-control-and-csh">REMOTE CONTROL AND CSH</a></li>
      <li><a href="#remote-control-details">REMOTE CONTROL DETAILS</a></li>
      <li><a href="#using-remote-control-robustly-from-shell-scripts">USING REMOTE CONTROL ROBUSTLY FROM SHELL SCRIPTS</a></li>
      <li><a href="#remote-control-does-not-work-with--a-etc.-options">REMOTE CONTROL DOES NOT WORK WITH <i>-a</i> ETC. OPTIONS</a></li>
      <li><a href="#remote-control-run-command-hanging">REMOTE CONTROL RUN COMMAND HANGING</a></li>
    </ul>
  </li>
  <li><a href="#prepared-disk-images">PREPARED DISK IMAGES</a>
    <ul>
      <li><a href="#examples1">EXAMPLES</a></li>
      <li><a href="#n-disk---create-a-blank-disk"><b>-N disk</b> - create a blank disk</a></li>
      <li><a href="#n-part---create-a-partitioned-disk"><b>-N part</b> - create a partitioned disk</a></li>
      <li><a href="#n-fs---create-a-filesystem"><b>-N fs</b> - create a filesystem</a></li>
      <li><a href="#n-lv---create-a-disk-with-logical-volume"><b>-N lv</b> - create a disk with logical volume</a></li>
      <li><a href="#n-lvfs---create-a-disk-with-logical-volume-and-filesystem"><b>-N lvfs</b> - create a disk with logical volume and filesystem</a></li>
      <li><a href="#n-bootroot---create-a-boot-and-root-filesystem"><b>-N bootroot</b> - create a boot and root filesystem</a></li>
      <li><a href="#n-bootrootlv---create-a-boot-and-root-filesystem-using-lvm"><b>-N bootrootlv</b> - create a boot and root filesystem using LVM</a></li>
    </ul>
  </li>
  <li><a href="#adding-remote-storage">ADDING REMOTE STORAGE</a>
    <ul>
      <li><a href="#a-disk.img"><b>-a disk.img</b></a></li>
      <li><a href="#a-file:-path-to-disk.img"><b>-a file:///path/to/disk.img</b></a></li>
      <li><a href="#a-ftp:-user-example.com-:port-disk.img"><b>-a ftp://[user@]example.com[:port]/disk.img</b></a></li>
      <li><a href="#a-ftps:-user-example.com-:port-disk.img"><b>-a ftps://[user@]example.com[:port]/disk.img</b></a></li>
      <li><a href="#a-http:-user-example.com-:port-disk.img"><b>-a http://[user@]example.com[:port]/disk.img</b></a></li>
      <li><a href="#a-https:-user-example.com-:port-disk.img"><b>-a https://[user@]example.com[:port]/disk.img</b></a></li>
      <li><a href="#a-tftp:-user-example.com-:port-disk.img"><b>-a tftp://[user@]example.com[:port]/disk.img</b></a></li>
      <li><a href="#a-gluster:-example.com-:port-volname-image"><b>-a gluster://example.com[:port]/volname/image</b></a></li>
      <li><a href="#a-iscsi:-example.com-:port-target-iqn-name-lun-"><b>-a iscsi://example.com[:port]/target-iqn-name[/lun]</b></a></li>
      <li><a href="#a-nbd:-example.com-:port-"><b>-a nbd://example.com[:port]</b></a></li>
      <li><a href="#a-nbd:-example.com-:port-exportname"><b>-a nbd://example.com[:port]/exportname</b></a></li>
      <li><a href="#a-nbd:-socket-socket"><b>-a nbd://?socket=/socket</b></a></li>
      <li><a href="#a-nbd:-exportname-socket-socket"><b>-a nbd:///exportname?socket=/socket</b></a></li>
      <li><a href="#a-rbd:-pool-disk"><b>-a rbd:///pool/disk</b></a></li>
      <li><a href="#a-rbd:-example.com-:port-pool-disk"><b>-a rbd://example.com[:port]/pool/disk</b></a></li>
      <li><a href="#a-sheepdog:-example.com-:port-volume-image"><b>-a sheepdog://[example.com[:port]]/volume/image</b></a></li>
      <li><a href="#a-ssh:-user-example.com-:port-disk.img"><b>-a ssh://[user@]example.com[:port]/disk.img</b></a></li>
    </ul>
  </li>
  <li><a href="#progress-bars">PROGRESS BARS</a></li>
  <li><a href="#prompt">PROMPT</a>
    <ul>
      <li><a href="#examples-of-prompts">EXAMPLES OF PROMPTS</a></li>
    </ul>
  </li>
  <li><a href="#windows-8">WINDOWS 8</a></li>
  <li><a href="#guestfish-commands">GUESTFISH COMMANDS</a>
    <ul>
      <li><a href="#help">help</a></li>
      <li><a href="#exit">exit</a></li>
      <li><a href="#quit">quit</a></li>
      <li><a href="#alloc">alloc</a></li>
      <li><a href="#allocate">allocate</a></li>
      <li><a href="#copy-in">copy-in</a></li>
      <li><a href="#copy-out">copy-out</a></li>
      <li><a href="#delete-event">delete-event</a></li>
      <li><a href="#display">display</a></li>
      <li><a href="#echo">echo</a></li>
      <li><a href="#edit">edit</a></li>
      <li><a href="#vi">vi</a></li>
      <li><a href="#emacs">emacs</a></li>
      <li><a href="#event">event</a></li>
      <li><a href="#glob">glob</a></li>
      <li><a href="#hexedit">hexedit</a></li>
      <li><a href="#lcd">lcd</a></li>
      <li><a href="#list-events">list-events</a></li>
      <li><a href="#man">man</a></li>
      <li><a href="#manual">manual</a></li>
      <li><a href="#more">more</a></li>
      <li><a href="#less">less</a></li>
      <li><a href="#reopen">reopen</a></li>
      <li><a href="#setenv">setenv</a></li>
      <li><a href="#sparse">sparse</a></li>
      <li><a href="#supported">supported</a></li>
      <li><a href="#time">time</a></li>
      <li><a href="#unsetenv">unsetenv</a></li>
    </ul>
  </li>
  <li><a href="#commands">COMMANDS</a>
    <ul>
      <li><a href="#acl-delete-def-file">acl-delete-def-file</a></li>
      <li><a href="#acl-get-file">acl-get-file</a></li>
      <li><a href="#acl-set-file">acl-set-file</a></li>
      <li><a href="#add-cdrom">add-cdrom</a></li>
      <li><a href="#add-domain">add-domain</a></li>
      <li><a href="#domain">domain</a></li>
      <li><a href="#add-drive">add-drive</a></li>
      <li><a href="#add">add</a></li>
      <li><a href="#add-drive-opts">add-drive-opts</a></li>
      <li><a href="#add-drive-ro">add-drive-ro</a></li>
      <li><a href="#add-ro">add-ro</a></li>
      <li><a href="#add-drive-ro-with-if">add-drive-ro-with-if</a></li>
      <li><a href="#add-drive-scratch">add-drive-scratch</a></li>
      <li><a href="#scratch">scratch</a></li>
      <li><a href="#add-drive-with-if">add-drive-with-if</a></li>
      <li><a href="#aug-clear">aug-clear</a></li>
      <li><a href="#aug-close">aug-close</a></li>
      <li><a href="#aug-defnode">aug-defnode</a></li>
      <li><a href="#aug-defvar">aug-defvar</a></li>
      <li><a href="#aug-get">aug-get</a></li>
      <li><a href="#aug-init">aug-init</a></li>
      <li><a href="#aug-insert">aug-insert</a></li>
      <li><a href="#aug-label">aug-label</a></li>
      <li><a href="#aug-load">aug-load</a></li>
      <li><a href="#aug-ls">aug-ls</a></li>
      <li><a href="#aug-match">aug-match</a></li>
      <li><a href="#aug-mv">aug-mv</a></li>
      <li><a href="#aug-rm">aug-rm</a></li>
      <li><a href="#aug-save">aug-save</a></li>
      <li><a href="#aug-set">aug-set</a></li>
      <li><a href="#aug-setm">aug-setm</a></li>
      <li><a href="#available">available</a></li>
      <li><a href="#available-all-groups">available-all-groups</a></li>
      <li><a href="#base64-in">base64-in</a></li>
      <li><a href="#base64-out">base64-out</a></li>
      <li><a href="#blkdiscard">blkdiscard</a></li>
      <li><a href="#blkdiscardzeroes">blkdiscardzeroes</a></li>
      <li><a href="#blkid">blkid</a></li>
      <li><a href="#blockdev-flushbufs">blockdev-flushbufs</a></li>
      <li><a href="#blockdev-getbsz">blockdev-getbsz</a></li>
      <li><a href="#blockdev-getro">blockdev-getro</a></li>
      <li><a href="#blockdev-getsize64">blockdev-getsize64</a></li>
      <li><a href="#blockdev-getss">blockdev-getss</a></li>
      <li><a href="#blockdev-getsz">blockdev-getsz</a></li>
      <li><a href="#blockdev-rereadpt">blockdev-rereadpt</a></li>
      <li><a href="#blockdev-setbsz">blockdev-setbsz</a></li>
      <li><a href="#blockdev-setra">blockdev-setra</a></li>
      <li><a href="#blockdev-setro">blockdev-setro</a></li>
      <li><a href="#blockdev-setrw">blockdev-setrw</a></li>
      <li><a href="#btrfs-balance-cancel">btrfs-balance-cancel</a></li>
      <li><a href="#btrfs-balance-pause">btrfs-balance-pause</a></li>
      <li><a href="#btrfs-balance-resume">btrfs-balance-resume</a></li>
      <li><a href="#btrfs-balance-status">btrfs-balance-status</a></li>
      <li><a href="#btrfs-device-add">btrfs-device-add</a></li>
      <li><a href="#btrfs-device-delete">btrfs-device-delete</a></li>
      <li><a href="#btrfs-filesystem-balance">btrfs-filesystem-balance</a></li>
      <li><a href="#btrfs-balance">btrfs-balance</a></li>
      <li><a href="#btrfs-filesystem-defragment">btrfs-filesystem-defragment</a></li>
      <li><a href="#btrfs-filesystem-resize">btrfs-filesystem-resize</a></li>
      <li><a href="#btrfs-filesystem-sync">btrfs-filesystem-sync</a></li>
      <li><a href="#btrfs-fsck">btrfs-fsck</a></li>
      <li><a href="#btrfs-image">btrfs-image</a></li>
      <li><a href="#btrfs-qgroup-assign">btrfs-qgroup-assign</a></li>
      <li><a href="#btrfs-qgroup-create">btrfs-qgroup-create</a></li>
      <li><a href="#btrfs-qgroup-destroy">btrfs-qgroup-destroy</a></li>
      <li><a href="#btrfs-qgroup-limit">btrfs-qgroup-limit</a></li>
      <li><a href="#btrfs-qgroup-remove">btrfs-qgroup-remove</a></li>
      <li><a href="#btrfs-qgroup-show">btrfs-qgroup-show</a></li>
      <li><a href="#btrfs-quota-enable">btrfs-quota-enable</a></li>
      <li><a href="#btrfs-quota-rescan">btrfs-quota-rescan</a></li>
      <li><a href="#btrfs-replace">btrfs-replace</a></li>
      <li><a href="#btrfs-rescue-chunk-recover">btrfs-rescue-chunk-recover</a></li>
      <li><a href="#btrfs-rescue-super-recover">btrfs-rescue-super-recover</a></li>
      <li><a href="#btrfs-scrub-cancel">btrfs-scrub-cancel</a></li>
      <li><a href="#btrfs-scrub-resume">btrfs-scrub-resume</a></li>
      <li><a href="#btrfs-scrub-start">btrfs-scrub-start</a></li>
      <li><a href="#btrfs-scrub-status">btrfs-scrub-status</a></li>
      <li><a href="#btrfs-set-seeding">btrfs-set-seeding</a></li>
      <li><a href="#btrfs-subvolume-create">btrfs-subvolume-create</a></li>
      <li><a href="#btrfs-subvolume-create-opts">btrfs-subvolume-create-opts</a></li>
      <li><a href="#btrfs-subvolume-delete">btrfs-subvolume-delete</a></li>
      <li><a href="#btrfs-subvolume-get-default">btrfs-subvolume-get-default</a></li>
      <li><a href="#btrfs-subvolume-list">btrfs-subvolume-list</a></li>
      <li><a href="#btrfs-subvolume-set-default">btrfs-subvolume-set-default</a></li>
      <li><a href="#btrfs-subvolume-show">btrfs-subvolume-show</a></li>
      <li><a href="#btrfs-subvolume-snapshot">btrfs-subvolume-snapshot</a></li>
      <li><a href="#btrfs-subvolume-snapshot-opts">btrfs-subvolume-snapshot-opts</a></li>
      <li><a href="#btrfstune-enable-extended-inode-refs">btrfstune-enable-extended-inode-refs</a></li>
      <li><a href="#btrfstune-enable-skinny-metadata-extent-refs">btrfstune-enable-skinny-metadata-extent-refs</a></li>
      <li><a href="#btrfstune-seeding">btrfstune-seeding</a></li>
      <li><a href="#c-pointer">c-pointer</a></li>
      <li><a href="#canonical-device-name">canonical-device-name</a></li>
      <li><a href="#cap-get-file">cap-get-file</a></li>
      <li><a href="#cap-set-file">cap-set-file</a></li>
      <li><a href="#case-sensitive-path">case-sensitive-path</a></li>
      <li><a href="#cat">cat</a></li>
      <li><a href="#checksum">checksum</a></li>
      <li><a href="#checksum-device">checksum-device</a></li>
      <li><a href="#checksums-out">checksums-out</a></li>
      <li><a href="#chmod">chmod</a></li>
      <li><a href="#chown">chown</a></li>
      <li><a href="#clear-backend-setting">clear-backend-setting</a></li>
      <li><a href="#command">command</a></li>
      <li><a href="#command-lines">command-lines</a></li>
      <li><a href="#compress-device-out">compress-device-out</a></li>
      <li><a href="#compress-out">compress-out</a></li>
      <li><a href="#config">config</a></li>
      <li><a href="#copy-attributes">copy-attributes</a></li>
      <li><a href="#copy-device-to-device">copy-device-to-device</a></li>
      <li><a href="#copy-device-to-file">copy-device-to-file</a></li>
      <li><a href="#copy-file-to-device">copy-file-to-device</a></li>
      <li><a href="#copy-file-to-file">copy-file-to-file</a></li>
      <li><a href="#copy-size">copy-size</a></li>
      <li><a href="#cp">cp</a></li>
      <li><a href="#cp-a">cp-a</a></li>
      <li><a href="#cp-r">cp-r</a></li>
      <li><a href="#cpio-out">cpio-out</a></li>
      <li><a href="#dd">dd</a></li>
      <li><a href="#device-index">device-index</a></li>
      <li><a href="#df">df</a></li>
      <li><a href="#df-h">df-h</a></li>
      <li><a href="#disk-create">disk-create</a></li>
      <li><a href="#disk-format">disk-format</a></li>
      <li><a href="#disk-has-backing-file">disk-has-backing-file</a></li>
      <li><a href="#disk-virtual-size">disk-virtual-size</a></li>
      <li><a href="#dmesg">dmesg</a></li>
      <li><a href="#download">download</a></li>
      <li><a href="#download-offset">download-offset</a></li>
      <li><a href="#drop-caches">drop-caches</a></li>
      <li><a href="#du">du</a></li>
      <li><a href="#e2fsck">e2fsck</a></li>
      <li><a href="#e2fsck-f">e2fsck-f</a></li>
      <li><a href="#echo-daemon">echo-daemon</a></li>
      <li><a href="#egrep">egrep</a></li>
      <li><a href="#egrepi">egrepi</a></li>
      <li><a href="#equal">equal</a></li>
      <li><a href="#exists">exists</a></li>
      <li><a href="#extlinux">extlinux</a></li>
      <li><a href="#fallocate">fallocate</a></li>
      <li><a href="#fallocate64">fallocate64</a></li>
      <li><a href="#feature-available">feature-available</a></li>
      <li><a href="#fgrep">fgrep</a></li>
      <li><a href="#fgrepi">fgrepi</a></li>
      <li><a href="#file">file</a></li>
      <li><a href="#file-architecture">file-architecture</a></li>
      <li><a href="#filesize">filesize</a></li>
      <li><a href="#filesystem-available">filesystem-available</a></li>
      <li><a href="#fill">fill</a></li>
      <li><a href="#fill-dir">fill-dir</a></li>
      <li><a href="#fill-pattern">fill-pattern</a></li>
      <li><a href="#find">find</a></li>
      <li><a href="#find0">find0</a></li>
      <li><a href="#findfs-label">findfs-label</a></li>
      <li><a href="#findfs-uuid">findfs-uuid</a></li>
      <li><a href="#fsck">fsck</a></li>
      <li><a href="#fstrim">fstrim</a></li>
      <li><a href="#get-append">get-append</a></li>
      <li><a href="#get-attach-method">get-attach-method</a></li>
      <li><a href="#get-autosync">get-autosync</a></li>
      <li><a href="#get-backend">get-backend</a></li>
      <li><a href="#get-backend-setting">get-backend-setting</a></li>
      <li><a href="#get-backend-settings">get-backend-settings</a></li>
      <li><a href="#get-cachedir">get-cachedir</a></li>
      <li><a href="#get-direct">get-direct</a></li>
      <li><a href="#get-e2attrs">get-e2attrs</a></li>
      <li><a href="#get-e2generation">get-e2generation</a></li>
      <li><a href="#get-e2label">get-e2label</a></li>
      <li><a href="#get-e2uuid">get-e2uuid</a></li>
      <li><a href="#get-hv">get-hv</a></li>
      <li><a href="#get-libvirt-requested-credential-challenge">get-libvirt-requested-credential-challenge</a></li>
      <li><a href="#get-libvirt-requested-credential-defresult">get-libvirt-requested-credential-defresult</a></li>
      <li><a href="#get-libvirt-requested-credential-prompt">get-libvirt-requested-credential-prompt</a></li>
      <li><a href="#get-libvirt-requested-credentials">get-libvirt-requested-credentials</a></li>
      <li><a href="#get-memsize">get-memsize</a></li>
      <li><a href="#get-network">get-network</a></li>
      <li><a href="#get-path">get-path</a></li>
      <li><a href="#get-pgroup">get-pgroup</a></li>
      <li><a href="#get-pid">get-pid</a></li>
      <li><a href="#pid">pid</a></li>
      <li><a href="#get-program">get-program</a></li>
      <li><a href="#get-qemu">get-qemu</a></li>
      <li><a href="#get-recovery-proc">get-recovery-proc</a></li>
      <li><a href="#get-selinux">get-selinux</a></li>
      <li><a href="#get-smp">get-smp</a></li>
      <li><a href="#get-tmpdir">get-tmpdir</a></li>
      <li><a href="#get-trace">get-trace</a></li>
      <li><a href="#get-umask">get-umask</a></li>
      <li><a href="#get-verbose">get-verbose</a></li>
      <li><a href="#getcon">getcon</a></li>
      <li><a href="#getxattr">getxattr</a></li>
      <li><a href="#getxattrs">getxattrs</a></li>
      <li><a href="#glob-expand">glob-expand</a></li>
      <li><a href="#grep">grep</a></li>
      <li><a href="#grep-opts">grep-opts</a></li>
      <li><a href="#grepi">grepi</a></li>
      <li><a href="#grub-install">grub-install</a></li>
      <li><a href="#head">head</a></li>
      <li><a href="#head-n">head-n</a></li>
      <li><a href="#hexdump">hexdump</a></li>
      <li><a href="#hivex-close">hivex-close</a></li>
      <li><a href="#hivex-commit">hivex-commit</a></li>
      <li><a href="#hivex-node-add-child">hivex-node-add-child</a></li>
      <li><a href="#hivex-node-children">hivex-node-children</a></li>
      <li><a href="#hivex-node-delete-child">hivex-node-delete-child</a></li>
      <li><a href="#hivex-node-get-child">hivex-node-get-child</a></li>
      <li><a href="#hivex-node-get-value">hivex-node-get-value</a></li>
      <li><a href="#hivex-node-name">hivex-node-name</a></li>
      <li><a href="#hivex-node-parent">hivex-node-parent</a></li>
      <li><a href="#hivex-node-set-value">hivex-node-set-value</a></li>
      <li><a href="#hivex-node-values">hivex-node-values</a></li>
      <li><a href="#hivex-open">hivex-open</a></li>
      <li><a href="#hivex-root">hivex-root</a></li>
      <li><a href="#hivex-value-key">hivex-value-key</a></li>
      <li><a href="#hivex-value-type">hivex-value-type</a></li>
      <li><a href="#hivex-value-utf8">hivex-value-utf8</a></li>
      <li><a href="#hivex-value-value">hivex-value-value</a></li>
      <li><a href="#initrd-cat">initrd-cat</a></li>
      <li><a href="#initrd-list">initrd-list</a></li>
      <li><a href="#inotify-add-watch">inotify-add-watch</a></li>
      <li><a href="#inotify-close">inotify-close</a></li>
      <li><a href="#inotify-files">inotify-files</a></li>
      <li><a href="#inotify-init">inotify-init</a></li>
      <li><a href="#inotify-read">inotify-read</a></li>
      <li><a href="#inotify-rm-watch">inotify-rm-watch</a></li>
      <li><a href="#inspect-get-arch">inspect-get-arch</a></li>
      <li><a href="#inspect-get-distro">inspect-get-distro</a></li>
      <li><a href="#inspect-get-drive-mappings">inspect-get-drive-mappings</a></li>
      <li><a href="#inspect-get-filesystems">inspect-get-filesystems</a></li>
      <li><a href="#inspect-get-format">inspect-get-format</a></li>
      <li><a href="#inspect-get-hostname">inspect-get-hostname</a></li>
      <li><a href="#inspect-get-icon">inspect-get-icon</a></li>
      <li><a href="#inspect-get-major-version">inspect-get-major-version</a></li>
      <li><a href="#inspect-get-minor-version">inspect-get-minor-version</a></li>
      <li><a href="#inspect-get-mountpoints">inspect-get-mountpoints</a></li>
      <li><a href="#inspect-get-package-format">inspect-get-package-format</a></li>
      <li><a href="#inspect-get-package-management">inspect-get-package-management</a></li>
      <li><a href="#inspect-get-product-name">inspect-get-product-name</a></li>
      <li><a href="#inspect-get-product-variant">inspect-get-product-variant</a></li>
      <li><a href="#inspect-get-roots">inspect-get-roots</a></li>
      <li><a href="#inspect-get-type">inspect-get-type</a></li>
      <li><a href="#inspect-get-windows-current-control-set">inspect-get-windows-current-control-set</a></li>
      <li><a href="#inspect-get-windows-systemroot">inspect-get-windows-systemroot</a></li>
      <li><a href="#inspect-is-live">inspect-is-live</a></li>
      <li><a href="#inspect-is-multipart">inspect-is-multipart</a></li>
      <li><a href="#inspect-is-netinst">inspect-is-netinst</a></li>
      <li><a href="#inspect-list-applications">inspect-list-applications</a></li>
      <li><a href="#inspect-list-applications2">inspect-list-applications2</a></li>
      <li><a href="#inspect-os">inspect-os</a></li>
      <li><a href="#is-blockdev">is-blockdev</a></li>
      <li><a href="#is-blockdev-opts">is-blockdev-opts</a></li>
      <li><a href="#is-chardev">is-chardev</a></li>
      <li><a href="#is-chardev-opts">is-chardev-opts</a></li>
      <li><a href="#is-config">is-config</a></li>
      <li><a href="#is-dir">is-dir</a></li>
      <li><a href="#is-dir-opts">is-dir-opts</a></li>
      <li><a href="#is-fifo">is-fifo</a></li>
      <li><a href="#is-fifo-opts">is-fifo-opts</a></li>
      <li><a href="#is-file">is-file</a></li>
      <li><a href="#is-file-opts">is-file-opts</a></li>
      <li><a href="#is-lv">is-lv</a></li>
      <li><a href="#is-socket">is-socket</a></li>
      <li><a href="#is-socket-opts">is-socket-opts</a></li>
      <li><a href="#is-symlink">is-symlink</a></li>
      <li><a href="#is-whole-device">is-whole-device</a></li>
      <li><a href="#is-zero">is-zero</a></li>
      <li><a href="#is-zero-device">is-zero-device</a></li>
      <li><a href="#isoinfo">isoinfo</a></li>
      <li><a href="#isoinfo-device">isoinfo-device</a></li>
      <li><a href="#journal-close">journal-close</a></li>
      <li><a href="#journal-get">journal-get</a></li>
      <li><a href="#journal-get-data-threshold">journal-get-data-threshold</a></li>
      <li><a href="#journal-get-realtime-usec">journal-get-realtime-usec</a></li>
      <li><a href="#journal-next">journal-next</a></li>
      <li><a href="#journal-open">journal-open</a></li>
      <li><a href="#journal-set-data-threshold">journal-set-data-threshold</a></li>
      <li><a href="#journal-skip">journal-skip</a></li>
      <li><a href="#kill-subprocess">kill-subprocess</a></li>
      <li><a href="#launch">launch</a></li>
      <li><a href="#run">run</a></li>
      <li><a href="#lchown">lchown</a></li>
      <li><a href="#ldmtool-create-all">ldmtool-create-all</a></li>
      <li><a href="#ldmtool-diskgroup-disks">ldmtool-diskgroup-disks</a></li>
      <li><a href="#ldmtool-diskgroup-name">ldmtool-diskgroup-name</a></li>
      <li><a href="#ldmtool-diskgroup-volumes">ldmtool-diskgroup-volumes</a></li>
      <li><a href="#ldmtool-remove-all">ldmtool-remove-all</a></li>
      <li><a href="#ldmtool-scan">ldmtool-scan</a></li>
      <li><a href="#ldmtool-scan-devices">ldmtool-scan-devices</a></li>
      <li><a href="#ldmtool-volume-hint">ldmtool-volume-hint</a></li>
      <li><a href="#ldmtool-volume-partitions">ldmtool-volume-partitions</a></li>
      <li><a href="#ldmtool-volume-type">ldmtool-volume-type</a></li>
      <li><a href="#lgetxattr">lgetxattr</a></li>
      <li><a href="#lgetxattrs">lgetxattrs</a></li>
      <li><a href="#list-9p">list-9p</a></li>
      <li><a href="#list-devices">list-devices</a></li>
      <li><a href="#list-disk-labels">list-disk-labels</a></li>
      <li><a href="#list-dm-devices">list-dm-devices</a></li>
      <li><a href="#list-filesystems">list-filesystems</a></li>
      <li><a href="#list-ldm-partitions">list-ldm-partitions</a></li>
      <li><a href="#list-ldm-volumes">list-ldm-volumes</a></li>
      <li><a href="#list-md-devices">list-md-devices</a></li>
      <li><a href="#list-partitions">list-partitions</a></li>
      <li><a href="#ll">ll</a></li>
      <li><a href="#llz">llz</a></li>
      <li><a href="#ln">ln</a></li>
      <li><a href="#ln-f">ln-f</a></li>
      <li><a href="#ln-s">ln-s</a></li>
      <li><a href="#ln-sf">ln-sf</a></li>
      <li><a href="#lremovexattr">lremovexattr</a></li>
      <li><a href="#ls">ls</a></li>
      <li><a href="#ls0">ls0</a></li>
      <li><a href="#lsetxattr">lsetxattr</a></li>
      <li><a href="#lstat">lstat</a></li>
      <li><a href="#lstatlist">lstatlist</a></li>
      <li><a href="#lstatns">lstatns</a></li>
      <li><a href="#lstatnslist">lstatnslist</a></li>
      <li><a href="#luks-add-key">luks-add-key</a></li>
      <li><a href="#luks-close">luks-close</a></li>
      <li><a href="#luks-format">luks-format</a></li>
      <li><a href="#luks-format-cipher">luks-format-cipher</a></li>
      <li><a href="#luks-kill-slot">luks-kill-slot</a></li>
      <li><a href="#luks-open">luks-open</a></li>
      <li><a href="#luks-open-ro">luks-open-ro</a></li>
      <li><a href="#lvcreate">lvcreate</a></li>
      <li><a href="#lvcreate-free">lvcreate-free</a></li>
      <li><a href="#lvm-canonical-lv-name">lvm-canonical-lv-name</a></li>
      <li><a href="#lvm-clear-filter">lvm-clear-filter</a></li>
      <li><a href="#lvm-remove-all">lvm-remove-all</a></li>
      <li><a href="#lvm-set-filter">lvm-set-filter</a></li>
      <li><a href="#lvremove">lvremove</a></li>
      <li><a href="#lvrename">lvrename</a></li>
      <li><a href="#lvresize">lvresize</a></li>
      <li><a href="#lvresize-free">lvresize-free</a></li>
      <li><a href="#lvs">lvs</a></li>
      <li><a href="#lvs-full">lvs-full</a></li>
      <li><a href="#lvuuid">lvuuid</a></li>
      <li><a href="#lxattrlist">lxattrlist</a></li>
      <li><a href="#max-disks">max-disks</a></li>
      <li><a href="#md-create">md-create</a></li>
      <li><a href="#md-detail">md-detail</a></li>
      <li><a href="#md-stat">md-stat</a></li>
      <li><a href="#md-stop">md-stop</a></li>
      <li><a href="#mkdir">mkdir</a></li>
      <li><a href="#mkdir-mode">mkdir-mode</a></li>
      <li><a href="#mkdir-p">mkdir-p</a></li>
      <li><a href="#mkdtemp">mkdtemp</a></li>
      <li><a href="#mke2fs">mke2fs</a></li>
      <li><a href="#mke2fs-j">mke2fs-J</a></li>
      <li><a href="#mke2fs-jl">mke2fs-JL</a></li>
      <li><a href="#mke2fs-ju">mke2fs-JU</a></li>
      <li><a href="#mke2journal">mke2journal</a></li>
      <li><a href="#mke2journal-l">mke2journal-L</a></li>
      <li><a href="#mke2journal-u">mke2journal-U</a></li>
      <li><a href="#mkfifo">mkfifo</a></li>
      <li><a href="#mkfs">mkfs</a></li>
      <li><a href="#mkfs-opts">mkfs-opts</a></li>
      <li><a href="#mkfs-b">mkfs-b</a></li>
      <li><a href="#mkfs-btrfs">mkfs-btrfs</a></li>
      <li><a href="#mklost-and-found">mklost-and-found</a></li>
      <li><a href="#mkmountpoint">mkmountpoint</a></li>
      <li><a href="#mknod">mknod</a></li>
      <li><a href="#mknod-b">mknod-b</a></li>
      <li><a href="#mknod-c">mknod-c</a></li>
      <li><a href="#mkswap">mkswap</a></li>
      <li><a href="#mkswap-opts">mkswap-opts</a></li>
      <li><a href="#mkswap-l">mkswap-L</a></li>
      <li><a href="#mkswap-u">mkswap-U</a></li>
      <li><a href="#mkswap-file">mkswap-file</a></li>
      <li><a href="#mktemp">mktemp</a></li>
      <li><a href="#modprobe">modprobe</a></li>
      <li><a href="#mount">mount</a></li>
      <li><a href="#mount-9p">mount-9p</a></li>
      <li><a href="#mount-local">mount-local</a></li>
      <li><a href="#mount-local-run">mount-local-run</a></li>
      <li><a href="#mount-loop">mount-loop</a></li>
      <li><a href="#mount-options">mount-options</a></li>
      <li><a href="#mount-ro">mount-ro</a></li>
      <li><a href="#mount-vfs">mount-vfs</a></li>
      <li><a href="#mountpoints">mountpoints</a></li>
      <li><a href="#mounts">mounts</a></li>
      <li><a href="#mv">mv</a></li>
      <li><a href="#nr-devices">nr-devices</a></li>
      <li><a href="#ntfs-3g-probe">ntfs-3g-probe</a></li>
      <li><a href="#ntfsclone-in">ntfsclone-in</a></li>
      <li><a href="#ntfsclone-out">ntfsclone-out</a></li>
      <li><a href="#ntfsfix">ntfsfix</a></li>
      <li><a href="#ntfsresize">ntfsresize</a></li>
      <li><a href="#ntfsresize-opts">ntfsresize-opts</a></li>
      <li><a href="#ntfsresize-size">ntfsresize-size</a></li>
      <li><a href="#parse-environment">parse-environment</a></li>
      <li><a href="#parse-environment-list">parse-environment-list</a></li>
      <li><a href="#part-add">part-add</a></li>
      <li><a href="#part-del">part-del</a></li>
      <li><a href="#part-disk">part-disk</a></li>
      <li><a href="#part-get-bootable">part-get-bootable</a></li>
      <li><a href="#part-get-gpt-guid">part-get-gpt-guid</a></li>
      <li><a href="#part-get-gpt-type">part-get-gpt-type</a></li>
      <li><a href="#part-get-mbr-id">part-get-mbr-id</a></li>
      <li><a href="#part-get-mbr-part-type">part-get-mbr-part-type</a></li>
      <li><a href="#part-get-name">part-get-name</a></li>
      <li><a href="#part-get-parttype">part-get-parttype</a></li>
      <li><a href="#part-init">part-init</a></li>
      <li><a href="#part-list">part-list</a></li>
      <li><a href="#part-set-bootable">part-set-bootable</a></li>
      <li><a href="#part-set-gpt-guid">part-set-gpt-guid</a></li>
      <li><a href="#part-set-gpt-type">part-set-gpt-type</a></li>
      <li><a href="#part-set-mbr-id">part-set-mbr-id</a></li>
      <li><a href="#part-set-name">part-set-name</a></li>
      <li><a href="#part-to-dev">part-to-dev</a></li>
      <li><a href="#part-to-partnum">part-to-partnum</a></li>
      <li><a href="#ping-daemon">ping-daemon</a></li>
      <li><a href="#pread">pread</a></li>
      <li><a href="#pread-device">pread-device</a></li>
      <li><a href="#pvchange-uuid">pvchange-uuid</a></li>
      <li><a href="#pvchange-uuid-all">pvchange-uuid-all</a></li>
      <li><a href="#pvcreate">pvcreate</a></li>
      <li><a href="#pvremove">pvremove</a></li>
      <li><a href="#pvresize">pvresize</a></li>
      <li><a href="#pvresize-size">pvresize-size</a></li>
      <li><a href="#pvs">pvs</a></li>
      <li><a href="#pvs-full">pvs-full</a></li>
      <li><a href="#pvuuid">pvuuid</a></li>
      <li><a href="#pwrite">pwrite</a></li>
      <li><a href="#pwrite-device">pwrite-device</a></li>
      <li><a href="#read-file">read-file</a></li>
      <li><a href="#read-lines">read-lines</a></li>
      <li><a href="#readdir">readdir</a></li>
      <li><a href="#readlink">readlink</a></li>
      <li><a href="#readlinklist">readlinklist</a></li>
      <li><a href="#realpath">realpath</a></li>
      <li><a href="#remount">remount</a></li>
      <li><a href="#remove-drive">remove-drive</a></li>
      <li><a href="#removexattr">removexattr</a></li>
      <li><a href="#rename">rename</a></li>
      <li><a href="#resize2fs">resize2fs</a></li>
      <li><a href="#resize2fs-m">resize2fs-M</a></li>
      <li><a href="#resize2fs-size">resize2fs-size</a></li>
      <li><a href="#rm">rm</a></li>
      <li><a href="#rm-f">rm-f</a></li>
      <li><a href="#rm-rf">rm-rf</a></li>
      <li><a href="#rmdir">rmdir</a></li>
      <li><a href="#rmmountpoint">rmmountpoint</a></li>
      <li><a href="#rsync">rsync</a></li>
      <li><a href="#rsync-in">rsync-in</a></li>
      <li><a href="#rsync-out">rsync-out</a></li>
      <li><a href="#scrub-device">scrub-device</a></li>
      <li><a href="#scrub-file">scrub-file</a></li>
      <li><a href="#scrub-freespace">scrub-freespace</a></li>
      <li><a href="#set-append">set-append</a></li>
      <li><a href="#append">append</a></li>
      <li><a href="#set-attach-method">set-attach-method</a></li>
      <li><a href="#attach-method">attach-method</a></li>
      <li><a href="#set-autosync">set-autosync</a></li>
      <li><a href="#autosync">autosync</a></li>
      <li><a href="#set-backend">set-backend</a></li>
      <li><a href="#backend">backend</a></li>
      <li><a href="#set-backend-setting">set-backend-setting</a></li>
      <li><a href="#set-backend-settings">set-backend-settings</a></li>
      <li><a href="#set-cachedir">set-cachedir</a></li>
      <li><a href="#cachedir">cachedir</a></li>
      <li><a href="#set-direct">set-direct</a></li>
      <li><a href="#direct">direct</a></li>
      <li><a href="#set-e2attrs">set-e2attrs</a></li>
      <li><a href="#set-e2generation">set-e2generation</a></li>
      <li><a href="#set-e2label">set-e2label</a></li>
      <li><a href="#set-e2uuid">set-e2uuid</a></li>
      <li><a href="#set-hv">set-hv</a></li>
      <li><a href="#hv">hv</a></li>
      <li><a href="#set-label">set-label</a></li>
      <li><a href="#set-libvirt-requested-credential">set-libvirt-requested-credential</a></li>
      <li><a href="#set-libvirt-supported-credentials">set-libvirt-supported-credentials</a></li>
      <li><a href="#set-memsize">set-memsize</a></li>
      <li><a href="#memsize">memsize</a></li>
      <li><a href="#set-network">set-network</a></li>
      <li><a href="#network">network</a></li>
      <li><a href="#set-path">set-path</a></li>
      <li><a href="#path">path</a></li>
      <li><a href="#set-pgroup">set-pgroup</a></li>
      <li><a href="#pgroup">pgroup</a></li>
      <li><a href="#set-program">set-program</a></li>
      <li><a href="#program">program</a></li>
      <li><a href="#set-qemu">set-qemu</a></li>
      <li><a href="#qemu">qemu</a></li>
      <li><a href="#set-recovery-proc">set-recovery-proc</a></li>
      <li><a href="#recovery-proc">recovery-proc</a></li>
      <li><a href="#set-selinux">set-selinux</a></li>
      <li><a href="#selinux">selinux</a></li>
      <li><a href="#set-smp">set-smp</a></li>
      <li><a href="#smp">smp</a></li>
      <li><a href="#set-tmpdir">set-tmpdir</a></li>
      <li><a href="#tmpdir">tmpdir</a></li>
      <li><a href="#set-trace">set-trace</a></li>
      <li><a href="#trace">trace</a></li>
      <li><a href="#set-uuid">set-uuid</a></li>
      <li><a href="#set-uuid-random">set-uuid-random</a></li>
      <li><a href="#set-verbose">set-verbose</a></li>
      <li><a href="#verbose">verbose</a></li>
      <li><a href="#setcon">setcon</a></li>
      <li><a href="#setxattr">setxattr</a></li>
      <li><a href="#sfdisk">sfdisk</a></li>
      <li><a href="#sfdiskm">sfdiskM</a></li>
      <li><a href="#sfdisk-n">sfdisk-N</a></li>
      <li><a href="#sfdisk-disk-geometry">sfdisk-disk-geometry</a></li>
      <li><a href="#sfdisk-kernel-geometry">sfdisk-kernel-geometry</a></li>
      <li><a href="#sfdisk-l">sfdisk-l</a></li>
      <li><a href="#sh">sh</a></li>
      <li><a href="#sh-lines">sh-lines</a></li>
      <li><a href="#shutdown">shutdown</a></li>
      <li><a href="#sleep">sleep</a></li>
      <li><a href="#stat">stat</a></li>
      <li><a href="#statns">statns</a></li>
      <li><a href="#statvfs">statvfs</a></li>
      <li><a href="#strings">strings</a></li>
      <li><a href="#strings-e">strings-e</a></li>
      <li><a href="#swapoff-device">swapoff-device</a></li>
      <li><a href="#swapoff-file">swapoff-file</a></li>
      <li><a href="#swapoff-label">swapoff-label</a></li>
      <li><a href="#swapoff-uuid">swapoff-uuid</a></li>
      <li><a href="#swapon-device">swapon-device</a></li>
      <li><a href="#swapon-file">swapon-file</a></li>
      <li><a href="#swapon-label">swapon-label</a></li>
      <li><a href="#swapon-uuid">swapon-uuid</a></li>
      <li><a href="#sync">sync</a></li>
      <li><a href="#syslinux">syslinux</a></li>
      <li><a href="#tail">tail</a></li>
      <li><a href="#tail-n">tail-n</a></li>
      <li><a href="#tar-in">tar-in</a></li>
      <li><a href="#tar-in-opts">tar-in-opts</a></li>
      <li><a href="#tar-out">tar-out</a></li>
      <li><a href="#tar-out-opts">tar-out-opts</a></li>
      <li><a href="#tgz-in">tgz-in</a></li>
      <li><a href="#tgz-out">tgz-out</a></li>
      <li><a href="#touch">touch</a></li>
      <li><a href="#truncate">truncate</a></li>
      <li><a href="#truncate-size">truncate-size</a></li>
      <li><a href="#tune2fs">tune2fs</a></li>
      <li><a href="#tune2fs-l">tune2fs-l</a></li>
      <li><a href="#txz-in">txz-in</a></li>
      <li><a href="#txz-out">txz-out</a></li>
      <li><a href="#umask">umask</a></li>
      <li><a href="#umount">umount</a></li>
      <li><a href="#unmount">unmount</a></li>
      <li><a href="#umount-opts">umount-opts</a></li>
      <li><a href="#umount-all">umount-all</a></li>
      <li><a href="#unmount-all">unmount-all</a></li>
      <li><a href="#umount-local">umount-local</a></li>
      <li><a href="#upload">upload</a></li>
      <li><a href="#upload-offset">upload-offset</a></li>
      <li><a href="#user-cancel">user-cancel</a></li>
      <li><a href="#utimens">utimens</a></li>
      <li><a href="#utsname">utsname</a></li>
      <li><a href="#version">version</a></li>
      <li><a href="#vfs-label">vfs-label</a></li>
      <li><a href="#vfs-type">vfs-type</a></li>
      <li><a href="#vfs-uuid">vfs-uuid</a></li>
      <li><a href="#get-uuid">get-uuid</a></li>
      <li><a href="#vg-activate">vg-activate</a></li>
      <li><a href="#vg-activate-all">vg-activate-all</a></li>
      <li><a href="#vgchange-uuid">vgchange-uuid</a></li>
      <li><a href="#vgchange-uuid-all">vgchange-uuid-all</a></li>
      <li><a href="#vgcreate">vgcreate</a></li>
      <li><a href="#vglvuuids">vglvuuids</a></li>
      <li><a href="#vgmeta">vgmeta</a></li>
      <li><a href="#vgpvuuids">vgpvuuids</a></li>
      <li><a href="#vgremove">vgremove</a></li>
      <li><a href="#vgrename">vgrename</a></li>
      <li><a href="#vgs">vgs</a></li>
      <li><a href="#vgs-full">vgs-full</a></li>
      <li><a href="#vgscan">vgscan</a></li>
      <li><a href="#vguuid">vguuid</a></li>
      <li><a href="#wc-c">wc-c</a></li>
      <li><a href="#wc-l">wc-l</a></li>
      <li><a href="#wc-w">wc-w</a></li>
      <li><a href="#wipefs">wipefs</a></li>
      <li><a href="#write">write</a></li>
      <li><a href="#write-append">write-append</a></li>
      <li><a href="#write-file">write-file</a></li>
      <li><a href="#xfs-admin">xfs-admin</a></li>
      <li><a href="#xfs-growfs">xfs-growfs</a></li>
      <li><a href="#xfs-info">xfs-info</a></li>
      <li><a href="#xfs-repair">xfs-repair</a></li>
      <li><a href="#zegrep">zegrep</a></li>
      <li><a href="#zegrepi">zegrepi</a></li>
      <li><a href="#zero">zero</a></li>
      <li><a href="#zero-device">zero-device</a></li>
      <li><a href="#zero-free-space">zero-free-space</a></li>
      <li><a href="#zerofree">zerofree</a></li>
      <li><a href="#zfgrep">zfgrep</a></li>
      <li><a href="#zfgrepi">zfgrepi</a></li>
      <li><a href="#zfile">zfile</a></li>
      <li><a href="#zgrep">zgrep</a></li>
      <li><a href="#zgrepi">zgrepi</a></li>
    </ul>
  </li>
  <li><a href="#exit-status">EXIT STATUS</a></li>
  <li><a href="#environment-variables">ENVIRONMENT VARIABLES</a></li>
  <li><a href="#files">FILES</a></li>
  <li><a href="#see-also">SEE ALSO</a></li>
  <li><a href="#authors">AUTHORS</a></li>
  <li><a href="#copyright">COPYRIGHT</a></li>
  <li><a href="#license">LICENSE</a></li>
  <li><a href="#bugs">BUGS</a></li>
</ul>

<h1 id="name">NAME</h1>

<p>guestfish - the guest filesystem shell</p>

<h1 id="synopsis">SYNOPSIS</h1>

<pre><code> guestfish [--options] [commands]

 guestfish

 guestfish [--ro|--rw] -a disk.img

 guestfish [--ro|--rw] -a disk.img -m dev[:mountpoint]

 guestfish -d libvirt-domain

 guestfish [--ro|--rw] -a disk.img -i

 guestfish -d libvirt-domain -i</code></pre>

<h1 id="warning">WARNING</h1>

<p>Using guestfish in read/write mode on live virtual machines can be dangerous, potentially causing disk corruption. Use the <i>--ro</i> (read-only) option to use guestfish safely if the disk image or virtual machine might be live.</p>

<h1 id="description">DESCRIPTION</h1>

<p>Guestfish is a shell and command-line tool for examining and modifying virtual machine filesystems. It uses libguestfs and exposes all of the functionality of the guestfs API, see <a href="guestfs.3.html">guestfs(3)</a>.</p>

<p>Guestfish gives you structured access to the libguestfs API, from shell scripts or the command line or interactively. If you want to rescue a broken virtual machine image, you should look at the <a href="virt-rescue.1.html">virt-rescue(1)</a> command.</p>

<h1 id="examples">EXAMPLES</h1>

<h2 id="as-an-interactive-shell">As an interactive shell</h2>

<pre><code> $ guestfish
 
 Welcome to guestfish, the guest filesystem shell for
 editing virtual machine filesystems.
 
 Type: &#39;help&#39; for a list of commands
       &#39;man&#39; to read the manual
       &#39;quit&#39; to quit the shell
 
 &gt;&lt;fs&gt; add-ro disk.img
 &gt;&lt;fs&gt; run
 &gt;&lt;fs&gt; list-filesystems
 /dev/sda1: ext4
 /dev/vg_guest/lv_root: ext4
 /dev/vg_guest/lv_swap: swap
 &gt;&lt;fs&gt; mount /dev/vg_guest/lv_root /
 &gt;&lt;fs&gt; cat /etc/fstab
 # /etc/fstab
 # Created by anaconda
 [...]
 &gt;&lt;fs&gt; exit</code></pre>

<h2 id="from-shell-scripts">From shell scripts</h2>

<p>Create a new <i>/etc/motd</i> file in a guest or disk image:</p>

<pre><code> guestfish &lt;&lt;_EOF_
 add disk.img
 run
 mount /dev/vg_guest/lv_root /
 write /etc/motd &quot;Welcome, new users&quot;
 _EOF_</code></pre>

<p>List the LVM logical volumes in a disk image:</p>

<pre><code> guestfish -a disk.img --ro &lt;&lt;_EOF_
 run
 lvs
 _EOF_</code></pre>

<p>List all the filesystems in a disk image:</p>

<pre><code> guestfish -a disk.img --ro &lt;&lt;_EOF_
 run
 list-filesystems
 _EOF_</code></pre>

<h2 id="on-one-command-line">On one command line</h2>

<p>Update <i>/etc/resolv.conf</i> in a guest:</p>

<pre><code> guestfish \
   add disk.img : run : mount /dev/vg_guest/lv_root / : \
   write /etc/resolv.conf &quot;nameserver 1.2.3.4&quot;</code></pre>

<p>Edit <i>/boot/grub/grub.conf</i> interactively:</p>

<pre><code> guestfish --rw --add disk.img \
   --mount /dev/vg_guest/lv_root \
   --mount /dev/sda1:/boot \
   edit /boot/grub/grub.conf</code></pre>

<h2 id="mount-disks-automatically">Mount disks automatically</h2>

<p>Use the <i>-i</i> option to automatically mount the disks from a virtual machine:</p>

<pre><code> guestfish --ro -a disk.img -i cat /etc/group

 guestfish --ro -d libvirt-domain -i cat /etc/group</code></pre>

<p>Another way to edit <i>/boot/grub/grub.conf</i> interactively is:</p>

<pre><code> guestfish --rw -a disk.img -i edit /boot/grub/grub.conf</code></pre>

<h2 id="as-a-script-interpreter">As a script interpreter</h2>

<p>Create a 100MB disk containing an ext2-formatted partition:</p>

<pre><code> #!/usr/bin/guestfish -f
 sparse test1.img 100M
 run
 part-disk /dev/sda mbr
 mkfs ext2 /dev/sda1</code></pre>

<h2 id="start-with-a-prepared-disk">Start with a prepared disk</h2>

<p>An alternate way to create a 100MB disk called <i>test1.img</i> containing a single ext2-formatted partition:</p>

<pre><code> guestfish -N fs</code></pre>

<p>To list what is available do:</p>

<pre><code> guestfish -N help | less</code></pre>

<h2 id="remote-drives">Remote drives</h2>

<p>Access a remote disk using ssh:</p>

<pre><code> guestfish -a ssh://example.com/path/to/disk.img</code></pre>

<h2 id="remote-control">Remote control</h2>

<pre><code> eval &quot;`guestfish --listen`&quot;
 guestfish --remote add-ro disk.img
 guestfish --remote run
 guestfish --remote lvs</code></pre>

<h1 id="options">OPTIONS</h1>

<dl>

<dt><b>--help</b></dt>
<dd>

<p>Displays general help on options.</p>

</dd>
<dt><b>-h</b></dt>
<dd>

</dd>
<dt><b>--cmd-help</b></dt>
<dd>

<p>Lists all available guestfish commands.</p>

</dd>
<dt><b>-h cmd</b></dt>
<dd>

</dd>
<dt><b>--cmd-help cmd</b></dt>
<dd>

<p>Displays detailed help on a single command <code>cmd</code>.</p>

</dd>
<dt><b>-a image</b></dt>
<dd>

</dd>
<dt><b>--add image</b></dt>
<dd>

<p>Add a block device or virtual machine image to the shell.</p>

<p>The format of the disk image is auto-detected. To override this and force a particular format use the <i>--format=..</i> option.</p>

<p>Using this flag is mostly equivalent to using the <code>add</code> command, with <code>readonly:true</code> if the <i>--ro</i> flag was given, and with <code>format:...</code> if the <i>--format=...</i> flag was given.</p>

</dd>
<dt><b>-a URI</b></dt>
<dd>

</dd>
<dt><b>--add URI</b></dt>
<dd>

<p>Add a remote disk. See <a href="#adding-remote-storage">&quot;ADDING REMOTE STORAGE&quot;</a>.</p>

</dd>
<dt><b>-c URI</b></dt>
<dd>

</dd>
<dt><b>--connect URI</b></dt>
<dd>

<p>When used in conjunction with the <i>-d</i> option, this specifies the libvirt URI to use. The default is to use the default libvirt connection.</p>

</dd>
<dt><b>--csh</b></dt>
<dd>

<p>If using the <i>--listen</i> option and a csh-like shell, use this option. See section <a href="#remote-control-and-csh">&quot;REMOTE CONTROL AND CSH&quot;</a> below.</p>

</dd>
<dt><b>-d libvirt-domain</b></dt>
<dd>

</dd>
<dt><b>--domain libvirt-domain</b></dt>
<dd>

<p>Add disks from the named libvirt domain. If the <i>--ro</i> option is also used, then any libvirt domain can be used. However in write mode, only libvirt domains which are shut down can be named here.</p>

<p>Domain UUIDs can be used instead of names.</p>

<p>Using this flag is mostly equivalent to using the <code>add-domain</code> command, with <code>readonly:true</code> if the <i>--ro</i> flag was given, and with <code>format:...</code> if the <i>--format=...</i> flag was given.</p>

</dd>
<dt><b>--echo-keys</b></dt>
<dd>

<p>When prompting for keys and passphrases, guestfish normally turns echoing off so you cannot see what you are typing. If you are not worried about Tempest attacks and there is no one else in the room you can specify this flag to see what you are typing.</p>

</dd>
<dt><b>-f file</b></dt>
<dd>

</dd>
<dt><b>--file file</b></dt>
<dd>

<p>Read commands from <code>file</code>. To write pure guestfish scripts, use:</p>

<pre><code> #!/usr/bin/guestfish -f</code></pre>

</dd>
<dt><b>--format=raw|qcow2|..</b></dt>
<dd>

</dd>
<dt><b>--format</b></dt>
<dd>

<p>The default for the <i>-a</i> option is to auto-detect the format of the disk image. Using this forces the disk format for <i>-a</i> options which follow on the command line. Using <i>--format</i> with no argument switches back to auto-detection for subsequent <i>-a</i> options.</p>

<p>For example:</p>

<pre><code> guestfish --format=raw -a disk.img</code></pre>

<p>forces raw format (no auto-detection) for <i>disk.img</i>.</p>

<pre><code> guestfish --format=raw -a disk.img --format -a another.img</code></pre>

<p>forces raw format (no auto-detection) for <i>disk.img</i> and reverts to auto-detection for <i>another.img</i>.</p>

<p>If you have untrusted raw-format guest disk images, you should use this option to specify the disk format. This avoids a possible security problem with malicious guests (CVE-2010-3851). See also <a href="#add">&quot;add&quot;</a>.</p>

</dd>
<dt><b>-i</b></dt>
<dd>

</dd>
<dt><b>--inspector</b></dt>
<dd>

<p>Using <a href="virt-inspector.1.html">virt-inspector(1)</a> code, inspect the disks looking for an operating system and mount filesystems as they would be mounted on the real virtual machine.</p>

<p>Typical usage is either:</p>

<pre><code> guestfish -d myguest -i</code></pre>

<p>(for an inactive libvirt domain called <i>myguest</i>), or:</p>

<pre><code> guestfish --ro -d myguest -i</code></pre>

<p>(for active domains, readonly), or specify the block device directly:</p>

<pre><code> guestfish --rw -a /dev/Guests/MyGuest -i</code></pre>

<p>Note that the command line syntax changed slightly over older versions of guestfish. You can still use the old syntax:</p>

<pre><code> guestfish [--ro] -i disk.img

 guestfish [--ro] -i libvirt-domain</code></pre>

<p>Using this flag is mostly equivalent to using the <code>inspect-os</code> command and then using other commands to mount the filesystems that were found.</p>

</dd>
<dt><b>--keys-from-stdin</b></dt>
<dd>

<p>Read key or passphrase parameters from stdin. The default is to try to read passphrases from the user by opening <i>/dev/tty</i>.</p>

</dd>
<dt><b>--listen</b></dt>
<dd>

<p>Fork into the background and listen for remote commands. See section <a href="#remote-control-guestfish-over-a-socket">&quot;REMOTE CONTROL GUESTFISH OVER A SOCKET&quot;</a> below.</p>

</dd>
<dt><b>--live</b></dt>
<dd>

<p>Connect to a live virtual machine. (Experimental, see <a href="guestfs.3.html#attaching-to-running-daemons">&quot;ATTACHING TO RUNNING DAEMONS&quot; in guestfs(3)</a>).</p>

</dd>
<dt><b>-m dev[:mountpoint[:options[:fstype]]]</b></dt>
<dd>

</dd>
<dt><b>--mount dev[:mountpoint[:options[:fstype]]]</b></dt>
<dd>

<p>Mount the named partition or logical volume on the given mountpoint.</p>

<p>If the mountpoint is omitted, it defaults to <i>/</i>.</p>

<p>You have to mount something on <i>/</i> before most commands will work.</p>

<p>If any <i>-m</i> or <i>--mount</i> options are given, the guest is automatically launched.</p>

<p>If you don&#39;t know what filesystems a disk image contains, you can either run guestfish without this option, then list the partitions, filesystems and LVs available (see <a href="#list-partitions">&quot;list-partitions&quot;</a>, <a href="#list-filesystems">&quot;list-filesystems&quot;</a> and <a href="#lvs">&quot;lvs&quot;</a> commands), or you can use the <a href="virt-filesystems.1.html">virt-filesystems(1)</a> program.</p>

<p>The third (and rarely used) part of the mount parameter is the list of mount options used to mount the underlying filesystem. If this is not given, then the mount options are either the empty string or <code>ro</code> (the latter if the <i>--ro</i> flag is used). By specifying the mount options, you override this default choice. Probably the only time you would use this is to enable ACLs and/or extended attributes if the filesystem can support them:</p>

<pre><code> -m /dev/sda1:/:acl,user_xattr</code></pre>

<p>Using this flag is equivalent to using the <code>mount-options</code> command.</p>

<p>The fourth part of the parameter is the filesystem driver to use, such as <code>ext3</code> or <code>ntfs</code>. This is rarely needed, but can be useful if multiple drivers are valid for a filesystem (eg: <code>ext2</code> and <code>ext3</code>), or if libguestfs misidentifies a filesystem.</p>

</dd>
<dt><b>--network</b></dt>
<dd>

<p>Enable QEMU user networking in the guest.</p>

</dd>
<dt><b>-N [filename=]type</b></dt>
<dd>

</dd>
<dt><b>--new [filename=]type</b></dt>
<dd>

</dd>
<dt><b>-N help</b></dt>
<dd>

<p>Prepare a fresh disk image formatted as &quot;type&quot;. This is an alternative to the <i>-a</i> option: whereas <i>-a</i> adds an existing disk, <i>-N</i> creates a preformatted disk with a filesystem and adds it. See <a href="#prepared-disk-images">&quot;PREPARED DISK IMAGES&quot;</a> below.</p>

</dd>
<dt><b>-n</b></dt>
<dd>

</dd>
<dt><b>--no-sync</b></dt>
<dd>

<p>Disable autosync. This is enabled by default. See the discussion of autosync in the <a href="guestfs.3.html">guestfs(3)</a> manpage.</p>

</dd>
<dt><b>--no-dest-paths</b></dt>
<dd>

<p>Don&#39;t tab-complete paths on the guest filesystem. It is useful to be able to hit the tab key to complete paths on the guest filesystem, but this causes extra &quot;hidden&quot; guestfs calls to be made, so this option is here to allow this feature to be disabled.</p>

</dd>
<dt><b>--pipe-error</b></dt>
<dd>

<p>If writes fail to pipe commands (see <a href="#pipes">&quot;PIPES&quot;</a> below), then the command returns an error.</p>

<p>The default (also for historical reasons) is to ignore such errors so that:</p>

<pre><code> &gt;&lt;fs&gt; command_with_lots_of_output | head</code></pre>

<p>doesn&#39;t give an error.</p>

</dd>
<dt><b>--progress-bars</b></dt>
<dd>

<p>Enable progress bars, even when guestfish is used non-interactively.</p>

<p>Progress bars are enabled by default when guestfish is used as an interactive shell.</p>

</dd>
<dt><b>--no-progress-bars</b></dt>
<dd>

<p>Disable progress bars.</p>

</dd>
<dt><b>--remote[=pid]</b></dt>
<dd>

<p>Send remote commands to <code>$GUESTFISH_PID</code> or <code>pid</code>. See section <a href="#remote-control-guestfish-over-a-socket">&quot;REMOTE CONTROL GUESTFISH OVER A SOCKET&quot;</a> below.</p>

</dd>
<dt><b>-r</b></dt>
<dd>

</dd>
<dt><b>--ro</b></dt>
<dd>

<p>This changes the <i>-a</i>, <i>-d</i> and <i>-m</i> options so that disks are added and mounts are done read-only.</p>

<p>The option must always be used if the disk image or virtual machine might be running, and is generally recommended in cases where you don&#39;t need write access to the disk.</p>

<p>Note that prepared disk images created with <i>-N</i> are not affected by this option. Also commands like <code>add</code> are not affected - you have to specify the <code>readonly:true</code> option explicitly if you need it.</p>

<p>See also <a href="#opening-disks-for-read-and-write">&quot;OPENING DISKS FOR READ AND WRITE&quot;</a> below.</p>

</dd>
<dt><b>--selinux</b></dt>
<dd>

<p>Enable SELinux support for the guest. See <a href="guestfs.3.html#selinux">&quot;SELINUX&quot; in guestfs(3)</a>.</p>

</dd>
<dt><b>-v</b></dt>
<dd>

</dd>
<dt><b>--verbose</b></dt>
<dd>

<p>Enable very verbose messages. This is particularly useful if you find a bug.</p>

</dd>
<dt><b>-V</b></dt>
<dd>

</dd>
<dt><b>--version</b></dt>
<dd>

<p>Display the guestfish / libguestfs version number and exit.</p>

</dd>
<dt><b>-w</b></dt>
<dd>

</dd>
<dt><b>--rw</b></dt>
<dd>

<p>This changes the <i>-a</i>, <i>-d</i> and <i>-m</i> options so that disks are added and mounts are done read-write.</p>

<p>See <a href="#opening-disks-for-read-and-write">&quot;OPENING DISKS FOR READ AND WRITE&quot;</a> below.</p>

</dd>
<dt><b>-x</b></dt>
<dd>

<p>Echo each command before executing it.</p>

</dd>
</dl>

<h1 id="commands-on-command-line">COMMANDS ON COMMAND LINE</h1>

<p>Any additional (non-option) arguments are treated as commands to execute.</p>

<p>Commands to execute should be separated by a colon (<code>:</code>), where the colon is a separate parameter. Thus:</p>

<pre><code> guestfish cmd [args...] : cmd [args...] : cmd [args...] ...</code></pre>

<p>If there are no additional arguments, then we enter a shell, either an interactive shell with a prompt (if the input is a terminal) or a non-interactive shell.</p>

<p>In either command line mode or non-interactive shell, the first command that gives an error causes the whole shell to exit. In interactive mode (with a prompt) if a command fails, you can continue to enter commands.</p>

<h1 id="using-launch-or-run-">USING launch (OR run)</h1>

<p>As with <a href="guestfs.3.html">guestfs(3)</a>, you must first configure your guest by adding disks, then launch it, then mount any disks you need, and finally issue actions/commands. So the general order of the day is:</p>

<ul>

<li><p>add or -a/--add</p>

</li>
<li><p>launch (aka run)</p>

</li>
<li><p>mount or -m/--mount</p>

</li>
<li><p>any other commands</p>

</li>
</ul>

<p><code>run</code> is a synonym for <code>launch</code>. You must <code>launch</code> (or <code>run</code>) your guest before mounting or performing any other commands.</p>

<p>The only exception is that if any of the <i>-i</i>, <i>-m</i>, <i>--mount</i>, <i>-N</i> or <i>--new</i> options were given then <code>run</code> is done automatically, simply because guestfish can&#39;t perform the action you asked for without doing this.</p>

<h1 id="opening-disks-for-read-and-write">OPENING DISKS FOR READ AND WRITE</h1>

<p>The guestfish, <a href="guestmount.1.html">guestmount(1)</a> and <a href="virt-rescue.1.html">virt-rescue(1)</a> options <i>--ro</i> and <i>--rw</i> affect whether the other command line options <i>-a</i>, <i>-c</i>, <i>-d</i>, <i>-i</i> and <i>-m</i> open disk images read-only or for writing.</p>

<p>In libguestfs &le; 1.10, guestfish, guestmount and virt-rescue defaulted to opening disk images supplied on the command line for write. To open a disk image read-only you have to do <i>-a image --ro</i>.</p>

<p>This matters: If you accidentally open a live VM disk image writable then you will cause irreversible disk corruption.</p>

<p>In a future libguestfs we intend to change the default the other way. Disk images will be opened read-only. You will have to either specify <i>guestfish --rw</i>, <i>guestmount --rw</i>, <i>virt-rescue --rw</i>, or change the configuration file in order to get write access for disk images specified by those other command line options.</p>

<p>This version of guestfish, guestmount and virt-rescue has a <i>--rw</i> option which does nothing (it is already the default). However it is highly recommended that you use this option to indicate that you need write access, and prepare your scripts for the day when this option will be required for write access.</p>

<p><b>Note:</b> This does <i>not</i> affect commands like <a href="#add">&quot;add&quot;</a> and <a href="#mount">&quot;mount&quot;</a>, or any other libguestfs program apart from guestfish and guestmount.</p>

<h1 id="quoting">QUOTING</h1>

<p>You can quote ordinary parameters using either single or double quotes. For example:</p>

<pre><code> add &quot;file with a space.img&quot;

 rm &#39;/file name&#39;

 rm &#39;/&quot;&#39;</code></pre>

<p>A few commands require a list of strings to be passed. For these, use a whitespace-separated list, enclosed in quotes. Strings containing whitespace to be passed through must be enclosed in single quotes. A literal single quote must be escaped with a backslash.</p>

<pre><code> vgcreate VG &quot;/dev/sda1 /dev/sdb1&quot;
 command &quot;/bin/echo &#39;foo      bar&#39;&quot;
 command &quot;/bin/echo \&#39;foo\&#39;&quot;</code></pre>

<h2 id="escape-sequences-in-double-quoted-arguments">ESCAPE SEQUENCES IN DOUBLE QUOTED ARGUMENTS</h2>

<p>In double-quoted arguments (only) use backslash to insert special characters:</p>

<dl>

<dt><code>\a</code></dt>
<dd>

<p>Alert (bell) character.</p>

</dd>
<dt><code>\b</code></dt>
<dd>

<p>Backspace character.</p>

</dd>
<dt><code>\f</code></dt>
<dd>

<p>Form feed character.</p>

</dd>
<dt><code>\n</code></dt>
<dd>

<p>Newline character.</p>

</dd>
<dt><code>\r</code></dt>
<dd>

<p>Carriage return character.</p>

</dd>
<dt><code>\t</code></dt>
<dd>

<p>Horizontal tab character.</p>

</dd>
<dt><code>\v</code></dt>
<dd>

<p>Vertical tab character.</p>

</dd>
<dt><code>\&quot;</code></dt>
<dd>

<p>A literal double quote character.</p>

</dd>
<dt><code>\ooo</code></dt>
<dd>

<p>A character with octal value <i>ooo</i>. There must be precisely 3 octal digits (unlike C).</p>

</dd>
<dt><code>\xhh</code></dt>
<dd>

<p>A character with hex value <i>hh</i>. There must be precisely 2 hex digits.</p>

<p>In the current implementation <code>\000</code> and <code>\x00</code> cannot be used in strings.</p>

</dd>
<dt><code>\\</code></dt>
<dd>

<p>A literal backslash character.</p>

</dd>
</dl>

<h1 id="optional-arguments">OPTIONAL ARGUMENTS</h1>

<p>Some commands take optional arguments. These arguments appear in this documentation as <code>[argname:..]</code>. You can use them as in these examples:</p>

<pre><code> add filename

 add filename readonly:true

 add filename format:qcow2 readonly:false</code></pre>

<p>Each optional argument can appear at most once. All optional arguments must appear after the required ones.</p>

<h1 id="numbers">NUMBERS</h1>

<p>This section applies to all commands which can take integers as parameters.</p>

<h2 id="size-suffix">SIZE SUFFIX</h2>

<p>When the command takes a parameter measured in bytes, you can use one of the following suffixes to specify kilobytes, megabytes and larger sizes:</p>

<dl>

<dt><b>k</b> or <b>K</b> or <b>KiB</b></dt>
<dd>

<p>The size in kilobytes (multiplied by 1024).</p>

</dd>
<dt><b>KB</b></dt>
<dd>

<p>The size in SI 1000 byte units.</p>

</dd>
<dt><b>M</b> or <b>MiB</b></dt>
<dd>

<p>The size in megabytes (multiplied by 1048576).</p>

</dd>
<dt><b>MB</b></dt>
<dd>

<p>The size in SI 1000000 byte units.</p>

</dd>
<dt><b>G</b> or <b>GiB</b></dt>
<dd>

<p>The size in gigabytes (multiplied by 2**30).</p>

</dd>
<dt><b>GB</b></dt>
<dd>

<p>The size in SI 10**9 byte units.</p>

</dd>
<dt><b>T</b> or <b>TiB</b></dt>
<dd>

<p>The size in terabytes (multiplied by 2**40).</p>

</dd>
<dt><b>TB</b></dt>
<dd>

<p>The size in SI 10**12 byte units.</p>

</dd>
<dt><b>P</b> or <b>PiB</b></dt>
<dd>

<p>The size in petabytes (multiplied by 2**50).</p>

</dd>
<dt><b>PB</b></dt>
<dd>

<p>The size in SI 10**15 byte units.</p>

</dd>
<dt><b>E</b> or <b>EiB</b></dt>
<dd>

<p>The size in exabytes (multiplied by 2**60).</p>

</dd>
<dt><b>EB</b></dt>
<dd>

<p>The size in SI 10**18 byte units.</p>

</dd>
<dt><b>Z</b> or <b>ZiB</b></dt>
<dd>

<p>The size in zettabytes (multiplied by 2**70).</p>

</dd>
<dt><b>ZB</b></dt>
<dd>

<p>The size in SI 10**21 byte units.</p>

</dd>
<dt><b>Y</b> or <b>YiB</b></dt>
<dd>

<p>The size in yottabytes (multiplied by 2**80).</p>

</dd>
<dt><b>YB</b></dt>
<dd>

<p>The size in SI 10**24 byte units.</p>

</dd>
</dl>

<p>For example:</p>

<pre><code> truncate-size /file 1G</code></pre>

<p>would truncate the file to 1 gigabyte.</p>

<p>Be careful because a few commands take sizes in kilobytes or megabytes (eg. the parameter to <a href="#memsize">&quot;memsize&quot;</a> is specified in megabytes already). Adding a suffix will probably not do what you expect.</p>

<h2 id="octal-and-hexadecimal-numbers">OCTAL AND HEXADECIMAL NUMBERS</h2>

<p>For specifying the radix (base) use the C convention: <code>0</code> to prefix an octal number or <code>0x</code> to prefix a hexadecimal number. For example:</p>

<pre><code> 1234      decimal number 1234
 02322     octal number, equivalent to decimal 1234
 0x4d2     hexadecimal number, equivalent to decimal 1234</code></pre>

<p>When using the <code>chmod</code> command, you almost always want to specify an octal number for the mode, and you must prefix it with <code>0</code> (unlike the Unix <a href="http://man.he.net/man1/chmod">chmod(1)</a> program):</p>

<pre><code> chmod 0777 /public  # OK
 chmod 777 /public   # WRONG! This is mode 777 decimal = 01411 octal.</code></pre>

<p>Commands that return numbers usually print them in decimal, but some commands print numbers in other radices (eg. <code>umask</code> prints the mode in octal, preceded by <code>0</code>).</p>

<h1 id="wildcards-and-globbing">WILDCARDS AND GLOBBING</h1>

<p>Neither guestfish nor the underlying guestfs API performs wildcard expansion (globbing) by default. So for example the following will not do what you expect:</p>

<pre><code> rm-rf /home/*</code></pre>

<p>Assuming you don&#39;t have a directory called literally <i>/home/*</i> then the above command will return an error.</p>

<p>To perform wildcard expansion, use the <code>glob</code> command.</p>

<pre><code> glob rm-rf /home/*</code></pre>

<p>runs <code>rm-rf</code> on each path that matches (ie. potentially running the command many times), equivalent to:</p>

<pre><code> rm-rf /home/jim
 rm-rf /home/joe
 rm-rf /home/mary</code></pre>

<p><code>glob</code> only works on simple guest paths and not on device names.</p>

<p>If you have several parameters, each containing a wildcard, then glob will perform a Cartesian product.</p>

<h1 id="comments">COMMENTS</h1>

<p>Any line which starts with a <i>#</i> character is treated as a comment and ignored. The <i>#</i> can optionally be preceded by whitespace, but <b>not</b> by a command. For example:</p>

<pre><code> # this is a comment
         # this is a comment
 foo # NOT a comment</code></pre>

<p>Blank lines are also ignored.</p>

<h1 id="running-commands-locally">RUNNING COMMANDS LOCALLY</h1>

<p>Any line which starts with a <i>!</i> character is treated as a command sent to the local shell (<i>/bin/sh</i> or whatever <a href="http://man.he.net/man3/system">system(3)</a> uses). For example:</p>

<pre><code> !mkdir local
 tgz-out /remote local/remote-data.tar.gz</code></pre>

<p>will create a directory <code>local</code> on the host, and then export the contents of <i>/remote</i> on the mounted filesystem to <i>local/remote-data.tar.gz</i>. (See <code>tgz-out</code>).</p>

<p>To change the local directory, use the <code>lcd</code> command. <code>!cd</code> will have no effect, due to the way that subprocesses work in Unix.</p>

<h2 id="local-commands-with-inline-execution">LOCAL COMMANDS WITH INLINE EXECUTION</h2>

<p>If a line starts with <i>&lt;!</i> then the shell command is executed (as for <i>!</i>), but subsequently any output (stdout) of the shell command is parsed and executed as guestfish commands.</p>

<p>Thus you can use shell script to construct arbitrary guestfish commands which are then parsed by guestfish.</p>

<p>For example it is tedious to create a sequence of files (eg. <i>/foo.1</i> through <i>/foo.100</i>) using guestfish commands alone. However this is simple if we use a shell script to create the guestfish commands for us:</p>

<pre><code> &lt;! for n in `seq 1 100`; do echo write /foo.$n $n; done</code></pre>

<p>or with names like <i>/foo.001</i>:</p>

<pre><code> &lt;! for n in `seq 1 100`; do printf &quot;write /foo.%03d %d\n&quot; $n $n; done</code></pre>

<p>When using guestfish interactively it can be helpful to just run the shell script first (ie. remove the initial <code>&lt;</code> character so it is just an ordinary <i>!</i> local command), see what guestfish commands it would run, and when you are happy with those prepend the <code>&lt;</code> character to run the guestfish commands for real.</p>

<h1 id="pipes">PIPES</h1>

<p>Use <code>command &lt;space&gt; | command</code> to pipe the output of the first command (a guestfish command) to the second command (any host command). For example:</p>

<pre><code> cat /etc/passwd | awk -F: &#39;$3 == 0 { print }&#39;</code></pre>

<p>(where <code>cat</code> is the guestfish cat command, but <code>awk</code> is the host awk program). The above command would list all accounts in the guest filesystem which have UID 0, ie. root accounts including backdoors. Other examples:</p>

<pre><code> hexdump /bin/ls | head
 list-devices | tail -1
 tgz-out / - | tar ztf -</code></pre>

<p>The space before the pipe symbol is required, any space after the pipe symbol is optional. Everything after the pipe symbol is just passed straight to the host shell, so it can contain redirections, globs and anything else that makes sense on the host side.</p>

<p>To use a literal argument which begins with a pipe symbol, you have to quote it, eg:</p>

<pre><code> echo &quot;|&quot;</code></pre>

<h1 id="home-directories">HOME DIRECTORIES</h1>

<p>If a parameter starts with the character <code>~</code> then the tilde may be expanded as a home directory path (either <code>~</code> for the current user&#39;s home directory, or <code>~user</code> for another user).</p>

<p>Note that home directory expansion happens for users known <i>on the host</i>, not in the guest filesystem.</p>

<p>To use a literal argument which begins with a tilde, you have to quote it, eg:</p>

<pre><code> echo &quot;~&quot;</code></pre>

<h1 id="encrypted-disks">ENCRYPTED DISKS</h1>

<p>Libguestfs has some support for Linux guests encrypted according to the Linux Unified Key Setup (LUKS) standard, which includes nearly all whole disk encryption systems used by modern Linux guests. Currently only LVM-on-LUKS is supported.</p>

<p>Identify encrypted block devices and partitions using <a href="#vfs-type">&quot;vfs-type&quot;</a>:</p>

<pre><code> &gt;&lt;fs&gt; vfs-type /dev/sda2
 crypto_LUKS</code></pre>

<p>Then open those devices using <a href="#luks-open">&quot;luks-open&quot;</a>. This creates a device-mapper device called <i>/dev/mapper/luksdev</i>.</p>

<pre><code> &gt;&lt;fs&gt; luks-open /dev/sda2 luksdev
 Enter key or passphrase (&quot;key&quot;): &lt;enter the passphrase&gt;</code></pre>

<p>Finally you have to tell LVM to scan for volume groups on the newly created mapper device:</p>

<pre><code> vgscan
 vg-activate-all true</code></pre>

<p>The logical volume(s) can now be mounted in the usual way.</p>

<p>Before closing a LUKS device you must unmount any logical volumes on it and deactivate the volume groups by calling <code>vg-activate false VG</code> on each one. Then you can close the mapper device:</p>

<pre><code> vg-activate false /dev/VG
 luks-close /dev/mapper/luksdev</code></pre>

<h1 id="windows-paths">WINDOWS PATHS</h1>

<p>If a path is prefixed with <code>win:</code> then you can use Windows-style drive letters and paths (with some limitations). The following commands are equivalent:</p>

<pre><code> file /WINDOWS/system32/config/system.LOG

 file win:\windows\system32\config\system.log

 file WIN:C:\Windows\SYSTEM32\CONFIG\SYSTEM.LOG</code></pre>

<p>The parameter is rewritten &quot;behind the scenes&quot; by looking up the position where the drive is mounted, prepending that to the path, changing all backslash characters to forward slash, then resolving the result using <a href="#case-sensitive-path">&quot;case-sensitive-path&quot;</a>. For example if the E: drive was mounted on <i>/e</i> then the parameter might be rewritten like this:</p>

<pre><code> win:e:\foo\bar =&gt; /e/FOO/bar</code></pre>

<p>This only works in argument positions that expect a path.</p>

<h1 id="uploading-and-downloading-files">UPLOADING AND DOWNLOADING FILES</h1>

<p>For commands such as <code>upload</code>, <code>download</code>, <code>tar-in</code>, <code>tar-out</code> and others which upload from or download to a local file, you can use the special filename <code>-</code> to mean &quot;from stdin&quot; or &quot;to stdout&quot;. For example:</p>

<pre><code> upload - /foo</code></pre>

<p>reads stdin and creates from that a file <i>/foo</i> in the disk image, and:</p>

<pre><code> tar-out /etc - | tar tf -</code></pre>

<p>writes the tarball to stdout and then pipes that into the external &quot;tar&quot; command (see <a href="#pipes">&quot;PIPES&quot;</a>).</p>

<p>When using <code>-</code> to read from stdin, the input is read up to the end of stdin. You can also use a special &quot;heredoc&quot;-like syntax to read up to some arbitrary end marker:</p>

<pre><code> upload -&lt;&lt;END /foo
 input line 1
 input line 2
 input line 3
 END</code></pre>

<p>Any string of characters can be used instead of <code>END</code>. The end marker must appear on a line of its own, without any preceding or following characters (not even spaces).</p>

<p>Note that the <code>-&lt;&lt;</code> syntax only applies to parameters used to upload local files (so-called &quot;FileIn&quot; parameters in the generator).</p>

<h1 id="exit-on-error-behaviour">EXIT ON ERROR BEHAVIOUR</h1>

<p>By default, guestfish will ignore any errors when in interactive mode (ie. taking commands from a human over a tty), and will exit on the first error in non-interactive mode (scripts, commands given on the command line).</p>

<p>If you prefix a command with a <i>-</i> character, then that command will not cause guestfish to exit, even if that (one) command returns an error.</p>

<h1 id="remote-control-guestfish-over-a-socket">REMOTE CONTROL GUESTFISH OVER A SOCKET</h1>

<p>Guestfish can be remote-controlled over a socket. This is useful particularly in shell scripts where you want to make several different changes to a filesystem, but you don&#39;t want the overhead of starting up a guestfish process each time.</p>

<p>Start a guestfish server process using:</p>

<pre><code> eval &quot;`guestfish --listen`&quot;</code></pre>

<p>and then send it commands by doing:</p>

<pre><code> guestfish --remote cmd [...]</code></pre>

<p>To cause the server to exit, send it the exit command:</p>

<pre><code> guestfish --remote exit</code></pre>

<p>Note that the server will normally exit if there is an error in a command. You can change this in the usual way. See section <a href="#exit-on-error-behaviour">&quot;EXIT ON ERROR BEHAVIOUR&quot;</a>.</p>

<h2 id="controlling-multiple-guestfish-processes">CONTROLLING MULTIPLE GUESTFISH PROCESSES</h2>

<p>The <code>eval</code> statement sets the environment variable <code>$GUESTFISH_PID</code>, which is how the <i>--remote</i> option knows where to send the commands. You can have several guestfish listener processes running using:</p>

<pre><code> eval &quot;`guestfish --listen`&quot;
 pid1=$GUESTFISH_PID
 eval &quot;`guestfish --listen`&quot;
 pid2=$GUESTFISH_PID
 ...
 guestfish --remote=$pid1 cmd
 guestfish --remote=$pid2 cmd</code></pre>

<h2 id="remote-control-and-csh">REMOTE CONTROL AND CSH</h2>

<p>When using csh-like shells (csh, tcsh etc) you have to add the <i>--csh</i> option:</p>

<pre><code> eval &quot;`guestfish --listen --csh`&quot;</code></pre>

<h2 id="remote-control-details">REMOTE CONTROL DETAILS</h2>

<p>Remote control happens over a Unix domain socket called <i>/tmp/.guestfish-$UID/socket-$PID</i>, where <code>$UID</code> is the effective user ID of the process, and <code>$PID</code> is the process ID of the server.</p>

<p>Guestfish client and server versions must match exactly.</p>

<p>Older versions of guestfish were vulnerable to CVE-2013-4419 (see <a href="guestfs.3.html#cve-2013-4419">&quot;CVE-2013-4419&quot; in guestfs(3)</a>). This is fixed in the current version.</p>

<h2 id="using-remote-control-robustly-from-shell-scripts">USING REMOTE CONTROL ROBUSTLY FROM SHELL SCRIPTS</h2>

<p>From Bash, you can use the following code which creates a guestfish instance, correctly quotes the command line, handles failure to start, and cleans up guestfish when the script exits:</p>

<pre><code> #!/bin/bash -
 
 set -e
 
 guestfish[0]=&quot;guestfish&quot;
 guestfish[1]=&quot;--listen&quot;
 guestfish[2]=&quot;--ro&quot;
 guestfish[3]=&quot;-a&quot;
 guestfish[4]=&quot;disk.img&quot;
 
 GUESTFISH_PID=
 eval $(&quot;${guestfish[@]}&quot;)
 if [ -z &quot;$GUESTFISH_PID&quot; ]; then
     echo &quot;error: guestfish didn&#39;t start up, see error messages above&quot;
     exit 1
 fi
 
 cleanup_guestfish ()
 {
     guestfish --remote -- exit &gt;/dev/null 2&gt;&amp;1 ||:
 }
 trap cleanup_guestfish EXIT ERR
 
 guestfish --remote -- run
 
 # ...</code></pre>

<h2 id="remote-control-does-not-work-with--a-etc.-options">REMOTE CONTROL DOES NOT WORK WITH <i>-a</i> ETC. OPTIONS</h2>

<p>Options such as <i>-a</i>, <i>--add</i>, <i>-N</i>, <i>--new</i> etc don&#39;t interact properly with remote support. They are processed locally, and not sent through to the remote guestfish. In particular this won&#39;t do what you expect:</p>

<pre><code> guestfish --remote --add disk.img</code></pre>

<p>Don&#39;t use these options. Use the equivalent commands instead, eg:</p>

<pre><code> guestfish --remote add-drive disk.img</code></pre>

<p>or:</p>

<pre><code> guestfish --remote
 &gt;&lt;fs&gt; add disk.img</code></pre>

<h2 id="remote-control-run-command-hanging">REMOTE CONTROL RUN COMMAND HANGING</h2>

<p>Using the <code>run</code> (or <code>launch</code>) command remotely in a command substitution context hangs, ie. don&#39;t do (note the backquotes):</p>

<pre><code> a=`guestfish --remote run`</code></pre>

<p>Since the <code>run</code> command produces no output on stdout, this is not useful anyway. For further information see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=592910">https://bugzilla.redhat.com/show_bug.cgi?id=592910</a>.</p>

<h1 id="prepared-disk-images">PREPARED DISK IMAGES</h1>

<p>Use the <i>-N [filename=]type</i> or <i>--new [filename=]type</i> parameter to select one of a set of preformatted disk images that guestfish can make for you to save typing. This is particularly useful for testing purposes. This option is used instead of the <i>-a</i> option, and like <i>-a</i> can appear multiple times (and can be mixed with <i>-a</i>).</p>

<p>The new disk is called <i>test1.img</i> for the first <i>-N</i>, <i>test2.img</i> for the second and so on. Existing files in the current directory are <i>overwritten</i>. You can use a different filename by specifying <code>filename=</code> before the type (see examples below).</p>

<p>The type briefly describes how the disk should be sized, partitioned, how filesystem(s) should be created, and how content should be added. Optionally the type can be followed by extra parameters, separated by <code>:</code> (colon) characters. For example, <i>-N fs</i> creates a default 100MB, sparsely-allocated disk, containing a single partition, with the partition formatted as ext2. <i>-N fs:ext4:1G</i> is the same, but for an ext4 filesystem on a 1GB disk instead.</p>

<p>Note that the prepared filesystem is not mounted. You would usually have to use the <code>mount /dev/sda1 /</code> command or add the <i>-m /dev/sda1</i> option.</p>

<p>If any <i>-N</i> or <i>--new</i> options are given, the libguestfs appliance is automatically launched.</p>

<h2 id="examples1">EXAMPLES</h2>

<p>Create a 100MB disk with an ext4-formatted partition, called <i>test1.img</i> in the current directory:</p>

<pre><code> guestfish -N fs:ext4</code></pre>

<p>Create a 32MB disk with a VFAT-formatted partition, and mount it:</p>

<pre><code> guestfish -N fs:vfat:32M -m /dev/sda1</code></pre>

<p>Create a blank 200MB disk:</p>

<pre><code> guestfish -N disk:200M</code></pre>

<p>Create a blank 200MB disk called <i>blankdisk.img</i> (instead of <i>test1.img</i>):</p>

<pre><code> guestfish -N blankdisk.img=disk:200M</code></pre>

<h2 id="n-disk---create-a-blank-disk"><b>-N disk</b> - create a blank disk</h2>

<p><code>guestfish -N [<i>filename</i>=]disk[:<i>size</i>]</code></p>

<p>Create a blank disk, size 100MB (by default).</p>

<p>The default size can be changed by supplying an optional parameter.</p>

<p>The optional parameters are:</p>

<pre><code> Name          Default value
 size          100M          the size of the disk image</code></pre>

<h2 id="n-part---create-a-partitioned-disk"><b>-N part</b> - create a partitioned disk</h2>

<p><code>guestfish -N [<i>filename</i>=]part[:<i>size</i>[:<i>partition</i>]]</code></p>

<p>Create a disk with a single partition. By default the size of the disk is 100MB (the available space in the partition will be a tiny bit smaller) and the partition table will be MBR (old DOS-style).</p>

<p>These defaults can be changed by supplying optional parameters.</p>

<p>The optional parameters are:</p>

<pre><code> Name          Default value
 size          100M          the size of the disk image
 partition     mbr           partition table type</code></pre>

<h2 id="n-fs---create-a-filesystem"><b>-N fs</b> - create a filesystem</h2>

<p><code>guestfish -N [<i>filename</i>=]fs[:<i>filesystem</i>[:<i>size</i>[:<i>partition</i>]]]</code></p>

<p>Create a disk with a single partition, with the partition containing an empty filesystem. This defaults to creating a 100MB disk (the available space in the filesystem will be a tiny bit smaller) with an MBR (old DOS-style) partition table and an ext2 filesystem.</p>

<p>These defaults can be changed by supplying optional parameters.</p>

<p>The optional parameters are:</p>

<pre><code> Name          Default value
 filesystem    ext2          the type of filesystem to use
 size          100M          the size of the disk image
 partition     mbr           partition table type</code></pre>

<h2 id="n-lv---create-a-disk-with-logical-volume"><b>-N lv</b> - create a disk with logical volume</h2>

<p><code>guestfish -N [<i>filename</i>=]lv[:<i>name</i>[:<i>size</i>[:<i>partition</i>]]]</code></p>

<p>Create a disk with a single partition, set up the partition as an LVM2 physical volume, and place a volume group and logical volume on there. This defaults to creating a 100MB disk with the VG and LV called <code>/dev/VG/LV</code>. You can change the name of the VG and LV by supplying an alternate name as the first optional parameter.</p>

<p>Note this does not create a filesystem. Use &#39;lvfs&#39; to do that.</p>

<p>The optional parameters are:</p>

<pre><code> Name          Default value
 name          /dev/VG/LV    the name of the VG and LV to use
 size          100M          the size of the disk image
 partition     mbr           partition table type</code></pre>

<h2 id="n-lvfs---create-a-disk-with-logical-volume-and-filesystem"><b>-N lvfs</b> - create a disk with logical volume and filesystem</h2>

<p><code>guestfish -N [<i>filename</i>=]lvfs[:<i>name</i>[:<i>filesystem</i>[:<i>size</i>[:<i>partition</i>]]]]</code></p>

<p>Create a disk with a single partition, set up the partition as an LVM2 physical volume, and place a volume group and logical volume on there. Then format the LV with a filesystem. This defaults to creating a 100MB disk with the VG and LV called <code>/dev/VG/LV</code>, with an ext2 filesystem.</p>

<p>The optional parameters are:</p>

<pre><code> Name          Default value
 name          /dev/VG/LV    the name of the VG and LV to use
 filesystem    ext2          the type of filesystem to use
 size          100M          the size of the disk image
 partition     mbr           partition table type</code></pre>

<h2 id="n-bootroot---create-a-boot-and-root-filesystem"><b>-N bootroot</b> - create a boot and root filesystem</h2>

<p><code>guestfish -N [<i>filename</i>=]bootroot[:<i>bootfs</i>[:<i>rootfs</i>[:<i>size</i>[:<i>bootsize</i>[:<i>partition</i>]]]]]</code></p>

<p>Create a disk with two partitions, for boot and root filesystem. Format the two filesystems independently. There are several optional parameters which control the exact layout and filesystem types.</p>

<p>The optional parameters are:</p>

<pre><code> Name          Default value
 bootfs        ext2          the type of filesystem to use for boot
 rootfs        ext2          the type of filesystem to use for root
 size          100M          the size of the disk image
 bootsize      32M           the size of the boot filesystem
 partition     mbr           partition table type</code></pre>

<h2 id="n-bootrootlv---create-a-boot-and-root-filesystem-using-lvm"><b>-N bootrootlv</b> - create a boot and root filesystem using LVM</h2>

<p><code>guestfish -N [<i>filename</i>=]bootrootlv[:<i>name</i>[:<i>bootfs</i>[:<i>rootfs</i>[:<i>size</i>[:<i>bootsize</i>[:<i>partition</i>]]]]]]</code></p>

<p>This is the same as <code>bootroot</code> but the root filesystem (only) is placed on a logical volume, named by default <code>/dev/VG/LV</code>. There are several optional parameters which control the exact layout.</p>

<p>The optional parameters are:</p>

<pre><code> Name          Default value
 name          /dev/VG/LV    the name of the VG and LV for root
 bootfs        ext2          the type of filesystem to use for boot
 rootfs        ext2          the type of filesystem to use for root
 size          100M          the size of the disk image
 bootsize      32M           the size of the boot filesystem
 partition     mbr           partition table type</code></pre>

<h1 id="adding-remote-storage">ADDING REMOTE STORAGE</h1>

<p><i>For API-level documentation on this topic, see <a href="guestfs.3.html#guestfs_add_drive_opts">&quot;guestfs_add_drive_opts&quot; in guestfs(3)</a> and <a href="guestfs.3.html#remote-storage">&quot;REMOTE STORAGE&quot; in guestfs(3)</a></i>.</p>

<p>On the command line, you can use the <i>-a</i> option to add network block devices using a URI-style format, for example:</p>

<pre><code> guestfish -a ssh://root@example.com/disk.img</code></pre>

<p>URIs <i>cannot</i> be used with the <a href="#add">&quot;add&quot;</a> command. The equivalent command using the API directly is:</p>

<pre><code> &gt;&lt;fs&gt; add /disk.img protocol:ssh server:tcp:example.com username:root</code></pre>

<p>The possible <i>-a URI</i> formats are described below.</p>

<h2 id="a-disk.img"><b>-a disk.img</b></h2>

<h2 id="a-file:-path-to-disk.img"><b>-a file:///path/to/disk.img</b></h2>

<p>Add the local disk image (or device) called <i>disk.img</i>.</p>

<h2 id="a-ftp:-user-example.com-:port-disk.img"><b>-a ftp://[user@]example.com[:port]/disk.img</b></h2>

<h2 id="a-ftps:-user-example.com-:port-disk.img"><b>-a ftps://[user@]example.com[:port]/disk.img</b></h2>

<h2 id="a-http:-user-example.com-:port-disk.img"><b>-a http://[user@]example.com[:port]/disk.img</b></h2>

<h2 id="a-https:-user-example.com-:port-disk.img"><b>-a https://[user@]example.com[:port]/disk.img</b></h2>

<h2 id="a-tftp:-user-example.com-:port-disk.img"><b>-a tftp://[user@]example.com[:port]/disk.img</b></h2>

<p>Add a disk located on a remote FTP, HTTP or TFTP server.</p>

<p>The equivalent API command would be:</p>

<pre><code> &gt;&lt;fs&gt; add /disk.img protocol:(ftp|...) server:tcp:example.com</code></pre>

<h2 id="a-gluster:-example.com-:port-volname-image"><b>-a gluster://example.com[:port]/volname/image</b></h2>

<p>Add a disk image located on GlusterFS storage.</p>

<p>The server is the one running <code>glusterd</code>, and may be <code>localhost</code>.</p>

<p>The equivalent API command would be:</p>

<pre><code> &gt;&lt;fs&gt; add volname/image protocol:gluster server:tcp:example.com</code></pre>

<h2 id="a-iscsi:-example.com-:port-target-iqn-name-lun-"><b>-a iscsi://example.com[:port]/target-iqn-name[/lun]</b></h2>

<p>Add a disk located on an iSCSI server.</p>

<p>The equivalent API command would be:</p>

<pre><code> &gt;&lt;fs&gt; add target-iqn-name/lun protocol:iscsi server:tcp:example.com</code></pre>

<h2 id="a-nbd:-example.com-:port-"><b>-a nbd://example.com[:port]</b></h2>

<h2 id="a-nbd:-example.com-:port-exportname"><b>-a nbd://example.com[:port]/exportname</b></h2>

<h2 id="a-nbd:-socket-socket"><b>-a nbd://?socket=/socket</b></h2>

<h2 id="a-nbd:-exportname-socket-socket"><b>-a nbd:///exportname?socket=/socket</b></h2>

<p>Add a disk located on Network Block Device (nbd) storage.</p>

<p>The <i>/exportname</i> part of the URI specifies an NBD export name, but is usually left empty.</p>

<p>The optional <i>?socket</i> parameter can be used to specify a Unix domain socket that we talk to the NBD server over. Note that you cannot mix server name (ie. TCP/IP) and socket path.</p>

<p>The equivalent API command would be (no export name):</p>

<pre><code> &gt;&lt;fs&gt; add &quot;&quot; protocol:nbd server:[tcp:example.com|unix:/socket]</code></pre>

<h2 id="a-rbd:-pool-disk"><b>-a rbd:///pool/disk</b></h2>

<h2 id="a-rbd:-example.com-:port-pool-disk"><b>-a rbd://example.com[:port]/pool/disk</b></h2>

<p>Add a disk image located on a Ceph (RBD/librbd) storage volume.</p>

<p>Although libguestfs and Ceph supports multiple servers, only a single server can be specified when using this URI syntax.</p>

<p>The equivalent API command would be:</p>

<pre><code> &gt;&lt;fs&gt; add pool/disk protocol:rbd server:tcp:example.com:port</code></pre>

<h2 id="a-sheepdog:-example.com-:port-volume-image"><b>-a sheepdog://[example.com[:port]]/volume/image</b></h2>

<p>Add a disk image located on a Sheepdog volume.</p>

<p>The server name is optional. Although libguestfs and Sheepdog supports multiple servers, only at most one server can be specified when using this URI syntax.</p>

<p>The equivalent API command would be:</p>

<pre><code> &gt;&lt;fs&gt; add volume protocol:sheepdog [server:tcp:example.com]</code></pre>

<h2 id="a-ssh:-user-example.com-:port-disk.img"><b>-a ssh://[user@]example.com[:port]/disk.img</b></h2>

<p>Add a disk image located on a remote server, accessed using the Secure Shell (ssh) SFTP protocol. SFTP is supported out of the box by all major SSH servers.</p>

<p>The equivalent API command would be:</p>

<pre><code> &gt;&lt;fs&gt; add /disk protocol:ssh server:tcp:example.com [username:user]</code></pre>

<h1 id="progress-bars">PROGRESS BARS</h1>

<p>Some (not all) long-running commands send progress notification messages as they are running. Guestfish turns these messages into progress bars.</p>

<p>When a command that supports progress bars takes longer than two seconds to run, and if progress bars are enabled, then you will see one appearing below the command:</p>

<pre><code> &gt;&lt;fs&gt; copy-size /large-file /another-file 2048M
 / 10% [#####-----------------------------------------] 00:30</code></pre>

<p>The spinner on the left hand side moves round once for every progress notification received from the backend. This is a (reasonably) golden assurance that the command is &quot;doing something&quot; even if the progress bar is not moving, because the command is able to send the progress notifications. When the bar reaches 100% and the command finishes, the spinner disappears.</p>

<p>Progress bars are enabled by default when guestfish is used interactively. You can enable them even for non-interactive modes using <i>--progress-bars</i>, and you can disable them completely using <i>--no-progress-bars</i>.</p>

<h1 id="prompt">PROMPT</h1>

<p>You can change or add colours to the default prompt (<code>&gt;&lt;fs&gt;</code>) by setting the <code>GUESTFISH_PS1</code> environment variable. A second string (<code>GUESTFISH_OUTPUT</code>) is printed after the command has been entered and before the output, allowing you to control the colour of the output. A third string (<code>GUESTFISH_INIT</code>) is printed before the welcome message, allowing you to control the colour of that message. A fourth string (<code>GUESTFISH_RESTORE</code>) is printed before guestfish exits.</p>

<p>A simple prompt can be set by setting <code>GUESTFISH_PS1</code> to an alternate string:</p>

<pre><code> $ GUESTFISH_PS1=&#39;(type a command) &#39;
 $ export GUESTFISH_PS1
 $ guestfish
 [...]
 (type a command) &#x2582;</code></pre>

<p>You can also use special escape sequences, as described in the table below:</p>

<dl>

<dt>\\</dt>
<dd>

<p>A literal backslash character.</p>

</dd>
<dt>\[</dt>
<dd>

</dd>
<dt>\]</dt>
<dd>

<p>(These should only be used in <code>GUESTFISH_PS1</code>.)</p>

<p>Place non-printing characters (eg. terminal control codes for colours) between <code>\[...\]</code>. What this does it to tell the <a href="http://man.he.net/man3/readline">readline(3)</a> library that it should treat this subsequence as zero-width, so that command-line redisplay, editing etc works.</p>

</dd>
<dt>\a</dt>
<dd>

<p>A bell character.</p>

</dd>
<dt>\e</dt>
<dd>

<p>An ASCII ESC (escape) character.</p>

</dd>
<dt>\n</dt>
<dd>

<p>A newline.</p>

</dd>
<dt>\r</dt>
<dd>

<p>A carriage return.</p>

</dd>
<dt>\NNN</dt>
<dd>

<p>The ASCII character whose code is the octal value NNN.</p>

</dd>
<dt>\xNN</dt>
<dd>

<p>The ASCII character whose code is the hex value NN.</p>

</dd>
</dl>

<h2 id="examples-of-prompts">EXAMPLES OF PROMPTS</h2>

<p>Note these these require a terminal that supports ANSI escape codes.</p>

<ul>

<li><p></p>

<pre><code> GUESTFISH_PS1=&#39;\[\e[1;30m\]&gt;&lt;fs&gt;\[\e[0;30m\] &#39;</code></pre>

<p>A bold black version of the ordinary prompt.</p>

</li>
<li><p></p>

<pre><code> GUESTFISH_PS1=&#39;\[\e[1;32m\]&gt;&lt;fs&gt;\[\e[0;31m\] &#39;
 GUESTFISH_OUTPUT=&#39;\e[0m&#39;
 GUESTFISH_RESTORE=&quot;$GUESTFISH_OUTPUT&quot;
 GUESTFISH_INIT=&#39;\e[1;34m&#39;</code></pre>

<p>Blue welcome text, green prompt, red commands, black command output.</p>

</li>
</ul>

<h1 id="windows-8">WINDOWS 8</h1>

<p>Windows 8 &quot;fast startup&quot; can prevent guestfish from mounting NTFS partitions. See <a href="guestfs.3.html#windows-hibernation-and-windows-8-fast-startup">&quot;WINDOWS HIBERNATION AND WINDOWS 8 FAST STARTUP&quot; in guestfs(3)</a>.</p>

<h1 id="guestfish-commands">GUESTFISH COMMANDS</h1>

<p>The commands in this section are guestfish convenience commands, in other words, they are not part of the <a href="guestfs.3.html">guestfs(3)</a> API.</p>

<h2 id="help">help</h2>

<pre><code> help
 help cmd</code></pre>

<p>Without any parameter, this provides general help.</p>

<p>With a <code>cmd</code> parameter, this displays detailed help for that command.</p>

<h2 id="exit">exit</h2>

<h2 id="quit">quit</h2>

<p>This exits guestfish. You can also use <code>^D</code> key.</p>

<h2 id="alloc">alloc</h2>

<h2 id="allocate">allocate</h2>

<pre><code> alloc filename size</code></pre>

<p>This creates an empty (zeroed) file of the given size, and then adds so it can be further examined.</p>

<p>For more advanced image creation, see <a href="#disk-create">&quot;disk-create&quot;</a>.</p>

<p>Size can be specified using standard suffixes, eg. <code>1M</code>.</p>

<p>To create a sparse file, use <a href="#sparse">&quot;sparse&quot;</a> instead. To create a prepared disk image, see <a href="#prepared-disk-images">&quot;PREPARED DISK IMAGES&quot;</a>.</p>

<h2 id="copy-in">copy-in</h2>

<pre><code> copy-in local [local ...] /remotedir</code></pre>

<p><code>copy-in</code> copies local files or directories recursively into the disk image, placing them in the directory called <i>/remotedir</i> (which must exist). This guestfish meta-command turns into a sequence of <a href="#tar-in">&quot;tar-in&quot;</a> and other commands as necessary.</p>

<p>Multiple local files and directories can be specified, but the last parameter must always be a remote directory. Wildcards cannot be used.</p>

<h2 id="copy-out">copy-out</h2>

<pre><code> copy-out remote [remote ...] localdir</code></pre>

<p><code>copy-out</code> copies remote files or directories recursively out of the disk image, placing them on the host disk in a local directory called <code>localdir</code> (which must exist). This guestfish meta-command turns into a sequence of <a href="#download">&quot;download&quot;</a>, <a href="#tar-out">&quot;tar-out&quot;</a> and other commands as necessary.</p>

<p>Multiple remote files and directories can be specified, but the last parameter must always be a local directory. To download to the current directory, use <code>.</code> as in:</p>

<pre><code> copy-out /home .</code></pre>

<p>Wildcards cannot be used in the ordinary command, but you can use them with the help of <a href="#glob">&quot;glob&quot;</a> like this:</p>

<pre><code> glob copy-out /home/* .</code></pre>

<h2 id="delete-event">delete-event</h2>

<pre><code> delete-event name</code></pre>

<p>Delete the event handler which was previously registered as <code>name</code>. If multiple event handlers were registered with the same name, they are all deleted.</p>

<p>See also the guestfish commands <code>event</code> and <code>list-events</code>.</p>

<h2 id="display">display</h2>

<pre><code> display filename</code></pre>

<p>Use <code>display</code> (a graphical display program) to display an image file. It downloads the file, and runs <code>display</code> on it.</p>

<p>To use an alternative program, set the <code>GUESTFISH_DISPLAY_IMAGE</code> environment variable. For example to use the GNOME display program:</p>

<pre><code> export GUESTFISH_DISPLAY_IMAGE=eog</code></pre>

<p>See also <a href="http://man.he.net/man1/display">display(1)</a>.</p>

<h2 id="echo">echo</h2>

<pre><code> echo [params ...]</code></pre>

<p>This echos the parameters to the terminal.</p>

<h2 id="edit">edit</h2>

<h2 id="vi">vi</h2>

<h2 id="emacs">emacs</h2>

<pre><code> edit filename</code></pre>

<p>This is used to edit a file. It downloads the file, edits it locally using your editor, then uploads the result.</p>

<p>The editor is <code>$EDITOR</code>. However if you use the alternate commands <code>vi</code> or <code>emacs</code> you will get those corresponding editors.</p>

<h2 id="event">event</h2>

<pre><code> event name eventset &quot;shell script ...&quot;</code></pre>

<p>Register a shell script fragment which is executed when an event is raised. See <a href="guestfs.3.html#guestfs_set_event_callback">&quot;guestfs_set_event_callback&quot; in guestfs(3)</a> for a discussion of the event API in libguestfs.</p>

<p>The <code>name</code> parameter is a name that you give to this event handler. It can be any string (even the empty string) and is simply there so you can delete the handler using the guestfish <code>delete-event</code> command.</p>

<p>The <code>eventset</code> parameter is a comma-separated list of one or more events, for example <code>close</code> or <code>close,trace</code>. The special value <code>*</code> means all events.</p>

<p>The third and final parameter is the shell script fragment (or any external command) that is executed when any of the events in the eventset occurs. It is executed using <code>$SHELL -c</code>, or if <code>$SHELL</code> is not set then <i>/bin/sh -c</i>.</p>

<p>The shell script fragment receives callback parameters as arguments <code>$1</code>, <code>$2</code> etc. The actual event that was called is available in the environment variable <code>$EVENT</code>.</p>

<pre><code> event &quot;&quot; close &quot;echo closed&quot;
 event messages appliance,library,trace &quot;echo $@&quot;
 event &quot;&quot; progress &quot;echo progress: $3/$4&quot;
 event &quot;&quot; * &quot;echo $EVENT $@&quot;</code></pre>

<p>See also the guestfish commands <code>delete-event</code> and <code>list-events</code>.</p>

<h2 id="glob">glob</h2>

<pre><code> glob command args...</code></pre>

<p>Expand wildcards in any paths in the args list, and run <code>command</code> repeatedly on each matching path.</p>

<p>See <a href="#wildcards-and-globbing">&quot;WILDCARDS AND GLOBBING&quot;</a>.</p>

<h2 id="hexedit">hexedit</h2>

<pre><code> hexedit &lt;filename|device&gt;
 hexedit &lt;filename|device&gt; &lt;max&gt;
 hexedit &lt;filename|device&gt; &lt;start&gt; &lt;max&gt;</code></pre>

<p>Use hexedit (a hex editor) to edit all or part of a binary file or block device.</p>

<p>This command works by downloading potentially the whole file or device, editing it locally, then uploading it. If the file or device is large, you have to specify which part you wish to edit by using <code>max</code> and/or <code>start</code> <code>max</code> parameters. <code>start</code> and <code>max</code> are specified in bytes, with the usual modifiers allowed such as <code>1M</code> (1 megabyte).</p>

<p>For example to edit the first few sectors of a disk you might do:</p>

<pre><code> hexedit /dev/sda 1M</code></pre>

<p>which would allow you to edit anywhere within the first megabyte of the disk.</p>

<p>To edit the superblock of an ext2 filesystem on <i>/dev/sda1</i>, do:</p>

<pre><code> hexedit /dev/sda1 0x400 0x400</code></pre>

<p>(assuming the superblock is in the standard location).</p>

<p>This command requires the external <a href="http://man.he.net/man1/hexedit">hexedit(1)</a> program. You can specify another program to use by setting the <code>HEXEDITOR</code> environment variable.</p>

<p>See also <a href="#hexdump">&quot;hexdump&quot;</a>.</p>

<h2 id="lcd">lcd</h2>

<pre><code> lcd directory</code></pre>

<p>Change the local directory, ie. the current directory of guestfish itself.</p>

<p>Note that <code>!cd</code> won&#39;t do what you might expect.</p>

<h2 id="list-events">list-events</h2>

<pre><code> list-events</code></pre>

<p>List the event handlers registered using the guestfish <code>event</code> command.</p>

<h2 id="man">man</h2>

<h2 id="manual">manual</h2>

<pre><code>  man</code></pre>

<p>Opens the manual page for guestfish.</p>

<h2 id="more">more</h2>

<h2 id="less">less</h2>

<pre><code> more filename

 less filename</code></pre>

<p>This is used to view a file.</p>

<p>The default viewer is <code>$PAGER</code>. However if you use the alternate command <code>less</code> you will get the <code>less</code> command specifically.</p>

<h2 id="reopen">reopen</h2>

<pre><code>  reopen</code></pre>

<p>Close and reopen the libguestfs handle. It is not necessary to use this normally, because the handle is closed properly when guestfish exits. However this is occasionally useful for testing.</p>

<h2 id="setenv">setenv</h2>

<pre><code>  setenv VAR value</code></pre>

<p>Set the environment variable <code>VAR</code> to the string <code>value</code>.</p>

<p>To print the value of an environment variable use a shell command such as:</p>

<pre><code> !echo $VAR</code></pre>

<h2 id="sparse">sparse</h2>

<pre><code> sparse filename size</code></pre>

<p>This creates an empty sparse file of the given size, and then adds so it can be further examined.</p>

<p>In all respects it works the same as the <a href="#alloc">&quot;alloc&quot;</a> command, except that the image file is allocated sparsely, which means that disk blocks are not assigned to the file until they are needed. Sparse disk files only use space when written to, but they are slower and there is a danger you could run out of real disk space during a write operation.</p>

<p>For more advanced image creation, see <a href="#disk-create">&quot;disk-create&quot;</a>.</p>

<p>Size can be specified using standard suffixes, eg. <code>1M</code>.</p>

<p>See also the guestfish <a href="#scratch">&quot;scratch&quot;</a> command.</p>

<h2 id="supported">supported</h2>

<pre><code> supported</code></pre>

<p>This command returns a list of the optional groups known to the daemon, and indicates which ones are supported by this build of the libguestfs appliance.</p>

<p>See also <a href="guestfs.3.html#availability">&quot;AVAILABILITY&quot; in guestfs(3)</a>.</p>

<h2 id="time">time</h2>

<pre><code> time command args...</code></pre>

<p>Run the command as usual, but print the elapsed time afterwards. This can be useful for benchmarking operations.</p>

<h2 id="unsetenv">unsetenv</h2>

<pre><code>  unsetenv VAR</code></pre>

<p>Remove <code>VAR</code> from the environment.</p>

<h1 id="commands">COMMANDS</h1>

<h2 id="acl-delete-def-file">acl-delete-def-file</h2>

<pre><code> acl-delete-def-file dir</code></pre>

<p>This function deletes the default POSIX Access Control List (ACL) attached to directory <code>dir</code>.</p>

<h2 id="acl-get-file">acl-get-file</h2>

<pre><code> acl-get-file path acltype</code></pre>

<p>This function returns the POSIX Access Control List (ACL) attached to <code>path</code>. The ACL is returned in &quot;long text form&quot; (see <a href="http://man.he.net/man5/acl">acl(5)</a>).</p>

<p>The <code>acltype</code> parameter may be:</p>

<dl>

<dt><code>access</code></dt>
<dd>

<p>Return the ordinary (access) ACL for any file, directory or other filesystem object.</p>

</dd>
<dt><code>default</code></dt>
<dd>

<p>Return the default ACL. Normally this only makes sense if <code>path</code> is a directory.</p>

</dd>
</dl>

<h2 id="acl-set-file">acl-set-file</h2>

<pre><code> acl-set-file path acltype acl</code></pre>

<p>This function sets the POSIX Access Control List (ACL) attached to <code>path</code>.</p>

<p>The <code>acltype</code> parameter may be:</p>

<dl>

<dt><code>access</code></dt>
<dd>

<p>Set the ordinary (access) ACL for any file, directory or other filesystem object.</p>

</dd>
<dt><code>default</code></dt>
<dd>

<p>Set the default ACL. Normally this only makes sense if <code>path</code> is a directory.</p>

</dd>
</dl>

<p>The <code>acl</code> parameter is the new ACL in either &quot;long text form&quot; or &quot;short text form&quot; (see <a href="http://man.he.net/man5/acl">acl(5)</a>). The new ACL completely replaces any previous ACL on the file. The ACL must contain the full Unix permissions (eg. <code>u::rwx,g::rx,o::rx</code>).</p>

<p>If you are specifying individual users or groups, then the mask field is also required (eg. <code>m::rwx</code>), followed by the <code>u:<i>ID</i>:...</code> and/or <code>g:<i>ID</i>:...</code> field(s). A full ACL string might therefore look like this:</p>

<pre><code> u::rwx,g::rwx,o::rwx,m::rwx,u:500:rwx,g:500:rwx
 \ Unix permissions / \mask/ \      ACL        /</code></pre>

<p>You should use numeric UIDs and GIDs. To map usernames and groupnames to the correct numeric ID in the context of the guest, use the Augeas functions (see <a href="#aug-init">&quot;aug-init&quot;</a>).</p>

<h2 id="add-cdrom">add-cdrom</h2>

<pre><code> add-cdrom filename</code></pre>

<p>This function adds a virtual CD-ROM disk image to the guest.</p>

<p>The image is added as read-only drive, so this function is equivalent of <a href="#add-drive-ro">&quot;add-drive-ro&quot;</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#add-drive-ro">&quot;add-drive-ro&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="add-domain">add-domain</h2>

<h2 id="domain">domain</h2>

<pre><code> add-domain dom [libvirturi:..] [readonly:true|false] [iface:..] [live:true|false] [allowuuid:true|false] [readonlydisk:..] [cachemode:..] [discard:..] [copyonread:true|false]</code></pre>

<p>This function adds the disk(s) attached to the named libvirt domain <code>dom</code>. It works by connecting to libvirt, requesting the domain and domain XML from libvirt, parsing it for disks, and calling <a href="#add-drive-opts">&quot;add-drive-opts&quot;</a> on each one.</p>

<p>The number of disks added is returned. This operation is atomic: if an error is returned, then no disks are added.</p>

<p>This function does some minimal checks to make sure the libvirt domain is not running (unless <code>readonly</code> is true). In a future version we will try to acquire the libvirt lock on each disk.</p>

<p>Disks must be accessible locally. This often means that adding disks from a remote libvirt connection (see <a href="http://libvirt.org/remote.html">http://libvirt.org/remote.html</a>) will fail unless those disks are accessible via the same device path locally too.</p>

<p>The optional <code>libvirturi</code> parameter sets the libvirt URI (see <a href="http://libvirt.org/uri.html">http://libvirt.org/uri.html</a>). If this is not set then we connect to the default libvirt URI (or one set through an environment variable, see the libvirt documentation for full details).</p>

<p>The optional <code>live</code> flag controls whether this call will try to connect to a running virtual machine <code>guestfsd</code> process if it sees a suitable &lt;channel&gt; element in the libvirt XML definition. The default (if the flag is omitted) is never to try. See <a href="guestfs.3.html#attaching-to-running-daemons">&quot;ATTACHING TO RUNNING DAEMONS&quot; in guestfs(3)</a> for more information.</p>

<p>If the <code>allowuuid</code> flag is true (default is false) then a UUID <i>may</i> be passed instead of the domain name. The <code>dom</code> string is treated as a UUID first and looked up, and if that lookup fails then we treat <code>dom</code> as a name as usual.</p>

<p>The optional <code>readonlydisk</code> parameter controls what we do for disks which are marked &lt;readonly/&gt; in the libvirt XML. Possible values are:</p>

<dl>

<dt>readonlydisk = &quot;error&quot;</dt>
<dd>

<p>If <code>readonly</code> is false:</p>

<p>The whole call is aborted with an error if any disk with the &lt;readonly/&gt; flag is found.</p>

<p>If <code>readonly</code> is true:</p>

<p>Disks with the &lt;readonly/&gt; flag are added read-only.</p>

</dd>
<dt>readonlydisk = &quot;read&quot;</dt>
<dd>

<p>If <code>readonly</code> is false:</p>

<p>Disks with the &lt;readonly/&gt; flag are added read-only. Other disks are added read/write.</p>

<p>If <code>readonly</code> is true:</p>

<p>Disks with the &lt;readonly/&gt; flag are added read-only.</p>

</dd>
<dt>readonlydisk = &quot;write&quot; (default)</dt>
<dd>

<p>If <code>readonly</code> is false:</p>

<p>Disks with the &lt;readonly/&gt; flag are added read/write.</p>

<p>If <code>readonly</code> is true:</p>

<p>Disks with the &lt;readonly/&gt; flag are added read-only.</p>

</dd>
<dt>readonlydisk = &quot;ignore&quot;</dt>
<dd>

<p>If <code>readonly</code> is true or false:</p>

<p>Disks with the &lt;readonly/&gt; flag are skipped.</p>

</dd>
</dl>

<p>The other optional parameters are passed directly through to <a href="#add-drive-opts">&quot;add-drive-opts&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="add-drive">add-drive</h2>

<h2 id="add">add</h2>

<h2 id="add-drive-opts">add-drive-opts</h2>

<pre><code> add-drive filename [readonly:true|false] [format:..] [iface:..] [name:..] [label:..] [protocol:..] [server:..] [username:..] [secret:..] [cachemode:..] [discard:..] [copyonread:true|false]</code></pre>

<p>This function adds a disk image called <i>filename</i> to the handle. <i>filename</i> may be a regular host file or a host device.</p>

<p>When this function is called before <a href="#launch">&quot;launch&quot;</a> (the usual case) then the first time you call this function, the disk appears in the API as <i>/dev/sda</i>, the second time as <i>/dev/sdb</i>, and so on.</p>

<p>In libguestfs &ge; 1.20 you can also call this function after launch (with some restrictions). This is called &quot;hotplugging&quot;. When hotplugging, you must specify a <code>label</code> so that the new disk gets a predictable name. For more information see <a href="guestfs.3.html#hotplugging">&quot;HOTPLUGGING&quot; in guestfs(3)</a>.</p>

<p>You don&#39;t necessarily need to be root when using libguestfs. However you obviously do need sufficient permissions to access the filename for whatever operations you want to perform (ie. read access if you just want to read the image or write access if you want to modify the image).</p>

<p>This call checks that <i>filename</i> exists.</p>

<p><i>filename</i> may be the special string <code>&quot;/dev/null&quot;</code>. See <a href="guestfs.3.html#null-disks">&quot;NULL DISKS&quot; in guestfs(3)</a>.</p>

<p>The optional arguments are:</p>

<dl>

<dt><code>readonly</code></dt>
<dd>

<p>If true then the image is treated as read-only. Writes are still allowed, but they are stored in a temporary snapshot overlay which is discarded at the end. The disk that you add is not modified.</p>

</dd>
<dt><code>format</code></dt>
<dd>

<p>This forces the image format. If you omit this (or use <a href="#add-drive">&quot;add-drive&quot;</a> or <a href="#add-drive-ro">&quot;add-drive-ro&quot;</a>) then the format is automatically detected. Possible formats include <code>raw</code> and <code>qcow2</code>.</p>

<p>Automatic detection of the format opens you up to a potential security hole when dealing with untrusted raw-format images. See CVE-2010-3851 and RHBZ#642934. Specifying the format closes this security hole.</p>

</dd>
<dt><code>iface</code></dt>
<dd>

<p>This rarely-used option lets you emulate the behaviour of the deprecated <a href="#add-drive-with-if">&quot;add-drive-with-if&quot;</a> call (q.v.)</p>

</dd>
<dt><code>name</code></dt>
<dd>

<p>The name the drive had in the original guest, e.g. <i>/dev/sdb</i>. This is used as a hint to the guest inspection process if it is available.</p>

</dd>
<dt><code>label</code></dt>
<dd>

<p>Give the disk a label. The label should be a unique, short string using <i>only</i> ASCII characters <code>[a-zA-Z]</code>. As well as its usual name in the API (such as <i>/dev/sda</i>), the drive will also be named <i>/dev/disk/guestfs/<i>label</i></i>.</p>

<p>See <a href="guestfs.3.html#disk-labels">&quot;DISK LABELS&quot; in guestfs(3)</a>.</p>

</dd>
<dt><code>protocol</code></dt>
<dd>

<p>The optional protocol argument can be used to select an alternate source protocol.</p>

<p>See also: <a href="guestfs.3.html#remote-storage">&quot;REMOTE STORAGE&quot; in guestfs(3)</a>.</p>

<dl>

<dt><code>protocol = &quot;file&quot;</code></dt>
<dd>

<p><i>filename</i> is interpreted as a local file or device. This is the default if the optional protocol parameter is omitted.</p>

</dd>
<dt><code>protocol = &quot;ftp&quot;|&quot;ftps&quot;|&quot;http&quot;|&quot;https&quot;|&quot;tftp&quot;</code></dt>
<dd>

<p>Connect to a remote FTP, HTTP or TFTP server. The <code>server</code> parameter must also be supplied - see below.</p>

<p>See also: <a href="guestfs.3.html#ftp-http-and-tftp">&quot;FTP, HTTP AND TFTP&quot; in guestfs(3)</a></p>

</dd>
<dt><code>protocol = &quot;gluster&quot;</code></dt>
<dd>

<p>Connect to the GlusterFS server. The <code>server</code> parameter must also be supplied - see below.</p>

<p>See also: <a href="guestfs.3.html#gluster">&quot;GLUSTER&quot; in guestfs(3)</a></p>

</dd>
<dt><code>protocol = &quot;iscsi&quot;</code></dt>
<dd>

<p>Connect to the iSCSI server. The <code>server</code> parameter must also be supplied - see below.</p>

<p>See also: <a href="guestfs.3.html#iscsi">&quot;ISCSI&quot; in guestfs(3)</a>.</p>

</dd>
<dt><code>protocol = &quot;nbd&quot;</code></dt>
<dd>

<p>Connect to the Network Block Device server. The <code>server</code> parameter must also be supplied - see below.</p>

<p>See also: <a href="guestfs.3.html#network-block-device">&quot;NETWORK BLOCK DEVICE&quot; in guestfs(3)</a>.</p>

</dd>
<dt><code>protocol = &quot;rbd&quot;</code></dt>
<dd>

<p>Connect to the Ceph (librbd/RBD) server. The <code>server</code> parameter must also be supplied - see below. The <code>username</code> parameter may be supplied. See below. The <code>secret</code> parameter may be supplied. See below.</p>

<p>See also: <a href="guestfs.3.html#ceph">&quot;CEPH&quot; in guestfs(3)</a>.</p>

</dd>
<dt><code>protocol = &quot;sheepdog&quot;</code></dt>
<dd>

<p>Connect to the Sheepdog server. The <code>server</code> parameter may also be supplied - see below.</p>

<p>See also: <a href="guestfs.3.html#sheepdog">&quot;SHEEPDOG&quot; in guestfs(3)</a>.</p>

</dd>
<dt><code>protocol = &quot;ssh&quot;</code></dt>
<dd>

<p>Connect to the Secure Shell (ssh) server.</p>

<p>The <code>server</code> parameter must be supplied. The <code>username</code> parameter may be supplied. See below.</p>

<p>See also: <a href="guestfs.3.html#ssh">&quot;SSH&quot; in guestfs(3)</a>.</p>

</dd>
</dl>

</dd>
<dt><code>server</code></dt>
<dd>

<p>For protocols which require access to a remote server, this is a list of server(s).</p>

<pre><code> Protocol       Number of servers required
 --------       --------------------------
 file           List must be empty or param not used at all
 ftp|ftps|http|https|tftp  Exactly one
 gluster        Exactly one
 iscsi          Exactly one
 nbd            Exactly one
 rbd            Zero or more
 sheepdog       Zero or more
 ssh            Exactly one</code></pre>

<p>Each list element is a string specifying a server. The string must be in one of the following formats:</p>

<pre><code> hostname
 hostname:port
 tcp:hostname
 tcp:hostname:port
 unix:/path/to/socket</code></pre>

<p>If the port number is omitted, then the standard port number for the protocol is used (see <i>/etc/services</i>).</p>

</dd>
<dt><code>username</code></dt>
<dd>

<p>For the <code>ftp</code>, <code>ftps</code>, <code>http</code>, <code>https</code>, <code>iscsi</code>, <code>rbd</code>, <code>ssh</code> and <code>tftp</code> protocols, this specifies the remote username.</p>

<p>If not given, then the local username is used for <code>ssh</code>, and no authentication is attempted for ceph. But note this sometimes may give unexpected results, for example if using the libvirt backend and if the libvirt backend is configured to start the qemu appliance as a special user such as <code>qemu.qemu</code>. If in doubt, specify the remote username you want.</p>

</dd>
<dt><code>secret</code></dt>
<dd>

<p>For the <code>rbd</code> protocol only, this specifies the &#39;secret&#39; to use when connecting to the remote device. It must be base64 encoded.</p>

<p>If not given, then a secret matching the given username will be looked up in the default keychain locations, or if no username is given, then no authentication will be used.</p>

</dd>
<dt><code>cachemode</code></dt>
<dd>

<p>Choose whether or not libguestfs will obey sync operations (safe but slow) or not (unsafe but fast). The possible values for this string are:</p>

<dl>

<dt><code>cachemode = &quot;writeback&quot;</code></dt>
<dd>

<p>This is the default.</p>

<p>Write operations in the API do not return until a <a href="http://man.he.net/man2/write">write(2)</a> call has completed in the host [but note this does not imply that anything gets written to disk].</p>

<p>Sync operations in the API, including implicit syncs caused by filesystem journalling, will not return until an <a href="http://man.he.net/man2/fdatasync">fdatasync(2)</a> call has completed in the host, indicating that data has been committed to disk.</p>

</dd>
<dt><code>cachemode = &quot;unsafe&quot;</code></dt>
<dd>

<p>In this mode, there are no guarantees. Libguestfs may cache anything and ignore sync requests. This is suitable only for scratch or temporary disks.</p>

</dd>
</dl>

</dd>
<dt><code>discard</code></dt>
<dd>

<p>Enable or disable discard (a.k.a. trim or unmap) support on this drive. If enabled, operations such as <a href="#fstrim">&quot;fstrim&quot;</a> will be able to discard / make thin / punch holes in the underlying host file or device.</p>

<p>Possible discard settings are:</p>

<dl>

<dt><code>discard = &quot;disable&quot;</code></dt>
<dd>

<p>Disable discard support. This is the default.</p>

</dd>
<dt><code>discard = &quot;enable&quot;</code></dt>
<dd>

<p>Enable discard support. Fail if discard is not possible.</p>

</dd>
<dt><code>discard = &quot;besteffort&quot;</code></dt>
<dd>

<p>Enable discard support if possible, but don&#39;t fail if it is not supported.</p>

<p>Since not all backends and not all underlying systems support discard, this is a good choice if you want to use discard if possible, but don&#39;t mind if it doesn&#39;t work.</p>

</dd>
</dl>

</dd>
<dt><code>copyonread</code></dt>
<dd>

<p>The boolean parameter <code>copyonread</code> enables copy-on-read support. This only affects disk formats which have backing files, and causes reads to be stored in the overlay layer, speeding up multiple reads of the same area of disk.</p>

<p>The default is false.</p>

</dd>
</dl>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="add-drive-ro">add-drive-ro</h2>

<h2 id="add-ro">add-ro</h2>

<pre><code> add-drive-ro filename</code></pre>

<p>This function is the equivalent of calling <a href="#add-drive-opts">&quot;add-drive-opts&quot;</a> with the optional parameter <code>GUESTFS_ADD_DRIVE_OPTS_READONLY</code> set to 1, so the disk is added read-only, with the format being detected automatically.</p>

<h2 id="add-drive-ro-with-if">add-drive-ro-with-if</h2>

<pre><code> add-drive-ro-with-if filename iface</code></pre>

<p>This is the same as <a href="#add-drive-ro">&quot;add-drive-ro&quot;</a> but it allows you to specify the QEMU interface emulation to use at run time.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#add-drive">&quot;add-drive&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="add-drive-scratch">add-drive-scratch</h2>

<h2 id="scratch">scratch</h2>

<pre><code> add-drive-scratch size [name:..] [label:..]</code></pre>

<p>This command adds a temporary scratch drive to the handle. The <code>size</code> parameter is the virtual size (in bytes). The scratch drive is blank initially (all reads return zeroes until you start writing to it). The drive is deleted when the handle is closed.</p>

<p>The optional arguments <code>name</code> and <code>label</code> are passed through to <a href="#add-drive">&quot;add-drive&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="add-drive-with-if">add-drive-with-if</h2>

<pre><code> add-drive-with-if filename iface</code></pre>

<p>This is the same as <a href="#add-drive">&quot;add-drive&quot;</a> but it allows you to specify the QEMU interface emulation to use at run time.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#add-drive">&quot;add-drive&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="aug-clear">aug-clear</h2>

<pre><code> aug-clear augpath</code></pre>

<p>Set the value associated with <code>path</code> to <code>NULL</code>. This is the same as the <a href="http://man.he.net/man1/augtool">augtool(1)</a> <code>clear</code> command.</p>

<h2 id="aug-close">aug-close</h2>

<pre><code> aug-close</code></pre>

<p>Close the current Augeas handle and free up any resources used by it. After calling this, you have to call <a href="#aug-init">&quot;aug-init&quot;</a> again before you can use any other Augeas functions.</p>

<h2 id="aug-defnode">aug-defnode</h2>

<pre><code> aug-defnode name expr val</code></pre>

<p>Defines a variable <code>name</code> whose value is the result of evaluating <code>expr</code>.</p>

<p>If <code>expr</code> evaluates to an empty nodeset, a node is created, equivalent to calling <a href="#aug-set">&quot;aug-set&quot;</a> <code>expr</code>, <code>value</code>. <code>name</code> will be the nodeset containing that single node.</p>

<p>On success this returns a pair containing the number of nodes in the nodeset, and a boolean flag if a node was created.</p>

<h2 id="aug-defvar">aug-defvar</h2>

<pre><code> aug-defvar name expr</code></pre>

<p>Defines an Augeas variable <code>name</code> whose value is the result of evaluating <code>expr</code>. If <code>expr</code> is NULL, then <code>name</code> is undefined.</p>

<p>On success this returns the number of nodes in <code>expr</code>, or <code>0</code> if <code>expr</code> evaluates to something which is not a nodeset.</p>

<h2 id="aug-get">aug-get</h2>

<pre><code> aug-get augpath</code></pre>

<p>Look up the value associated with <code>path</code>. If <code>path</code> matches exactly one node, the <code>value</code> is returned.</p>

<h2 id="aug-init">aug-init</h2>

<pre><code> aug-init root flags</code></pre>

<p>Create a new Augeas handle for editing configuration files. If there was any previous Augeas handle associated with this guestfs session, then it is closed.</p>

<p>You must call this before using any other <a href="#aug--">&quot;aug-*&quot;</a> commands.</p>

<p><code>root</code> is the filesystem root. <code>root</code> must not be NULL, use <i>/</i> instead.</p>

<p>The flags are the same as the flags defined in &lt;augeas.h&gt;, the logical <i>or</i> of the following integers:</p>

<dl>

<dt><code>AUG_SAVE_BACKUP</code> = 1</dt>
<dd>

<p>Keep the original file with a <code>.augsave</code> extension.</p>

</dd>
<dt><code>AUG_SAVE_NEWFILE</code> = 2</dt>
<dd>

<p>Save changes into a file with extension <code>.augnew</code>, and do not overwrite original. Overrides <code>AUG_SAVE_BACKUP</code>.</p>

</dd>
<dt><code>AUG_TYPE_CHECK</code> = 4</dt>
<dd>

<p>Typecheck lenses.</p>

<p>This option is only useful when debugging Augeas lenses. Use of this option may require additional memory for the libguestfs appliance. You may need to set the <code>LIBGUESTFS_MEMSIZE</code> environment variable or call <a href="#set-memsize">&quot;set-memsize&quot;</a>.</p>

</dd>
<dt><code>AUG_NO_STDINC</code> = 8</dt>
<dd>

<p>Do not use standard load path for modules.</p>

</dd>
<dt><code>AUG_SAVE_NOOP</code> = 16</dt>
<dd>

<p>Make save a no-op, just record what would have been changed.</p>

</dd>
<dt><code>AUG_NO_LOAD</code> = 32</dt>
<dd>

<p>Do not load the tree in <a href="#aug-init">&quot;aug-init&quot;</a>.</p>

</dd>
</dl>

<p>To close the handle, you can call <a href="#aug-close">&quot;aug-close&quot;</a>.</p>

<p>To find out more about Augeas, see <a href="http://augeas.net/">http://augeas.net/</a>.</p>

<h2 id="aug-insert">aug-insert</h2>

<pre><code> aug-insert augpath label true|false</code></pre>

<p>Create a new sibling <code>label</code> for <code>path</code>, inserting it into the tree before or after <code>path</code> (depending on the boolean flag <code>before</code>).</p>

<p><code>path</code> must match exactly one existing node in the tree, and <code>label</code> must be a label, ie. not contain <i>/</i>, <code>*</code> or end with a bracketed index <code>[N]</code>.</p>

<h2 id="aug-label">aug-label</h2>

<pre><code> aug-label augpath</code></pre>

<p>The label (name of the last element) of the Augeas path expression <code>augpath</code> is returned. <code>augpath</code> must match exactly one node, else this function returns an error.</p>

<h2 id="aug-load">aug-load</h2>

<pre><code> aug-load</code></pre>

<p>Load files into the tree.</p>

<p>See <code>aug_load</code> in the Augeas documentation for the full gory details.</p>

<h2 id="aug-ls">aug-ls</h2>

<pre><code> aug-ls augpath</code></pre>

<p>This is just a shortcut for listing <a href="#aug-match">&quot;aug-match&quot;</a> <code>path/*</code> and sorting the resulting nodes into alphabetical order.</p>

<h2 id="aug-match">aug-match</h2>

<pre><code> aug-match augpath</code></pre>

<p>Returns a list of paths which match the path expression <code>path</code>. The returned paths are sufficiently qualified so that they match exactly one node in the current tree.</p>

<h2 id="aug-mv">aug-mv</h2>

<pre><code> aug-mv src dest</code></pre>

<p>Move the node <code>src</code> to <code>dest</code>. <code>src</code> must match exactly one node. <code>dest</code> is overwritten if it exists.</p>

<h2 id="aug-rm">aug-rm</h2>

<pre><code> aug-rm augpath</code></pre>

<p>Remove <code>path</code> and all of its children.</p>

<p>On success this returns the number of entries which were removed.</p>

<h2 id="aug-save">aug-save</h2>

<pre><code> aug-save</code></pre>

<p>This writes all pending changes to disk.</p>

<p>The flags which were passed to <a href="#aug-init">&quot;aug-init&quot;</a> affect exactly how files are saved.</p>

<h2 id="aug-set">aug-set</h2>

<pre><code> aug-set augpath val</code></pre>

<p>Set the value associated with <code>path</code> to <code>val</code>.</p>

<p>In the Augeas API, it is possible to clear a node by setting the value to NULL. Due to an oversight in the libguestfs API you cannot do that with this call. Instead you must use the <a href="#aug-clear">&quot;aug-clear&quot;</a> call.</p>

<h2 id="aug-setm">aug-setm</h2>

<pre><code> aug-setm base sub val</code></pre>

<p>Change multiple Augeas nodes in a single operation. <code>base</code> is an expression matching multiple nodes. <code>sub</code> is a path expression relative to <code>base</code>. All nodes matching <code>base</code> are found, and then for each node, <code>sub</code> is changed to <code>val</code>. <code>sub</code> may also be <code>NULL</code> in which case the <code>base</code> nodes are modified.</p>

<p>This returns the number of nodes modified.</p>

<h2 id="available">available</h2>

<pre><code> available &#39;groups ...&#39;</code></pre>

<p>This command is used to check the availability of some groups of functionality in the appliance, which not all builds of the libguestfs appliance will be able to provide.</p>

<p>The libguestfs groups, and the functions that those groups correspond to, are listed in <a href="guestfs.3.html#availability">&quot;AVAILABILITY&quot; in guestfs(3)</a>. You can also fetch this list at runtime by calling <a href="#available-all-groups">&quot;available-all-groups&quot;</a>.</p>

<p>The argument <code>groups</code> is a list of group names, eg: <code>[&quot;inotify&quot;, &quot;augeas&quot;]</code> would check for the availability of the Linux inotify functions and Augeas (configuration file editing) functions.</p>

<p>The command returns no error if <i>all</i> requested groups are available.</p>

<p>It fails with an error if one or more of the requested groups is unavailable in the appliance.</p>

<p>If an unknown group name is included in the list of groups then an error is always returned.</p>

<p><i>Notes:</i></p>

<ul>

<li><p><a href="#feature-available">&quot;feature-available&quot;</a> is the same as this call, but with a slightly simpler to use API: that call returns a boolean true/false instead of throwing an error.</p>

</li>
<li><p>You must call <a href="#launch">&quot;launch&quot;</a> before calling this function.</p>

<p>The reason is because we don&#39;t know what groups are supported by the appliance/daemon until it is running and can be queried.</p>

</li>
<li><p>If a group of functions is available, this does not necessarily mean that they will work. You still have to check for errors when calling individual API functions even if they are available.</p>

</li>
<li><p>It is usually the job of distro packagers to build complete functionality into the libguestfs appliance. Upstream libguestfs, if built from source with all requirements satisfied, will support everything.</p>

</li>
<li><p>This call was added in version <code>1.0.80</code>. In previous versions of libguestfs all you could do would be to speculatively execute a command to find out if the daemon implemented it. See also <a href="#version">&quot;version&quot;</a>.</p>

</li>
</ul>

<p>See also <a href="#filesystem-available">&quot;filesystem-available&quot;</a>.</p>

<h2 id="available-all-groups">available-all-groups</h2>

<pre><code> available-all-groups</code></pre>

<p>This command returns a list of all optional groups that this daemon knows about. Note this returns both supported and unsupported groups. To find out which ones the daemon can actually support you have to call <a href="#available">&quot;available&quot;</a> / <a href="#feature-available">&quot;feature-available&quot;</a> on each member of the returned list.</p>

<p>See also <a href="#available">&quot;available&quot;</a>, <a href="#feature-available">&quot;feature-available&quot;</a> and <a href="guestfs.3.html#availability">&quot;AVAILABILITY&quot; in guestfs(3)</a>.</p>

<h2 id="base64-in">base64-in</h2>

<pre><code> base64-in (base64file|-) filename</code></pre>

<p>This command uploads base64-encoded data from <code>base64file</code> to <i>filename</i>.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<h2 id="base64-out">base64-out</h2>

<pre><code> base64-out filename (base64file|-)</code></pre>

<p>This command downloads the contents of <i>filename</i>, writing it out to local file <code>base64file</code> encoded as base64.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<h2 id="blkdiscard">blkdiscard</h2>

<pre><code> blkdiscard device</code></pre>

<p>This discards all blocks on the block device <code>device</code>, giving the free space back to the host.</p>

<p>This operation requires support in libguestfs, the host filesystem, qemu and the host kernel. If this support isn&#39;t present it may give an error or even appear to run but do nothing. You must also set the <code>discard</code> attribute on the underlying drive (see <a href="#add-drive-opts">&quot;add-drive-opts&quot;</a>).</p>

<h2 id="blkdiscardzeroes">blkdiscardzeroes</h2>

<pre><code> blkdiscardzeroes device</code></pre>

<p>This call returns true if blocks on <code>device</code> that have been discarded by a call to <a href="#blkdiscard">&quot;blkdiscard&quot;</a> are returned as blocks of zero bytes when read the next time.</p>

<p>If it returns false, then it may be that discarded blocks are read as stale or random data.</p>

<h2 id="blkid">blkid</h2>

<pre><code> blkid device</code></pre>

<p>This command returns block device attributes for <code>device</code>. The following fields are usually present in the returned hash. Other fields may also be present.</p>

<dl>

<dt><code>UUID</code></dt>
<dd>

<p>The uuid of this device.</p>

</dd>
<dt><code>LABEL</code></dt>
<dd>

<p>The label of this device.</p>

</dd>
<dt><code>VERSION</code></dt>
<dd>

<p>The version of blkid command.</p>

</dd>
<dt><code>TYPE</code></dt>
<dd>

<p>The filesystem type or RAID of this device.</p>

</dd>
<dt><code>USAGE</code></dt>
<dd>

<p>The usage of this device, for example <code>filesystem</code> or <code>raid</code>.</p>

</dd>
</dl>

<h2 id="blockdev-flushbufs">blockdev-flushbufs</h2>

<pre><code> blockdev-flushbufs device</code></pre>

<p>This tells the kernel to flush internal buffers associated with <code>device</code>.</p>

<p>This uses the <a href="http://man.he.net/man8/blockdev">blockdev(8)</a> command.</p>

<h2 id="blockdev-getbsz">blockdev-getbsz</h2>

<pre><code> blockdev-getbsz device</code></pre>

<p>This returns the block size of a device.</p>

<p>Note: this is different from both <i>size in blocks</i> and <i>filesystem block size</i>. Also this setting is not really used by anything. You should probably not use it for anything. Filesystems have their own idea about what block size to choose.</p>

<p>This uses the <a href="http://man.he.net/man8/blockdev">blockdev(8)</a> command.</p>

<h2 id="blockdev-getro">blockdev-getro</h2>

<pre><code> blockdev-getro device</code></pre>

<p>Returns a boolean indicating if the block device is read-only (true if read-only, false if not).</p>

<p>This uses the <a href="http://man.he.net/man8/blockdev">blockdev(8)</a> command.</p>

<h2 id="blockdev-getsize64">blockdev-getsize64</h2>

<pre><code> blockdev-getsize64 device</code></pre>

<p>This returns the size of the device in bytes.</p>

<p>See also <a href="#blockdev-getsz">&quot;blockdev-getsz&quot;</a>.</p>

<p>This uses the <a href="http://man.he.net/man8/blockdev">blockdev(8)</a> command.</p>

<h2 id="blockdev-getss">blockdev-getss</h2>

<pre><code> blockdev-getss device</code></pre>

<p>This returns the size of sectors on a block device. Usually 512, but can be larger for modern devices.</p>

<p>(Note, this is not the size in sectors, use <a href="#blockdev-getsz">&quot;blockdev-getsz&quot;</a> for that).</p>

<p>This uses the <a href="http://man.he.net/man8/blockdev">blockdev(8)</a> command.</p>

<h2 id="blockdev-getsz">blockdev-getsz</h2>

<pre><code> blockdev-getsz device</code></pre>

<p>This returns the size of the device in units of 512-byte sectors (even if the sectorsize isn&#39;t 512 bytes ... weird).</p>

<p>See also <a href="#blockdev-getss">&quot;blockdev-getss&quot;</a> for the real sector size of the device, and <a href="#blockdev-getsize64">&quot;blockdev-getsize64&quot;</a> for the more useful <i>size in bytes</i>.</p>

<p>This uses the <a href="http://man.he.net/man8/blockdev">blockdev(8)</a> command.</p>

<h2 id="blockdev-rereadpt">blockdev-rereadpt</h2>

<pre><code> blockdev-rereadpt device</code></pre>

<p>Reread the partition table on <code>device</code>.</p>

<p>This uses the <a href="http://man.he.net/man8/blockdev">blockdev(8)</a> command.</p>

<h2 id="blockdev-setbsz">blockdev-setbsz</h2>

<pre><code> blockdev-setbsz device blocksize</code></pre>

<p>This call does nothing and has never done anything because of a bug in blockdev. <b>Do not use it.</b></p>

<p>If you need to set the filesystem block size, use the <code>blocksize</code> option of <a href="#mkfs">&quot;mkfs&quot;</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#mkfs">&quot;mkfs&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="blockdev-setra">blockdev-setra</h2>

<pre><code> blockdev-setra device sectors</code></pre>

<p>Set readahead (in 512-byte sectors) for the device.</p>

<p>This uses the <a href="http://man.he.net/man8/blockdev">blockdev(8)</a> command.</p>

<h2 id="blockdev-setro">blockdev-setro</h2>

<pre><code> blockdev-setro device</code></pre>

<p>Sets the block device named <code>device</code> to read-only.</p>

<p>This uses the <a href="http://man.he.net/man8/blockdev">blockdev(8)</a> command.</p>

<h2 id="blockdev-setrw">blockdev-setrw</h2>

<pre><code> blockdev-setrw device</code></pre>

<p>Sets the block device named <code>device</code> to read-write.</p>

<p>This uses the <a href="http://man.he.net/man8/blockdev">blockdev(8)</a> command.</p>

<h2 id="btrfs-balance-cancel">btrfs-balance-cancel</h2>

<pre><code> btrfs-balance-cancel path</code></pre>

<p>Cancel a running balance on a btrfs filesystem.</p>

<h2 id="btrfs-balance-pause">btrfs-balance-pause</h2>

<pre><code> btrfs-balance-pause path</code></pre>

<p>Pause a running balance on a btrfs filesystem.</p>

<h2 id="btrfs-balance-resume">btrfs-balance-resume</h2>

<pre><code> btrfs-balance-resume path</code></pre>

<p>Resume a paused balance on a btrfs filesystem.</p>

<h2 id="btrfs-balance-status">btrfs-balance-status</h2>

<pre><code> btrfs-balance-status path</code></pre>

<p>Show the status of a running or paused balance on a btrfs filesystem.</p>

<h2 id="btrfs-device-add">btrfs-device-add</h2>

<pre><code> btrfs-device-add &#39;devices ...&#39; fs</code></pre>

<p>Add the list of device(s) in <code>devices</code> to the btrfs filesystem mounted at <code>fs</code>. If <code>devices</code> is an empty list, this does nothing.</p>

<h2 id="btrfs-device-delete">btrfs-device-delete</h2>

<pre><code> btrfs-device-delete &#39;devices ...&#39; fs</code></pre>

<p>Remove the <code>devices</code> from the btrfs filesystem mounted at <code>fs</code>. If <code>devices</code> is an empty list, this does nothing.</p>

<h2 id="btrfs-filesystem-balance">btrfs-filesystem-balance</h2>

<h2 id="btrfs-balance">btrfs-balance</h2>

<pre><code> btrfs-filesystem-balance fs</code></pre>

<p>Balance the chunks in the btrfs filesystem mounted at <code>fs</code> across the underlying devices.</p>

<h2 id="btrfs-filesystem-defragment">btrfs-filesystem-defragment</h2>

<pre><code> btrfs-filesystem-defragment path [flush:true|false] [compress:..]</code></pre>

<p>Defragment a file or directory on a btrfs filesystem. compress is one of zlib or lzo.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="btrfs-filesystem-resize">btrfs-filesystem-resize</h2>

<pre><code> btrfs-filesystem-resize mountpoint [size:N]</code></pre>

<p>This command resizes a btrfs filesystem.</p>

<p>Note that unlike other resize calls, the filesystem has to be mounted and the parameter is the mountpoint not the device (this is a requirement of btrfs itself).</p>

<p>The optional parameters are:</p>

<dl>

<dt><code>size</code></dt>
<dd>

<p>The new size (in bytes) of the filesystem. If omitted, the filesystem is resized to the maximum size.</p>

</dd>
</dl>

<p>See also <a href="http://man.he.net/man8/btrfs">btrfs(8)</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="btrfs-filesystem-sync">btrfs-filesystem-sync</h2>

<pre><code> btrfs-filesystem-sync fs</code></pre>

<p>Force sync on the btrfs filesystem mounted at <code>fs</code>.</p>

<h2 id="btrfs-fsck">btrfs-fsck</h2>

<pre><code> btrfs-fsck device [superblock:N] [repair:true|false]</code></pre>

<p>Used to check a btrfs filesystem, <code>device</code> is the device file where the filesystem is stored.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="btrfs-image">btrfs-image</h2>

<pre><code> btrfs-image &#39;source ...&#39; image [compresslevel:N]</code></pre>

<p>This is used to create an image of a btrfs filesystem. All data will be zeroed, but metadata and the like is preserved.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="btrfs-qgroup-assign">btrfs-qgroup-assign</h2>

<pre><code> btrfs-qgroup-assign src dst path</code></pre>

<p>Add qgroup <code>src</code> to parent qgroup <code>dst</code>. This command can group several qgroups into a parent qgroup to share common limit.</p>

<h2 id="btrfs-qgroup-create">btrfs-qgroup-create</h2>

<pre><code> btrfs-qgroup-create qgroupid subvolume</code></pre>

<p>Create a quota group (qgroup) for subvolume at <code>subvolume</code>.</p>

<h2 id="btrfs-qgroup-destroy">btrfs-qgroup-destroy</h2>

<pre><code> btrfs-qgroup-destroy qgroupid subvolume</code></pre>

<p>Destroy a quota group.</p>

<h2 id="btrfs-qgroup-limit">btrfs-qgroup-limit</h2>

<pre><code> btrfs-qgroup-limit subvolume size</code></pre>

<p>Limit the size of a subvolume which&#39;s path is <code>subvolume</code>. <code>size</code> can have suffix of G, M, or K.</p>

<h2 id="btrfs-qgroup-remove">btrfs-qgroup-remove</h2>

<pre><code> btrfs-qgroup-remove src dst path</code></pre>

<p>Remove qgroup <code>src</code> from the parent qgroup <code>dst</code>.</p>

<h2 id="btrfs-qgroup-show">btrfs-qgroup-show</h2>

<pre><code> btrfs-qgroup-show path</code></pre>

<p>Show all subvolume quota groups in a btrfs filesystem, including their usages.</p>

<h2 id="btrfs-quota-enable">btrfs-quota-enable</h2>

<pre><code> btrfs-quota-enable fs true|false</code></pre>

<p>Enable or disable subvolume quota support for filesystem which contains <code>path</code>.</p>

<h2 id="btrfs-quota-rescan">btrfs-quota-rescan</h2>

<pre><code> btrfs-quota-rescan fs</code></pre>

<p>Trash all qgroup numbers and scan the metadata again with the current config.</p>

<h2 id="btrfs-replace">btrfs-replace</h2>

<pre><code> btrfs-replace srcdev targetdev mntpoint</code></pre>

<p>Replace device of a btrfs filesystem. On a live filesystem, duplicate the data to the target device which is currently stored on the source device. After completion of the operation, the source device is wiped out and removed from the filesystem.</p>

<p>The <code>targetdev</code> needs to be same size or larger than the <code>srcdev</code>. Devices which are currently mounted are never allowed to be used as the <code>targetdev</code>.</p>

<h2 id="btrfs-rescue-chunk-recover">btrfs-rescue-chunk-recover</h2>

<pre><code> btrfs-rescue-chunk-recover device</code></pre>

<p>Recover the chunk tree of btrfs filesystem by scanning the devices one by one.</p>

<h2 id="btrfs-rescue-super-recover">btrfs-rescue-super-recover</h2>

<pre><code> btrfs-rescue-super-recover device</code></pre>

<p>Recover bad superblocks from good copies.</p>

<h2 id="btrfs-scrub-cancel">btrfs-scrub-cancel</h2>

<pre><code> btrfs-scrub-cancel path</code></pre>

<p>Cancel a running scrub on a btrfs filesystem.</p>

<h2 id="btrfs-scrub-resume">btrfs-scrub-resume</h2>

<pre><code> btrfs-scrub-resume path</code></pre>

<p>Resume a previously canceled or interrupted scrub on a btrfs filesystem.</p>

<h2 id="btrfs-scrub-start">btrfs-scrub-start</h2>

<pre><code> btrfs-scrub-start path</code></pre>

<p>Reads all the data and metadata on the filesystem, and uses checksums and the duplicate copies from RAID storage to identify and repair any corrupt data.</p>

<h2 id="btrfs-scrub-status">btrfs-scrub-status</h2>

<pre><code> btrfs-scrub-status path</code></pre>

<p>Show status of running or finished scrub on a btrfs filesystem.</p>

<h2 id="btrfs-set-seeding">btrfs-set-seeding</h2>

<pre><code> btrfs-set-seeding device true|false</code></pre>

<p>Enable or disable the seeding feature of a device that contains a btrfs filesystem.</p>

<h2 id="btrfs-subvolume-create">btrfs-subvolume-create</h2>

<h2 id="btrfs-subvolume-create-opts">btrfs-subvolume-create-opts</h2>

<pre><code> btrfs-subvolume-create dest [qgroupid:..]</code></pre>

<p>Create a btrfs subvolume. The <code>dest</code> argument is the destination directory and the name of the subvolume, in the form <i>/path/to/dest/name</i>. The optional parameter <code>qgroupid</code> represents the qgroup which the newly created subvolume will be added to.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="btrfs-subvolume-delete">btrfs-subvolume-delete</h2>

<pre><code> btrfs-subvolume-delete subvolume</code></pre>

<p>Delete the named btrfs subvolume or snapshot.</p>

<h2 id="btrfs-subvolume-get-default">btrfs-subvolume-get-default</h2>

<pre><code> btrfs-subvolume-get-default fs</code></pre>

<p>Get the default subvolume or snapshot of a filesystem mounted at <code>mountpoint</code>.</p>

<h2 id="btrfs-subvolume-list">btrfs-subvolume-list</h2>

<pre><code> btrfs-subvolume-list fs</code></pre>

<p>List the btrfs snapshots and subvolumes of the btrfs filesystem which is mounted at <code>fs</code>.</p>

<h2 id="btrfs-subvolume-set-default">btrfs-subvolume-set-default</h2>

<pre><code> btrfs-subvolume-set-default id fs</code></pre>

<p>Set the subvolume of the btrfs filesystem <code>fs</code> which will be mounted by default. See <a href="#btrfs-subvolume-list">&quot;btrfs-subvolume-list&quot;</a> to get a list of subvolumes.</p>

<h2 id="btrfs-subvolume-show">btrfs-subvolume-show</h2>

<pre><code> btrfs-subvolume-show subvolume</code></pre>

<p>Return detailed information of the subvolume.</p>

<h2 id="btrfs-subvolume-snapshot">btrfs-subvolume-snapshot</h2>

<h2 id="btrfs-subvolume-snapshot-opts">btrfs-subvolume-snapshot-opts</h2>

<pre><code> btrfs-subvolume-snapshot source dest [ro:true|false] [qgroupid:..]</code></pre>

<p>Create a snapshot of the btrfs subvolume <code>source</code>. The <code>dest</code> argument is the destination directory and the name of the snapshot, in the form <i>/path/to/dest/name</i>. By default the newly created snapshot is writable, if the value of optional parameter <code>ro</code> is true, then a readonly snapshot is created. The optional parameter <code>qgroupid</code> represents the qgroup which the newly created snapshot will be added to.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="btrfstune-enable-extended-inode-refs">btrfstune-enable-extended-inode-refs</h2>

<pre><code> btrfstune-enable-extended-inode-refs device</code></pre>

<p>This will Enable extended inode refs.</p>

<h2 id="btrfstune-enable-skinny-metadata-extent-refs">btrfstune-enable-skinny-metadata-extent-refs</h2>

<pre><code> btrfstune-enable-skinny-metadata-extent-refs device</code></pre>

<p>This enable skinny metadata extent refs.</p>

<h2 id="btrfstune-seeding">btrfstune-seeding</h2>

<pre><code> btrfstune-seeding device true|false</code></pre>

<p>Enable seeding of a btrfs device, this will force a fs readonly so that you can use it to build other filesystems.</p>

<h2 id="c-pointer">c-pointer</h2>

<pre><code> c-pointer</code></pre>

<p>In non-C language bindings, this allows you to retrieve the underlying C pointer to the handle (ie. <a href="#h-">&quot;h *&quot;</a>). The purpose of this is to allow other libraries to interwork with libguestfs.</p>

<h2 id="canonical-device-name">canonical-device-name</h2>

<pre><code> canonical-device-name device</code></pre>

<p>This utility function is useful when displaying device names to the user. It takes a number of irregular device names and returns them in a consistent format:</p>

<dl>

<dt><i>/dev/hdX</i></dt>
<dd>

</dd>
<dt><i>/dev/vdX</i></dt>
<dd>

<p>These are returned as <i>/dev/sdX</i>. Note this works for device names and partition names. This is approximately the reverse of the algorithm described in <a href="guestfs.3.html#block-device-naming">&quot;BLOCK DEVICE NAMING&quot; in guestfs(3)</a>.</p>

</dd>
<dt><i>/dev/mapper/VG-LV</i></dt>
<dd>

</dd>
<dt><i>/dev/dm-N</i></dt>
<dd>

<p>Converted to <i>/dev/VG/LV</i> form using <a href="#lvm-canonical-lv-name">&quot;lvm-canonical-lv-name&quot;</a>.</p>

</dd>
</dl>

<p>Other strings are returned unmodified.</p>

<h2 id="cap-get-file">cap-get-file</h2>

<pre><code> cap-get-file path</code></pre>

<p>This function returns the Linux capabilities attached to <code>path</code>. The capabilities set is returned in text form (see <a href="http://search.cpan.org/perldoc?cap_to_text(3)">cap_to_text(3)</a>).</p>

<p>If no capabilities are attached to a file, an empty string is returned.</p>

<h2 id="cap-set-file">cap-set-file</h2>

<pre><code> cap-set-file path cap</code></pre>

<p>This function sets the Linux capabilities attached to <code>path</code>. The capabilities set <code>cap</code> should be passed in text form (see <a href="http://search.cpan.org/perldoc?cap_from_text(3)">cap_from_text(3)</a>).</p>

<h2 id="case-sensitive-path">case-sensitive-path</h2>

<pre><code> case-sensitive-path path</code></pre>

<p>This can be used to resolve case insensitive paths on a filesystem which is case sensitive. The use case is to resolve paths which you have read from Windows configuration files or the Windows Registry, to the true path.</p>

<p>The command handles a peculiarity of the Linux ntfs-3g filesystem driver (and probably others), which is that although the underlying filesystem is case-insensitive, the driver exports the filesystem to Linux as case-sensitive.</p>

<p>One consequence of this is that special directories such as <i>C:\windows</i> may appear as <i>/WINDOWS</i> or <i>/windows</i> (or other things) depending on the precise details of how they were created. In Windows itself this would not be a problem.</p>

<p>Bug or feature? You decide: <a href="http://www.tuxera.com/community/ntfs-3g-faq/#posixfilenames1">http://www.tuxera.com/community/ntfs-3g-faq/#posixfilenames1</a></p>

<p><a href="#case-sensitive-path">&quot;case-sensitive-path&quot;</a> attempts to resolve the true case of each element in the path. It will return a resolved path if either the full path or its parent directory exists. If the parent directory exists but the full path does not, the case of the parent directory will be correctly resolved, and the remainder appended unmodified. For example, if the file <code>&quot;/Windows/System32/netkvm.sys&quot;</code> exists:</p>

<dl>

<dt><a href="#case-sensitive-path">&quot;case-sensitive-path&quot;</a> (&quot;/windows/system32/netkvm.sys&quot;)</dt>
<dd>

<p>&quot;Windows/System32/netkvm.sys&quot;</p>

</dd>
<dt><a href="#case-sensitive-path">&quot;case-sensitive-path&quot;</a> (&quot;/windows/system32/NoSuchFile&quot;)</dt>
<dd>

<p>&quot;Windows/System32/NoSuchFile&quot;</p>

</dd>
<dt><a href="#case-sensitive-path">&quot;case-sensitive-path&quot;</a> (&quot;/windows/system33/netkvm.sys&quot;)</dt>
<dd>

<p><i>ERROR</i></p>

</dd>
</dl>

<p><i>Note</i>: Because of the above behaviour, <a href="#case-sensitive-path">&quot;case-sensitive-path&quot;</a> cannot be used to check for the existence of a file.</p>

<p><i>Note</i>: This function does not handle drive names, backslashes etc.</p>

<p>See also <a href="#realpath">&quot;realpath&quot;</a>.</p>

<h2 id="cat">cat</h2>

<pre><code> cat path</code></pre>

<p>Return the contents of the file named <code>path</code>.</p>

<p>Because, in C, this function returns a <code>char *</code>, there is no way to differentiate between a <code>\0</code> character in a file and end of string. To handle binary files, use the <a href="#read-file">&quot;read-file&quot;</a> or <a href="#download">&quot;download&quot;</a> functions.</p>

<h2 id="checksum">checksum</h2>

<pre><code> checksum csumtype path</code></pre>

<p>This call computes the MD5, SHAx or CRC checksum of the file named <code>path</code>.</p>

<p>The type of checksum to compute is given by the <code>csumtype</code> parameter which must have one of the following values:</p>

<dl>

<dt><code>crc</code></dt>
<dd>

<p>Compute the cyclic redundancy check (CRC) specified by POSIX for the <code>cksum</code> command.</p>

</dd>
<dt><code>md5</code></dt>
<dd>

<p>Compute the MD5 hash (using the <code>md5sum</code> program).</p>

</dd>
<dt><code>sha1</code></dt>
<dd>

<p>Compute the SHA1 hash (using the <code>sha1sum</code> program).</p>

</dd>
<dt><code>sha224</code></dt>
<dd>

<p>Compute the SHA224 hash (using the <code>sha224sum</code> program).</p>

</dd>
<dt><code>sha256</code></dt>
<dd>

<p>Compute the SHA256 hash (using the <code>sha256sum</code> program).</p>

</dd>
<dt><code>sha384</code></dt>
<dd>

<p>Compute the SHA384 hash (using the <code>sha384sum</code> program).</p>

</dd>
<dt><code>sha512</code></dt>
<dd>

<p>Compute the SHA512 hash (using the <code>sha512sum</code> program).</p>

</dd>
</dl>

<p>The checksum is returned as a printable string.</p>

<p>To get the checksum for a device, use <a href="#checksum-device">&quot;checksum-device&quot;</a>.</p>

<p>To get the checksums for many files, use <a href="#checksums-out">&quot;checksums-out&quot;</a>.</p>

<h2 id="checksum-device">checksum-device</h2>

<pre><code> checksum-device csumtype device</code></pre>

<p>This call computes the MD5, SHAx or CRC checksum of the contents of the device named <code>device</code>. For the types of checksums supported see the <a href="#checksum">&quot;checksum&quot;</a> command.</p>

<h2 id="checksums-out">checksums-out</h2>

<pre><code> checksums-out csumtype directory (sumsfile|-)</code></pre>

<p>This command computes the checksums of all regular files in <i>directory</i> and then emits a list of those checksums to the local output file <code>sumsfile</code>.</p>

<p>This can be used for verifying the integrity of a virtual machine. However to be properly secure you should pay attention to the output of the checksum command (it uses the ones from GNU coreutils). In particular when the filename is not printable, coreutils uses a special backslash syntax. For more information, see the GNU coreutils info file.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<h2 id="chmod">chmod</h2>

<pre><code> chmod mode path</code></pre>

<p>Change the mode (permissions) of <code>path</code> to <code>mode</code>. Only numeric modes are supported.</p>

<p><i>Note</i>: When using this command from guestfish, <code>mode</code> by default would be decimal, unless you prefix it with <code>0</code> to get octal, ie. use <code>0700</code> not <code>700</code>.</p>

<p>The mode actually set is affected by the umask.</p>

<h2 id="chown">chown</h2>

<pre><code> chown owner group path</code></pre>

<p>Change the file owner to <code>owner</code> and group to <code>group</code>.</p>

<p>Only numeric uid and gid are supported. If you want to use names, you will need to locate and parse the password file yourself (Augeas support makes this relatively easy).</p>

<h2 id="clear-backend-setting">clear-backend-setting</h2>

<pre><code> clear-backend-setting name</code></pre>

<p>If there is a backend setting string matching <code>&quot;name&quot;</code> or beginning with <code>&quot;name=&quot;</code>, then that string is removed from the backend settings.</p>

<p>This call returns the number of strings which were removed (which may be 0, 1 or greater than 1).</p>

<p>See <a href="guestfs.3.html#backend">&quot;BACKEND&quot; in guestfs(3)</a>, <a href="guestfs.3.html#backend-settings">&quot;BACKEND SETTINGS&quot; in guestfs(3)</a>.</p>

<h2 id="command">command</h2>

<pre><code> command &#39;arguments ...&#39;</code></pre>

<p>This call runs a command from the guest filesystem. The filesystem must be mounted, and must contain a compatible operating system (ie. something Linux, with the same or compatible processor architecture).</p>

<p>The single parameter is an argv-style list of arguments. The first element is the name of the program to run. Subsequent elements are parameters. The list must be non-empty (ie. must contain a program name). Note that the command runs directly, and is <i>not</i> invoked via the shell (see <a href="#sh">&quot;sh&quot;</a>).</p>

<p>The return value is anything printed to <i>stdout</i> by the command.</p>

<p>If the command returns a non-zero exit status, then this function returns an error message. The error message string is the content of <i>stderr</i> from the command.</p>

<p>The <code>$PATH</code> environment variable will contain at least <i>/usr/bin</i> and <i>/bin</i>. If you require a program from another location, you should provide the full path in the first parameter.</p>

<p>Shared libraries and data files required by the program must be available on filesystems which are mounted in the correct places. It is the caller&#39;s responsibility to ensure all filesystems that are needed are mounted at the right locations.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="command-lines">command-lines</h2>

<pre><code> command-lines &#39;arguments ...&#39;</code></pre>

<p>This is the same as <a href="#command">&quot;command&quot;</a>, but splits the result into a list of lines.</p>

<p>See also: <a href="#sh-lines">&quot;sh-lines&quot;</a></p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="compress-device-out">compress-device-out</h2>

<pre><code> compress-device-out ctype device (zdevice|-) [level:N]</code></pre>

<p>This command compresses <code>device</code> and writes it out to the local file <code>zdevice</code>.</p>

<p>The <code>ctype</code> and optional <code>level</code> parameters have the same meaning as in <a href="#compress-out">&quot;compress-out&quot;</a>.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="compress-out">compress-out</h2>

<pre><code> compress-out ctype file (zfile|-) [level:N]</code></pre>

<p>This command compresses <i>file</i> and writes it out to the local file <i>zfile</i>.</p>

<p>The compression program used is controlled by the <code>ctype</code> parameter. Currently this includes: <code>compress</code>, <code>gzip</code>, <code>bzip2</code>, <code>xz</code> or <code>lzop</code>. Some compression types may not be supported by particular builds of libguestfs, in which case you will get an error containing the substring &quot;not supported&quot;.</p>

<p>The optional <code>level</code> parameter controls compression level. The meaning and default for this parameter depends on the compression program being used.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="config">config</h2>

<pre><code> config hvparam hvvalue</code></pre>

<p>This can be used to add arbitrary hypervisor parameters of the form <i>-param value</i>. Actually it&#39;s not quite arbitrary - we prevent you from setting some parameters which would interfere with parameters that we use.</p>

<p>The first character of <code>hvparam</code> string must be a <code>-</code> (dash).</p>

<p><code>hvvalue</code> can be NULL.</p>

<h2 id="copy-attributes">copy-attributes</h2>

<pre><code> copy-attributes src dest [all:true|false] [mode:true|false] [xattributes:true|false] [ownership:true|false]</code></pre>

<p>Copy the attributes of a path (which can be a file or a directory) to another path.</p>

<p>By default <code>no</code> attribute is copied, so make sure to specify any (or <code>all</code> to copy everything).</p>

<p>The optional arguments specify which attributes can be copied:</p>

<dl>

<dt><code>mode</code></dt>
<dd>

<p>Copy part of the file mode from <code>source</code> to <code>destination</code>. Only the UNIX permissions and the sticky/setuid/setgid bits can be copied.</p>

</dd>
<dt><code>xattributes</code></dt>
<dd>

<p>Copy the Linux extended attributes (xattrs) from <code>source</code> to <code>destination</code>. This flag does nothing if the <i>linuxxattrs</i> feature is not available (see <a href="#feature-available">&quot;feature-available&quot;</a>).</p>

</dd>
<dt><code>ownership</code></dt>
<dd>

<p>Copy the owner uid and the group gid of <code>source</code> to <code>destination</code>.</p>

</dd>
<dt><code>all</code></dt>
<dd>

<p>Copy <b>all</b> the attributes from <code>source</code> to <code>destination</code>. Enabling it enables all the other flags, if they are not specified already.</p>

</dd>
</dl>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="copy-device-to-device">copy-device-to-device</h2>

<pre><code> copy-device-to-device src dest [srcoffset:N] [destoffset:N] [size:N] [sparse:true|false] [append:true|false]</code></pre>

<p>The four calls <a href="#copy-device-to-device">&quot;copy-device-to-device&quot;</a>, <a href="#copy-device-to-file">&quot;copy-device-to-file&quot;</a>, <a href="#copy-file-to-device">&quot;copy-file-to-device&quot;</a>, and <a href="#copy-file-to-file">&quot;copy-file-to-file&quot;</a> let you copy from a source (device|file) to a destination (device|file).</p>

<p>Partial copies can be made since you can specify optionally the source offset, destination offset and size to copy. These values are all specified in bytes. If not given, the offsets both default to zero, and the size defaults to copying as much as possible until we hit the end of the source.</p>

<p>The source and destination may be the same object. However overlapping regions may not be copied correctly.</p>

<p>If the destination is a file, it is created if required. If the destination file is not large enough, it is extended.</p>

<p>If the destination is a file and the <code>append</code> flag is not set, then the destination file is truncated. If the <code>append</code> flag is set, then the copy appends to the destination file. The <code>append</code> flag currently cannot be set for devices.</p>

<p>If the <code>sparse</code> flag is true then the call avoids writing blocks that contain only zeroes, which can help in some situations where the backing disk is thin-provisioned. Note that unless the target is already zeroed, using this option will result in incorrect copying.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="copy-device-to-file">copy-device-to-file</h2>

<pre><code> copy-device-to-file src dest [srcoffset:N] [destoffset:N] [size:N] [sparse:true|false] [append:true|false]</code></pre>

<p>See <a href="#copy-device-to-device">&quot;copy-device-to-device&quot;</a> for a general overview of this call.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="copy-file-to-device">copy-file-to-device</h2>

<pre><code> copy-file-to-device src dest [srcoffset:N] [destoffset:N] [size:N] [sparse:true|false] [append:true|false]</code></pre>

<p>See <a href="#copy-device-to-device">&quot;copy-device-to-device&quot;</a> for a general overview of this call.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="copy-file-to-file">copy-file-to-file</h2>

<pre><code> copy-file-to-file src dest [srcoffset:N] [destoffset:N] [size:N] [sparse:true|false] [append:true|false]</code></pre>

<p>See <a href="#copy-device-to-device">&quot;copy-device-to-device&quot;</a> for a general overview of this call.</p>

<p>This is <b>not</b> the function you want for copying files. This is for copying blocks within existing files. See <a href="#cp">&quot;cp&quot;</a>, <a href="#cp-a">&quot;cp-a&quot;</a> and <a href="#mv">&quot;mv&quot;</a> for general file copying and moving functions.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="copy-size">copy-size</h2>

<pre><code> copy-size src dest size</code></pre>

<p>This command copies exactly <code>size</code> bytes from one source device or file <code>src</code> to another destination device or file <code>dest</code>.</p>

<p>Note this will fail if the source is too short or if the destination is not large enough.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#copy-device-to-device">&quot;copy-device-to-device&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="cp">cp</h2>

<pre><code> cp src dest</code></pre>

<p>This copies a file from <code>src</code> to <code>dest</code> where <code>dest</code> is either a destination filename or destination directory.</p>

<h2 id="cp-a">cp-a</h2>

<pre><code> cp-a src dest</code></pre>

<p>This copies a file or directory from <code>src</code> to <code>dest</code> recursively using the <code>cp -a</code> command.</p>

<h2 id="cp-r">cp-r</h2>

<pre><code> cp-r src dest</code></pre>

<p>This copies a file or directory from <code>src</code> to <code>dest</code> recursively using the <code>cp -rP</code> command.</p>

<p>Most users should use <a href="#cp-a">&quot;cp-a&quot;</a> instead. This command is useful when you don&#39;t want to preserve permissions, because the target filesystem does not support it (primarily when writing to DOS FAT filesystems).</p>

<h2 id="cpio-out">cpio-out</h2>

<pre><code> cpio-out directory (cpiofile|-) [format:..]</code></pre>

<p>This command packs the contents of <i>directory</i> and downloads it to local file <code>cpiofile</code>.</p>

<p>The optional <code>format</code> parameter can be used to select the format. Only the following formats are currently permitted:</p>

<dl>

<dt><code>newc</code></dt>
<dd>

<p>New (SVR4) portable format. This format happens to be compatible with the cpio-like format used by the Linux kernel for initramfs.</p>

<p>This is the default format.</p>

</dd>
<dt><code>crc</code></dt>
<dd>

<p>New (SVR4) portable format with a checksum.</p>

</dd>
</dl>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="dd">dd</h2>

<pre><code> dd src dest</code></pre>

<p>This command copies from one source device or file <code>src</code> to another destination device or file <code>dest</code>. Normally you would use this to copy to or from a device or partition, for example to duplicate a filesystem.</p>

<p>If the destination is a device, it must be as large or larger than the source file or device, otherwise the copy will fail. This command cannot do partial copies (see <a href="#copy-device-to-device">&quot;copy-device-to-device&quot;</a>).</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#copy-device-to-device">&quot;copy-device-to-device&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="device-index">device-index</h2>

<pre><code> device-index device</code></pre>

<p>This function takes a device name (eg. &quot;/dev/sdb&quot;) and returns the index of the device in the list of devices.</p>

<p>Index numbers start from 0. The named device must exist, for example as a string returned from <a href="#list-devices">&quot;list-devices&quot;</a>.</p>

<p>See also <a href="#list-devices">&quot;list-devices&quot;</a>, <a href="#part-to-dev">&quot;part-to-dev&quot;</a>.</p>

<h2 id="df">df</h2>

<pre><code> df</code></pre>

<p>This command runs the <code>df</code> command to report disk space used.</p>

<p>This command is mostly useful for interactive sessions. It is <i>not</i> intended that you try to parse the output string. Use <a href="#statvfs">&quot;statvfs&quot;</a> from programs.</p>

<h2 id="df-h">df-h</h2>

<pre><code> df-h</code></pre>

<p>This command runs the <code>df -h</code> command to report disk space used in human-readable format.</p>

<p>This command is mostly useful for interactive sessions. It is <i>not</i> intended that you try to parse the output string. Use <a href="#statvfs">&quot;statvfs&quot;</a> from programs.</p>

<h2 id="disk-create">disk-create</h2>

<pre><code> disk-create filename format size [backingfile:..] [backingformat:..] [preallocation:..] [compat:..] [clustersize:N]</code></pre>

<p>Create a blank disk image called <i>filename</i> (a host file) with format <code>format</code> (usually <code>raw</code> or <code>qcow2</code>). The size is <code>size</code> bytes.</p>

<p>If used with the optional <code>backingfile</code> parameter, then a snapshot is created on top of the backing file. In this case, <code>size</code> must be passed as <code>-1</code>. The size of the snapshot is the same as the size of the backing file, which is discovered automatically. You are encouraged to also pass <code>backingformat</code> to describe the format of <code>backingfile</code>.</p>

<p>If <i>filename</i> refers to a block device, then the device is formatted. The <code>size</code> is ignored since block devices have an intrinsic size.</p>

<p>The other optional parameters are:</p>

<dl>

<dt><code>preallocation</code></dt>
<dd>

<p>If format is <code>raw</code>, then this can be either <code>sparse</code> or <code>full</code> to create a sparse or fully allocated file respectively. The default is <code>sparse</code>.</p>

<p>If format is <code>qcow2</code>, then this can be either <code>off</code> or <code>metadata</code>. Preallocating metadata can be faster when doing lots of writes, but uses more space. The default is <code>off</code>.</p>

</dd>
<dt><code>compat</code></dt>
<dd>

<p><code>qcow2</code> only: Pass the string <code>1.1</code> to use the advanced qcow2 format supported by qemu &ge; 1.1.</p>

</dd>
<dt><code>clustersize</code></dt>
<dd>

<p><code>qcow2</code> only: Change the qcow2 cluster size. The default is 65536 (bytes) and this setting may be any power of two between 512 and 2097152.</p>

</dd>
</dl>

<p>Note that this call does not add the new disk to the handle. You may need to call <a href="#add-drive-opts">&quot;add-drive-opts&quot;</a> separately.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="disk-format">disk-format</h2>

<pre><code> disk-format filename</code></pre>

<p>Detect and return the format of the disk image called <i>filename</i>. <i>filename</i> can also be a host device, etc. If the format of the image could not be detected, then <code>&quot;unknown&quot;</code> is returned.</p>

<p>Note that detecting the disk format can be insecure under some circumstances. See <a href="guestfs.3.html#cve-2010-3851">&quot;CVE-2010-3851&quot; in guestfs(3)</a>.</p>

<p>See also: <a href="guestfs.3.html#disk-image-formats">&quot;DISK IMAGE FORMATS&quot; in guestfs(3)</a></p>

<h2 id="disk-has-backing-file">disk-has-backing-file</h2>

<pre><code> disk-has-backing-file filename</code></pre>

<p>Detect and return whether the disk image <i>filename</i> has a backing file.</p>

<p>Note that detecting disk features can be insecure under some circumstances. See <a href="guestfs.3.html#cve-2010-3851">&quot;CVE-2010-3851&quot; in guestfs(3)</a>.</p>

<h2 id="disk-virtual-size">disk-virtual-size</h2>

<pre><code> disk-virtual-size filename</code></pre>

<p>Detect and return the virtual size in bytes of the disk image called <i>filename</i>.</p>

<p>Note that detecting disk features can be insecure under some circumstances. See <a href="guestfs.3.html#cve-2010-3851">&quot;CVE-2010-3851&quot; in guestfs(3)</a>.</p>

<h2 id="dmesg">dmesg</h2>

<pre><code> dmesg</code></pre>

<p>This returns the kernel messages (<code>dmesg</code> output) from the guest kernel. This is sometimes useful for extended debugging of problems.</p>

<p>Another way to get the same information is to enable verbose messages with <a href="#set-verbose">&quot;set-verbose&quot;</a> or by setting the environment variable <code>LIBGUESTFS_DEBUG=1</code> before running the program.</p>

<h2 id="download">download</h2>

<pre><code> download remotefilename (filename|-)</code></pre>

<p>Download file <i>remotefilename</i> and save it as <i>filename</i> on the local machine.</p>

<p><i>filename</i> can also be a named pipe.</p>

<p>See also <a href="#upload">&quot;upload&quot;</a>, <a href="#cat">&quot;cat&quot;</a>.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<h2 id="download-offset">download-offset</h2>

<pre><code> download-offset remotefilename (filename|-) offset size</code></pre>

<p>Download file <i>remotefilename</i> and save it as <i>filename</i> on the local machine.</p>

<p><i>remotefilename</i> is read for <code>size</code> bytes starting at <code>offset</code> (this region must be within the file or device).</p>

<p>Note that there is no limit on the amount of data that can be downloaded with this call, unlike with <a href="#pread">&quot;pread&quot;</a>, and this call always reads the full amount unless an error occurs.</p>

<p>See also <a href="#download">&quot;download&quot;</a>, <a href="#pread">&quot;pread&quot;</a>.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<h2 id="drop-caches">drop-caches</h2>

<pre><code> drop-caches whattodrop</code></pre>

<p>This instructs the guest kernel to drop its page cache, and/or dentries and inode caches. The parameter <code>whattodrop</code> tells the kernel what precisely to drop, see <a href="http://linux-mm.org/Drop_Caches">http://linux-mm.org/Drop_Caches</a></p>

<p>Setting <code>whattodrop</code> to 3 should drop everything.</p>

<p>This automatically calls <a href="http://man.he.net/man2/sync">sync(2)</a> before the operation, so that the maximum guest memory is freed.</p>

<h2 id="du">du</h2>

<pre><code> du path</code></pre>

<p>This command runs the <code>du -s</code> command to estimate file space usage for <code>path</code>.</p>

<p><code>path</code> can be a file or a directory. If <code>path</code> is a directory then the estimate includes the contents of the directory and all subdirectories (recursively).</p>

<p>The result is the estimated size in <i>kilobytes</i> (ie. units of 1024 bytes).</p>

<h2 id="e2fsck">e2fsck</h2>

<pre><code> e2fsck device [correct:true|false] [forceall:true|false]</code></pre>

<p>This runs the ext2/ext3 filesystem checker on <code>device</code>. It can take the following optional arguments:</p>

<dl>

<dt><code>correct</code></dt>
<dd>

<p>Automatically repair the file system. This option will cause e2fsck to automatically fix any filesystem problems that can be safely fixed without human intervention.</p>

<p>This option may not be specified at the same time as the <code>forceall</code> option.</p>

</dd>
<dt><code>forceall</code></dt>
<dd>

<p>Assume an answer of &#39;yes&#39; to all questions; allows e2fsck to be used non-interactively.</p>

<p>This option may not be specified at the same time as the <code>correct</code> option.</p>

</dd>
</dl>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="e2fsck-f">e2fsck-f</h2>

<pre><code> e2fsck-f device</code></pre>

<p>This runs <code>e2fsck -p -f device</code>, ie. runs the ext2/ext3 filesystem checker on <code>device</code>, noninteractively (<i>-p</i>), even if the filesystem appears to be clean (<i>-f</i>).</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#e2fsck">&quot;e2fsck&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="echo-daemon">echo-daemon</h2>

<pre><code> echo-daemon &#39;words ...&#39;</code></pre>

<p>This command concatenates the list of <code>words</code> passed with single spaces between them and returns the resulting string.</p>

<p>You can use this command to test the connection through to the daemon.</p>

<p>See also <a href="#ping-daemon">&quot;ping-daemon&quot;</a>.</p>

<h2 id="egrep">egrep</h2>

<pre><code> egrep regex path</code></pre>

<p>This calls the external <code>egrep</code> program and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#grep">&quot;grep&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="egrepi">egrepi</h2>

<pre><code> egrepi regex path</code></pre>

<p>This calls the external <code>egrep -i</code> program and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#grep">&quot;grep&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="equal">equal</h2>

<pre><code> equal file1 file2</code></pre>

<p>This compares the two files <i>file1</i> and <i>file2</i> and returns true if their content is exactly equal, or false otherwise.</p>

<p>The external <a href="http://man.he.net/man1/cmp">cmp(1)</a> program is used for the comparison.</p>

<h2 id="exists">exists</h2>

<pre><code> exists path</code></pre>

<p>This returns <code>true</code> if and only if there is a file, directory (or anything) with the given <code>path</code> name.</p>

<p>See also <a href="#is-file">&quot;is-file&quot;</a>, <a href="#is-dir">&quot;is-dir&quot;</a>, <a href="#stat">&quot;stat&quot;</a>.</p>

<h2 id="extlinux">extlinux</h2>

<pre><code> extlinux directory</code></pre>

<p>Install the SYSLINUX bootloader on the device mounted at <i>directory</i>. Unlike <a href="#syslinux">&quot;syslinux&quot;</a> which requires a FAT filesystem, this can be used on an ext2/3/4 or btrfs filesystem.</p>

<p>The <i>directory</i> parameter can be either a mountpoint, or a directory within the mountpoint.</p>

<p>You also have to mark the partition as &quot;active&quot; (<a href="#part-set-bootable">&quot;part-set-bootable&quot;</a>) and a Master Boot Record must be installed (eg. using <a href="#pwrite-device">&quot;pwrite-device&quot;</a>) on the first sector of the whole disk. The SYSLINUX package comes with some suitable Master Boot Records. See the <a href="http://man.he.net/man1/extlinux">extlinux(1)</a> man page for further information.</p>

<p>Additional configuration can be supplied to SYSLINUX by placing a file called <i>extlinux.conf</i> on the filesystem under <i>directory</i>. For further information about the contents of this file, see <a href="http://man.he.net/man1/extlinux">extlinux(1)</a>.</p>

<p>See also <a href="#syslinux">&quot;syslinux&quot;</a>.</p>

<h2 id="fallocate">fallocate</h2>

<pre><code> fallocate path len</code></pre>

<p>This command preallocates a file (containing zero bytes) named <code>path</code> of size <code>len</code> bytes. If the file exists already, it is overwritten.</p>

<p>Do not confuse this with the guestfish-specific <code>alloc</code> command which allocates a file in the host and attaches it as a device.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#fallocate64">&quot;fallocate64&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="fallocate64">fallocate64</h2>

<pre><code> fallocate64 path len</code></pre>

<p>This command preallocates a file (containing zero bytes) named <code>path</code> of size <code>len</code> bytes. If the file exists already, it is overwritten.</p>

<p>Note that this call allocates disk blocks for the file. To create a sparse file use <a href="#truncate-size">&quot;truncate-size&quot;</a> instead.</p>

<p>The deprecated call <a href="#fallocate">&quot;fallocate&quot;</a> does the same, but owing to an oversight it only allowed 30 bit lengths to be specified, effectively limiting the maximum size of files created through that call to 1GB.</p>

<p>Do not confuse this with the guestfish-specific <code>alloc</code> and <code>sparse</code> commands which create a file in the host and attach it as a device.</p>

<h2 id="feature-available">feature-available</h2>

<pre><code> feature-available &#39;groups ...&#39;</code></pre>

<p>This is the same as <a href="#available">&quot;available&quot;</a>, but unlike that call it returns a simple true/false boolean result, instead of throwing an exception if a feature is not found. For other documentation see <a href="#available">&quot;available&quot;</a>.</p>

<h2 id="fgrep">fgrep</h2>

<pre><code> fgrep pattern path</code></pre>

<p>This calls the external <code>fgrep</code> program and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#grep">&quot;grep&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="fgrepi">fgrepi</h2>

<pre><code> fgrepi pattern path</code></pre>

<p>This calls the external <code>fgrep -i</code> program and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#grep">&quot;grep&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="file">file</h2>

<pre><code> file path</code></pre>

<p>This call uses the standard <a href="http://man.he.net/man1/file">file(1)</a> command to determine the type or contents of the file.</p>

<p>This call will also transparently look inside various types of compressed file.</p>

<p>The exact command which runs is <code>file -zb path</code>. Note in particular that the filename is not prepended to the output (the <i>-b</i> option).</p>

<p>The output depends on the output of the underlying <a href="http://man.he.net/man1/file">file(1)</a> command and it can change in future in ways beyond our control. In other words, the output is not guaranteed by the ABI.</p>

<p>See also: <a href="http://man.he.net/man1/file">file(1)</a>, <a href="#vfs-type">&quot;vfs-type&quot;</a>, <a href="#lstat">&quot;lstat&quot;</a>, <a href="#is-file">&quot;is-file&quot;</a>, <a href="#is-blockdev">&quot;is-blockdev&quot;</a> (etc), <a href="#is-zero">&quot;is-zero&quot;</a>.</p>

<h2 id="file-architecture">file-architecture</h2>

<pre><code> file-architecture filename</code></pre>

<p>This detects the architecture of the binary <i>filename</i>, and returns it if known.</p>

<p>Currently defined architectures are:</p>

<dl>

<dt>&quot;i386&quot;</dt>
<dd>

<p>This string is returned for all 32 bit i386, i486, i586, i686 binaries irrespective of the precise processor requirements of the binary.</p>

</dd>
<dt>&quot;x86_64&quot;</dt>
<dd>

<p>64 bit x86-64.</p>

</dd>
<dt>&quot;sparc&quot;</dt>
<dd>

<p>32 bit SPARC.</p>

</dd>
<dt>&quot;sparc64&quot;</dt>
<dd>

<p>64 bit SPARC V9 and above.</p>

</dd>
<dt>&quot;ia64&quot;</dt>
<dd>

<p>Intel Itanium.</p>

</dd>
<dt>&quot;ppc&quot;</dt>
<dd>

<p>32 bit Power PC.</p>

</dd>
<dt>&quot;ppc64&quot;</dt>
<dd>

<p>64 bit Power PC.</p>

</dd>
<dt>&quot;arm&quot;</dt>
<dd>

<p>32 bit ARM.</p>

</dd>
<dt>&quot;aarch64&quot;</dt>
<dd>

<p>64 bit ARM.</p>

</dd>
</dl>

<p>Libguestfs may return other architecture strings in future.</p>

<p>The function works on at least the following types of files:</p>

<ul>

<li><p>many types of Un*x and Linux binary</p>

</li>
<li><p>many types of Un*x and Linux shared library</p>

</li>
<li><p>Windows Win32 and Win64 binaries</p>

</li>
<li><p>Windows Win32 and Win64 DLLs</p>

<p>Win32 binaries and DLLs return <code>i386</code>.</p>

<p>Win64 binaries and DLLs return <code>x86_64</code>.</p>

</li>
<li><p>Linux kernel modules</p>

</li>
<li><p>Linux new-style initrd images</p>

</li>
<li><p>some non-x86 Linux vmlinuz kernels</p>

</li>
</ul>

<p>What it can&#39;t do currently:</p>

<ul>

<li><p>static libraries (libfoo.a)</p>

</li>
<li><p>Linux old-style initrd as compressed ext2 filesystem (RHEL 3)</p>

</li>
<li><p>x86 Linux vmlinuz kernels</p>

<p>x86 vmlinuz images (bzImage format) consist of a mix of 16-, 32- and compressed code, and are horribly hard to unpack. If you want to find the architecture of a kernel, use the architecture of the associated initrd or kernel module(s) instead.</p>

</li>
</ul>

<h2 id="filesize">filesize</h2>

<pre><code> filesize file</code></pre>

<p>This command returns the size of <i>file</i> in bytes.</p>

<p>To get other stats about a file, use <a href="#stat">&quot;stat&quot;</a>, <a href="#lstat">&quot;lstat&quot;</a>, <a href="#is-dir">&quot;is-dir&quot;</a>, <a href="#is-file">&quot;is-file&quot;</a> etc. To get the size of block devices, use <a href="#blockdev-getsize64">&quot;blockdev-getsize64&quot;</a>.</p>

<h2 id="filesystem-available">filesystem-available</h2>

<pre><code> filesystem-available filesystem</code></pre>

<p>Check whether libguestfs supports the named filesystem. The argument <code>filesystem</code> is a filesystem name, such as <code>ext3</code>.</p>

<p>You must call <a href="#launch">&quot;launch&quot;</a> before using this command.</p>

<p>This is mainly useful as a negative test. If this returns true, it doesn&#39;t mean that a particular filesystem can be created or mounted, since filesystems can fail for other reasons such as it being a later version of the filesystem, or having incompatible features, or lacking the right mkfs.&lt;<i>fs</i>&gt; tool.</p>

<p>See also <a href="#available">&quot;available&quot;</a>, <a href="#feature-available">&quot;feature-available&quot;</a>, <a href="guestfs.3.html#availability">&quot;AVAILABILITY&quot; in guestfs(3)</a>.</p>

<h2 id="fill">fill</h2>

<pre><code> fill c len path</code></pre>

<p>This command creates a new file called <code>path</code>. The initial content of the file is <code>len</code> octets of <code>c</code>, where <code>c</code> must be a number in the range <code>[0..255]</code>.</p>

<p>To fill a file with zero bytes (sparsely), it is much more efficient to use <a href="#truncate-size">&quot;truncate-size&quot;</a>. To create a file with a pattern of repeating bytes use <a href="#fill-pattern">&quot;fill-pattern&quot;</a>.</p>

<h2 id="fill-dir">fill-dir</h2>

<pre><code> fill-dir dir nr</code></pre>

<p>This function, useful for testing filesystems, creates <code>nr</code> empty files in the directory <code>dir</code> with names <code>00000000</code> through <code>nr-1</code> (ie. each file name is 8 digits long padded with zeroes).</p>

<h2 id="fill-pattern">fill-pattern</h2>

<pre><code> fill-pattern pattern len path</code></pre>

<p>This function is like <a href="#fill">&quot;fill&quot;</a> except that it creates a new file of length <code>len</code> containing the repeating pattern of bytes in <code>pattern</code>. The pattern is truncated if necessary to ensure the length of the file is exactly <code>len</code> bytes.</p>

<h2 id="find">find</h2>

<pre><code> find directory</code></pre>

<p>This command lists out all files and directories, recursively, starting at <i>directory</i>. It is essentially equivalent to running the shell command <code>find directory -print</code> but some post-processing happens on the output, described below.</p>

<p>This returns a list of strings <i>without any prefix</i>. Thus if the directory structure was:</p>

<pre><code> /tmp/a
 /tmp/b
 /tmp/c/d</code></pre>

<p>then the returned list from <a href="#find">&quot;find&quot;</a> <i>/tmp</i> would be 4 elements:</p>

<pre><code> a
 b
 c
 c/d</code></pre>

<p>If <i>directory</i> is not a directory, then this command returns an error.</p>

<p>The returned list is sorted.</p>

<h2 id="find0">find0</h2>

<pre><code> find0 directory (files|-)</code></pre>

<p>This command lists out all files and directories, recursively, starting at <i>directory</i>, placing the resulting list in the external file called <i>files</i>.</p>

<p>This command works the same way as <a href="#find">&quot;find&quot;</a> with the following exceptions:</p>

<ul>

<li><p>The resulting list is written to an external file.</p>

</li>
<li><p>Items (filenames) in the result are separated by <code>\0</code> characters. See <a href="http://man.he.net/man1/find">find(1)</a> option <i>-print0</i>.</p>

</li>
<li><p>The result list is not sorted.</p>

</li>
</ul>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<h2 id="findfs-label">findfs-label</h2>

<pre><code> findfs-label label</code></pre>

<p>This command searches the filesystems and returns the one which has the given label. An error is returned if no such filesystem can be found.</p>

<p>To find the label of a filesystem, use <a href="#vfs-label">&quot;vfs-label&quot;</a>.</p>

<h2 id="findfs-uuid">findfs-uuid</h2>

<pre><code> findfs-uuid uuid</code></pre>

<p>This command searches the filesystems and returns the one which has the given UUID. An error is returned if no such filesystem can be found.</p>

<p>To find the UUID of a filesystem, use <a href="#vfs-uuid">&quot;vfs-uuid&quot;</a>.</p>

<h2 id="fsck">fsck</h2>

<pre><code> fsck fstype device</code></pre>

<p>This runs the filesystem checker (fsck) on <code>device</code> which should have filesystem type <code>fstype</code>.</p>

<p>The returned integer is the status. See <a href="http://man.he.net/man8/fsck">fsck(8)</a> for the list of status codes from <code>fsck</code>.</p>

<p>Notes:</p>

<ul>

<li><p>Multiple status codes can be summed together.</p>

</li>
<li><p>A non-zero return code can mean &quot;success&quot;, for example if errors have been corrected on the filesystem.</p>

</li>
<li><p>Checking or repairing NTFS volumes is not supported (by linux-ntfs).</p>

</li>
</ul>

<p>This command is entirely equivalent to running <code>fsck -a -t fstype device</code>.</p>

<h2 id="fstrim">fstrim</h2>

<pre><code> fstrim mountpoint [offset:N] [length:N] [minimumfreeextent:N]</code></pre>

<p>Trim the free space in the filesystem mounted on <code>mountpoint</code>. The filesystem must be mounted read-write.</p>

<p>The filesystem contents are not affected, but any free space in the filesystem is &quot;trimmed&quot;, that is, given back to the host device, thus making disk images more sparse, allowing unused space in qcow2 files to be reused, etc.</p>

<p>This operation requires support in libguestfs, the mounted filesystem, the host filesystem, qemu and the host kernel. If this support isn&#39;t present it may give an error or even appear to run but do nothing.</p>

<p>See also <a href="#zero-free-space">&quot;zero-free-space&quot;</a>. That is a slightly different operation that turns free space in the filesystem into zeroes. It is valid to call <a href="#fstrim">&quot;fstrim&quot;</a> either instead of, or after calling <a href="#zero-free-space">&quot;zero-free-space&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="get-append">get-append</h2>

<pre><code> get-append</code></pre>

<p>Return the additional kernel options which are added to the libguestfs appliance kernel command line.</p>

<p>If <code>NULL</code> then no options are added.</p>

<h2 id="get-attach-method">get-attach-method</h2>

<pre><code> get-attach-method</code></pre>

<p>Return the current backend.</p>

<p>See <a href="#set-backend">&quot;set-backend&quot;</a> and <a href="guestfs.3.html#backend">&quot;BACKEND&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#get-backend">&quot;get-backend&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="get-autosync">get-autosync</h2>

<pre><code> get-autosync</code></pre>

<p>Get the autosync flag.</p>

<h2 id="get-backend">get-backend</h2>

<pre><code> get-backend</code></pre>

<p>Return the current backend.</p>

<p>This handle property was previously called the &quot;attach method&quot;.</p>

<p>See <a href="#set-backend">&quot;set-backend&quot;</a> and <a href="guestfs.3.html#backend">&quot;BACKEND&quot; in guestfs(3)</a>.</p>

<h2 id="get-backend-setting">get-backend-setting</h2>

<pre><code> get-backend-setting name</code></pre>

<p>Find a backend setting string which is either <code>&quot;name&quot;</code> or begins with <code>&quot;name=&quot;</code>. If <code>&quot;name&quot;</code>, this returns the string <code>&quot;1&quot;</code>. If <code>&quot;name=&quot;</code>, this returns the part after the equals sign (which may be an empty string).</p>

<p>If no such setting is found, this function throws an error. The errno (see <a href="#last-errno">&quot;last-errno&quot;</a>) will be <code>ESRCH</code> in this case.</p>

<p>See <a href="guestfs.3.html#backend">&quot;BACKEND&quot; in guestfs(3)</a>, <a href="guestfs.3.html#backend-settings">&quot;BACKEND SETTINGS&quot; in guestfs(3)</a>.</p>

<h2 id="get-backend-settings">get-backend-settings</h2>

<pre><code> get-backend-settings</code></pre>

<p>Return the current backend settings.</p>

<p>This call returns all backend settings strings. If you want to find a single backend setting, see <a href="#get-backend-setting">&quot;get-backend-setting&quot;</a>.</p>

<p>See <a href="guestfs.3.html#backend">&quot;BACKEND&quot; in guestfs(3)</a>, <a href="guestfs.3.html#backend-settings">&quot;BACKEND SETTINGS&quot; in guestfs(3)</a>.</p>

<h2 id="get-cachedir">get-cachedir</h2>

<pre><code> get-cachedir</code></pre>

<p>Get the directory used by the handle to store the appliance cache.</p>

<h2 id="get-direct">get-direct</h2>

<pre><code> get-direct</code></pre>

<p>Return the direct appliance mode flag.</p>

<h2 id="get-e2attrs">get-e2attrs</h2>

<pre><code> get-e2attrs file</code></pre>

<p>This returns the file attributes associated with <i>file</i>.</p>

<p>The attributes are a set of bits associated with each inode which affect the behaviour of the file. The attributes are returned as a string of letters (described below). The string may be empty, indicating that no file attributes are set for this file.</p>

<p>These attributes are only present when the file is located on an ext2/3/4 filesystem. Using this call on other filesystem types will result in an error.</p>

<p>The characters (file attributes) in the returned string are currently:</p>

<dl>

<dt>&#39;A&#39;</dt>
<dd>

<p>When the file is accessed, its atime is not modified.</p>

</dd>
<dt>&#39;a&#39;</dt>
<dd>

<p>The file is append-only.</p>

</dd>
<dt>&#39;c&#39;</dt>
<dd>

<p>The file is compressed on-disk.</p>

</dd>
<dt>&#39;D&#39;</dt>
<dd>

<p>(Directories only.) Changes to this directory are written synchronously to disk.</p>

</dd>
<dt>&#39;d&#39;</dt>
<dd>

<p>The file is not a candidate for backup (see <a href="http://man.he.net/man8/dump">dump(8)</a>).</p>

</dd>
<dt>&#39;E&#39;</dt>
<dd>

<p>The file has compression errors.</p>

</dd>
<dt>&#39;e&#39;</dt>
<dd>

<p>The file is using extents.</p>

</dd>
<dt>&#39;h&#39;</dt>
<dd>

<p>The file is storing its blocks in units of the filesystem blocksize instead of sectors.</p>

</dd>
<dt>&#39;I&#39;</dt>
<dd>

<p>(Directories only.) The directory is using hashed trees.</p>

</dd>
<dt>&#39;i&#39;</dt>
<dd>

<p>The file is immutable. It cannot be modified, deleted or renamed. No link can be created to this file.</p>

</dd>
<dt>&#39;j&#39;</dt>
<dd>

<p>The file is data-journaled.</p>

</dd>
<dt>&#39;s&#39;</dt>
<dd>

<p>When the file is deleted, all its blocks will be zeroed.</p>

</dd>
<dt>&#39;S&#39;</dt>
<dd>

<p>Changes to this file are written synchronously to disk.</p>

</dd>
<dt>&#39;T&#39;</dt>
<dd>

<p>(Directories only.) This is a hint to the block allocator that subdirectories contained in this directory should be spread across blocks. If not present, the block allocator will try to group subdirectories together.</p>

</dd>
<dt>&#39;t&#39;</dt>
<dd>

<p>For a file, this disables tail-merging. (Not used by upstream implementations of ext2.)</p>

</dd>
<dt>&#39;u&#39;</dt>
<dd>

<p>When the file is deleted, its blocks will be saved, allowing the file to be undeleted.</p>

</dd>
<dt>&#39;X&#39;</dt>
<dd>

<p>The raw contents of the compressed file may be accessed.</p>

</dd>
<dt>&#39;Z&#39;</dt>
<dd>

<p>The compressed file is dirty.</p>

</dd>
</dl>

<p>More file attributes may be added to this list later. Not all file attributes may be set for all kinds of files. For detailed information, consult the <a href="http://man.he.net/man1/chattr">chattr(1)</a> man page.</p>

<p>See also <a href="#set-e2attrs">&quot;set-e2attrs&quot;</a>.</p>

<p>Don&#39;t confuse these attributes with extended attributes (see <a href="#getxattr">&quot;getxattr&quot;</a>).</p>

<h2 id="get-e2generation">get-e2generation</h2>

<pre><code> get-e2generation file</code></pre>

<p>This returns the ext2 file generation of a file. The generation (which used to be called the &quot;version&quot;) is a number associated with an inode. This is most commonly used by NFS servers.</p>

<p>The generation is only present when the file is located on an ext2/3/4 filesystem. Using this call on other filesystem types will result in an error.</p>

<p>See <a href="#set-e2generation">&quot;set-e2generation&quot;</a>.</p>

<h2 id="get-e2label">get-e2label</h2>

<pre><code> get-e2label device</code></pre>

<p>This returns the ext2/3/4 filesystem label of the filesystem on <code>device</code>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#vfs-label">&quot;vfs-label&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="get-e2uuid">get-e2uuid</h2>

<pre><code> get-e2uuid device</code></pre>

<p>This returns the ext2/3/4 filesystem UUID of the filesystem on <code>device</code>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#vfs-uuid">&quot;vfs-uuid&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="get-hv">get-hv</h2>

<pre><code> get-hv</code></pre>

<p>Return the current hypervisor binary.</p>

<p>This is always non-NULL. If it wasn&#39;t set already, then this will return the default qemu binary name.</p>

<h2 id="get-libvirt-requested-credential-challenge">get-libvirt-requested-credential-challenge</h2>

<pre><code> get-libvirt-requested-credential-challenge index</code></pre>

<p>Get the challenge (provided by libvirt) for the <code>index</code>&#39;th requested credential. If libvirt did not provide a challenge, this returns the empty string <code>&quot;&quot;</code>.</p>

<p>See <a href="guestfs.3.html#libvirt-authentication">&quot;LIBVIRT AUTHENTICATION&quot; in guestfs(3)</a> for documentation and example code.</p>

<h2 id="get-libvirt-requested-credential-defresult">get-libvirt-requested-credential-defresult</h2>

<pre><code> get-libvirt-requested-credential-defresult index</code></pre>

<p>Get the default result (provided by libvirt) for the <code>index</code>&#39;th requested credential. If libvirt did not provide a default result, this returns the empty string <code>&quot;&quot;</code>.</p>

<p>See <a href="guestfs.3.html#libvirt-authentication">&quot;LIBVIRT AUTHENTICATION&quot; in guestfs(3)</a> for documentation and example code.</p>

<h2 id="get-libvirt-requested-credential-prompt">get-libvirt-requested-credential-prompt</h2>

<pre><code> get-libvirt-requested-credential-prompt index</code></pre>

<p>Get the prompt (provided by libvirt) for the <code>index</code>&#39;th requested credential. If libvirt did not provide a prompt, this returns the empty string <code>&quot;&quot;</code>.</p>

<p>See <a href="guestfs.3.html#libvirt-authentication">&quot;LIBVIRT AUTHENTICATION&quot; in guestfs(3)</a> for documentation and example code.</p>

<h2 id="get-libvirt-requested-credentials">get-libvirt-requested-credentials</h2>

<pre><code> get-libvirt-requested-credentials</code></pre>

<p>This should only be called during the event callback for events of type <code>GUESTFS_EVENT_LIBVIRT_AUTH</code>.</p>

<p>Return the list of credentials requested by libvirt. Possible values are a subset of the strings provided when you called <a href="#set-libvirt-supported-credentials">&quot;set-libvirt-supported-credentials&quot;</a>.</p>

<p>See <a href="guestfs.3.html#libvirt-authentication">&quot;LIBVIRT AUTHENTICATION&quot; in guestfs(3)</a> for documentation and example code.</p>

<h2 id="get-memsize">get-memsize</h2>

<pre><code> get-memsize</code></pre>

<p>This gets the memory size in megabytes allocated to the hypervisor.</p>

<p>If <a href="#set-memsize">&quot;set-memsize&quot;</a> was not called on this handle, and if <code>LIBGUESTFS_MEMSIZE</code> was not set, then this returns the compiled-in default value for memsize.</p>

<p>For more information on the architecture of libguestfs, see <a href="guestfs.3.html">guestfs(3)</a>.</p>

<h2 id="get-network">get-network</h2>

<pre><code> get-network</code></pre>

<p>This returns the enable network flag.</p>

<h2 id="get-path">get-path</h2>

<pre><code> get-path</code></pre>

<p>Return the current search path.</p>

<p>This is always non-NULL. If it wasn&#39;t set already, then this will return the default path.</p>

<h2 id="get-pgroup">get-pgroup</h2>

<pre><code> get-pgroup</code></pre>

<p>This returns the process group flag.</p>

<h2 id="get-pid">get-pid</h2>

<h2 id="pid">pid</h2>

<pre><code> get-pid</code></pre>

<p>Return the process ID of the hypervisor. If there is no hypervisor running, then this will return an error.</p>

<p>This is an internal call used for debugging and testing.</p>

<h2 id="get-program">get-program</h2>

<pre><code> get-program</code></pre>

<p>Get the program name. See <a href="#set-program">&quot;set-program&quot;</a>.</p>

<h2 id="get-qemu">get-qemu</h2>

<pre><code> get-qemu</code></pre>

<p>Return the current hypervisor binary (usually qemu).</p>

<p>This is always non-NULL. If it wasn&#39;t set already, then this will return the default qemu binary name.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#get-hv">&quot;get-hv&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="get-recovery-proc">get-recovery-proc</h2>

<pre><code> get-recovery-proc</code></pre>

<p>Return the recovery process enabled flag.</p>

<h2 id="get-selinux">get-selinux</h2>

<pre><code> get-selinux</code></pre>

<p>This returns the current setting of the selinux flag which is passed to the appliance at boot time. See <a href="#set-selinux">&quot;set-selinux&quot;</a>.</p>

<p>For more information on the architecture of libguestfs, see <a href="guestfs.3.html">guestfs(3)</a>.</p>

<h2 id="get-smp">get-smp</h2>

<pre><code> get-smp</code></pre>

<p>This returns the number of virtual CPUs assigned to the appliance.</p>

<h2 id="get-tmpdir">get-tmpdir</h2>

<pre><code> get-tmpdir</code></pre>

<p>Get the directory used by the handle to store temporary files.</p>

<h2 id="get-trace">get-trace</h2>

<pre><code> get-trace</code></pre>

<p>Return the command trace flag.</p>

<h2 id="get-umask">get-umask</h2>

<pre><code> get-umask</code></pre>

<p>Return the current umask. By default the umask is <code>022</code> unless it has been set by calling <a href="#umask">&quot;umask&quot;</a>.</p>

<h2 id="get-verbose">get-verbose</h2>

<pre><code> get-verbose</code></pre>

<p>This returns the verbose messages flag.</p>

<h2 id="getcon">getcon</h2>

<pre><code> getcon</code></pre>

<p>This gets the SELinux security context of the daemon.</p>

<p>See the documentation about SELINUX in <a href="guestfs.3.html">guestfs(3)</a>, and <a href="#setcon">&quot;setcon&quot;</a></p>

<h2 id="getxattr">getxattr</h2>

<pre><code> getxattr path name</code></pre>

<p>Get a single extended attribute from file <code>path</code> named <code>name</code>. This call follows symlinks. If you want to lookup an extended attribute for the symlink itself, use <a href="#lgetxattr">&quot;lgetxattr&quot;</a>.</p>

<p>Normally it is better to get all extended attributes from a file in one go by calling <a href="#getxattrs">&quot;getxattrs&quot;</a>. However some Linux filesystem implementations are buggy and do not provide a way to list out attributes. For these filesystems (notably ntfs-3g) you have to know the names of the extended attributes you want in advance and call this function.</p>

<p>Extended attribute values are blobs of binary data. If there is no extended attribute named <code>name</code>, this returns an error.</p>

<p>See also: <a href="#getxattrs">&quot;getxattrs&quot;</a>, <a href="#lgetxattr">&quot;lgetxattr&quot;</a>, <a href="http://man.he.net/man5/attr">attr(5)</a>.</p>

<h2 id="getxattrs">getxattrs</h2>

<pre><code> getxattrs path</code></pre>

<p>This call lists the extended attributes of the file or directory <code>path</code>.</p>

<p>At the system call level, this is a combination of the <a href="http://man.he.net/man2/listxattr">listxattr(2)</a> and <a href="http://man.he.net/man2/getxattr">getxattr(2)</a> calls.</p>

<p>See also: <a href="#lgetxattrs">&quot;lgetxattrs&quot;</a>, <a href="http://man.he.net/man5/attr">attr(5)</a>.</p>

<h2 id="glob-expand">glob-expand</h2>

<pre><code> glob-expand pattern</code></pre>

<p>This command searches for all the pathnames matching <code>pattern</code> according to the wildcard expansion rules used by the shell.</p>

<p>If no paths match, then this returns an empty list (note: not an error).</p>

<p>It is just a wrapper around the C <a href="http://man.he.net/man3/glob">glob(3)</a> function with flags <code>GLOB_MARK|GLOB_BRACE</code>. See that manual page for more details.</p>

<p>Notice that there is no equivalent command for expanding a device name (eg. <i>/dev/sd*</i>). Use <a href="#list-devices">&quot;list-devices&quot;</a>, <a href="#list-partitions">&quot;list-partitions&quot;</a> etc functions instead.</p>

<h2 id="grep">grep</h2>

<h2 id="grep-opts">grep-opts</h2>

<pre><code> grep regex path [extended:true|false] [fixed:true|false] [insensitive:true|false] [compressed:true|false]</code></pre>

<p>This calls the external <code>grep</code> program and returns the matching lines.</p>

<p>The optional flags are:</p>

<dl>

<dt><code>extended</code></dt>
<dd>

<p>Use extended regular expressions. This is the same as using the <i>-E</i> flag.</p>

</dd>
<dt><code>fixed</code></dt>
<dd>

<p>Match fixed (don&#39;t use regular expressions). This is the same as using the <i>-F</i> flag.</p>

</dd>
<dt><code>insensitive</code></dt>
<dd>

<p>Match case-insensitive. This is the same as using the <i>-i</i> flag.</p>

</dd>
<dt><code>compressed</code></dt>
<dd>

<p>Use <code>zgrep</code> instead of <code>grep</code>. This allows the input to be compress- or gzip-compressed.</p>

</dd>
</dl>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="grepi">grepi</h2>

<pre><code> grepi regex path</code></pre>

<p>This calls the external <code>grep -i</code> program and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#grep">&quot;grep&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="grub-install">grub-install</h2>

<pre><code> grub-install root device</code></pre>

<p>This command installs GRUB 1 (the Grand Unified Bootloader) on <code>device</code>, with the root directory being <code>root</code>.</p>

<p>Notes:</p>

<ul>

<li><p>There is currently no way in the API to install grub2, which is used by most modern Linux guests. It is possible to run the grub2 command from the guest, although see the caveats in <a href="guestfs.3.html#running-commands">&quot;RUNNING COMMANDS&quot; in guestfs(3)</a>.</p>

</li>
<li><p>This uses <code>grub-install</code> from the host. Unfortunately grub is not always compatible with itself, so this only works in rather narrow circumstances. Careful testing with each guest version is advisable.</p>

</li>
<li><p>If grub-install reports the error &quot;No suitable drive was found in the generated device map.&quot; it may be that you need to create a <i>/boot/grub/device.map</i> file first that contains the mapping between grub device names and Linux device names. It is usually sufficient to create a file containing:</p>

<pre><code> (hd0) /dev/vda</code></pre>

<p>replacing <i>/dev/vda</i> with the name of the installation device.</p>

</li>
</ul>

<h2 id="head">head</h2>

<pre><code> head path</code></pre>

<p>This command returns up to the first 10 lines of a file as a list of strings.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="head-n">head-n</h2>

<pre><code> head-n nrlines path</code></pre>

<p>If the parameter <code>nrlines</code> is a positive number, this returns the first <code>nrlines</code> lines of the file <code>path</code>.</p>

<p>If the parameter <code>nrlines</code> is a negative number, this returns lines from the file <code>path</code>, excluding the last <code>nrlines</code> lines.</p>

<p>If the parameter <code>nrlines</code> is zero, this returns an empty list.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="hexdump">hexdump</h2>

<pre><code> hexdump path</code></pre>

<p>This runs <code>hexdump -C</code> on the given <code>path</code>. The result is the human-readable, canonical hex dump of the file.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="hivex-close">hivex-close</h2>

<pre><code> hivex-close</code></pre>

<p>Close the current hivex handle.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-commit">hivex-commit</h2>

<pre><code> hivex-commit filename</code></pre>

<p>Commit (write) changes to the hive.</p>

<p>If the optional <i>filename</i> parameter is null, then the changes are written back to the same hive that was opened. If this is not null then they are written to the alternate filename given and the original hive is left untouched.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-node-add-child">hivex-node-add-child</h2>

<pre><code> hivex-node-add-child parent name</code></pre>

<p>Add a child node to <code>parent</code> named <code>name</code>.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-node-children">hivex-node-children</h2>

<pre><code> hivex-node-children nodeh</code></pre>

<p>Return the list of nodes which are subkeys of <code>nodeh</code>.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-node-delete-child">hivex-node-delete-child</h2>

<pre><code> hivex-node-delete-child nodeh</code></pre>

<p>Delete <code>nodeh</code>, recursively if necessary.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-node-get-child">hivex-node-get-child</h2>

<pre><code> hivex-node-get-child nodeh name</code></pre>

<p>Return the child of <code>nodeh</code> with the name <code>name</code>, if it exists. This can return <code>0</code> meaning the name was not found.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-node-get-value">hivex-node-get-value</h2>

<pre><code> hivex-node-get-value nodeh key</code></pre>

<p>Return the value attached to <code>nodeh</code> which has the name <code>key</code>, if it exists. This can return <code>0</code> meaning the key was not found.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-node-name">hivex-node-name</h2>

<pre><code> hivex-node-name nodeh</code></pre>

<p>Return the name of <code>nodeh</code>.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-node-parent">hivex-node-parent</h2>

<pre><code> hivex-node-parent nodeh</code></pre>

<p>Return the parent node of <code>nodeh</code>.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-node-set-value">hivex-node-set-value</h2>

<pre><code> hivex-node-set-value nodeh key t val</code></pre>

<p>Set or replace a single value under the node <code>nodeh</code>. The <code>key</code> is the name, <code>t</code> is the type, and <code>val</code> is the data.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-node-values">hivex-node-values</h2>

<pre><code> hivex-node-values nodeh</code></pre>

<p>Return the array of (key, datatype, data) tuples attached to <code>nodeh</code>.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-open">hivex-open</h2>

<pre><code> hivex-open filename [verbose:true|false] [debug:true|false] [write:true|false]</code></pre>

<p>Open the Windows Registry hive file named <i>filename</i>. If there was any previous hivex handle associated with this guestfs session, then it is closed.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="hivex-root">hivex-root</h2>

<pre><code> hivex-root</code></pre>

<p>Return the root node of the hive.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-value-key">hivex-value-key</h2>

<pre><code> hivex-value-key valueh</code></pre>

<p>Return the key (name) field of a (key, datatype, data) tuple.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-value-type">hivex-value-type</h2>

<pre><code> hivex-value-type valueh</code></pre>

<p>Return the data type field from a (key, datatype, data) tuple.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<h2 id="hivex-value-utf8">hivex-value-utf8</h2>

<pre><code> hivex-value-utf8 valueh</code></pre>

<p>This calls <a href="#hivex-value-value">&quot;hivex-value-value&quot;</a> (which returns the data field from a hivex value tuple). It then assumes that the field is a UTF-16LE string and converts the result to UTF-8 (or if this is not possible, it returns an error).</p>

<p>This is useful for reading strings out of the Windows registry. However it is not foolproof because the registry is not strongly-typed and fields can contain arbitrary or unexpected data.</p>

<h2 id="hivex-value-value">hivex-value-value</h2>

<pre><code> hivex-value-value valueh</code></pre>

<p>Return the data field of a (key, datatype, data) tuple.</p>

<p>This is a wrapper around the <a href="hivex.3.html">hivex(3)</a> call of the same name.</p>

<p>See also: <a href="#hivex-value-utf8">&quot;hivex-value-utf8&quot;</a>.</p>

<h2 id="initrd-cat">initrd-cat</h2>

<pre><code> initrd-cat initrdpath filename</code></pre>

<p>This command unpacks the file <i>filename</i> from the initrd file called <i>initrdpath</i>. The filename must be given <i>without</i> the initial <i>/</i> character.</p>

<p>For example, in guestfish you could use the following command to examine the boot script (usually called <i>/init</i>) contained in a Linux initrd or initramfs image:</p>

<pre><code> initrd-cat /boot/initrd-&lt;version&gt;.img init</code></pre>

<p>See also <a href="#initrd-list">&quot;initrd-list&quot;</a>.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="initrd-list">initrd-list</h2>

<pre><code> initrd-list path</code></pre>

<p>This command lists out files contained in an initrd.</p>

<p>The files are listed without any initial <i>/</i> character. The files are listed in the order they appear (not necessarily alphabetical). Directory names are listed as separate items.</p>

<p>Old Linux kernels (2.4 and earlier) used a compressed ext2 filesystem as initrd. We <i>only</i> support the newer initramfs format (compressed cpio files).</p>

<h2 id="inotify-add-watch">inotify-add-watch</h2>

<pre><code> inotify-add-watch path mask</code></pre>

<p>Watch <code>path</code> for the events listed in <code>mask</code>.</p>

<p>Note that if <code>path</code> is a directory then events within that directory are watched, but this does <i>not</i> happen recursively (in subdirectories).</p>

<p>Note for non-C or non-Linux callers: the inotify events are defined by the Linux kernel ABI and are listed in <i>/usr/include/sys/inotify.h</i>.</p>

<h2 id="inotify-close">inotify-close</h2>

<pre><code> inotify-close</code></pre>

<p>This closes the inotify handle which was previously opened by inotify_init. It removes all watches, throws away any pending events, and deallocates all resources.</p>

<h2 id="inotify-files">inotify-files</h2>

<pre><code> inotify-files</code></pre>

<p>This function is a helpful wrapper around <a href="#inotify-read">&quot;inotify-read&quot;</a> which just returns a list of pathnames of objects that were touched. The returned pathnames are sorted and deduplicated.</p>

<h2 id="inotify-init">inotify-init</h2>

<pre><code> inotify-init maxevents</code></pre>

<p>This command creates a new inotify handle. The inotify subsystem can be used to notify events which happen to objects in the guest filesystem.</p>

<p><code>maxevents</code> is the maximum number of events which will be queued up between calls to <a href="#inotify-read">&quot;inotify-read&quot;</a> or <a href="#inotify-files">&quot;inotify-files&quot;</a>. If this is passed as <code>0</code>, then the kernel (or previously set) default is used. For Linux 2.6.29 the default was 16384 events. Beyond this limit, the kernel throws away events, but records the fact that it threw them away by setting a flag <code>IN_Q_OVERFLOW</code> in the returned structure list (see <a href="#inotify-read">&quot;inotify-read&quot;</a>).</p>

<p>Before any events are generated, you have to add some watches to the internal watch list. See: <a href="#inotify-add-watch">&quot;inotify-add-watch&quot;</a> and <a href="#inotify-rm-watch">&quot;inotify-rm-watch&quot;</a>.</p>

<p>Queued up events should be read periodically by calling <a href="#inotify-read">&quot;inotify-read&quot;</a> (or <a href="#inotify-files">&quot;inotify-files&quot;</a> which is just a helpful wrapper around <a href="#inotify-read">&quot;inotify-read&quot;</a>). If you don&#39;t read the events out often enough then you risk the internal queue overflowing.</p>

<p>The handle should be closed after use by calling <a href="#inotify-close">&quot;inotify-close&quot;</a>. This also removes any watches automatically.</p>

<p>See also <a href="http://man.he.net/man7/inotify">inotify(7)</a> for an overview of the inotify interface as exposed by the Linux kernel, which is roughly what we expose via libguestfs. Note that there is one global inotify handle per libguestfs instance.</p>

<h2 id="inotify-read">inotify-read</h2>

<pre><code> inotify-read</code></pre>

<p>Return the complete queue of events that have happened since the previous read call.</p>

<p>If no events have happened, this returns an empty list.</p>

<p><i>Note</i>: In order to make sure that all events have been read, you must call this function repeatedly until it returns an empty list. The reason is that the call will read events up to the maximum appliance-to-host message size and leave remaining events in the queue.</p>

<h2 id="inotify-rm-watch">inotify-rm-watch</h2>

<pre><code> inotify-rm-watch wd</code></pre>

<p>Remove a previously defined inotify watch. See <a href="#inotify-add-watch">&quot;inotify-add-watch&quot;</a>.</p>

<h2 id="inspect-get-arch">inspect-get-arch</h2>

<pre><code> inspect-get-arch root</code></pre>

<p>This returns the architecture of the inspected operating system. The possible return values are listed under <a href="#file-architecture">&quot;file-architecture&quot;</a>.</p>

<p>If the architecture could not be determined, then the string <code>unknown</code> is returned.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-get-distro">inspect-get-distro</h2>

<pre><code> inspect-get-distro root</code></pre>

<p>This returns the distro (distribution) of the inspected operating system.</p>

<p>Currently defined distros are:</p>

<dl>

<dt>&quot;archlinux&quot;</dt>
<dd>

<p>Arch Linux.</p>

</dd>
<dt>&quot;buildroot&quot;</dt>
<dd>

<p>Buildroot-derived distro, but not one we specifically recognize.</p>

</dd>
<dt>&quot;centos&quot;</dt>
<dd>

<p>CentOS.</p>

</dd>
<dt>&quot;cirros&quot;</dt>
<dd>

<p>Cirros.</p>

</dd>
<dt>&quot;coreos&quot;</dt>
<dd>

<p>CoreOS.</p>

</dd>
<dt>&quot;debian&quot;</dt>
<dd>

<p>Debian.</p>

</dd>
<dt>&quot;fedora&quot;</dt>
<dd>

<p>Fedora.</p>

</dd>
<dt>&quot;freebsd&quot;</dt>
<dd>

<p>FreeBSD.</p>

</dd>
<dt>&quot;freedos&quot;</dt>
<dd>

<p>FreeDOS.</p>

</dd>
<dt>&quot;gentoo&quot;</dt>
<dd>

<p>Gentoo.</p>

</dd>
<dt>&quot;linuxmint&quot;</dt>
<dd>

<p>Linux Mint.</p>

</dd>
<dt>&quot;mageia&quot;</dt>
<dd>

<p>Mageia.</p>

</dd>
<dt>&quot;mandriva&quot;</dt>
<dd>

<p>Mandriva.</p>

</dd>
<dt>&quot;meego&quot;</dt>
<dd>

<p>MeeGo.</p>

</dd>
<dt>&quot;netbsd&quot;</dt>
<dd>

<p>NetBSD.</p>

</dd>
<dt>&quot;openbsd&quot;</dt>
<dd>

<p>OpenBSD.</p>

</dd>
<dt>&quot;opensuse&quot;</dt>
<dd>

<p>OpenSUSE.</p>

</dd>
<dt>&quot;oraclelinux&quot;</dt>
<dd>

<p>Oracle Linux.</p>

</dd>
<dt>&quot;pardus&quot;</dt>
<dd>

<p>Pardus.</p>

</dd>
<dt>&quot;redhat-based&quot;</dt>
<dd>

<p>Some Red Hat-derived distro.</p>

</dd>
<dt>&quot;rhel&quot;</dt>
<dd>

<p>Red Hat Enterprise Linux.</p>

</dd>
<dt>&quot;scientificlinux&quot;</dt>
<dd>

<p>Scientific Linux.</p>

</dd>
<dt>&quot;slackware&quot;</dt>
<dd>

<p>Slackware.</p>

</dd>
<dt>&quot;sles&quot;</dt>
<dd>

<p>SuSE Linux Enterprise Server or Desktop.</p>

</dd>
<dt>&quot;suse-based&quot;</dt>
<dd>

<p>Some openSuSE-derived distro.</p>

</dd>
<dt>&quot;ttylinux&quot;</dt>
<dd>

<p>ttylinux.</p>

</dd>
<dt>&quot;ubuntu&quot;</dt>
<dd>

<p>Ubuntu.</p>

</dd>
<dt>&quot;unknown&quot;</dt>
<dd>

<p>The distro could not be determined.</p>

</dd>
<dt>&quot;windows&quot;</dt>
<dd>

<p>Windows does not have distributions. This string is returned if the OS type is Windows.</p>

</dd>
</dl>

<p>Future versions of libguestfs may return other strings here. The caller should be prepared to handle any string.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-get-drive-mappings">inspect-get-drive-mappings</h2>

<pre><code> inspect-get-drive-mappings root</code></pre>

<p>This call is useful for Windows which uses a primitive system of assigning drive letters (like <i>C:\</i>) to partitions. This inspection API examines the Windows Registry to find out how disks/partitions are mapped to drive letters, and returns a hash table as in the example below:</p>

<pre><code> C      =&gt;     /dev/vda2
 E      =&gt;     /dev/vdb1
 F      =&gt;     /dev/vdc1</code></pre>

<p>Note that keys are drive letters. For Windows, the key is case insensitive and just contains the drive letter, without the customary colon separator character.</p>

<p>In future we may support other operating systems that also used drive letters, but the keys for those might not be case insensitive and might be longer than 1 character. For example in OS-9, hard drives were named <code>h0</code>, <code>h1</code> etc.</p>

<p>For Windows guests, currently only hard drive mappings are returned. Removable disks (eg. DVD-ROMs) are ignored.</p>

<p>For guests that do not use drive mappings, or if the drive mappings could not be determined, this returns an empty hash table.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details. See also <a href="#inspect-get-mountpoints">&quot;inspect-get-mountpoints&quot;</a>, <a href="#inspect-get-filesystems">&quot;inspect-get-filesystems&quot;</a>.</p>

<h2 id="inspect-get-filesystems">inspect-get-filesystems</h2>

<pre><code> inspect-get-filesystems root</code></pre>

<p>This returns a list of all the filesystems that we think are associated with this operating system. This includes the root filesystem, other ordinary filesystems, and non-mounted devices like swap partitions.</p>

<p>In the case of a multi-boot virtual machine, it is possible for a filesystem to be shared between operating systems.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details. See also <a href="#inspect-get-mountpoints">&quot;inspect-get-mountpoints&quot;</a>.</p>

<h2 id="inspect-get-format">inspect-get-format</h2>

<pre><code> inspect-get-format root</code></pre>

<p>This returns the format of the inspected operating system. You can use it to detect install images, live CDs and similar.</p>

<p>Currently defined formats are:</p>

<dl>

<dt>&quot;installed&quot;</dt>
<dd>

<p>This is an installed operating system.</p>

</dd>
<dt>&quot;installer&quot;</dt>
<dd>

<p>The disk image being inspected is not an installed operating system, but a <i>bootable</i> install disk, live CD, or similar.</p>

</dd>
<dt>&quot;unknown&quot;</dt>
<dd>

<p>The format of this disk image is not known.</p>

</dd>
</dl>

<p>Future versions of libguestfs may return other strings here. The caller should be prepared to handle any string.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-get-hostname">inspect-get-hostname</h2>

<pre><code> inspect-get-hostname root</code></pre>

<p>This function returns the hostname of the operating system as found by inspection of the guest&#39;s configuration files.</p>

<p>If the hostname could not be determined, then the string <code>unknown</code> is returned.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-get-icon">inspect-get-icon</h2>

<pre><code> inspect-get-icon root [favicon:true|false] [highquality:true|false]</code></pre>

<p>This function returns an icon corresponding to the inspected operating system. The icon is returned as a buffer containing a PNG image (re-encoded to PNG if necessary).</p>

<p>If it was not possible to get an icon this function returns a zero-length (non-NULL) buffer. <i>Callers must check for this case</i>.</p>

<p>Libguestfs will start by looking for a file called <i>/etc/favicon.png</i> or <i>C:\etc\favicon.png</i> and if it has the correct format, the contents of this file will be returned. You can disable favicons by passing the optional <code>favicon</code> boolean as false (default is true).</p>

<p>If finding the favicon fails, then we look in other places in the guest for a suitable icon.</p>

<p>If the optional <code>highquality</code> boolean is true then only high quality icons are returned, which means only icons of high resolution with an alpha channel. The default (false) is to return any icon we can, even if it is of substandard quality.</p>

<p>Notes:</p>

<ul>

<li><p>Unlike most other inspection API calls, the guest&#39;s disks must be mounted up before you call this, since it needs to read information from the guest filesystem during the call.</p>

</li>
<li><p><b>Security:</b> The icon data comes from the untrusted guest, and should be treated with caution. PNG files have been known to contain exploits. Ensure that libpng (or other relevant libraries) are fully up to date before trying to process or display the icon.</p>

</li>
<li><p>The PNG image returned can be any size. It might not be square. Libguestfs tries to return the largest, highest quality icon available. The application must scale the icon to the required size.</p>

</li>
<li><p>Extracting icons from Windows guests requires the external <code>wrestool</code> program from the <code>icoutils</code> package, and several programs (<code>bmptopnm</code>, <code>pnmtopng</code>, <code>pamcut</code>) from the <code>netpbm</code> package. These must be installed separately.</p>

</li>
<li><p>Operating system icons are usually trademarks. Seek legal advice before using trademarks in applications.</p>

</li>
</ul>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="inspect-get-major-version">inspect-get-major-version</h2>

<pre><code> inspect-get-major-version root</code></pre>

<p>This returns the major version number of the inspected operating system.</p>

<p>Windows uses a consistent versioning scheme which is <i>not</i> reflected in the popular public names used by the operating system. Notably the operating system known as &quot;Windows 7&quot; is really version 6.1 (ie. major = 6, minor = 1). You can find out the real versions corresponding to releases of Windows by consulting Wikipedia or MSDN.</p>

<p>If the version could not be determined, then <code>0</code> is returned.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-get-minor-version">inspect-get-minor-version</h2>

<pre><code> inspect-get-minor-version root</code></pre>

<p>This returns the minor version number of the inspected operating system.</p>

<p>If the version could not be determined, then <code>0</code> is returned.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details. See also <a href="#inspect-get-major-version">&quot;inspect-get-major-version&quot;</a>.</p>

<h2 id="inspect-get-mountpoints">inspect-get-mountpoints</h2>

<pre><code> inspect-get-mountpoints root</code></pre>

<p>This returns a hash of where we think the filesystems associated with this operating system should be mounted. Callers should note that this is at best an educated guess made by reading configuration files such as <i>/etc/fstab</i>. <i>In particular note</i> that this may return filesystems which are non-existent or not mountable and callers should be prepared to handle or ignore failures if they try to mount them.</p>

<p>Each element in the returned hashtable has a key which is the path of the mountpoint (eg. <i>/boot</i>) and a value which is the filesystem that would be mounted there (eg. <i>/dev/sda1</i>).</p>

<p>Non-mounted devices such as swap devices are <i>not</i> returned in this list.</p>

<p>For operating systems like Windows which still use drive letters, this call will only return an entry for the first drive &quot;mounted on&quot; <i>/</i>. For information about the mapping of drive letters to partitions, see <a href="#inspect-get-drive-mappings">&quot;inspect-get-drive-mappings&quot;</a>.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details. See also <a href="#inspect-get-filesystems">&quot;inspect-get-filesystems&quot;</a>.</p>

<h2 id="inspect-get-package-format">inspect-get-package-format</h2>

<pre><code> inspect-get-package-format root</code></pre>

<p>This function and <a href="#inspect-get-package-management">&quot;inspect-get-package-management&quot;</a> return the package format and package management tool used by the inspected operating system. For example for Fedora these functions would return <code>rpm</code> (package format), and <code>yum</code> or <code>dnf</code> (package management).</p>

<p>This returns the string <code>unknown</code> if we could not determine the package format <i>or</i> if the operating system does not have a real packaging system (eg. Windows).</p>

<p>Possible strings include: <code>rpm</code>, <code>deb</code>, <code>ebuild</code>, <code>pisi</code>, <code>pacman</code>, <code>pkgsrc</code>. Future versions of libguestfs may return other strings.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-get-package-management">inspect-get-package-management</h2>

<pre><code> inspect-get-package-management root</code></pre>

<p><a href="#inspect-get-package-format">&quot;inspect-get-package-format&quot;</a> and this function return the package format and package management tool used by the inspected operating system. For example for Fedora these functions would return <code>rpm</code> (package format), and <code>yum</code> or <code>dnf</code> (package management).</p>

<p>This returns the string <code>unknown</code> if we could not determine the package management tool <i>or</i> if the operating system does not have a real packaging system (eg. Windows).</p>

<p>Possible strings include: <code>yum</code>, <code>dnf</code>, <code>up2date</code>, <code>apt</code> (for all Debian derivatives), <code>portage</code>, <code>pisi</code>, <code>pacman</code>, <code>urpmi</code>, <code>zypper</code>. Future versions of libguestfs may return other strings.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-get-product-name">inspect-get-product-name</h2>

<pre><code> inspect-get-product-name root</code></pre>

<p>This returns the product name of the inspected operating system. The product name is generally some freeform string which can be displayed to the user, but should not be parsed by programs.</p>

<p>If the product name could not be determined, then the string <code>unknown</code> is returned.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-get-product-variant">inspect-get-product-variant</h2>

<pre><code> inspect-get-product-variant root</code></pre>

<p>This returns the product variant of the inspected operating system.</p>

<p>For Windows guests, this returns the contents of the Registry key <code>HKLM\Software\Microsoft\Windows NT\CurrentVersion</code> <code>InstallationType</code> which is usually a string such as <code>Client</code> or <code>Server</code> (other values are possible). This can be used to distinguish consumer and enterprise versions of Windows that have the same version number (for example, Windows 7 and Windows 2008 Server are both version 6.1, but the former is <code>Client</code> and the latter is <code>Server</code>).</p>

<p>For enterprise Linux guests, in future we intend this to return the product variant such as <code>Desktop</code>, <code>Server</code> and so on. But this is not implemented at present.</p>

<p>If the product variant could not be determined, then the string <code>unknown</code> is returned.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details. See also <a href="#inspect-get-product-name">&quot;inspect-get-product-name&quot;</a>, <a href="#inspect-get-major-version">&quot;inspect-get-major-version&quot;</a>.</p>

<h2 id="inspect-get-roots">inspect-get-roots</h2>

<pre><code> inspect-get-roots</code></pre>

<p>This function is a convenient way to get the list of root devices, as returned from a previous call to <a href="#inspect-os">&quot;inspect-os&quot;</a>, but without redoing the whole inspection process.</p>

<p>This returns an empty list if either no root devices were found or the caller has not called <a href="#inspect-os">&quot;inspect-os&quot;</a>.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-get-type">inspect-get-type</h2>

<pre><code> inspect-get-type root</code></pre>

<p>This returns the type of the inspected operating system. Currently defined types are:</p>

<dl>

<dt>&quot;linux&quot;</dt>
<dd>

<p>Any Linux-based operating system.</p>

</dd>
<dt>&quot;windows&quot;</dt>
<dd>

<p>Any Microsoft Windows operating system.</p>

</dd>
<dt>&quot;freebsd&quot;</dt>
<dd>

<p>FreeBSD.</p>

</dd>
<dt>&quot;netbsd&quot;</dt>
<dd>

<p>NetBSD.</p>

</dd>
<dt>&quot;openbsd&quot;</dt>
<dd>

<p>OpenBSD.</p>

</dd>
<dt>&quot;hurd&quot;</dt>
<dd>

<p>GNU/Hurd.</p>

</dd>
<dt>&quot;dos&quot;</dt>
<dd>

<p>MS-DOS, FreeDOS and others.</p>

</dd>
<dt>&quot;minix&quot;</dt>
<dd>

<p>MINIX.</p>

</dd>
<dt>&quot;unknown&quot;</dt>
<dd>

<p>The operating system type could not be determined.</p>

</dd>
</dl>

<p>Future versions of libguestfs may return other strings here. The caller should be prepared to handle any string.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-get-windows-current-control-set">inspect-get-windows-current-control-set</h2>

<pre><code> inspect-get-windows-current-control-set root</code></pre>

<p>This returns the Windows CurrentControlSet of the inspected guest. The CurrentControlSet is a registry key name such as <code>ControlSet001</code>.</p>

<p>This call assumes that the guest is Windows and that the Registry could be examined by inspection. If this is not the case then an error is returned.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-get-windows-systemroot">inspect-get-windows-systemroot</h2>

<pre><code> inspect-get-windows-systemroot root</code></pre>

<p>This returns the Windows systemroot of the inspected guest. The systemroot is a directory path such as <i>/WINDOWS</i>.</p>

<p>This call assumes that the guest is Windows and that the systemroot could be determined by inspection. If this is not the case then an error is returned.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-is-live">inspect-is-live</h2>

<pre><code> inspect-is-live root</code></pre>

<p>If <a href="#inspect-get-format">&quot;inspect-get-format&quot;</a> returns <code>installer</code> (this is an install disk), then this returns true if a live image was detected on the disk.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-is-multipart">inspect-is-multipart</h2>

<pre><code> inspect-is-multipart root</code></pre>

<p>If <a href="#inspect-get-format">&quot;inspect-get-format&quot;</a> returns <code>installer</code> (this is an install disk), then this returns true if the disk is part of a set.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-is-netinst">inspect-is-netinst</h2>

<pre><code> inspect-is-netinst root</code></pre>

<p>If <a href="#inspect-get-format">&quot;inspect-get-format&quot;</a> returns <code>installer</code> (this is an install disk), then this returns true if the disk is a network installer, ie. not a self-contained install CD but one which is likely to require network access to complete the install.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-list-applications">inspect-list-applications</h2>

<pre><code> inspect-list-applications root</code></pre>

<p>Return the list of applications installed in the operating system.</p>

<p><i>Note:</i> This call works differently from other parts of the inspection API. You have to call <a href="#inspect-os">&quot;inspect-os&quot;</a>, then <a href="#inspect-get-mountpoints">&quot;inspect-get-mountpoints&quot;</a>, then mount up the disks, before calling this. Listing applications is a significantly more difficult operation which requires access to the full filesystem. Also note that unlike the other <a href="#inspect-get--">&quot;inspect-get-*&quot;</a> calls which are just returning data cached in the libguestfs handle, this call actually reads parts of the mounted filesystems during the call.</p>

<p>This returns an empty list if the inspection code was not able to determine the list of applications.</p>

<p>The application structure contains the following fields:</p>

<dl>

<dt><code>app_name</code></dt>
<dd>

<p>The name of the application. For Red Hat-derived and Debian-derived Linux guests, this is the package name.</p>

</dd>
<dt><code>app_display_name</code></dt>
<dd>

<p>The display name of the application, sometimes localized to the install language of the guest operating system.</p>

<p>If unavailable this is returned as an empty string <code>&quot;&quot;</code>. Callers needing to display something can use <code>app_name</code> instead.</p>

</dd>
<dt><code>app_epoch</code></dt>
<dd>

<p>For package managers which use epochs, this contains the epoch of the package (an integer). If unavailable, this is returned as <code>0</code>.</p>

</dd>
<dt><code>app_version</code></dt>
<dd>

<p>The version string of the application or package. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app_release</code></dt>
<dd>

<p>The release string of the application or package, for package managers that use this. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app_install_path</code></dt>
<dd>

<p>The installation path of the application (on operating systems such as Windows which use installation paths). This path is in the format used by the guest operating system, it is not a libguestfs path.</p>

<p>If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app_trans_path</code></dt>
<dd>

<p>The install path translated into a libguestfs path. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app_publisher</code></dt>
<dd>

<p>The name of the publisher of the application, for package managers that use this. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app_url</code></dt>
<dd>

<p>The URL (eg. upstream URL) of the application. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app_source_package</code></dt>
<dd>

<p>For packaging systems which support this, the name of the source package. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app_summary</code></dt>
<dd>

<p>A short (usually one line) description of the application or package. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app_description</code></dt>
<dd>

<p>A longer description of the application or package. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
</dl>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#inspect-list-applications2">&quot;inspect-list-applications2&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="inspect-list-applications2">inspect-list-applications2</h2>

<pre><code> inspect-list-applications2 root</code></pre>

<p>Return the list of applications installed in the operating system.</p>

<p><i>Note:</i> This call works differently from other parts of the inspection API. You have to call <a href="#inspect-os">&quot;inspect-os&quot;</a>, then <a href="#inspect-get-mountpoints">&quot;inspect-get-mountpoints&quot;</a>, then mount up the disks, before calling this. Listing applications is a significantly more difficult operation which requires access to the full filesystem. Also note that unlike the other <a href="#inspect-get--">&quot;inspect-get-*&quot;</a> calls which are just returning data cached in the libguestfs handle, this call actually reads parts of the mounted filesystems during the call.</p>

<p>This returns an empty list if the inspection code was not able to determine the list of applications.</p>

<p>The application structure contains the following fields:</p>

<dl>

<dt><code>app2_name</code></dt>
<dd>

<p>The name of the application. For Red Hat-derived and Debian-derived Linux guests, this is the package name.</p>

</dd>
<dt><code>app2_display_name</code></dt>
<dd>

<p>The display name of the application, sometimes localized to the install language of the guest operating system.</p>

<p>If unavailable this is returned as an empty string <code>&quot;&quot;</code>. Callers needing to display something can use <code>app2_name</code> instead.</p>

</dd>
<dt><code>app2_epoch</code></dt>
<dd>

<p>For package managers which use epochs, this contains the epoch of the package (an integer). If unavailable, this is returned as <code>0</code>.</p>

</dd>
<dt><code>app2_version</code></dt>
<dd>

<p>The version string of the application or package. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app2_release</code></dt>
<dd>

<p>The release string of the application or package, for package managers that use this. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app2_arch</code></dt>
<dd>

<p>The architecture string of the application or package, for package managers that use this. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app2_install_path</code></dt>
<dd>

<p>The installation path of the application (on operating systems such as Windows which use installation paths). This path is in the format used by the guest operating system, it is not a libguestfs path.</p>

<p>If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app2_trans_path</code></dt>
<dd>

<p>The install path translated into a libguestfs path. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app2_publisher</code></dt>
<dd>

<p>The name of the publisher of the application, for package managers that use this. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app2_url</code></dt>
<dd>

<p>The URL (eg. upstream URL) of the application. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app2_source_package</code></dt>
<dd>

<p>For packaging systems which support this, the name of the source package. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app2_summary</code></dt>
<dd>

<p>A short (usually one line) description of the application or package. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
<dt><code>app2_description</code></dt>
<dd>

<p>A longer description of the application or package. If unavailable this is returned as an empty string <code>&quot;&quot;</code>.</p>

</dd>
</dl>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<h2 id="inspect-os">inspect-os</h2>

<pre><code> inspect-os</code></pre>

<p>This function uses other libguestfs functions and certain heuristics to inspect the disk(s) (usually disks belonging to a virtual machine), looking for operating systems.</p>

<p>The list returned is empty if no operating systems were found.</p>

<p>If one operating system was found, then this returns a list with a single element, which is the name of the root filesystem of this operating system. It is also possible for this function to return a list containing more than one element, indicating a dual-boot or multi-boot virtual machine, with each element being the root filesystem of one of the operating systems.</p>

<p>You can pass the root string(s) returned to other <a href="#inspect-get--">&quot;inspect-get-*&quot;</a> functions in order to query further information about each operating system, such as the name and version.</p>

<p>This function uses other libguestfs features such as <a href="#mount-ro">&quot;mount-ro&quot;</a> and <a href="#umount-all">&quot;umount-all&quot;</a> in order to mount and unmount filesystems and look at the contents. This should be called with no disks currently mounted. The function may also use Augeas, so any existing Augeas handle will be closed.</p>

<p>This function cannot decrypt encrypted disks. The caller must do that first (supplying the necessary keys) if the disk is encrypted.</p>

<p>Please read <a href="guestfs.3.html#inspection">&quot;INSPECTION&quot; in guestfs(3)</a> for more details.</p>

<p>See also <a href="#list-filesystems">&quot;list-filesystems&quot;</a>.</p>

<h2 id="is-blockdev">is-blockdev</h2>

<h2 id="is-blockdev-opts">is-blockdev-opts</h2>

<pre><code> is-blockdev path [followsymlinks:true|false]</code></pre>

<p>This returns <code>true</code> if and only if there is a block device with the given <code>path</code> name.</p>

<p>If the optional flag <code>followsymlinks</code> is true, then a symlink (or chain of symlinks) that ends with a block device also causes the function to return true.</p>

<p>This call only looks at files within the guest filesystem. Libguestfs partitions and block devices (eg. <i>/dev/sda</i>) cannot be used as the <code>path</code> parameter of this call.</p>

<p>See also <a href="#stat">&quot;stat&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="is-chardev">is-chardev</h2>

<h2 id="is-chardev-opts">is-chardev-opts</h2>

<pre><code> is-chardev path [followsymlinks:true|false]</code></pre>

<p>This returns <code>true</code> if and only if there is a character device with the given <code>path</code> name.</p>

<p>If the optional flag <code>followsymlinks</code> is true, then a symlink (or chain of symlinks) that ends with a chardev also causes the function to return true.</p>

<p>See also <a href="#stat">&quot;stat&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="is-config">is-config</h2>

<pre><code> is-config</code></pre>

<p>This returns true iff this handle is being configured (in the <code>CONFIG</code> state).</p>

<p>For more information on states, see <a href="guestfs.3.html">guestfs(3)</a>.</p>

<h2 id="is-dir">is-dir</h2>

<h2 id="is-dir-opts">is-dir-opts</h2>

<pre><code> is-dir path [followsymlinks:true|false]</code></pre>

<p>This returns <code>true</code> if and only if there is a directory with the given <code>path</code> name. Note that it returns false for other objects like files.</p>

<p>If the optional flag <code>followsymlinks</code> is true, then a symlink (or chain of symlinks) that ends with a directory also causes the function to return true.</p>

<p>See also <a href="#stat">&quot;stat&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="is-fifo">is-fifo</h2>

<h2 id="is-fifo-opts">is-fifo-opts</h2>

<pre><code> is-fifo path [followsymlinks:true|false]</code></pre>

<p>This returns <code>true</code> if and only if there is a FIFO (named pipe) with the given <code>path</code> name.</p>

<p>If the optional flag <code>followsymlinks</code> is true, then a symlink (or chain of symlinks) that ends with a FIFO also causes the function to return true.</p>

<p>See also <a href="#stat">&quot;stat&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="is-file">is-file</h2>

<h2 id="is-file-opts">is-file-opts</h2>

<pre><code> is-file path [followsymlinks:true|false]</code></pre>

<p>This returns <code>true</code> if and only if there is a regular file with the given <code>path</code> name. Note that it returns false for other objects like directories.</p>

<p>If the optional flag <code>followsymlinks</code> is true, then a symlink (or chain of symlinks) that ends with a file also causes the function to return true.</p>

<p>See also <a href="#stat">&quot;stat&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="is-lv">is-lv</h2>

<pre><code> is-lv device</code></pre>

<p>This command tests whether <code>device</code> is a logical volume, and returns true iff this is the case.</p>

<h2 id="is-socket">is-socket</h2>

<h2 id="is-socket-opts">is-socket-opts</h2>

<pre><code> is-socket path [followsymlinks:true|false]</code></pre>

<p>This returns <code>true</code> if and only if there is a Unix domain socket with the given <code>path</code> name.</p>

<p>If the optional flag <code>followsymlinks</code> is true, then a symlink (or chain of symlinks) that ends with a socket also causes the function to return true.</p>

<p>See also <a href="#stat">&quot;stat&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="is-symlink">is-symlink</h2>

<pre><code> is-symlink path</code></pre>

<p>This returns <code>true</code> if and only if there is a symbolic link with the given <code>path</code> name.</p>

<p>See also <a href="#stat">&quot;stat&quot;</a>.</p>

<h2 id="is-whole-device">is-whole-device</h2>

<pre><code> is-whole-device device</code></pre>

<p>This returns <code>true</code> if and only if <code>device</code> refers to a whole block device. That is, not a partition or a logical device.</p>

<h2 id="is-zero">is-zero</h2>

<pre><code> is-zero path</code></pre>

<p>This returns true iff the file exists and the file is empty or it contains all zero bytes.</p>

<h2 id="is-zero-device">is-zero-device</h2>

<pre><code> is-zero-device device</code></pre>

<p>This returns true iff the device exists and contains all zero bytes.</p>

<p>Note that for large devices this can take a long time to run.</p>

<h2 id="isoinfo">isoinfo</h2>

<pre><code> isoinfo isofile</code></pre>

<p>This is the same as <a href="#isoinfo-device">&quot;isoinfo-device&quot;</a> except that it works for an ISO file located inside some other mounted filesystem. Note that in the common case where you have added an ISO file as a libguestfs device, you would <i>not</i> call this. Instead you would call <a href="#isoinfo-device">&quot;isoinfo-device&quot;</a>.</p>

<h2 id="isoinfo-device">isoinfo-device</h2>

<pre><code> isoinfo-device device</code></pre>

<p><code>device</code> is an ISO device. This returns a struct of information read from the primary volume descriptor (the ISO equivalent of the superblock) of the device.</p>

<p>Usually it is more efficient to use the <a href="http://man.he.net/man1/isoinfo">isoinfo(1)</a> command with the <i>-d</i> option on the host to analyze ISO files, instead of going through libguestfs.</p>

<p>For information on the primary volume descriptor fields, see <a href="http://wiki.osdev.org/ISO_9660#The_Primary_Volume_Descriptor">http://wiki.osdev.org/ISO_9660#The_Primary_Volume_Descriptor</a></p>

<h2 id="journal-close">journal-close</h2>

<pre><code> journal-close</code></pre>

<p>Close the journal handle.</p>

<h2 id="journal-get">journal-get</h2>

<pre><code> journal-get</code></pre>

<p>Read the current journal entry. This returns all the fields in the journal as a set of <code>(attrname, attrval)</code> pairs. The <code>attrname</code> is the field name (a string).</p>

<p>The <code>attrval</code> is the field value (a binary blob, often but not always a string). Please note that <code>attrval</code> is a byte array, <i>not</i> a \0-terminated C string.</p>

<p>The length of data may be truncated to the data threshold (see: <a href="#journal-set-data-threshold">&quot;journal-set-data-threshold&quot;</a>, <a href="#journal-get-data-threshold">&quot;journal-get-data-threshold&quot;</a>).</p>

<p>If you set the data threshold to unlimited (<code>0</code>) then this call can read a journal entry of any size, ie. it is not limited by the libguestfs protocol.</p>

<h2 id="journal-get-data-threshold">journal-get-data-threshold</h2>

<pre><code> journal-get-data-threshold</code></pre>

<p>Get the current data threshold for reading journal entries. This is a hint to the journal that it may truncate data fields to this size when reading them (note also that it may not truncate them). If this returns <code>0</code>, then the threshold is unlimited.</p>

<p>See also <a href="#journal-set-data-threshold">&quot;journal-set-data-threshold&quot;</a>.</p>

<h2 id="journal-get-realtime-usec">journal-get-realtime-usec</h2>

<pre><code> journal-get-realtime-usec</code></pre>

<p>Get the realtime (wallclock) timestamp of the current journal entry.</p>

<h2 id="journal-next">journal-next</h2>

<pre><code> journal-next</code></pre>

<p>Move to the next journal entry. You have to call this at least once after opening the handle before you are able to read data.</p>

<p>The returned boolean tells you if there are any more journal records to read. <code>true</code> means you can read the next record (eg. using <a href="#journal-get">&quot;journal-get&quot;</a>), and <code>false</code> means you have reached the end of the journal.</p>

<h2 id="journal-open">journal-open</h2>

<pre><code> journal-open directory</code></pre>

<p>Open the systemd journal located in <i>directory</i>. Any previously opened journal handle is closed.</p>

<p>The contents of the journal can be read using <a href="#journal-next">&quot;journal-next&quot;</a> and <a href="#journal-get">&quot;journal-get&quot;</a>.</p>

<p>After you have finished using the journal, you should close the handle by calling <a href="#journal-close">&quot;journal-close&quot;</a>.</p>

<h2 id="journal-set-data-threshold">journal-set-data-threshold</h2>

<pre><code> journal-set-data-threshold threshold</code></pre>

<p>Set the data threshold for reading journal entries. This is a hint to the journal that it may truncate data fields to this size when reading them (note also that it may not truncate them). If you set this to <code>0</code>, then the threshold is unlimited.</p>

<p>See also <a href="#journal-get-data-threshold">&quot;journal-get-data-threshold&quot;</a>.</p>

<h2 id="journal-skip">journal-skip</h2>

<pre><code> journal-skip skip</code></pre>

<p>Skip forwards (<code>skip &ge; 0</code>) or backwards (<code>skip &lt; 0</code>) in the journal.</p>

<p>The number of entries actually skipped is returned (note <span style="white-space: nowrap;"><code>rskip &ge; 0</code></span>). If this is not the same as the absolute value of the skip parameter (<code>|skip|</code>) you passed in then it means you have reached the end or the start of the journal.</p>

<h2 id="kill-subprocess">kill-subprocess</h2>

<pre><code> kill-subprocess</code></pre>

<p>This kills the hypervisor.</p>

<p>Do not call this. See: <a href="#shutdown">&quot;shutdown&quot;</a> instead.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#shutdown">&quot;shutdown&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="launch">launch</h2>

<h2 id="run">run</h2>

<pre><code> launch</code></pre>

<p>You should call this after configuring the handle (eg. adding drives) but before performing any actions.</p>

<p>Do not call <a href="#launch">&quot;launch&quot;</a> twice on the same handle. Although it will not give an error (for historical reasons), the precise behaviour when you do this is not well defined. Handles are very cheap to create, so create a new one for each launch.</p>

<h2 id="lchown">lchown</h2>

<pre><code> lchown owner group path</code></pre>

<p>Change the file owner to <code>owner</code> and group to <code>group</code>. This is like <a href="#chown">&quot;chown&quot;</a> but if <code>path</code> is a symlink then the link itself is changed, not the target.</p>

<p>Only numeric uid and gid are supported. If you want to use names, you will need to locate and parse the password file yourself (Augeas support makes this relatively easy).</p>

<h2 id="ldmtool-create-all">ldmtool-create-all</h2>

<pre><code> ldmtool-create-all</code></pre>

<p>This function scans all block devices looking for Windows dynamic disk volumes and partitions, and creates devices for any that were found.</p>

<p>Call <a href="#list-ldm-volumes">&quot;list-ldm-volumes&quot;</a> and <a href="#list-ldm-partitions">&quot;list-ldm-partitions&quot;</a> to return all devices.</p>

<p>Note that you <b>don&#39;t</b> normally need to call this explicitly, since it is done automatically at <a href="#launch">&quot;launch&quot;</a> time. However you might want to call this function if you have hotplugged disks or have just created a Windows dynamic disk.</p>

<h2 id="ldmtool-diskgroup-disks">ldmtool-diskgroup-disks</h2>

<pre><code> ldmtool-diskgroup-disks diskgroup</code></pre>

<p>Return the disks in a Windows dynamic disk group. The <code>diskgroup</code> parameter should be the GUID of a disk group, one element from the list returned by <a href="#ldmtool-scan">&quot;ldmtool-scan&quot;</a>.</p>

<h2 id="ldmtool-diskgroup-name">ldmtool-diskgroup-name</h2>

<pre><code> ldmtool-diskgroup-name diskgroup</code></pre>

<p>Return the name of a Windows dynamic disk group. The <code>diskgroup</code> parameter should be the GUID of a disk group, one element from the list returned by <a href="#ldmtool-scan">&quot;ldmtool-scan&quot;</a>.</p>

<h2 id="ldmtool-diskgroup-volumes">ldmtool-diskgroup-volumes</h2>

<pre><code> ldmtool-diskgroup-volumes diskgroup</code></pre>

<p>Return the volumes in a Windows dynamic disk group. The <code>diskgroup</code> parameter should be the GUID of a disk group, one element from the list returned by <a href="#ldmtool-scan">&quot;ldmtool-scan&quot;</a>.</p>

<h2 id="ldmtool-remove-all">ldmtool-remove-all</h2>

<pre><code> ldmtool-remove-all</code></pre>

<p>This is essentially the opposite of <a href="#ldmtool-create-all">&quot;ldmtool-create-all&quot;</a>. It removes the device mapper mappings for all Windows dynamic disk volumes</p>

<h2 id="ldmtool-scan">ldmtool-scan</h2>

<pre><code> ldmtool-scan</code></pre>

<p>This function scans for Windows dynamic disks. It returns a list of identifiers (GUIDs) for all disk groups that were found. These identifiers can be passed to other <a href="#ldmtool--">&quot;ldmtool-*&quot;</a> functions.</p>

<p>This function scans all block devices. To scan a subset of block devices, call <a href="#ldmtool-scan-devices">&quot;ldmtool-scan-devices&quot;</a> instead.</p>

<h2 id="ldmtool-scan-devices">ldmtool-scan-devices</h2>

<pre><code> ldmtool-scan-devices &#39;devices ...&#39;</code></pre>

<p>This function scans for Windows dynamic disks. It returns a list of identifiers (GUIDs) for all disk groups that were found. These identifiers can be passed to other <a href="#ldmtool--">&quot;ldmtool-*&quot;</a> functions.</p>

<p>The parameter <code>devices</code> is a list of block devices which are scanned. If this list is empty, all block devices are scanned.</p>

<h2 id="ldmtool-volume-hint">ldmtool-volume-hint</h2>

<pre><code> ldmtool-volume-hint diskgroup volume</code></pre>

<p>Return the hint field of the volume named <code>volume</code> in the disk group with GUID <code>diskgroup</code>. This may not be defined, in which case the empty string is returned. The hint field is often, though not always, the name of a Windows drive, eg. <code>E:</code>.</p>

<h2 id="ldmtool-volume-partitions">ldmtool-volume-partitions</h2>

<pre><code> ldmtool-volume-partitions diskgroup volume</code></pre>

<p>Return the list of partitions in the volume named <code>volume</code> in the disk group with GUID <code>diskgroup</code>.</p>

<h2 id="ldmtool-volume-type">ldmtool-volume-type</h2>

<pre><code> ldmtool-volume-type diskgroup volume</code></pre>

<p>Return the type of the volume named <code>volume</code> in the disk group with GUID <code>diskgroup</code>.</p>

<p>Possible volume types that can be returned here include: <code>simple</code>, <code>spanned</code>, <code>striped</code>, <code>mirrored</code>, <code>raid5</code>. Other types may also be returned.</p>

<h2 id="lgetxattr">lgetxattr</h2>

<pre><code> lgetxattr path name</code></pre>

<p>Get a single extended attribute from file <code>path</code> named <code>name</code>. If <code>path</code> is a symlink, then this call returns an extended attribute from the symlink.</p>

<p>Normally it is better to get all extended attributes from a file in one go by calling <a href="#getxattrs">&quot;getxattrs&quot;</a>. However some Linux filesystem implementations are buggy and do not provide a way to list out attributes. For these filesystems (notably ntfs-3g) you have to know the names of the extended attributes you want in advance and call this function.</p>

<p>Extended attribute values are blobs of binary data. If there is no extended attribute named <code>name</code>, this returns an error.</p>

<p>See also: <a href="#lgetxattrs">&quot;lgetxattrs&quot;</a>, <a href="#getxattr">&quot;getxattr&quot;</a>, <a href="http://man.he.net/man5/attr">attr(5)</a>.</p>

<h2 id="lgetxattrs">lgetxattrs</h2>

<pre><code> lgetxattrs path</code></pre>

<p>This is the same as <a href="#getxattrs">&quot;getxattrs&quot;</a>, but if <code>path</code> is a symbolic link, then it returns the extended attributes of the link itself.</p>

<h2 id="list-9p">list-9p</h2>

<pre><code> list-9p</code></pre>

<p>List all 9p filesystems attached to the guest. A list of mount tags is returned.</p>

<h2 id="list-devices">list-devices</h2>

<pre><code> list-devices</code></pre>

<p>List all the block devices.</p>

<p>The full block device names are returned, eg. <i>/dev/sda</i>.</p>

<p>See also <a href="#list-filesystems">&quot;list-filesystems&quot;</a>.</p>

<h2 id="list-disk-labels">list-disk-labels</h2>

<pre><code> list-disk-labels</code></pre>

<p>If you add drives using the optional <code>label</code> parameter of <a href="#add-drive-opts">&quot;add-drive-opts&quot;</a>, you can use this call to map between disk labels, and raw block device and partition names (like <i>/dev/sda</i> and <i>/dev/sda1</i>).</p>

<p>This returns a hashtable, where keys are the disk labels (<i>without</i> the <i>/dev/disk/guestfs</i> prefix), and the values are the full raw block device and partition names (eg. <i>/dev/sda</i> and <i>/dev/sda1</i>).</p>

<h2 id="list-dm-devices">list-dm-devices</h2>

<pre><code> list-dm-devices</code></pre>

<p>List all device mapper devices.</p>

<p>The returned list contains <i>/dev/mapper/*</i> devices, eg. ones created by a previous call to <a href="#luks-open">&quot;luks-open&quot;</a>.</p>

<p>Device mapper devices which correspond to logical volumes are <i>not</i> returned in this list. Call <a href="#lvs">&quot;lvs&quot;</a> if you want to list logical volumes.</p>

<h2 id="list-filesystems">list-filesystems</h2>

<pre><code> list-filesystems</code></pre>

<p>This inspection command looks for filesystems on partitions, block devices and logical volumes, returning a list of <code>mountables</code> containing filesystems and their type.</p>

<p>The return value is a hash, where the keys are the devices containing filesystems, and the values are the filesystem types. For example:</p>

<pre><code> &quot;/dev/sda1&quot; =&gt; &quot;ntfs&quot;
 &quot;/dev/sda2&quot; =&gt; &quot;ext2&quot;
 &quot;/dev/vg_guest/lv_root&quot; =&gt; &quot;ext4&quot;
 &quot;/dev/vg_guest/lv_swap&quot; =&gt; &quot;swap&quot;</code></pre>

<p>The key is not necessarily a block device. It may also be an opaque &#39;mountable&#39; string which can be passed to <a href="#mount">&quot;mount&quot;</a>.</p>

<p>The value can have the special value &quot;unknown&quot;, meaning the content of the device is undetermined or empty. &quot;swap&quot; means a Linux swap partition.</p>

<p>This command runs other libguestfs commands, which might include <a href="#mount">&quot;mount&quot;</a> and <a href="#umount">&quot;umount&quot;</a>, and therefore you should use this soon after launch and only when nothing is mounted.</p>

<p>Not all of the filesystems returned will be mountable. In particular, swap partitions are returned in the list. Also this command does not check that each filesystem found is valid and mountable, and some filesystems might be mountable but require special options. Filesystems may not all belong to a single logical operating system (use <a href="#inspect-os">&quot;inspect-os&quot;</a> to look for OSes).</p>

<h2 id="list-ldm-partitions">list-ldm-partitions</h2>

<pre><code> list-ldm-partitions</code></pre>

<p>This function returns all Windows dynamic disk partitions that were found at launch time. It returns a list of device names.</p>

<h2 id="list-ldm-volumes">list-ldm-volumes</h2>

<pre><code> list-ldm-volumes</code></pre>

<p>This function returns all Windows dynamic disk volumes that were found at launch time. It returns a list of device names.</p>

<h2 id="list-md-devices">list-md-devices</h2>

<pre><code> list-md-devices</code></pre>

<p>List all Linux md devices.</p>

<h2 id="list-partitions">list-partitions</h2>

<pre><code> list-partitions</code></pre>

<p>List all the partitions detected on all block devices.</p>

<p>The full partition device names are returned, eg. <i>/dev/sda1</i></p>

<p>This does not return logical volumes. For that you will need to call <a href="#lvs">&quot;lvs&quot;</a>.</p>

<p>See also <a href="#list-filesystems">&quot;list-filesystems&quot;</a>.</p>

<h2 id="ll">ll</h2>

<pre><code> ll directory</code></pre>

<p>List the files in <i>directory</i> (relative to the root directory, there is no cwd) in the format of &#39;ls -la&#39;.</p>

<p>This command is mostly useful for interactive sessions. It is <i>not</i> intended that you try to parse the output string.</p>

<h2 id="llz">llz</h2>

<pre><code> llz directory</code></pre>

<p>List the files in <i>directory</i> in the format of &#39;ls -laZ&#39;.</p>

<p>This command is mostly useful for interactive sessions. It is <i>not</i> intended that you try to parse the output string.</p>

<h2 id="ln">ln</h2>

<pre><code> ln target linkname</code></pre>

<p>This command creates a hard link using the <code>ln</code> command.</p>

<h2 id="ln-f">ln-f</h2>

<pre><code> ln-f target linkname</code></pre>

<p>This command creates a hard link using the <code>ln -f</code> command. The <i>-f</i> option removes the link (<code>linkname</code>) if it exists already.</p>

<h2 id="ln-s">ln-s</h2>

<pre><code> ln-s target linkname</code></pre>

<p>This command creates a symbolic link using the <code>ln -s</code> command.</p>

<h2 id="ln-sf">ln-sf</h2>

<pre><code> ln-sf target linkname</code></pre>

<p>This command creates a symbolic link using the <code>ln -sf</code> command, The <i>-f</i> option removes the link (<code>linkname</code>) if it exists already.</p>

<h2 id="lremovexattr">lremovexattr</h2>

<pre><code> lremovexattr xattr path</code></pre>

<p>This is the same as <a href="#removexattr">&quot;removexattr&quot;</a>, but if <code>path</code> is a symbolic link, then it removes an extended attribute of the link itself.</p>

<h2 id="ls">ls</h2>

<pre><code> ls directory</code></pre>

<p>List the files in <i>directory</i> (relative to the root directory, there is no cwd). The &#39;.&#39; and &#39;..&#39; entries are not returned, but hidden files are shown.</p>

<h2 id="ls0">ls0</h2>

<pre><code> ls0 dir (filenames|-)</code></pre>

<p>This specialized command is used to get a listing of the filenames in the directory <code>dir</code>. The list of filenames is written to the local file <i>filenames</i> (on the host).</p>

<p>In the output file, the filenames are separated by <code>\0</code> characters.</p>

<p><code>.</code> and <code>..</code> are not returned. The filenames are not sorted.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<h2 id="lsetxattr">lsetxattr</h2>

<pre><code> lsetxattr xattr val vallen path</code></pre>

<p>This is the same as <a href="#setxattr">&quot;setxattr&quot;</a>, but if <code>path</code> is a symbolic link, then it sets an extended attribute of the link itself.</p>

<h2 id="lstat">lstat</h2>

<pre><code> lstat path</code></pre>

<p>Returns file information for the given <code>path</code>.</p>

<p>This is the same as <a href="#stat">&quot;stat&quot;</a> except that if <code>path</code> is a symbolic link, then the link is stat-ed, not the file it refers to.</p>

<p>This is the same as the <a href="http://man.he.net/man2/lstat">lstat(2)</a> system call.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#lstatns">&quot;lstatns&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="lstatlist">lstatlist</h2>

<pre><code> lstatlist path &#39;names ...&#39;</code></pre>

<p>This call allows you to perform the <a href="#lstat">&quot;lstat&quot;</a> operation on multiple files, where all files are in the directory <code>path</code>. <code>names</code> is the list of files from this directory.</p>

<p>On return you get a list of stat structs, with a one-to-one correspondence to the <code>names</code> list. If any name did not exist or could not be lstat&#39;d, then the <code>st_ino</code> field of that structure is set to <code>-1</code>.</p>

<p>This call is intended for programs that want to efficiently list a directory contents without making many round-trips. See also <a href="#lxattrlist">&quot;lxattrlist&quot;</a> for a similarly efficient call for getting extended attributes.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#lstatnslist">&quot;lstatnslist&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="lstatns">lstatns</h2>

<pre><code> lstatns path</code></pre>

<p>Returns file information for the given <code>path</code>.</p>

<p>This is the same as <a href="#statns">&quot;statns&quot;</a> except that if <code>path</code> is a symbolic link, then the link is stat-ed, not the file it refers to.</p>

<p>This is the same as the <a href="http://man.he.net/man2/lstat">lstat(2)</a> system call.</p>

<h2 id="lstatnslist">lstatnslist</h2>

<pre><code> lstatnslist path &#39;names ...&#39;</code></pre>

<p>This call allows you to perform the <a href="#lstatns">&quot;lstatns&quot;</a> operation on multiple files, where all files are in the directory <code>path</code>. <code>names</code> is the list of files from this directory.</p>

<p>On return you get a list of stat structs, with a one-to-one correspondence to the <code>names</code> list. If any name did not exist or could not be lstat&#39;d, then the <code>st_ino</code> field of that structure is set to <code>-1</code>.</p>

<p>This call is intended for programs that want to efficiently list a directory contents without making many round-trips. See also <a href="#lxattrlist">&quot;lxattrlist&quot;</a> for a similarly efficient call for getting extended attributes.</p>

<h2 id="luks-add-key">luks-add-key</h2>

<pre><code> luks-add-key device keyslot</code></pre>

<p>This command adds a new key on LUKS device <code>device</code>. <code>key</code> is any existing key, and is used to access the device. <code>newkey</code> is the new key to add. <code>keyslot</code> is the key slot that will be replaced.</p>

<p>Note that if <code>keyslot</code> already contains a key, then this command will fail. You have to use <a href="#luks-kill-slot">&quot;luks-kill-slot&quot;</a> first to remove that key.</p>

<p>This command has one or more key or passphrase parameters. Guestfish will prompt for these separately.</p>

<h2 id="luks-close">luks-close</h2>

<pre><code> luks-close device</code></pre>

<p>This closes a LUKS device that was created earlier by <a href="#luks-open">&quot;luks-open&quot;</a> or <a href="#luks-open-ro">&quot;luks-open-ro&quot;</a>. The <code>device</code> parameter must be the name of the LUKS mapping device (ie. <i>/dev/mapper/mapname</i>) and <i>not</i> the name of the underlying block device.</p>

<h2 id="luks-format">luks-format</h2>

<pre><code> luks-format device keyslot</code></pre>

<p>This command erases existing data on <code>device</code> and formats the device as a LUKS encrypted device. <code>key</code> is the initial key, which is added to key slot <code>slot</code>. (LUKS supports 8 key slots, numbered 0-7).</p>

<p>This command has one or more key or passphrase parameters. Guestfish will prompt for these separately.</p>

<h2 id="luks-format-cipher">luks-format-cipher</h2>

<pre><code> luks-format-cipher device keyslot cipher</code></pre>

<p>This command is the same as <a href="#luks-format">&quot;luks-format&quot;</a> but it also allows you to set the <code>cipher</code> used.</p>

<p>This command has one or more key or passphrase parameters. Guestfish will prompt for these separately.</p>

<h2 id="luks-kill-slot">luks-kill-slot</h2>

<pre><code> luks-kill-slot device keyslot</code></pre>

<p>This command deletes the key in key slot <code>keyslot</code> from the encrypted LUKS device <code>device</code>. <code>key</code> must be one of the <i>other</i> keys.</p>

<p>This command has one or more key or passphrase parameters. Guestfish will prompt for these separately.</p>

<h2 id="luks-open">luks-open</h2>

<pre><code> luks-open device mapname</code></pre>

<p>This command opens a block device which has been encrypted according to the Linux Unified Key Setup (LUKS) standard.</p>

<p><code>device</code> is the encrypted block device or partition.</p>

<p>The caller must supply one of the keys associated with the LUKS block device, in the <code>key</code> parameter.</p>

<p>This creates a new block device called <i>/dev/mapper/mapname</i>. Reads and writes to this block device are decrypted from and encrypted to the underlying <code>device</code> respectively.</p>

<p>If this block device contains LVM volume groups, then calling <a href="#vgscan">&quot;vgscan&quot;</a> followed by <a href="#vg-activate-all">&quot;vg-activate-all&quot;</a> will make them visible.</p>

<p>Use <a href="#list-dm-devices">&quot;list-dm-devices&quot;</a> to list all device mapper devices.</p>

<p>This command has one or more key or passphrase parameters. Guestfish will prompt for these separately.</p>

<h2 id="luks-open-ro">luks-open-ro</h2>

<pre><code> luks-open-ro device mapname</code></pre>

<p>This is the same as <a href="#luks-open">&quot;luks-open&quot;</a> except that a read-only mapping is created.</p>

<p>This command has one or more key or passphrase parameters. Guestfish will prompt for these separately.</p>

<h2 id="lvcreate">lvcreate</h2>

<pre><code> lvcreate logvol volgroup mbytes</code></pre>

<p>This creates an LVM logical volume called <code>logvol</code> on the volume group <code>volgroup</code>, with <code>size</code> megabytes.</p>

<h2 id="lvcreate-free">lvcreate-free</h2>

<pre><code> lvcreate-free logvol volgroup percent</code></pre>

<p>Create an LVM logical volume called <i>/dev/volgroup/logvol</i>, using approximately <code>percent</code> % of the free space remaining in the volume group. Most usefully, when <code>percent</code> is <code>100</code> this will create the largest possible LV.</p>

<h2 id="lvm-canonical-lv-name">lvm-canonical-lv-name</h2>

<pre><code> lvm-canonical-lv-name lvname</code></pre>

<p>This converts alternative naming schemes for LVs that you might find to the canonical name. For example, <i>/dev/mapper/VG-LV</i> is converted to <i>/dev/VG/LV</i>.</p>

<p>This command returns an error if the <code>lvname</code> parameter does not refer to a logical volume.</p>

<p>See also <a href="#is-lv">&quot;is-lv&quot;</a>, <a href="#canonical-device-name">&quot;canonical-device-name&quot;</a>.</p>

<h2 id="lvm-clear-filter">lvm-clear-filter</h2>

<pre><code> lvm-clear-filter</code></pre>

<p>This undoes the effect of <a href="#lvm-set-filter">&quot;lvm-set-filter&quot;</a>. LVM will be able to see every block device.</p>

<p>This command also clears the LVM cache and performs a volume group scan.</p>

<h2 id="lvm-remove-all">lvm-remove-all</h2>

<pre><code> lvm-remove-all</code></pre>

<p>This command removes all LVM logical volumes, volume groups and physical volumes.</p>

<h2 id="lvm-set-filter">lvm-set-filter</h2>

<pre><code> lvm-set-filter &#39;devices ...&#39;</code></pre>

<p>This sets the LVM device filter so that LVM will only be able to &quot;see&quot; the block devices in the list <code>devices</code>, and will ignore all other attached block devices.</p>

<p>Where disk image(s) contain duplicate PVs or VGs, this command is useful to get LVM to ignore the duplicates, otherwise LVM can get confused. Note also there are two types of duplication possible: either cloned PVs/VGs which have identical UUIDs; or VGs that are not cloned but just happen to have the same name. In normal operation you cannot create this situation, but you can do it outside LVM, eg. by cloning disk images or by bit twiddling inside the LVM metadata.</p>

<p>This command also clears the LVM cache and performs a volume group scan.</p>

<p>You can filter whole block devices or individual partitions.</p>

<p>You cannot use this if any VG is currently in use (eg. contains a mounted filesystem), even if you are not filtering out that VG.</p>

<h2 id="lvremove">lvremove</h2>

<pre><code> lvremove device</code></pre>

<p>Remove an LVM logical volume <code>device</code>, where <code>device</code> is the path to the LV, such as <i>/dev/VG/LV</i>.</p>

<p>You can also remove all LVs in a volume group by specifying the VG name, <i>/dev/VG</i>.</p>

<h2 id="lvrename">lvrename</h2>

<pre><code> lvrename logvol newlogvol</code></pre>

<p>Rename a logical volume <code>logvol</code> with the new name <code>newlogvol</code>.</p>

<h2 id="lvresize">lvresize</h2>

<pre><code> lvresize device mbytes</code></pre>

<p>This resizes (expands or shrinks) an existing LVM logical volume to <code>mbytes</code>. When reducing, data in the reduced part is lost.</p>

<h2 id="lvresize-free">lvresize-free</h2>

<pre><code> lvresize-free lv percent</code></pre>

<p>This expands an existing logical volume <code>lv</code> so that it fills <code>pc</code>% of the remaining free space in the volume group. Commonly you would call this with pc = 100 which expands the logical volume as much as possible, using all remaining free space in the volume group.</p>

<h2 id="lvs">lvs</h2>

<pre><code> lvs</code></pre>

<p>List all the logical volumes detected. This is the equivalent of the <a href="http://man.he.net/man8/lvs">lvs(8)</a> command.</p>

<p>This returns a list of the logical volume device names (eg. <i>/dev/VolGroup00/LogVol00</i>).</p>

<p>See also <a href="#lvs-full">&quot;lvs-full&quot;</a>, <a href="#list-filesystems">&quot;list-filesystems&quot;</a>.</p>

<h2 id="lvs-full">lvs-full</h2>

<pre><code> lvs-full</code></pre>

<p>List all the logical volumes detected. This is the equivalent of the <a href="http://man.he.net/man8/lvs">lvs(8)</a> command. The &quot;full&quot; version includes all fields.</p>

<h2 id="lvuuid">lvuuid</h2>

<pre><code> lvuuid device</code></pre>

<p>This command returns the UUID of the LVM LV <code>device</code>.</p>

<h2 id="lxattrlist">lxattrlist</h2>

<pre><code> lxattrlist path &#39;names ...&#39;</code></pre>

<p>This call allows you to get the extended attributes of multiple files, where all files are in the directory <code>path</code>. <code>names</code> is the list of files from this directory.</p>

<p>On return you get a flat list of xattr structs which must be interpreted sequentially. The first xattr struct always has a zero-length <code>attrname</code>. <code>attrval</code> in this struct is zero-length to indicate there was an error doing <code>lgetxattr</code> for this file, <i>or</i> is a C string which is a decimal number (the number of following attributes for this file, which could be <code>&quot;0&quot;</code>). Then after the first xattr struct are the zero or more attributes for the first named file. This repeats for the second and subsequent files.</p>

<p>This call is intended for programs that want to efficiently list a directory contents without making many round-trips. See also <a href="#lstatlist">&quot;lstatlist&quot;</a> for a similarly efficient call for getting standard stats.</p>

<h2 id="max-disks">max-disks</h2>

<pre><code> max-disks</code></pre>

<p>Return the maximum number of disks that may be added to a handle (eg. by <a href="#add-drive-opts">&quot;add-drive-opts&quot;</a> and similar calls).</p>

<p>This function was added in libguestfs 1.19.7. In previous versions of libguestfs the limit was 25.</p>

<p>See <a href="guestfs.3.html#maximum-number-of-disks">&quot;MAXIMUM NUMBER OF DISKS&quot; in guestfs(3)</a> for additional information on this topic.</p>

<h2 id="md-create">md-create</h2>

<pre><code> md-create name &#39;devices ...&#39; [missingbitmap:N] [nrdevices:N] [spare:N] [chunk:N] [level:..]</code></pre>

<p>Create a Linux md (RAID) device named <code>name</code> on the devices in the list <code>devices</code>.</p>

<p>The optional parameters are:</p>

<dl>

<dt><code>missingbitmap</code></dt>
<dd>

<p>A bitmap of missing devices. If a bit is set it means that a missing device is added to the array. The least significant bit corresponds to the first device in the array.</p>

<p>As examples:</p>

<p>If <code>devices = [&quot;/dev/sda&quot;]</code> and <code>missingbitmap = 0x1</code> then the resulting array would be <code>[&lt;missing&gt;, &quot;/dev/sda&quot;]</code>.</p>

<p>If <code>devices = [&quot;/dev/sda&quot;]</code> and <code>missingbitmap = 0x2</code> then the resulting array would be <code>[&quot;/dev/sda&quot;, &lt;missing&gt;]</code>.</p>

<p>This defaults to <code>0</code> (no missing devices).</p>

<p>The length of <code>devices</code> + the number of bits set in <code>missingbitmap</code> must equal <code>nrdevices</code> + <code>spare</code>.</p>

</dd>
<dt><code>nrdevices</code></dt>
<dd>

<p>The number of active RAID devices.</p>

<p>If not set, this defaults to the length of <code>devices</code> plus the number of bits set in <code>missingbitmap</code>.</p>

</dd>
<dt><code>spare</code></dt>
<dd>

<p>The number of spare devices.</p>

<p>If not set, this defaults to <code>0</code>.</p>

</dd>
<dt><code>chunk</code></dt>
<dd>

<p>The chunk size in bytes.</p>

</dd>
<dt><code>level</code></dt>
<dd>

<p>The RAID level, which can be one of: <i>linear</i>, <i>raid0</i>, <i>0</i>, <i>stripe</i>, <i>raid1</i>, <i>1</i>, <i>mirror</i>, <i>raid4</i>, <i>4</i>, <i>raid5</i>, <i>5</i>, <i>raid6</i>, <i>6</i>, <i>raid10</i>, <i>10</i>. Some of these are synonymous, and more levels may be added in future.</p>

<p>If not set, this defaults to <code>raid1</code>.</p>

</dd>
</dl>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="md-detail">md-detail</h2>

<pre><code> md-detail md</code></pre>

<p>This command exposes the output of &#39;mdadm -DY &lt;md&gt;&#39;. The following fields are usually present in the returned hash. Other fields may also be present.</p>

<dl>

<dt><code>level</code></dt>
<dd>

<p>The raid level of the MD device.</p>

</dd>
<dt><code>devices</code></dt>
<dd>

<p>The number of underlying devices in the MD device.</p>

</dd>
<dt><code>metadata</code></dt>
<dd>

<p>The metadata version used.</p>

</dd>
<dt><code>uuid</code></dt>
<dd>

<p>The UUID of the MD device.</p>

</dd>
<dt><code>name</code></dt>
<dd>

<p>The name of the MD device.</p>

</dd>
</dl>

<h2 id="md-stat">md-stat</h2>

<pre><code> md-stat md</code></pre>

<p>This call returns a list of the underlying devices which make up the single software RAID array device <code>md</code>.</p>

<p>To get a list of software RAID devices, call <a href="#list-md-devices">&quot;list-md-devices&quot;</a>.</p>

<p>Each structure returned corresponds to one device along with additional status information:</p>

<dl>

<dt><code>mdstat_device</code></dt>
<dd>

<p>The name of the underlying device.</p>

</dd>
<dt><code>mdstat_index</code></dt>
<dd>

<p>The index of this device within the array.</p>

</dd>
<dt><code>mdstat_flags</code></dt>
<dd>

<p>Flags associated with this device. This is a string containing (in no specific order) zero or more of the following flags:</p>

<dl>

<dt><code>W</code></dt>
<dd>

<p>write-mostly</p>

</dd>
<dt><code>F</code></dt>
<dd>

<p>device is faulty</p>

</dd>
<dt><code>S</code></dt>
<dd>

<p>device is a RAID spare</p>

</dd>
<dt><code>R</code></dt>
<dd>

<p>replacement</p>

</dd>
</dl>

</dd>
</dl>

<h2 id="md-stop">md-stop</h2>

<pre><code> md-stop md</code></pre>

<p>This command deactivates the MD array named <code>md</code>. The device is stopped, but it is not destroyed or zeroed.</p>

<h2 id="mkdir">mkdir</h2>

<pre><code> mkdir path</code></pre>

<p>Create a directory named <code>path</code>.</p>

<h2 id="mkdir-mode">mkdir-mode</h2>

<pre><code> mkdir-mode path mode</code></pre>

<p>This command creates a directory, setting the initial permissions of the directory to <code>mode</code>.</p>

<p>For common Linux filesystems, the actual mode which is set will be <code>mode &amp; ~umask &amp; 01777</code>. Non-native-Linux filesystems may interpret the mode in other ways.</p>

<p>See also <a href="#mkdir">&quot;mkdir&quot;</a>, <a href="#umask">&quot;umask&quot;</a></p>

<h2 id="mkdir-p">mkdir-p</h2>

<pre><code> mkdir-p path</code></pre>

<p>Create a directory named <code>path</code>, creating any parent directories as necessary. This is like the <code>mkdir -p</code> shell command.</p>

<h2 id="mkdtemp">mkdtemp</h2>

<pre><code> mkdtemp tmpl</code></pre>

<p>This command creates a temporary directory. The <code>tmpl</code> parameter should be a full pathname for the temporary directory name with the final six characters being &quot;XXXXXX&quot;.</p>

<p>For example: &quot;/tmp/myprogXXXXXX&quot; or &quot;/Temp/myprogXXXXXX&quot;, the second one being suitable for Windows filesystems.</p>

<p>The name of the temporary directory that was created is returned.</p>

<p>The temporary directory is created with mode 0700 and is owned by root.</p>

<p>The caller is responsible for deleting the temporary directory and its contents after use.</p>

<p>See also: <a href="http://man.he.net/man3/mkdtemp">mkdtemp(3)</a></p>

<h2 id="mke2fs">mke2fs</h2>

<pre><code> mke2fs device [blockscount:N] [blocksize:N] [fragsize:N] [blockspergroup:N] [numberofgroups:N] [bytesperinode:N] [inodesize:N] [journalsize:N] [numberofinodes:N] [stridesize:N] [stripewidth:N] [maxonlineresize:N] [reservedblockspercentage:N] [mmpupdateinterval:N] [journaldevice:..] [label:..] [lastmounteddir:..] [creatoros:..] [fstype:..] [usagetype:..] [uuid:..] [forcecreate:true|false] [writesbandgrouponly:true|false] [lazyitableinit:true|false] [lazyjournalinit:true|false] [testfs:true|false] [discard:true|false] [quotatype:true|false] [extent:true|false] [filetype:true|false] [flexbg:true|false] [hasjournal:true|false] [journaldev:true|false] [largefile:true|false] [quota:true|false] [resizeinode:true|false] [sparsesuper:true|false] [uninitbg:true|false]</code></pre>

<p><code>mke2fs</code> is used to create an ext2, ext3, or ext4 filesystem on <code>device</code>.</p>

<p>The optional <code>blockscount</code> is the size of the filesystem in blocks. If omitted it defaults to the size of <code>device</code>. Note if the filesystem is too small to contain a journal, <code>mke2fs</code> will silently create an ext2 filesystem instead.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="mke2fs-j">mke2fs-J</h2>

<pre><code> mke2fs-J fstype blocksize device journal</code></pre>

<p>This creates an ext2/3/4 filesystem on <code>device</code> with an external journal on <code>journal</code>. It is equivalent to the command:</p>

<pre><code> mke2fs -t fstype -b blocksize -J device=&lt;journal&gt; &lt;device&gt;</code></pre>

<p>See also <a href="#mke2journal">&quot;mke2journal&quot;</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#mke2fs">&quot;mke2fs&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="mke2fs-jl">mke2fs-JL</h2>

<pre><code> mke2fs-JL fstype blocksize device label</code></pre>

<p>This creates an ext2/3/4 filesystem on <code>device</code> with an external journal on the journal labeled <code>label</code>.</p>

<p>See also <a href="#mke2journal-l">&quot;mke2journal-L&quot;</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#mke2fs">&quot;mke2fs&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="mke2fs-ju">mke2fs-JU</h2>

<pre><code> mke2fs-JU fstype blocksize device uuid</code></pre>

<p>This creates an ext2/3/4 filesystem on <code>device</code> with an external journal on the journal with UUID <code>uuid</code>.</p>

<p>See also <a href="#mke2journal-u">&quot;mke2journal-U&quot;</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#mke2fs">&quot;mke2fs&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="mke2journal">mke2journal</h2>

<pre><code> mke2journal blocksize device</code></pre>

<p>This creates an ext2 external journal on <code>device</code>. It is equivalent to the command:</p>

<pre><code> mke2fs -O journal_dev -b blocksize device</code></pre>

<p><i>This function is deprecated.</i> In new code, use the <a href="#mke2fs">&quot;mke2fs&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="mke2journal-l">mke2journal-L</h2>

<pre><code> mke2journal-L blocksize label device</code></pre>

<p>This creates an ext2 external journal on <code>device</code> with label <code>label</code>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#mke2fs">&quot;mke2fs&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="mke2journal-u">mke2journal-U</h2>

<pre><code> mke2journal-U blocksize uuid device</code></pre>

<p>This creates an ext2 external journal on <code>device</code> with UUID <code>uuid</code>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#mke2fs">&quot;mke2fs&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="mkfifo">mkfifo</h2>

<pre><code> mkfifo mode path</code></pre>

<p>This call creates a FIFO (named pipe) called <code>path</code> with mode <code>mode</code>. It is just a convenient wrapper around <a href="#mknod">&quot;mknod&quot;</a>.</p>

<p>Unlike with <a href="#mknod">&quot;mknod&quot;</a>, <code>mode</code> <b>must</b> contain only permissions bits.</p>

<p>The mode actually set is affected by the umask.</p>

<h2 id="mkfs">mkfs</h2>

<h2 id="mkfs-opts">mkfs-opts</h2>

<pre><code> mkfs fstype device [blocksize:N] [features:..] [inode:N] [sectorsize:N] [label:..]</code></pre>

<p>This function creates a filesystem on <code>device</code>. The filesystem type is <code>fstype</code>, for example <code>ext3</code>.</p>

<p>The optional arguments are:</p>

<dl>

<dt><code>blocksize</code></dt>
<dd>

<p>The filesystem block size. Supported block sizes depend on the filesystem type, but typically they are <code>1024</code>, <code>2048</code> or <code>4096</code> for Linux ext2/3 filesystems.</p>

<p>For VFAT and NTFS the <code>blocksize</code> parameter is treated as the requested cluster size.</p>

<p>For UFS block sizes, please see <a href="http://search.cpan.org/perldoc?mkfs.ufs(8)">mkfs.ufs(8)</a>.</p>

</dd>
<dt><code>features</code></dt>
<dd>

<p>This passes the <i>-O</i> parameter to the external mkfs program.</p>

<p>For certain filesystem types, this allows extra filesystem features to be selected. See <a href="http://man.he.net/man8/mke2fs">mke2fs(8)</a> and <a href="http://search.cpan.org/perldoc?mkfs.ufs(8)">mkfs.ufs(8)</a> for more details.</p>

<p>You cannot use this optional parameter with the <code>gfs</code> or <code>gfs2</code> filesystem type.</p>

</dd>
<dt><code>inode</code></dt>
<dd>

<p>This passes the <i>-I</i> parameter to the external <a href="http://man.he.net/man8/mke2fs">mke2fs(8)</a> program which sets the inode size (only for ext2/3/4 filesystems at present).</p>

</dd>
<dt><code>sectorsize</code></dt>
<dd>

<p>This passes the <i>-S</i> parameter to external <a href="http://search.cpan.org/perldoc?mkfs.ufs(8)">mkfs.ufs(8)</a> program, which sets sector size for ufs filesystem.</p>

</dd>
</dl>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="mkfs-b">mkfs-b</h2>

<pre><code> mkfs-b fstype blocksize device</code></pre>

<p>This call is similar to <a href="#mkfs">&quot;mkfs&quot;</a>, but it allows you to control the block size of the resulting filesystem. Supported block sizes depend on the filesystem type, but typically they are <code>1024</code>, <code>2048</code> or <code>4096</code> only.</p>

<p>For VFAT and NTFS the <code>blocksize</code> parameter is treated as the requested cluster size.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#mkfs">&quot;mkfs&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="mkfs-btrfs">mkfs-btrfs</h2>

<pre><code> mkfs-btrfs &#39;devices ...&#39; [allocstart:N] [bytecount:N] [datatype:..] [leafsize:N] [label:..] [metadata:..] [nodesize:N] [sectorsize:N]</code></pre>

<p>Create a btrfs filesystem, allowing all configurables to be set. For more information on the optional arguments, see <a href="http://search.cpan.org/perldoc?mkfs.btrfs(8)">mkfs.btrfs(8)</a>.</p>

<p>Since btrfs filesystems can span multiple devices, this takes a non-empty list of devices.</p>

<p>To create general filesystems, use <a href="#mkfs">&quot;mkfs&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="mklost-and-found">mklost-and-found</h2>

<pre><code> mklost-and-found mountpoint</code></pre>

<p>Make the <code>lost+found</code> directory, normally in the root directory of an ext2/3/4 filesystem. <code>mountpoint</code> is the directory under which we try to create the <code>lost+found</code> directory.</p>

<h2 id="mkmountpoint">mkmountpoint</h2>

<pre><code> mkmountpoint exemptpath</code></pre>

<p><a href="#mkmountpoint">&quot;mkmountpoint&quot;</a> and <a href="#rmmountpoint">&quot;rmmountpoint&quot;</a> are specialized calls that can be used to create extra mountpoints before mounting the first filesystem.</p>

<p>These calls are <i>only</i> necessary in some very limited circumstances, mainly the case where you want to mount a mix of unrelated and/or read-only filesystems together.</p>

<p>For example, live CDs often contain a &quot;Russian doll&quot; nest of filesystems, an ISO outer layer, with a squashfs image inside, with an ext2/3 image inside that. You can unpack this as follows in guestfish:</p>

<pre><code> add-ro Fedora-11-i686-Live.iso
 run
 mkmountpoint /cd
 mkmountpoint /sqsh
 mkmountpoint /ext3fs
 mount /dev/sda /cd
 mount-loop /cd/LiveOS/squashfs.img /sqsh
 mount-loop /sqsh/LiveOS/ext3fs.img /ext3fs</code></pre>

<p>The inner filesystem is now unpacked under the /ext3fs mountpoint.</p>

<p><a href="#mkmountpoint">&quot;mkmountpoint&quot;</a> is not compatible with <a href="#umount-all">&quot;umount-all&quot;</a>. You may get unexpected errors if you try to mix these calls. It is safest to manually unmount filesystems and remove mountpoints after use.</p>

<p><a href="#umount-all">&quot;umount-all&quot;</a> unmounts filesystems by sorting the paths longest first, so for this to work for manual mountpoints, you must ensure that the innermost mountpoints have the longest pathnames, as in the example code above.</p>

<p>For more details see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=599503">https://bugzilla.redhat.com/show_bug.cgi?id=599503</a></p>

<p>Autosync [see <a href="#set-autosync">&quot;set-autosync&quot;</a>, this is set by default on handles] can cause <a href="#umount-all">&quot;umount-all&quot;</a> to be called when the handle is closed which can also trigger these issues.</p>

<h2 id="mknod">mknod</h2>

<pre><code> mknod mode devmajor devminor path</code></pre>

<p>This call creates block or character special devices, or named pipes (FIFOs).</p>

<p>The <code>mode</code> parameter should be the mode, using the standard constants. <code>devmajor</code> and <code>devminor</code> are the device major and minor numbers, only used when creating block and character special devices.</p>

<p>Note that, just like <a href="http://man.he.net/man2/mknod">mknod(2)</a>, the mode must be bitwise OR&#39;d with S_IFBLK, S_IFCHR, S_IFIFO or S_IFSOCK (otherwise this call just creates a regular file). These constants are available in the standard Linux header files, or you can use <a href="#mknod-b">&quot;mknod-b&quot;</a>, <a href="#mknod-c">&quot;mknod-c&quot;</a> or <a href="#mkfifo">&quot;mkfifo&quot;</a> which are wrappers around this command which bitwise OR in the appropriate constant for you.</p>

<p>The mode actually set is affected by the umask.</p>

<h2 id="mknod-b">mknod-b</h2>

<pre><code> mknod-b mode devmajor devminor path</code></pre>

<p>This call creates a block device node called <code>path</code> with mode <code>mode</code> and device major/minor <code>devmajor</code> and <code>devminor</code>. It is just a convenient wrapper around <a href="#mknod">&quot;mknod&quot;</a>.</p>

<p>Unlike with <a href="#mknod">&quot;mknod&quot;</a>, <code>mode</code> <b>must</b> contain only permissions bits.</p>

<p>The mode actually set is affected by the umask.</p>

<h2 id="mknod-c">mknod-c</h2>

<pre><code> mknod-c mode devmajor devminor path</code></pre>

<p>This call creates a char device node called <code>path</code> with mode <code>mode</code> and device major/minor <code>devmajor</code> and <code>devminor</code>. It is just a convenient wrapper around <a href="#mknod">&quot;mknod&quot;</a>.</p>

<p>Unlike with <a href="#mknod">&quot;mknod&quot;</a>, <code>mode</code> <b>must</b> contain only permissions bits.</p>

<p>The mode actually set is affected by the umask.</p>

<h2 id="mkswap">mkswap</h2>

<h2 id="mkswap-opts">mkswap-opts</h2>

<pre><code> mkswap device [label:..] [uuid:..]</code></pre>

<p>Create a Linux swap partition on <code>device</code>.</p>

<p>The option arguments <code>label</code> and <code>uuid</code> allow you to set the label and/or UUID of the new swap partition.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="mkswap-l">mkswap-L</h2>

<pre><code> mkswap-L label device</code></pre>

<p>Create a swap partition on <code>device</code> with label <code>label</code>.</p>

<p>Note that you cannot attach a swap label to a block device (eg. <i>/dev/sda</i>), just to a partition. This appears to be a limitation of the kernel or swap tools.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#mkswap">&quot;mkswap&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="mkswap-u">mkswap-U</h2>

<pre><code> mkswap-U uuid device</code></pre>

<p>Create a swap partition on <code>device</code> with UUID <code>uuid</code>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#mkswap">&quot;mkswap&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="mkswap-file">mkswap-file</h2>

<pre><code> mkswap-file path</code></pre>

<p>Create a swap file.</p>

<p>This command just writes a swap file signature to an existing file. To create the file itself, use something like <a href="#fallocate">&quot;fallocate&quot;</a>.</p>

<h2 id="mktemp">mktemp</h2>

<pre><code> mktemp tmpl [suffix:..]</code></pre>

<p>This command creates a temporary file. The <code>tmpl</code> parameter should be a full pathname for the temporary directory name with the final six characters being &quot;XXXXXX&quot;.</p>

<p>For example: &quot;/tmp/myprogXXXXXX&quot; or &quot;/Temp/myprogXXXXXX&quot;, the second one being suitable for Windows filesystems.</p>

<p>The name of the temporary file that was created is returned.</p>

<p>The temporary file is created with mode 0600 and is owned by root.</p>

<p>The caller is responsible for deleting the temporary file after use.</p>

<p>If the optional <code>suffix</code> parameter is given, then the suffix (eg. <code>.txt</code>) is appended to the temporary name.</p>

<p>See also: <a href="#mkdtemp">&quot;mkdtemp&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="modprobe">modprobe</h2>

<pre><code> modprobe modulename</code></pre>

<p>This loads a kernel module in the appliance.</p>

<h2 id="mount">mount</h2>

<pre><code> mount mountable mountpoint</code></pre>

<p>Mount a guest disk at a position in the filesystem. Block devices are named <i>/dev/sda</i>, <i>/dev/sdb</i> and so on, as they were added to the guest. If those block devices contain partitions, they will have the usual names (eg. <i>/dev/sda1</i>). Also LVM <i>/dev/VG/LV</i>-style names can be used, or &#39;mountable&#39; strings returned by <a href="#list-filesystems">&quot;list-filesystems&quot;</a> or <a href="#inspect-get-mountpoints">&quot;inspect-get-mountpoints&quot;</a>.</p>

<p>The rules are the same as for <a href="http://man.he.net/man2/mount">mount(2)</a>: A filesystem must first be mounted on <i>/</i> before others can be mounted. Other filesystems can only be mounted on directories which already exist.</p>

<p>The mounted filesystem is writable, if we have sufficient permissions on the underlying device.</p>

<p>Before libguestfs 1.13.16, this call implicitly added the options <code>sync</code> and <code>noatime</code>. The <code>sync</code> option greatly slowed writes and caused many problems for users. If your program might need to work with older versions of libguestfs, use <a href="#mount-options">&quot;mount-options&quot;</a> instead (using an empty string for the first parameter if you don&#39;t want any options).</p>

<h2 id="mount-9p">mount-9p</h2>

<pre><code> mount-9p mounttag mountpoint [options:..]</code></pre>

<p>Mount the virtio-9p filesystem with the tag <code>mounttag</code> on the directory <code>mountpoint</code>.</p>

<p>If required, <code>trans=virtio</code> will be automatically added to the options. Any other options required can be passed in the optional <code>options</code> parameter.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="mount-local">mount-local</h2>

<pre><code> mount-local localmountpoint [readonly:true|false] [options:..] [cachetimeout:N] [debugcalls:true|false]</code></pre>

<p>This call exports the libguestfs-accessible filesystem to a local mountpoint (directory) called <code>localmountpoint</code>. Ordinary reads and writes to files and directories under <code>localmountpoint</code> are redirected through libguestfs.</p>

<p>If the optional <code>readonly</code> flag is set to true, then writes to the filesystem return error <code>EROFS</code>.</p>

<p><code>options</code> is a comma-separated list of mount options. See <a href="guestmount.1.html">guestmount(1)</a> for some useful options.</p>

<p><code>cachetimeout</code> sets the timeout (in seconds) for cached directory entries. The default is 60 seconds. See <a href="guestmount.1.html">guestmount(1)</a> for further information.</p>

<p>If <code>debugcalls</code> is set to true, then additional debugging information is generated for every FUSE call.</p>

<p>When <a href="#mount-local">&quot;mount-local&quot;</a> returns, the filesystem is ready, but is not processing requests (access to it will block). You have to call <a href="#mount-local-run">&quot;mount-local-run&quot;</a> to run the main loop.</p>

<p>See <a href="guestfs.3.html#mount-local">&quot;MOUNT LOCAL&quot; in guestfs(3)</a> for full documentation.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="mount-local-run">mount-local-run</h2>

<pre><code> mount-local-run</code></pre>

<p>Run the main loop which translates kernel calls to libguestfs calls.</p>

<p>This should only be called after <a href="#mount-local">&quot;mount-local&quot;</a> returns successfully. The call will not return until the filesystem is unmounted.</p>

<p><b>Note</b> you must <i>not</i> make concurrent libguestfs calls on the same handle from another thread.</p>

<p>You may call this from a different thread than the one which called <a href="#mount-local">&quot;mount-local&quot;</a>, subject to the usual rules for threads and libguestfs (see <a href="guestfs.3.html#multiple-handles-and-multiple-threads">&quot;MULTIPLE HANDLES AND MULTIPLE THREADS&quot; in guestfs(3)</a>).</p>

<p>See <a href="guestfs.3.html#mount-local">&quot;MOUNT LOCAL&quot; in guestfs(3)</a> for full documentation.</p>

<h2 id="mount-loop">mount-loop</h2>

<pre><code> mount-loop file mountpoint</code></pre>

<p>This command lets you mount <i>file</i> (a filesystem image in a file) on a mount point. It is entirely equivalent to the command <code>mount -o loop file mountpoint</code>.</p>

<h2 id="mount-options">mount-options</h2>

<pre><code> mount-options options mountable mountpoint</code></pre>

<p>This is the same as the <a href="#mount">&quot;mount&quot;</a> command, but it allows you to set the mount options as for the <a href="http://man.he.net/man8/mount">mount(8)</a> <i>-o</i> flag.</p>

<p>If the <code>options</code> parameter is an empty string, then no options are passed (all options default to whatever the filesystem uses).</p>

<h2 id="mount-ro">mount-ro</h2>

<pre><code> mount-ro mountable mountpoint</code></pre>

<p>This is the same as the <a href="#mount">&quot;mount&quot;</a> command, but it mounts the filesystem with the read-only (<i>-o ro</i>) flag.</p>

<h2 id="mount-vfs">mount-vfs</h2>

<pre><code> mount-vfs options vfstype mountable mountpoint</code></pre>

<p>This is the same as the <a href="#mount">&quot;mount&quot;</a> command, but it allows you to set both the mount options and the vfstype as for the <a href="http://man.he.net/man8/mount">mount(8)</a> <i>-o</i> and <i>-t</i> flags.</p>

<h2 id="mountpoints">mountpoints</h2>

<pre><code> mountpoints</code></pre>

<p>This call is similar to <a href="#mounts">&quot;mounts&quot;</a>. That call returns a list of devices. This one returns a hash table (map) of device name to directory where the device is mounted.</p>

<h2 id="mounts">mounts</h2>

<pre><code> mounts</code></pre>

<p>This returns the list of currently mounted filesystems. It returns the list of devices (eg. <i>/dev/sda1</i>, <i>/dev/VG/LV</i>).</p>

<p>Some internal mounts are not shown.</p>

<p>See also: <a href="#mountpoints">&quot;mountpoints&quot;</a></p>

<h2 id="mv">mv</h2>

<pre><code> mv src dest</code></pre>

<p>This moves a file from <code>src</code> to <code>dest</code> where <code>dest</code> is either a destination filename or destination directory.</p>

<p>See also: <a href="#rename">&quot;rename&quot;</a>.</p>

<h2 id="nr-devices">nr-devices</h2>

<pre><code> nr-devices</code></pre>

<p>This returns the number of whole block devices that were added. This is the same as the number of devices that would be returned if you called <a href="#list-devices">&quot;list-devices&quot;</a>.</p>

<p>To find out the maximum number of devices that could be added, call <a href="#max-disks">&quot;max-disks&quot;</a>.</p>

<h2 id="ntfs-3g-probe">ntfs-3g-probe</h2>

<pre><code> ntfs-3g-probe true|false device</code></pre>

<p>This command runs the <a href="http://search.cpan.org/perldoc?ntfs-3g.probe(8)">ntfs-3g.probe(8)</a> command which probes an NTFS <code>device</code> for mountability. (Not all NTFS volumes can be mounted read-write, and some cannot be mounted at all).</p>

<p><code>rw</code> is a boolean flag. Set it to true if you want to test if the volume can be mounted read-write. Set it to false if you want to test if the volume can be mounted read-only.</p>

<p>The return value is an integer which <code>0</code> if the operation would succeed, or some non-zero value documented in the <a href="http://search.cpan.org/perldoc?ntfs-3g.probe(8)">ntfs-3g.probe(8)</a> manual page.</p>

<h2 id="ntfsclone-in">ntfsclone-in</h2>

<pre><code> ntfsclone-in (backupfile|-) device</code></pre>

<p>Restore the <code>backupfile</code> (from a previous call to <a href="#ntfsclone-out">&quot;ntfsclone-out&quot;</a>) to <code>device</code>, overwriting any existing contents of this device.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<h2 id="ntfsclone-out">ntfsclone-out</h2>

<pre><code> ntfsclone-out device (backupfile|-) [metadataonly:true|false] [rescue:true|false] [ignorefscheck:true|false] [preservetimestamps:true|false] [force:true|false]</code></pre>

<p>Stream the NTFS filesystem <code>device</code> to the local file <code>backupfile</code>. The format used for the backup file is a special format used by the <a href="http://man.he.net/man8/ntfsclone">ntfsclone(8)</a> tool.</p>

<p>If the optional <code>metadataonly</code> flag is true, then <i>only</i> the metadata is saved, losing all the user data (this is useful for diagnosing some filesystem problems).</p>

<p>The optional <code>rescue</code>, <code>ignorefscheck</code>, <code>preservetimestamps</code> and <code>force</code> flags have precise meanings detailed in the <a href="http://man.he.net/man8/ntfsclone">ntfsclone(8)</a> man page.</p>

<p>Use <a href="#ntfsclone-in">&quot;ntfsclone-in&quot;</a> to restore the file back to a libguestfs device.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="ntfsfix">ntfsfix</h2>

<pre><code> ntfsfix device [clearbadsectors:true|false]</code></pre>

<p>This command repairs some fundamental NTFS inconsistencies, resets the NTFS journal file, and schedules an NTFS consistency check for the first boot into Windows.</p>

<p>This is <i>not</i> an equivalent of Windows <code>chkdsk</code>. It does <i>not</i> scan the filesystem for inconsistencies.</p>

<p>The optional <code>clearbadsectors</code> flag clears the list of bad sectors. This is useful after cloning a disk with bad sectors to a new disk.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="ntfsresize">ntfsresize</h2>

<h2 id="ntfsresize-opts">ntfsresize-opts</h2>

<pre><code> ntfsresize device [size:N] [force:true|false]</code></pre>

<p>This command resizes an NTFS filesystem, expanding or shrinking it to the size of the underlying device.</p>

<p>The optional parameters are:</p>

<dl>

<dt><code>size</code></dt>
<dd>

<p>The new size (in bytes) of the filesystem. If omitted, the filesystem is resized to fit the container (eg. partition).</p>

</dd>
<dt><code>force</code></dt>
<dd>

<p>If this option is true, then force the resize of the filesystem even if the filesystem is marked as requiring a consistency check.</p>

<p>After the resize operation, the filesystem is always marked as requiring a consistency check (for safety). You have to boot into Windows to perform this check and clear this condition. If you <i>don&#39;t</i> set the <code>force</code> option then it is not possible to call <a href="#ntfsresize">&quot;ntfsresize&quot;</a> multiple times on a single filesystem without booting into Windows between each resize.</p>

</dd>
</dl>

<p>See also <a href="http://man.he.net/man8/ntfsresize">ntfsresize(8)</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="ntfsresize-size">ntfsresize-size</h2>

<pre><code> ntfsresize-size device size</code></pre>

<p>This command is the same as <a href="#ntfsresize">&quot;ntfsresize&quot;</a> except that it allows you to specify the new size (in bytes) explicitly.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#ntfsresize">&quot;ntfsresize&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="parse-environment">parse-environment</h2>

<pre><code> parse-environment</code></pre>

<p>Parse the program&#39;s environment and set flags in the handle accordingly. For example if <code>LIBGUESTFS_DEBUG=1</code> then the &#39;verbose&#39; flag is set in the handle.</p>

<p><i>Most programs do not need to call this</i>. It is done implicitly when you call <a href="#create">&quot;create&quot;</a>.</p>

<p>See <a href="guestfs.3.html#environment-variables">&quot;ENVIRONMENT VARIABLES&quot; in guestfs(3)</a> for a list of environment variables that can affect libguestfs handles. See also <a href="guestfs.3.html#guestfs_create_flags">&quot;guestfs_create_flags&quot; in guestfs(3)</a>, and <a href="#parse-environment-list">&quot;parse-environment-list&quot;</a>.</p>

<h2 id="parse-environment-list">parse-environment-list</h2>

<pre><code> parse-environment-list &#39;environment ...&#39;</code></pre>

<p>Parse the list of strings in the argument <code>environment</code> and set flags in the handle accordingly. For example if <code>LIBGUESTFS_DEBUG=1</code> is a string in the list, then the &#39;verbose&#39; flag is set in the handle.</p>

<p>This is the same as <a href="#parse-environment">&quot;parse-environment&quot;</a> except that it parses an explicit list of strings instead of the program&#39;s environment.</p>

<h2 id="part-add">part-add</h2>

<pre><code> part-add device prlogex startsect endsect</code></pre>

<p>This command adds a partition to <code>device</code>. If there is no partition table on the device, call <a href="#part-init">&quot;part-init&quot;</a> first.</p>

<p>The <code>prlogex</code> parameter is the type of partition. Normally you should pass <code>p</code> or <code>primary</code> here, but MBR partition tables also support <code>l</code> (or <code>logical</code>) and <code>e</code> (or <code>extended</code>) partition types.</p>

<p><code>startsect</code> and <code>endsect</code> are the start and end of the partition in <i>sectors</i>. <code>endsect</code> may be negative, which means it counts backwards from the end of the disk (<code>-1</code> is the last sector).</p>

<p>Creating a partition which covers the whole disk is not so easy. Use <a href="#part-disk">&quot;part-disk&quot;</a> to do that.</p>

<h2 id="part-del">part-del</h2>

<pre><code> part-del device partnum</code></pre>

<p>This command deletes the partition numbered <code>partnum</code> on <code>device</code>.</p>

<p>Note that in the case of MBR partitioning, deleting an extended partition also deletes any logical partitions it contains.</p>

<h2 id="part-disk">part-disk</h2>

<pre><code> part-disk device parttype</code></pre>

<p>This command is simply a combination of <a href="#part-init">&quot;part-init&quot;</a> followed by <a href="#part-add">&quot;part-add&quot;</a> to create a single primary partition covering the whole disk.</p>

<p><code>parttype</code> is the partition table type, usually <code>mbr</code> or <code>gpt</code>, but other possible values are described in <a href="#part-init">&quot;part-init&quot;</a>.</p>

<h2 id="part-get-bootable">part-get-bootable</h2>

<pre><code> part-get-bootable device partnum</code></pre>

<p>This command returns true if the partition <code>partnum</code> on <code>device</code> has the bootable flag set.</p>

<p>See also <a href="#part-set-bootable">&quot;part-set-bootable&quot;</a>.</p>

<h2 id="part-get-gpt-guid">part-get-gpt-guid</h2>

<pre><code> part-get-gpt-guid device partnum</code></pre>

<p>Return the GUID of numbered GPT partition <code>partnum</code>.</p>

<h2 id="part-get-gpt-type">part-get-gpt-type</h2>

<pre><code> part-get-gpt-type device partnum</code></pre>

<p>Return the type GUID of numbered GPT partition <code>partnum</code>. For MBR partitions, return an appropriate GUID corresponding to the MBR type. Behaviour is undefined for other partition types.</p>

<h2 id="part-get-mbr-id">part-get-mbr-id</h2>

<pre><code> part-get-mbr-id device partnum</code></pre>

<p>Returns the MBR type byte (also known as the ID byte) from the numbered partition <code>partnum</code>.</p>

<p>Note that only MBR (old DOS-style) partitions have type bytes. You will get undefined results for other partition table types (see <a href="#part-get-parttype">&quot;part-get-parttype&quot;</a>).</p>

<h2 id="part-get-mbr-part-type">part-get-mbr-part-type</h2>

<pre><code> part-get-mbr-part-type device partnum</code></pre>

<p>This returns the partition type of an MBR partition numbered <code>partnum</code> on device <code>device</code>.</p>

<p>It returns <code>primary</code>, <code>logical</code>, or <code>extended</code>.</p>

<h2 id="part-get-name">part-get-name</h2>

<pre><code> part-get-name device partnum</code></pre>

<p>This gets the partition name on partition numbered <code>partnum</code> on device <code>device</code>. Note that partitions are numbered from 1.</p>

<p>The partition name can only be read on certain types of partition table. This works on <code>gpt</code> but not on <code>mbr</code> partitions.</p>

<h2 id="part-get-parttype">part-get-parttype</h2>

<pre><code> part-get-parttype device</code></pre>

<p>This command examines the partition table on <code>device</code> and returns the partition table type (format) being used.</p>

<p>Common return values include: <code>msdos</code> (a DOS/Windows style MBR partition table), <code>gpt</code> (a GPT/EFI-style partition table). Other values are possible, although unusual. See <a href="#part-init">&quot;part-init&quot;</a> for a full list.</p>

<h2 id="part-init">part-init</h2>

<pre><code> part-init device parttype</code></pre>

<p>This creates an empty partition table on <code>device</code> of one of the partition types listed below. Usually <code>parttype</code> should be either <code>msdos</code> or <code>gpt</code> (for large disks).</p>

<p>Initially there are no partitions. Following this, you should call <a href="#part-add">&quot;part-add&quot;</a> for each partition required.</p>

<p>Possible values for <code>parttype</code> are:</p>

<dl>

<dt><b>efi</b></dt>
<dd>

</dd>
<dt><b>gpt</b></dt>
<dd>

<p>Intel EFI / GPT partition table.</p>

<p>This is recommended for &gt;= 2 TB partitions that will be accessed from Linux and Intel-based Mac OS X. It also has limited backwards compatibility with the <code>mbr</code> format.</p>

</dd>
<dt><b>mbr</b></dt>
<dd>

</dd>
<dt><b>msdos</b></dt>
<dd>

<p>The standard PC &quot;Master Boot Record&quot; (MBR) format used by MS-DOS and Windows. This partition type will <b>only</b> work for device sizes up to 2 TB. For large disks we recommend using <code>gpt</code>.</p>

</dd>
</dl>

<p>Other partition table types that may work but are not supported include:</p>

<dl>

<dt><b>aix</b></dt>
<dd>

<p>AIX disk labels.</p>

</dd>
<dt><b>amiga</b></dt>
<dd>

</dd>
<dt><b>rdb</b></dt>
<dd>

<p>Amiga &quot;Rigid Disk Block&quot; format.</p>

</dd>
<dt><b>bsd</b></dt>
<dd>

<p>BSD disk labels.</p>

</dd>
<dt><b>dasd</b></dt>
<dd>

<p>DASD, used on IBM mainframes.</p>

</dd>
<dt><b>dvh</b></dt>
<dd>

<p>MIPS/SGI volumes.</p>

</dd>
<dt><b>mac</b></dt>
<dd>

<p>Old Mac partition format. Modern Macs use <code>gpt</code>.</p>

</dd>
<dt><b>pc98</b></dt>
<dd>

<p>NEC PC-98 format, common in Japan apparently.</p>

</dd>
<dt><b>sun</b></dt>
<dd>

<p>Sun disk labels.</p>

</dd>
</dl>

<h2 id="part-list">part-list</h2>

<pre><code> part-list device</code></pre>

<p>This command parses the partition table on <code>device</code> and returns the list of partitions found.</p>

<p>The fields in the returned structure are:</p>

<dl>

<dt><b>part_num</b></dt>
<dd>

<p>Partition number, counting from 1.</p>

</dd>
<dt><b>part_start</b></dt>
<dd>

<p>Start of the partition <i>in bytes</i>. To get sectors you have to divide by the device&#39;s sector size, see <a href="#blockdev-getss">&quot;blockdev-getss&quot;</a>.</p>

</dd>
<dt><b>part_end</b></dt>
<dd>

<p>End of the partition in bytes.</p>

</dd>
<dt><b>part_size</b></dt>
<dd>

<p>Size of the partition in bytes.</p>

</dd>
</dl>

<h2 id="part-set-bootable">part-set-bootable</h2>

<pre><code> part-set-bootable device partnum true|false</code></pre>

<p>This sets the bootable flag on partition numbered <code>partnum</code> on device <code>device</code>. Note that partitions are numbered from 1.</p>

<p>The bootable flag is used by some operating systems (notably Windows) to determine which partition to boot from. It is by no means universally recognized.</p>

<h2 id="part-set-gpt-guid">part-set-gpt-guid</h2>

<pre><code> part-set-gpt-guid device partnum guid</code></pre>

<p>Set the GUID of numbered GPT partition <code>partnum</code> to <code>guid</code>. Return an error if the partition table of <code>device</code> isn&#39;t GPT, or if <code>guid</code> is not a valid GUID.</p>

<h2 id="part-set-gpt-type">part-set-gpt-type</h2>

<pre><code> part-set-gpt-type device partnum guid</code></pre>

<p>Set the type GUID of numbered GPT partition <code>partnum</code> to <code>guid</code>. Return an error if the partition table of <code>device</code> isn&#39;t GPT, or if <code>guid</code> is not a valid GUID.</p>

<p>See <a href="http://en.wikipedia.org/wiki/GUID_Partition_Table#Partition_type_GUIDs">http://en.wikipedia.org/wiki/GUID_Partition_Table#Partition_type_GUIDs</a> for a useful list of type GUIDs.</p>

<h2 id="part-set-mbr-id">part-set-mbr-id</h2>

<pre><code> part-set-mbr-id device partnum idbyte</code></pre>

<p>Sets the MBR type byte (also known as the ID byte) of the numbered partition <code>partnum</code> to <code>idbyte</code>. Note that the type bytes quoted in most documentation are in fact hexadecimal numbers, but usually documented without any leading &quot;0x&quot; which might be confusing.</p>

<p>Note that only MBR (old DOS-style) partitions have type bytes. You will get undefined results for other partition table types (see <a href="#part-get-parttype">&quot;part-get-parttype&quot;</a>).</p>

<h2 id="part-set-name">part-set-name</h2>

<pre><code> part-set-name device partnum name</code></pre>

<p>This sets the partition name on partition numbered <code>partnum</code> on device <code>device</code>. Note that partitions are numbered from 1.</p>

<p>The partition name can only be set on certain types of partition table. This works on <code>gpt</code> but not on <code>mbr</code> partitions.</p>

<h2 id="part-to-dev">part-to-dev</h2>

<pre><code> part-to-dev partition</code></pre>

<p>This function takes a partition name (eg. &quot;/dev/sdb1&quot;) and removes the partition number, returning the device name (eg. &quot;/dev/sdb&quot;).</p>

<p>The named partition must exist, for example as a string returned from <a href="#list-partitions">&quot;list-partitions&quot;</a>.</p>

<p>See also <a href="#part-to-partnum">&quot;part-to-partnum&quot;</a>, <a href="#device-index">&quot;device-index&quot;</a>.</p>

<h2 id="part-to-partnum">part-to-partnum</h2>

<pre><code> part-to-partnum partition</code></pre>

<p>This function takes a partition name (eg. &quot;/dev/sdb1&quot;) and returns the partition number (eg. <code>1</code>).</p>

<p>The named partition must exist, for example as a string returned from <a href="#list-partitions">&quot;list-partitions&quot;</a>.</p>

<p>See also <a href="#part-to-dev">&quot;part-to-dev&quot;</a>.</p>

<h2 id="ping-daemon">ping-daemon</h2>

<pre><code> ping-daemon</code></pre>

<p>This is a test probe into the guestfs daemon running inside the libguestfs appliance. Calling this function checks that the daemon responds to the ping message, without affecting the daemon or attached block device(s) in any other way.</p>

<h2 id="pread">pread</h2>

<pre><code> pread path count offset</code></pre>

<p>This command lets you read part of a file. It reads <code>count</code> bytes of the file, starting at <code>offset</code>, from file <code>path</code>.</p>

<p>This may read fewer bytes than requested. For further details see the <a href="http://man.he.net/man2/pread">pread(2)</a> system call.</p>

<p>See also <a href="#pwrite">&quot;pwrite&quot;</a>, <a href="#pread-device">&quot;pread-device&quot;</a>.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="pread-device">pread-device</h2>

<pre><code> pread-device device count offset</code></pre>

<p>This command lets you read part of a block device. It reads <code>count</code> bytes of <code>device</code>, starting at <code>offset</code>.</p>

<p>This may read fewer bytes than requested. For further details see the <a href="http://man.he.net/man2/pread">pread(2)</a> system call.</p>

<p>See also <a href="#pread">&quot;pread&quot;</a>.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="pvchange-uuid">pvchange-uuid</h2>

<pre><code> pvchange-uuid device</code></pre>

<p>Generate a new random UUID for the physical volume <code>device</code>.</p>

<h2 id="pvchange-uuid-all">pvchange-uuid-all</h2>

<pre><code> pvchange-uuid-all</code></pre>

<p>Generate new random UUIDs for all physical volumes.</p>

<h2 id="pvcreate">pvcreate</h2>

<pre><code> pvcreate device</code></pre>

<p>This creates an LVM physical volume on the named <code>device</code>, where <code>device</code> should usually be a partition name such as <i>/dev/sda1</i>.</p>

<h2 id="pvremove">pvremove</h2>

<pre><code> pvremove device</code></pre>

<p>This wipes a physical volume <code>device</code> so that LVM will no longer recognise it.</p>

<p>The implementation uses the <code>pvremove</code> command which refuses to wipe physical volumes that contain any volume groups, so you have to remove those first.</p>

<h2 id="pvresize">pvresize</h2>

<pre><code> pvresize device</code></pre>

<p>This resizes (expands or shrinks) an existing LVM physical volume to match the new size of the underlying device.</p>

<h2 id="pvresize-size">pvresize-size</h2>

<pre><code> pvresize-size device size</code></pre>

<p>This command is the same as <a href="#pvresize">&quot;pvresize&quot;</a> except that it allows you to specify the new size (in bytes) explicitly.</p>

<h2 id="pvs">pvs</h2>

<pre><code> pvs</code></pre>

<p>List all the physical volumes detected. This is the equivalent of the <a href="http://man.he.net/man8/pvs">pvs(8)</a> command.</p>

<p>This returns a list of just the device names that contain PVs (eg. <i>/dev/sda2</i>).</p>

<p>See also <a href="#pvs-full">&quot;pvs-full&quot;</a>.</p>

<h2 id="pvs-full">pvs-full</h2>

<pre><code> pvs-full</code></pre>

<p>List all the physical volumes detected. This is the equivalent of the <a href="http://man.he.net/man8/pvs">pvs(8)</a> command. The &quot;full&quot; version includes all fields.</p>

<h2 id="pvuuid">pvuuid</h2>

<pre><code> pvuuid device</code></pre>

<p>This command returns the UUID of the LVM PV <code>device</code>.</p>

<h2 id="pwrite">pwrite</h2>

<pre><code> pwrite path content offset</code></pre>

<p>This command writes to part of a file. It writes the data buffer <code>content</code> to the file <code>path</code> starting at offset <code>offset</code>.</p>

<p>This command implements the <a href="http://man.he.net/man2/pwrite">pwrite(2)</a> system call, and like that system call it may not write the full data requested. The return value is the number of bytes that were actually written to the file. This could even be 0, although short writes are unlikely for regular files in ordinary circumstances.</p>

<p>See also <a href="#pread">&quot;pread&quot;</a>, <a href="#pwrite-device">&quot;pwrite-device&quot;</a>.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="pwrite-device">pwrite-device</h2>

<pre><code> pwrite-device device content offset</code></pre>

<p>This command writes to part of a device. It writes the data buffer <code>content</code> to <code>device</code> starting at offset <code>offset</code>.</p>

<p>This command implements the <a href="http://man.he.net/man2/pwrite">pwrite(2)</a> system call, and like that system call it may not write the full data requested (although short writes to disk devices and partitions are probably impossible with standard Linux kernels).</p>

<p>See also <a href="#pwrite">&quot;pwrite&quot;</a>.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="read-file">read-file</h2>

<pre><code> read-file path</code></pre>

<p>This calls returns the contents of the file <code>path</code> as a buffer.</p>

<p>Unlike <a href="#cat">&quot;cat&quot;</a>, this function can correctly handle files that contain embedded ASCII NUL characters.</p>

<h2 id="read-lines">read-lines</h2>

<pre><code> read-lines path</code></pre>

<p>Return the contents of the file named <code>path</code>.</p>

<p>The file contents are returned as a list of lines. Trailing <code>LF</code> and <code>CRLF</code> character sequences are <i>not</i> returned.</p>

<p>Note that this function cannot correctly handle binary files (specifically, files containing <code>\0</code> character which is treated as end of string). For those you need to use the <a href="#read-file">&quot;read-file&quot;</a> function and split the buffer into lines yourself.</p>

<h2 id="readdir">readdir</h2>

<pre><code> readdir dir</code></pre>

<p>This returns the list of directory entries in directory <code>dir</code>.</p>

<p>All entries in the directory are returned, including <code>.</code> and <code>..</code>. The entries are <i>not</i> sorted, but returned in the same order as the underlying filesystem.</p>

<p>Also this call returns basic file type information about each file. The <code>ftyp</code> field will contain one of the following characters:</p>

<dl>

<dt>&#39;b&#39;</dt>
<dd>

<p>Block special</p>

</dd>
<dt>&#39;c&#39;</dt>
<dd>

<p>Char special</p>

</dd>
<dt>&#39;d&#39;</dt>
<dd>

<p>Directory</p>

</dd>
<dt>&#39;f&#39;</dt>
<dd>

<p>FIFO (named pipe)</p>

</dd>
<dt>&#39;l&#39;</dt>
<dd>

<p>Symbolic link</p>

</dd>
<dt>&#39;r&#39;</dt>
<dd>

<p>Regular file</p>

</dd>
<dt>&#39;s&#39;</dt>
<dd>

<p>Socket</p>

</dd>
<dt>&#39;u&#39;</dt>
<dd>

<p>Unknown file type</p>

</dd>
<dt>&#39;?&#39;</dt>
<dd>

<p>The <a href="http://man.he.net/man3/readdir">readdir(3)</a> call returned a <code>d_type</code> field with an unexpected value</p>

</dd>
</dl>

<p>This function is primarily intended for use by programs. To get a simple list of names, use <a href="#ls">&quot;ls&quot;</a>. To get a printable directory for human consumption, use <a href="#ll">&quot;ll&quot;</a>.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="readlink">readlink</h2>

<pre><code> readlink path</code></pre>

<p>This command reads the target of a symbolic link.</p>

<h2 id="readlinklist">readlinklist</h2>

<pre><code> readlinklist path &#39;names ...&#39;</code></pre>

<p>This call allows you to do a <code>readlink</code> operation on multiple files, where all files are in the directory <code>path</code>. <code>names</code> is the list of files from this directory.</p>

<p>On return you get a list of strings, with a one-to-one correspondence to the <code>names</code> list. Each string is the value of the symbolic link.</p>

<p>If the <a href="http://man.he.net/man2/readlink">readlink(2)</a> operation fails on any name, then the corresponding result string is the empty string <code>&quot;&quot;</code>. However the whole operation is completed even if there were <a href="http://man.he.net/man2/readlink">readlink(2)</a> errors, and so you can call this function with names where you don&#39;t know if they are symbolic links already (albeit slightly less efficient).</p>

<p>This call is intended for programs that want to efficiently list a directory contents without making many round-trips.</p>

<h2 id="realpath">realpath</h2>

<pre><code> realpath path</code></pre>

<p>Return the canonicalized absolute pathname of <code>path</code>. The returned path has no <code>.</code>, <code>..</code> or symbolic link path elements.</p>

<h2 id="remount">remount</h2>

<pre><code> remount mountpoint [rw:true|false]</code></pre>

<p>This call allows you to change the <code>rw</code> (readonly/read-write) flag on an already mounted filesystem at <code>mountpoint</code>, converting a readonly filesystem to be read-write, or vice-versa.</p>

<p>Note that at the moment you must supply the &quot;optional&quot; <code>rw</code> parameter. In future we may allow other flags to be adjusted.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="remove-drive">remove-drive</h2>

<pre><code> remove-drive label</code></pre>

<p>This function is conceptually the opposite of <a href="#add-drive-opts">&quot;add-drive-opts&quot;</a>. It removes the drive that was previously added with label <code>label</code>.</p>

<p>Note that in order to remove drives, you have to add them with labels (see the optional <code>label</code> argument to <a href="#add-drive-opts">&quot;add-drive-opts&quot;</a>). If you didn&#39;t use a label, then they cannot be removed.</p>

<p>You can call this function before or after launching the handle. If called after launch, if the backend supports it, we try to hot unplug the drive: see <a href="guestfs.3.html#hotplugging">&quot;HOTPLUGGING&quot; in guestfs(3)</a>. The disk <b>must not</b> be in use (eg. mounted) when you do this. We try to detect if the disk is in use and stop you from doing this.</p>

<h2 id="removexattr">removexattr</h2>

<pre><code> removexattr xattr path</code></pre>

<p>This call removes the extended attribute named <code>xattr</code> of the file <code>path</code>.</p>

<p>See also: <a href="#lremovexattr">&quot;lremovexattr&quot;</a>, <a href="http://man.he.net/man5/attr">attr(5)</a>.</p>

<h2 id="rename">rename</h2>

<pre><code> rename oldpath newpath</code></pre>

<p>Rename a file to a new place on the same filesystem. This is the same as the Linux <a href="http://man.he.net/man2/rename">rename(2)</a> system call. In most cases you are better to use <a href="#mv">&quot;mv&quot;</a> instead.</p>

<h2 id="resize2fs">resize2fs</h2>

<pre><code> resize2fs device</code></pre>

<p>This resizes an ext2, ext3 or ext4 filesystem to match the size of the underlying device.</p>

<p>See also <a href="guestfs.3.html#resize2fs-errors">&quot;RESIZE2FS ERRORS&quot; in guestfs(3)</a>.</p>

<h2 id="resize2fs-m">resize2fs-M</h2>

<pre><code> resize2fs-M device</code></pre>

<p>This command is the same as <a href="#resize2fs">&quot;resize2fs&quot;</a>, but the filesystem is resized to its minimum size. This works like the <i>-M</i> option to the <code>resize2fs</code> command.</p>

<p>To get the resulting size of the filesystem you should call <a href="#tune2fs-l">&quot;tune2fs-l&quot;</a> and read the <code>Block size</code> and <code>Block count</code> values. These two numbers, multiplied together, give the resulting size of the minimal filesystem in bytes.</p>

<p>See also <a href="guestfs.3.html#resize2fs-errors">&quot;RESIZE2FS ERRORS&quot; in guestfs(3)</a>.</p>

<h2 id="resize2fs-size">resize2fs-size</h2>

<pre><code> resize2fs-size device size</code></pre>

<p>This command is the same as <a href="#resize2fs">&quot;resize2fs&quot;</a> except that it allows you to specify the new size (in bytes) explicitly.</p>

<p>See also <a href="guestfs.3.html#resize2fs-errors">&quot;RESIZE2FS ERRORS&quot; in guestfs(3)</a>.</p>

<h2 id="rm">rm</h2>

<pre><code> rm path</code></pre>

<p>Remove the single file <code>path</code>.</p>

<h2 id="rm-f">rm-f</h2>

<pre><code> rm-f path</code></pre>

<p>Remove the file <code>path</code>.</p>

<p>If the file doesn&#39;t exist, that error is ignored. (Other errors, eg. I/O errors or bad paths, are not ignored)</p>

<p>This call cannot remove directories. Use <a href="#rmdir">&quot;rmdir&quot;</a> to remove an empty directory, or <a href="#rm-rf">&quot;rm-rf&quot;</a> to remove directories recursively.</p>

<h2 id="rm-rf">rm-rf</h2>

<pre><code> rm-rf path</code></pre>

<p>Remove the file or directory <code>path</code>, recursively removing the contents if its a directory. This is like the <code>rm -rf</code> shell command.</p>

<h2 id="rmdir">rmdir</h2>

<pre><code> rmdir path</code></pre>

<p>Remove the single directory <code>path</code>.</p>

<h2 id="rmmountpoint">rmmountpoint</h2>

<pre><code> rmmountpoint exemptpath</code></pre>

<p>This calls removes a mountpoint that was previously created with <a href="#mkmountpoint">&quot;mkmountpoint&quot;</a>. See <a href="#mkmountpoint">&quot;mkmountpoint&quot;</a> for full details.</p>

<h2 id="rsync">rsync</h2>

<pre><code> rsync src dest [archive:true|false] [deletedest:true|false]</code></pre>

<p>This call may be used to copy or synchronize two directories under the same libguestfs handle. This uses the <a href="http://man.he.net/man1/rsync">rsync(1)</a> program which uses a fast algorithm that avoids copying files unnecessarily.</p>

<p><code>src</code> and <code>dest</code> are the source and destination directories. Files are copied from <code>src</code> to <code>dest</code>.</p>

<p>The optional arguments are:</p>

<dl>

<dt><code>archive</code></dt>
<dd>

<p>Turns on archive mode. This is the same as passing the <i>--archive</i> flag to <code>rsync</code>.</p>

</dd>
<dt><code>deletedest</code></dt>
<dd>

<p>Delete files at the destination that do not exist at the source.</p>

</dd>
</dl>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="rsync-in">rsync-in</h2>

<pre><code> rsync-in remote dest [archive:true|false] [deletedest:true|false]</code></pre>

<p>This call may be used to copy or synchronize the filesystem on the host or on a remote computer with the filesystem within libguestfs. This uses the <a href="http://man.he.net/man1/rsync">rsync(1)</a> program which uses a fast algorithm that avoids copying files unnecessarily.</p>

<p>This call only works if the network is enabled. See <a href="#set-network">&quot;set-network&quot;</a> or the <i>--network</i> option to various tools like <a href="guestfish.1.html">guestfish(1)</a>.</p>

<p>Files are copied from the remote server and directory specified by <code>remote</code> to the destination directory <code>dest</code>.</p>

<p>The format of the remote server string is defined by <a href="http://man.he.net/man1/rsync">rsync(1)</a>. Note that there is no way to supply a password or passphrase so the target must be set up not to require one.</p>

<p>The optional arguments are the same as those of <a href="#rsync">&quot;rsync&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="rsync-out">rsync-out</h2>

<pre><code> rsync-out src remote [archive:true|false] [deletedest:true|false]</code></pre>

<p>This call may be used to copy or synchronize the filesystem within libguestfs with a filesystem on the host or on a remote computer. This uses the <a href="http://man.he.net/man1/rsync">rsync(1)</a> program which uses a fast algorithm that avoids copying files unnecessarily.</p>

<p>This call only works if the network is enabled. See <a href="#set-network">&quot;set-network&quot;</a> or the <i>--network</i> option to various tools like <a href="guestfish.1.html">guestfish(1)</a>.</p>

<p>Files are copied from the source directory <code>src</code> to the remote server and directory specified by <code>remote</code>.</p>

<p>The format of the remote server string is defined by <a href="http://man.he.net/man1/rsync">rsync(1)</a>. Note that there is no way to supply a password or passphrase so the target must be set up not to require one.</p>

<p>The optional arguments are the same as those of <a href="#rsync">&quot;rsync&quot;</a>.</p>

<p>Globbing does not happen on the <code>src</code> parameter. In programs which use the API directly you have to expand wildcards yourself (see <a href="#glob-expand">&quot;glob-expand&quot;</a>). In guestfish you can use the <code>glob</code> command (see <a href="#glob">&quot;glob&quot;</a>), for example:</p>

<pre><code> &gt;&lt;fs&gt; glob rsync-out /* rsync://remote/</code></pre>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="scrub-device">scrub-device</h2>

<pre><code> scrub-device device</code></pre>

<p>This command writes patterns over <code>device</code> to make data retrieval more difficult.</p>

<p>It is an interface to the <a href="http://man.he.net/man1/scrub">scrub(1)</a> program. See that manual page for more details.</p>

<h2 id="scrub-file">scrub-file</h2>

<pre><code> scrub-file file</code></pre>

<p>This command writes patterns over a file to make data retrieval more difficult.</p>

<p>The file is <i>removed</i> after scrubbing.</p>

<p>It is an interface to the <a href="http://man.he.net/man1/scrub">scrub(1)</a> program. See that manual page for more details.</p>

<h2 id="scrub-freespace">scrub-freespace</h2>

<pre><code> scrub-freespace dir</code></pre>

<p>This command creates the directory <code>dir</code> and then fills it with files until the filesystem is full, and scrubs the files as for <a href="#scrub-file">&quot;scrub-file&quot;</a>, and deletes them. The intention is to scrub any free space on the partition containing <code>dir</code>.</p>

<p>It is an interface to the <a href="http://man.he.net/man1/scrub">scrub(1)</a> program. See that manual page for more details.</p>

<h2 id="set-append">set-append</h2>

<h2 id="append">append</h2>

<pre><code> set-append append</code></pre>

<p>This function is used to add additional options to the libguestfs appliance kernel command line.</p>

<p>The default is <code>NULL</code> unless overridden by setting <code>LIBGUESTFS_APPEND</code> environment variable.</p>

<p>Setting <code>append</code> to <code>NULL</code> means <i>no</i> additional options are passed (libguestfs always adds a few of its own).</p>

<h2 id="set-attach-method">set-attach-method</h2>

<h2 id="attach-method">attach-method</h2>

<pre><code> set-attach-method backend</code></pre>

<p>Set the method that libguestfs uses to connect to the backend guestfsd daemon.</p>

<p>See <a href="guestfs.3.html#backend">&quot;BACKEND&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#set-backend">&quot;set-backend&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="set-autosync">set-autosync</h2>

<h2 id="autosync">autosync</h2>

<pre><code> set-autosync true|false</code></pre>

<p>If <code>autosync</code> is true, this enables autosync. Libguestfs will make a best effort attempt to make filesystems consistent and synchronized when the handle is closed (also if the program exits without closing handles).</p>

<p>This is enabled by default (since libguestfs 1.5.24, previously it was disabled by default).</p>

<h2 id="set-backend">set-backend</h2>

<h2 id="backend">backend</h2>

<pre><code> set-backend backend</code></pre>

<p>Set the method that libguestfs uses to connect to the backend guestfsd daemon.</p>

<p>This handle property was previously called the &quot;attach method&quot;.</p>

<p>See <a href="guestfs.3.html#backend">&quot;BACKEND&quot; in guestfs(3)</a>.</p>

<h2 id="set-backend-setting">set-backend-setting</h2>

<pre><code> set-backend-setting name val</code></pre>

<p>Append <code>&quot;name=value&quot;</code> to the backend settings string list. However if a string already exists matching <code>&quot;name&quot;</code> or beginning with <code>&quot;name=&quot;</code>, then that setting is replaced.</p>

<p>See <a href="guestfs.3.html#backend">&quot;BACKEND&quot; in guestfs(3)</a>, <a href="guestfs.3.html#backend-settings">&quot;BACKEND SETTINGS&quot; in guestfs(3)</a>.</p>

<h2 id="set-backend-settings">set-backend-settings</h2>

<pre><code> set-backend-settings &#39;settings ...&#39;</code></pre>

<p>Set a list of zero or more settings which are passed through to the current backend. Each setting is a string which is interpreted in a backend-specific way, or ignored if not understood by the backend.</p>

<p>The default value is an empty list, unless the environment variable <code>LIBGUESTFS_BACKEND_SETTINGS</code> was set when the handle was created. This environment variable contains a colon-separated list of settings.</p>

<p>This call replaces all backend settings. If you want to replace a single backend setting, see <a href="#set-backend-setting">&quot;set-backend-setting&quot;</a>. If you want to clear a single backend setting, see <a href="#clear-backend-setting">&quot;clear-backend-setting&quot;</a>.</p>

<p>See <a href="guestfs.3.html#backend">&quot;BACKEND&quot; in guestfs(3)</a>, <a href="guestfs.3.html#backend-settings">&quot;BACKEND SETTINGS&quot; in guestfs(3)</a>.</p>

<h2 id="set-cachedir">set-cachedir</h2>

<h2 id="cachedir">cachedir</h2>

<pre><code> set-cachedir cachedir</code></pre>

<p>Set the directory used by the handle to store the appliance cache, when using a supermin appliance. The appliance is cached and shared between all handles which have the same effective user ID.</p>

<p>The environment variables <code>LIBGUESTFS_CACHEDIR</code> and <code>TMPDIR</code> control the default value: If <code>LIBGUESTFS_CACHEDIR</code> is set, then that is the default. Else if <code>TMPDIR</code> is set, then that is the default. Else <i>/var/tmp</i> is the default.</p>

<h2 id="set-direct">set-direct</h2>

<h2 id="direct">direct</h2>

<pre><code> set-direct true|false</code></pre>

<p>If the direct appliance mode flag is enabled, then stdin and stdout are passed directly through to the appliance once it is launched.</p>

<p>One consequence of this is that log messages aren&#39;t caught by the library and handled by <a href="#set-log-message-callback">&quot;set-log-message-callback&quot;</a>, but go straight to stdout.</p>

<p>You probably don&#39;t want to use this unless you know what you are doing.</p>

<p>The default is disabled.</p>

<h2 id="set-e2attrs">set-e2attrs</h2>

<pre><code> set-e2attrs file attrs [clear:true|false]</code></pre>

<p>This sets or clears the file attributes <code>attrs</code> associated with the inode <i>file</i>.</p>

<p><code>attrs</code> is a string of characters representing file attributes. See <a href="#get-e2attrs">&quot;get-e2attrs&quot;</a> for a list of possible attributes. Not all attributes can be changed.</p>

<p>If optional boolean <code>clear</code> is not present or false, then the <code>attrs</code> listed are set in the inode.</p>

<p>If <code>clear</code> is true, then the <code>attrs</code> listed are cleared in the inode.</p>

<p>In both cases, other attributes not present in the <code>attrs</code> string are left unchanged.</p>

<p>These attributes are only present when the file is located on an ext2/3/4 filesystem. Using this call on other filesystem types will result in an error.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="set-e2generation">set-e2generation</h2>

<pre><code> set-e2generation file generation</code></pre>

<p>This sets the ext2 file generation of a file.</p>

<p>See <a href="#get-e2generation">&quot;get-e2generation&quot;</a>.</p>

<h2 id="set-e2label">set-e2label</h2>

<pre><code> set-e2label device label</code></pre>

<p>This sets the ext2/3/4 filesystem label of the filesystem on <code>device</code> to <code>label</code>. Filesystem labels are limited to 16 characters.</p>

<p>You can use either <a href="#tune2fs-l">&quot;tune2fs-l&quot;</a> or <a href="#get-e2label">&quot;get-e2label&quot;</a> to return the existing label on a filesystem.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#set-label">&quot;set-label&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="set-e2uuid">set-e2uuid</h2>

<pre><code> set-e2uuid device uuid</code></pre>

<p>This sets the ext2/3/4 filesystem UUID of the filesystem on <code>device</code> to <code>uuid</code>. The format of the UUID and alternatives such as <code>clear</code>, <code>random</code> and <code>time</code> are described in the <a href="http://man.he.net/man8/tune2fs">tune2fs(8)</a> manpage.</p>

<p>You can use <a href="#vfs-uuid">&quot;vfs-uuid&quot;</a> to return the existing UUID of a filesystem.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#set-uuid">&quot;set-uuid&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="set-hv">set-hv</h2>

<h2 id="hv">hv</h2>

<pre><code> set-hv hv</code></pre>

<p>Set the hypervisor binary that we will use. The hypervisor depends on the backend, but is usually the location of the qemu/KVM hypervisor. For the uml backend, it is the location of the <code>linux</code> or <code>vmlinux</code> binary.</p>

<p>The default is chosen when the library was compiled by the configure script.</p>

<p>You can also override this by setting the <code>LIBGUESTFS_HV</code> environment variable.</p>

<p>Note that you should call this function as early as possible after creating the handle. This is because some pre-launch operations depend on testing qemu features (by running <code>qemu -help</code>). If the qemu binary changes, we don&#39;t retest features, and so you might see inconsistent results. Using the environment variable <code>LIBGUESTFS_HV</code> is safest of all since that picks the qemu binary at the same time as the handle is created.</p>

<h2 id="set-label">set-label</h2>

<pre><code> set-label mountable label</code></pre>

<p>Set the filesystem label on <code>mountable</code> to <code>label</code>.</p>

<p>Only some filesystem types support labels, and libguestfs supports setting labels on only a subset of these.</p>

<dl>

<dt>ext2, ext3, ext4</dt>
<dd>

<p>Labels are limited to 16 bytes.</p>

</dd>
<dt>NTFS</dt>
<dd>

<p>Labels are limited to 128 unicode characters.</p>

</dd>
<dt>XFS</dt>
<dd>

<p>The label is limited to 12 bytes. The filesystem must not be mounted when trying to set the label.</p>

</dd>
<dt>btrfs</dt>
<dd>

<p>The label is limited to 256 bytes and some characters are not allowed. Setting the label on a btrfs subvolume will set the label on its parent filesystem. The filesystem must not be mounted when trying to set the label.</p>

</dd>
<dt>fat</dt>
<dd>

<p>The label is limited to 11 bytes.</p>

</dd>
</dl>

<p>If there is no support for changing the label for the type of the specified filesystem, set_label will fail and set errno as ENOTSUP.</p>

<p>To read the label on a filesystem, call <a href="#vfs-label">&quot;vfs-label&quot;</a>.</p>

<h2 id="set-libvirt-requested-credential">set-libvirt-requested-credential</h2>

<pre><code> set-libvirt-requested-credential index cred</code></pre>

<p>After requesting the <code>index</code>&#39;th credential from the user, call this function to pass the answer back to libvirt.</p>

<p>See <a href="guestfs.3.html#libvirt-authentication">&quot;LIBVIRT AUTHENTICATION&quot; in guestfs(3)</a> for documentation and example code.</p>

<h2 id="set-libvirt-supported-credentials">set-libvirt-supported-credentials</h2>

<pre><code> set-libvirt-supported-credentials &#39;creds ...&#39;</code></pre>

<p>Call this function before setting an event handler for <code>GUESTFS_EVENT_LIBVIRT_AUTH</code>, to supply the list of credential types that the program knows how to process.</p>

<p>The <code>creds</code> list must be a non-empty list of strings. Possible strings are:</p>

<dl>

<dt><code>username</code></dt>
<dd>

</dd>
<dt><code>authname</code></dt>
<dd>

</dd>
<dt><code>language</code></dt>
<dd>

</dd>
<dt><code>cnonce</code></dt>
<dd>

</dd>
<dt><code>passphrase</code></dt>
<dd>

</dd>
<dt><code>echoprompt</code></dt>
<dd>

</dd>
<dt><code>noechoprompt</code></dt>
<dd>

</dd>
<dt><code>realm</code></dt>
<dd>

</dd>
<dt><code>external</code></dt>
<dd>

</dd>
</dl>

<p>See libvirt documentation for the meaning of these credential types.</p>

<p>See <a href="guestfs.3.html#libvirt-authentication">&quot;LIBVIRT AUTHENTICATION&quot; in guestfs(3)</a> for documentation and example code.</p>

<h2 id="set-memsize">set-memsize</h2>

<h2 id="memsize">memsize</h2>

<pre><code> set-memsize memsize</code></pre>

<p>This sets the memory size in megabytes allocated to the hypervisor. This only has any effect if called before <a href="#launch">&quot;launch&quot;</a>.</p>

<p>You can also change this by setting the environment variable <code>LIBGUESTFS_MEMSIZE</code> before the handle is created.</p>

<p>For more information on the architecture of libguestfs, see <a href="guestfs.3.html">guestfs(3)</a>.</p>

<h2 id="set-network">set-network</h2>

<h2 id="network">network</h2>

<pre><code> set-network true|false</code></pre>

<p>If <code>network</code> is true, then the network is enabled in the libguestfs appliance. The default is false.</p>

<p>This affects whether commands are able to access the network (see <a href="guestfs.3.html#running-commands">&quot;RUNNING COMMANDS&quot; in guestfs(3)</a>).</p>

<p>You must call this before calling <a href="#launch">&quot;launch&quot;</a>, otherwise it has no effect.</p>

<h2 id="set-path">set-path</h2>

<h2 id="path">path</h2>

<pre><code> set-path searchpath</code></pre>

<p>Set the path that libguestfs searches for kernel and initrd.img.</p>

<p>The default is <code>$libdir/guestfs</code> unless overridden by setting <code>LIBGUESTFS_PATH</code> environment variable.</p>

<p>Setting <code>path</code> to <code>NULL</code> restores the default path.</p>

<h2 id="set-pgroup">set-pgroup</h2>

<h2 id="pgroup">pgroup</h2>

<pre><code> set-pgroup true|false</code></pre>

<p>If <code>pgroup</code> is true, child processes are placed into their own process group.</p>

<p>The practical upshot of this is that signals like <code>SIGINT</code> (from users pressing <code>^C</code>) won&#39;t be received by the child process.</p>

<p>The default for this flag is false, because usually you want <code>^C</code> to kill the subprocess. Guestfish sets this flag to true when used interactively, so that <code>^C</code> can cancel long-running commands gracefully (see <a href="#user-cancel">&quot;user-cancel&quot;</a>).</p>

<h2 id="set-program">set-program</h2>

<h2 id="program">program</h2>

<pre><code> set-program program</code></pre>

<p>Set the program name. This is an informative string which the main program may optionally set in the handle.</p>

<p>When the handle is created, the program name in the handle is set to the basename from <code>argv[0]</code>. If that was not possible, it is set to the empty string (but never <code>NULL</code>).</p>

<h2 id="set-qemu">set-qemu</h2>

<h2 id="qemu">qemu</h2>

<pre><code> set-qemu hv</code></pre>

<p>Set the hypervisor binary (usually qemu) that we will use.</p>

<p>The default is chosen when the library was compiled by the configure script.</p>

<p>You can also override this by setting the <code>LIBGUESTFS_HV</code> environment variable.</p>

<p>Setting <code>hv</code> to <code>NULL</code> restores the default qemu binary.</p>

<p>Note that you should call this function as early as possible after creating the handle. This is because some pre-launch operations depend on testing qemu features (by running <code>qemu -help</code>). If the qemu binary changes, we don&#39;t retest features, and so you might see inconsistent results. Using the environment variable <code>LIBGUESTFS_HV</code> is safest of all since that picks the qemu binary at the same time as the handle is created.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#set-hv">&quot;set-hv&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="set-recovery-proc">set-recovery-proc</h2>

<h2 id="recovery-proc">recovery-proc</h2>

<pre><code> set-recovery-proc true|false</code></pre>

<p>If this is called with the parameter <code>false</code> then <a href="#launch">&quot;launch&quot;</a> does not create a recovery process. The purpose of the recovery process is to stop runaway hypervisor processes in the case where the main program aborts abruptly.</p>

<p>This only has any effect if called before <a href="#launch">&quot;launch&quot;</a>, and the default is true.</p>

<p>About the only time when you would want to disable this is if the main process will fork itself into the background (&quot;daemonize&quot; itself). In this case the recovery process thinks that the main program has disappeared and so kills the hypervisor, which is not very helpful.</p>

<h2 id="set-selinux">set-selinux</h2>

<h2 id="selinux">selinux</h2>

<pre><code> set-selinux true|false</code></pre>

<p>This sets the selinux flag that is passed to the appliance at boot time. The default is <code>selinux=0</code> (disabled).</p>

<p>Note that if SELinux is enabled, it is always in Permissive mode (<code>enforcing=0</code>).</p>

<p>For more information on the architecture of libguestfs, see <a href="guestfs.3.html">guestfs(3)</a>.</p>

<h2 id="set-smp">set-smp</h2>

<h2 id="smp">smp</h2>

<pre><code> set-smp smp</code></pre>

<p>Change the number of virtual CPUs assigned to the appliance. The default is <code>1</code>. Increasing this may improve performance, though often it has no effect.</p>

<p>This function must be called before <a href="#launch">&quot;launch&quot;</a>.</p>

<h2 id="set-tmpdir">set-tmpdir</h2>

<h2 id="tmpdir">tmpdir</h2>

<pre><code> set-tmpdir tmpdir</code></pre>

<p>Set the directory used by the handle to store temporary files.</p>

<p>The environment variables <code>LIBGUESTFS_TMPDIR</code> and <code>TMPDIR</code> control the default value: If <code>LIBGUESTFS_TMPDIR</code> is set, then that is the default. Else if <code>TMPDIR</code> is set, then that is the default. Else <i>/tmp</i> is the default.</p>

<h2 id="set-trace">set-trace</h2>

<h2 id="trace">trace</h2>

<pre><code> set-trace true|false</code></pre>

<p>If the command trace flag is set to 1, then libguestfs calls, parameters and return values are traced.</p>

<p>If you want to trace C API calls into libguestfs (and other libraries) then possibly a better way is to use the external <a href="http://man.he.net/man1/ltrace">ltrace(1)</a> command.</p>

<p>Command traces are disabled unless the environment variable <code>LIBGUESTFS_TRACE</code> is defined and set to <code>1</code>.</p>

<p>Trace messages are normally sent to <code>stderr</code>, unless you register a callback to send them somewhere else (see <a href="#set-event-callback">&quot;set-event-callback&quot;</a>).</p>

<h2 id="set-uuid">set-uuid</h2>

<pre><code> set-uuid device uuid</code></pre>

<p>Set the filesystem UUID on <code>device</code> to <code>uuid</code>. If this fails and the errno is ENOTSUP, means that there is no support for changing the UUID for the type of the specified filesystem.</p>

<p>Only some filesystem types support setting UUIDs.</p>

<p>To read the UUID on a filesystem, call <a href="#vfs-uuid">&quot;vfs-uuid&quot;</a>.</p>

<h2 id="set-uuid-random">set-uuid-random</h2>

<pre><code> set-uuid-random device</code></pre>

<p>Set the filesystem UUID on <code>device</code> to a random UUID. If this fails and the errno is ENOTSUP, means that there is no support for changing the UUID for the type of the specified filesystem.</p>

<p>Only some filesystem types support setting UUIDs.</p>

<p>To read the UUID on a filesystem, call <a href="#vfs-uuid">&quot;vfs-uuid&quot;</a>.</p>

<h2 id="set-verbose">set-verbose</h2>

<h2 id="verbose">verbose</h2>

<pre><code> set-verbose true|false</code></pre>

<p>If <code>verbose</code> is true, this turns on verbose messages.</p>

<p>Verbose messages are disabled unless the environment variable <code>LIBGUESTFS_DEBUG</code> is defined and set to <code>1</code>.</p>

<p>Verbose messages are normally sent to <code>stderr</code>, unless you register a callback to send them somewhere else (see <a href="#set-event-callback">&quot;set-event-callback&quot;</a>).</p>

<h2 id="setcon">setcon</h2>

<pre><code> setcon context</code></pre>

<p>This sets the SELinux security context of the daemon to the string <code>context</code>.</p>

<p>See the documentation about SELINUX in <a href="guestfs.3.html">guestfs(3)</a>.</p>

<h2 id="setxattr">setxattr</h2>

<pre><code> setxattr xattr val vallen path</code></pre>

<p>This call sets the extended attribute named <code>xattr</code> of the file <code>path</code> to the value <code>val</code> (of length <code>vallen</code>). The value is arbitrary 8 bit data.</p>

<p>See also: <a href="#lsetxattr">&quot;lsetxattr&quot;</a>, <a href="http://man.he.net/man5/attr">attr(5)</a>.</p>

<h2 id="sfdisk">sfdisk</h2>

<pre><code> sfdisk device cyls heads sectors &#39;lines ...&#39;</code></pre>

<p>This is a direct interface to the <a href="http://man.he.net/man8/sfdisk">sfdisk(8)</a> program for creating partitions on block devices.</p>

<p><code>device</code> should be a block device, for example <i>/dev/sda</i>.</p>

<p><code>cyls</code>, <code>heads</code> and <code>sectors</code> are the number of cylinders, heads and sectors on the device, which are passed directly to sfdisk as the <i>-C</i>, <i>-H</i> and <i>-S</i> parameters. If you pass <code>0</code> for any of these, then the corresponding parameter is omitted. Usually for &#39;large&#39; disks, you can just pass <code>0</code> for these, but for small (floppy-sized) disks, sfdisk (or rather, the kernel) cannot work out the right geometry and you will need to tell it.</p>

<p><code>lines</code> is a list of lines that we feed to <code>sfdisk</code>. For more information refer to the <a href="http://man.he.net/man8/sfdisk">sfdisk(8)</a> manpage.</p>

<p>To create a single partition occupying the whole disk, you would pass <code>lines</code> as a single element list, when the single element being the string <code>,</code> (comma).</p>

<p>See also: <a href="#sfdisk-l">&quot;sfdisk-l&quot;</a>, <a href="#sfdisk-n">&quot;sfdisk-N&quot;</a>, <a href="#part-init">&quot;part-init&quot;</a></p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#part-add">&quot;part-add&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="sfdiskm">sfdiskM</h2>

<pre><code> sfdiskM device &#39;lines ...&#39;</code></pre>

<p>This is a simplified interface to the <a href="#sfdisk">&quot;sfdisk&quot;</a> command, where partition sizes are specified in megabytes only (rounded to the nearest cylinder) and you don&#39;t need to specify the cyls, heads and sectors parameters which were rarely if ever used anyway.</p>

<p>See also: <a href="#sfdisk">&quot;sfdisk&quot;</a>, the <a href="http://man.he.net/man8/sfdisk">sfdisk(8)</a> manpage and <a href="#part-disk">&quot;part-disk&quot;</a></p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#part-add">&quot;part-add&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="sfdisk-n">sfdisk-N</h2>

<pre><code> sfdisk-N device partnum cyls heads sectors line</code></pre>

<p>This runs <a href="http://man.he.net/man8/sfdisk">sfdisk(8)</a> option to modify just the single partition <code>n</code> (note: <code>n</code> counts from 1).</p>

<p>For other parameters, see <a href="#sfdisk">&quot;sfdisk&quot;</a>. You should usually pass <code>0</code> for the cyls/heads/sectors parameters.</p>

<p>See also: <a href="#part-add">&quot;part-add&quot;</a></p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#part-add">&quot;part-add&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="sfdisk-disk-geometry">sfdisk-disk-geometry</h2>

<pre><code> sfdisk-disk-geometry device</code></pre>

<p>This displays the disk geometry of <code>device</code> read from the partition table. Especially in the case where the underlying block device has been resized, this can be different from the kernel&#39;s idea of the geometry (see <a href="#sfdisk-kernel-geometry">&quot;sfdisk-kernel-geometry&quot;</a>).</p>

<p>The result is in human-readable format, and not designed to be parsed.</p>

<h2 id="sfdisk-kernel-geometry">sfdisk-kernel-geometry</h2>

<pre><code> sfdisk-kernel-geometry device</code></pre>

<p>This displays the kernel&#39;s idea of the geometry of <code>device</code>.</p>

<p>The result is in human-readable format, and not designed to be parsed.</p>

<h2 id="sfdisk-l">sfdisk-l</h2>

<pre><code> sfdisk-l device</code></pre>

<p>This displays the partition table on <code>device</code>, in the human-readable output of the <a href="http://man.he.net/man8/sfdisk">sfdisk(8)</a> command. It is not intended to be parsed.</p>

<p>See also: <a href="#part-list">&quot;part-list&quot;</a></p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#part-list">&quot;part-list&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="sh">sh</h2>

<pre><code> sh command</code></pre>

<p>This call runs a command from the guest filesystem via the guest&#39;s <i>/bin/sh</i>.</p>

<p>This is like <a href="#command">&quot;command&quot;</a>, but passes the command to:</p>

<pre><code> /bin/sh -c &quot;command&quot;</code></pre>

<p>Depending on the guest&#39;s shell, this usually results in wildcards being expanded, shell expressions being interpolated and so on.</p>

<p>All the provisos about <a href="#command">&quot;command&quot;</a> apply to this call.</p>

<h2 id="sh-lines">sh-lines</h2>

<pre><code> sh-lines command</code></pre>

<p>This is the same as <a href="#sh">&quot;sh&quot;</a>, but splits the result into a list of lines.</p>

<p>See also: <a href="#command-lines">&quot;command-lines&quot;</a></p>

<h2 id="shutdown">shutdown</h2>

<pre><code> shutdown</code></pre>

<p>This is the opposite of <a href="#launch">&quot;launch&quot;</a>. It performs an orderly shutdown of the backend process(es). If the autosync flag is set (which is the default) then the disk image is synchronized.</p>

<p>If the subprocess exits with an error then this function will return an error, which should <i>not</i> be ignored (it may indicate that the disk image could not be written out properly).</p>

<p>It is safe to call this multiple times. Extra calls are ignored.</p>

<p>This call does <i>not</i> close or free up the handle. You still need to call <a href="#close">&quot;close&quot;</a> afterwards.</p>

<p><a href="#close">&quot;close&quot;</a> will call this if you don&#39;t do it explicitly, but note that any errors are ignored in that case.</p>

<h2 id="sleep">sleep</h2>

<pre><code> sleep secs</code></pre>

<p>Sleep for <code>secs</code> seconds.</p>

<h2 id="stat">stat</h2>

<pre><code> stat path</code></pre>

<p>Returns file information for the given <code>path</code>.</p>

<p>This is the same as the <a href="http://man.he.net/man2/stat">stat(2)</a> system call.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#statns">&quot;statns&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="statns">statns</h2>

<pre><code> statns path</code></pre>

<p>Returns file information for the given <code>path</code>.</p>

<p>This is the same as the <a href="http://man.he.net/man2/stat">stat(2)</a> system call.</p>

<h2 id="statvfs">statvfs</h2>

<pre><code> statvfs path</code></pre>

<p>Returns file system statistics for any mounted file system. <code>path</code> should be a file or directory in the mounted file system (typically it is the mount point itself, but it doesn&#39;t need to be).</p>

<p>This is the same as the <a href="http://man.he.net/man2/statvfs">statvfs(2)</a> system call.</p>

<h2 id="strings">strings</h2>

<pre><code> strings path</code></pre>

<p>This runs the <a href="http://man.he.net/man1/strings">strings(1)</a> command on a file and returns the list of printable strings found.</p>

<p>The <code>strings</code> command has, in the past, had problems with parsing untrusted files. These are mitigated in the current version of libguestfs, but see <a href="guestfs.3.html#cve-2014-8484">&quot;CVE-2014-8484&quot; in guestfs(3)</a>.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="strings-e">strings-e</h2>

<pre><code> strings-e encoding path</code></pre>

<p>This is like the <a href="#strings">&quot;strings&quot;</a> command, but allows you to specify the encoding of strings that are looked for in the source file <code>path</code>.</p>

<p>Allowed encodings are:</p>

<dl>

<dt>s</dt>
<dd>

<p>Single 7-bit-byte characters like ASCII and the ASCII-compatible parts of ISO-8859-X (this is what <a href="#strings">&quot;strings&quot;</a> uses).</p>

</dd>
<dt>S</dt>
<dd>

<p>Single 8-bit-byte characters.</p>

</dd>
<dt>b</dt>
<dd>

<p>16-bit big endian strings such as those encoded in UTF-16BE or UCS-2BE.</p>

</dd>
<dt>l (lower case letter L)</dt>
<dd>

<p>16-bit little endian such as UTF-16LE and UCS-2LE. This is useful for examining binaries in Windows guests.</p>

</dd>
<dt>B</dt>
<dd>

<p>32-bit big endian such as UCS-4BE.</p>

</dd>
<dt>L</dt>
<dd>

<p>32-bit little endian such as UCS-4LE.</p>

</dd>
</dl>

<p>The returned strings are transcoded to UTF-8.</p>

<p>The <code>strings</code> command has, in the past, had problems with parsing untrusted files. These are mitigated in the current version of libguestfs, but see <a href="guestfs.3.html#cve-2014-8484">&quot;CVE-2014-8484&quot; in guestfs(3)</a>.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="swapoff-device">swapoff-device</h2>

<pre><code> swapoff-device device</code></pre>

<p>This command disables the libguestfs appliance swap device or partition named <code>device</code>. See <a href="#swapon-device">&quot;swapon-device&quot;</a>.</p>

<h2 id="swapoff-file">swapoff-file</h2>

<pre><code> swapoff-file file</code></pre>

<p>This command disables the libguestfs appliance swap on file.</p>

<h2 id="swapoff-label">swapoff-label</h2>

<pre><code> swapoff-label label</code></pre>

<p>This command disables the libguestfs appliance swap on labeled swap partition.</p>

<h2 id="swapoff-uuid">swapoff-uuid</h2>

<pre><code> swapoff-uuid uuid</code></pre>

<p>This command disables the libguestfs appliance swap partition with the given UUID.</p>

<h2 id="swapon-device">swapon-device</h2>

<pre><code> swapon-device device</code></pre>

<p>This command enables the libguestfs appliance to use the swap device or partition named <code>device</code>. The increased memory is made available for all commands, for example those run using <a href="#command">&quot;command&quot;</a> or <a href="#sh">&quot;sh&quot;</a>.</p>

<p>Note that you should not swap to existing guest swap partitions unless you know what you are doing. They may contain hibernation information, or other information that the guest doesn&#39;t want you to trash. You also risk leaking information about the host to the guest this way. Instead, attach a new host device to the guest and swap on that.</p>

<h2 id="swapon-file">swapon-file</h2>

<pre><code> swapon-file file</code></pre>

<p>This command enables swap to a file. See <a href="#swapon-device">&quot;swapon-device&quot;</a> for other notes.</p>

<h2 id="swapon-label">swapon-label</h2>

<pre><code> swapon-label label</code></pre>

<p>This command enables swap to a labeled swap partition. See <a href="#swapon-device">&quot;swapon-device&quot;</a> for other notes.</p>

<h2 id="swapon-uuid">swapon-uuid</h2>

<pre><code> swapon-uuid uuid</code></pre>

<p>This command enables swap to a swap partition with the given UUID. See <a href="#swapon-device">&quot;swapon-device&quot;</a> for other notes.</p>

<h2 id="sync">sync</h2>

<pre><code> sync</code></pre>

<p>This syncs the disk, so that any writes are flushed through to the underlying disk image.</p>

<p>You should always call this if you have modified a disk image, before closing the handle.</p>

<h2 id="syslinux">syslinux</h2>

<pre><code> syslinux device [directory:..]</code></pre>

<p>Install the SYSLINUX bootloader on <code>device</code>.</p>

<p>The device parameter must be either a whole disk formatted as a FAT filesystem, or a partition formatted as a FAT filesystem. In the latter case, the partition should be marked as &quot;active&quot; (<a href="#part-set-bootable">&quot;part-set-bootable&quot;</a>) and a Master Boot Record must be installed (eg. using <a href="#pwrite-device">&quot;pwrite-device&quot;</a>) on the first sector of the whole disk. The SYSLINUX package comes with some suitable Master Boot Records. See the <a href="http://man.he.net/man1/syslinux">syslinux(1)</a> man page for further information.</p>

<p>The optional arguments are:</p>

<dl>

<dt><i>directory</i></dt>
<dd>

<p>Install SYSLINUX in the named subdirectory, instead of in the root directory of the FAT filesystem.</p>

</dd>
</dl>

<p>Additional configuration can be supplied to SYSLINUX by placing a file called <i>syslinux.cfg</i> on the FAT filesystem, either in the root directory, or under <i>directory</i> if that optional argument is being used. For further information about the contents of this file, see <a href="http://man.he.net/man1/syslinux">syslinux(1)</a>.</p>

<p>See also <a href="#extlinux">&quot;extlinux&quot;</a>.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="tail">tail</h2>

<pre><code> tail path</code></pre>

<p>This command returns up to the last 10 lines of a file as a list of strings.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="tail-n">tail-n</h2>

<pre><code> tail-n nrlines path</code></pre>

<p>If the parameter <code>nrlines</code> is a positive number, this returns the last <code>nrlines</code> lines of the file <code>path</code>.</p>

<p>If the parameter <code>nrlines</code> is a negative number, this returns lines from the file <code>path</code>, starting with the <code>-nrlines</code>th line.</p>

<p>If the parameter <code>nrlines</code> is zero, this returns an empty list.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<h2 id="tar-in">tar-in</h2>

<h2 id="tar-in-opts">tar-in-opts</h2>

<pre><code> tar-in (tarfile|-) directory [compress:..]</code></pre>

<p>This command uploads and unpacks local file <code>tarfile</code> into <i>directory</i>.</p>

<p>The optional <code>compress</code> flag controls compression. If not given, then the input should be an uncompressed tar file. Otherwise one of the following strings may be given to select the compression type of the input file: <code>compress</code>, <code>gzip</code>, <code>bzip2</code>, <code>xz</code>, <code>lzop</code>. (Note that not all builds of libguestfs will support all of these compression types).</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="tar-out">tar-out</h2>

<h2 id="tar-out-opts">tar-out-opts</h2>

<pre><code> tar-out directory (tarfile|-) [compress:..] [numericowner:true|false] [excludes:..]</code></pre>

<p>This command packs the contents of <i>directory</i> and downloads it to local file <code>tarfile</code>.</p>

<p>The optional <code>compress</code> flag controls compression. If not given, then the output will be an uncompressed tar file. Otherwise one of the following strings may be given to select the compression type of the output file: <code>compress</code>, <code>gzip</code>, <code>bzip2</code>, <code>xz</code>, <code>lzop</code>. (Note that not all builds of libguestfs will support all of these compression types).</p>

<p>The other optional arguments are:</p>

<dl>

<dt><code>excludes</code></dt>
<dd>

<p>A list of wildcards. Files are excluded if they match any of the wildcards.</p>

</dd>
<dt><code>numericowner</code></dt>
<dd>

<p>If set to true, the output tar file will contain UID/GID numbers instead of user/group names.</p>

</dd>
</dl>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="tgz-in">tgz-in</h2>

<pre><code> tgz-in (tarball|-) directory</code></pre>

<p>This command uploads and unpacks local file <code>tarball</code> (a <i>gzip compressed</i> tar file) into <i>directory</i>.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#tar-in">&quot;tar-in&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="tgz-out">tgz-out</h2>

<pre><code> tgz-out directory (tarball|-)</code></pre>

<p>This command packs the contents of <i>directory</i> and downloads it to local file <code>tarball</code>.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#tar-out">&quot;tar-out&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="touch">touch</h2>

<pre><code> touch path</code></pre>

<p>Touch acts like the <a href="http://man.he.net/man1/touch">touch(1)</a> command. It can be used to update the timestamps on a file, or, if the file does not exist, to create a new zero-length file.</p>

<p>This command only works on regular files, and will fail on other file types such as directories, symbolic links, block special etc.</p>

<h2 id="truncate">truncate</h2>

<pre><code> truncate path</code></pre>

<p>This command truncates <code>path</code> to a zero-length file. The file must exist already.</p>

<h2 id="truncate-size">truncate-size</h2>

<pre><code> truncate-size path size</code></pre>

<p>This command truncates <code>path</code> to size <code>size</code> bytes. The file must exist already.</p>

<p>If the current file size is less than <code>size</code> then the file is extended to the required size with zero bytes. This creates a sparse file (ie. disk blocks are not allocated for the file until you write to it). To create a non-sparse file of zeroes, use <a href="#fallocate64">&quot;fallocate64&quot;</a> instead.</p>

<h2 id="tune2fs">tune2fs</h2>

<pre><code> tune2fs device [force:true|false] [maxmountcount:N] [mountcount:N] [errorbehavior:..] [group:N] [intervalbetweenchecks:N] [reservedblockspercentage:N] [lastmounteddirectory:..] [reservedblockscount:N] [user:N]</code></pre>

<p>This call allows you to adjust various filesystem parameters of an ext2/ext3/ext4 filesystem called <code>device</code>.</p>

<p>The optional parameters are:</p>

<dl>

<dt><code>force</code></dt>
<dd>

<p>Force tune2fs to complete the operation even in the face of errors. This is the same as the tune2fs <code>-f</code> option.</p>

</dd>
<dt><code>maxmountcount</code></dt>
<dd>

<p>Set the number of mounts after which the filesystem is checked by <a href="http://man.he.net/man8/e2fsck">e2fsck(8)</a>. If this is <code>0</code> then the number of mounts is disregarded. This is the same as the tune2fs <code>-c</code> option.</p>

</dd>
<dt><code>mountcount</code></dt>
<dd>

<p>Set the number of times the filesystem has been mounted. This is the same as the tune2fs <code>-C</code> option.</p>

</dd>
<dt><code>errorbehavior</code></dt>
<dd>

<p>Change the behavior of the kernel code when errors are detected. Possible values currently are: <code>continue</code>, <code>remount-ro</code>, <code>panic</code>. In practice these options don&#39;t really make any difference, particularly for write errors.</p>

<p>This is the same as the tune2fs <code>-e</code> option.</p>

</dd>
<dt><code>group</code></dt>
<dd>

<p>Set the group which can use reserved filesystem blocks. This is the same as the tune2fs <code>-g</code> option except that it can only be specified as a number.</p>

</dd>
<dt><code>intervalbetweenchecks</code></dt>
<dd>

<p>Adjust the maximal time between two filesystem checks (in seconds). If the option is passed as <code>0</code> then time-dependent checking is disabled.</p>

<p>This is the same as the tune2fs <code>-i</code> option.</p>

</dd>
<dt><code>reservedblockspercentage</code></dt>
<dd>

<p>Set the percentage of the filesystem which may only be allocated by privileged processes. This is the same as the tune2fs <code>-m</code> option.</p>

</dd>
<dt><code>lastmounteddirectory</code></dt>
<dd>

<p>Set the last mounted directory. This is the same as the tune2fs <code>-M</code> option.</p>

</dd>
<dt><code>reservedblockscount</code> Set the number of reserved filesystem blocks. This is the same as the tune2fs <code>-r</code> option.</dt>
<dd>

</dd>
<dt><code>user</code></dt>
<dd>

<p>Set the user who can use the reserved filesystem blocks. This is the same as the tune2fs <code>-u</code> option except that it can only be specified as a number.</p>

</dd>
</dl>

<p>To get the current values of filesystem parameters, see <a href="#tune2fs-l">&quot;tune2fs-l&quot;</a>. For precise details of how tune2fs works, see the <a href="http://man.he.net/man8/tune2fs">tune2fs(8)</a> man page.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="tune2fs-l">tune2fs-l</h2>

<pre><code> tune2fs-l device</code></pre>

<p>This returns the contents of the ext2, ext3 or ext4 filesystem superblock on <code>device</code>.</p>

<p>It is the same as running <code>tune2fs -l device</code>. See <a href="http://man.he.net/man8/tune2fs">tune2fs(8)</a> manpage for more details. The list of fields returned isn&#39;t clearly defined, and depends on both the version of <code>tune2fs</code> that libguestfs was built against, and the filesystem itself.</p>

<h2 id="txz-in">txz-in</h2>

<pre><code> txz-in (tarball|-) directory</code></pre>

<p>This command uploads and unpacks local file <code>tarball</code> (an <i>xz compressed</i> tar file) into <i>directory</i>.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#tar-in">&quot;tar-in&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="txz-out">txz-out</h2>

<pre><code> txz-out directory (tarball|-)</code></pre>

<p>This command packs the contents of <i>directory</i> and downloads it to local file <code>tarball</code> (as an xz compressed tar archive).</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#tar-out">&quot;tar-out&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="umask">umask</h2>

<pre><code> umask mask</code></pre>

<p>This function sets the mask used for creating new files and device nodes to <code>mask &amp; 0777</code>.</p>

<p>Typical umask values would be <code>022</code> which creates new files with permissions like &quot;-rw-r--r--&quot; or &quot;-rwxr-xr-x&quot;, and <code>002</code> which creates new files with permissions like &quot;-rw-rw-r--&quot; or &quot;-rwxrwxr-x&quot;.</p>

<p>The default umask is <code>022</code>. This is important because it means that directories and device nodes will be created with <code>0644</code> or <code>0755</code> mode even if you specify <code>0777</code>.</p>

<p>See also <a href="#get-umask">&quot;get-umask&quot;</a>, <a href="http://man.he.net/man2/umask">umask(2)</a>, <a href="#mknod">&quot;mknod&quot;</a>, <a href="#mkdir">&quot;mkdir&quot;</a>.</p>

<p>This call returns the previous umask.</p>

<h2 id="umount">umount</h2>

<h2 id="unmount">unmount</h2>

<h2 id="umount-opts">umount-opts</h2>

<pre><code> umount pathordevice [force:true|false] [lazyunmount:true|false]</code></pre>

<p>This unmounts the given filesystem. The filesystem may be specified either by its mountpoint (path) or the device which contains the filesystem.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="umount-all">umount-all</h2>

<h2 id="unmount-all">unmount-all</h2>

<pre><code> umount-all</code></pre>

<p>This unmounts all mounted filesystems.</p>

<p>Some internal mounts are not unmounted by this call.</p>

<h2 id="umount-local">umount-local</h2>

<pre><code> umount-local [retry:true|false]</code></pre>

<p>If libguestfs is exporting the filesystem on a local mountpoint, then this unmounts it.</p>

<p>See <a href="guestfs.3.html#mount-local">&quot;MOUNT LOCAL&quot; in guestfs(3)</a> for full documentation.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="upload">upload</h2>

<pre><code> upload (filename|-) remotefilename</code></pre>

<p>Upload local file <i>filename</i> to <i>remotefilename</i> on the filesystem.</p>

<p><i>filename</i> can also be a named pipe.</p>

<p>See also <a href="#download">&quot;download&quot;</a>.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<h2 id="upload-offset">upload-offset</h2>

<pre><code> upload-offset (filename|-) remotefilename offset</code></pre>

<p>Upload local file <i>filename</i> to <i>remotefilename</i> on the filesystem.</p>

<p><i>remotefilename</i> is overwritten starting at the byte <code>offset</code> specified. The intention is to overwrite parts of existing files or devices, although if a non-existent file is specified then it is created with a &quot;hole&quot; before <code>offset</code>. The size of the data written is implicit in the size of the source <i>filename</i>.</p>

<p>Note that there is no limit on the amount of data that can be uploaded with this call, unlike with <a href="#pwrite">&quot;pwrite&quot;</a>, and this call always writes the full amount unless an error occurs.</p>

<p>See also <a href="#upload">&quot;upload&quot;</a>, <a href="#pwrite">&quot;pwrite&quot;</a>.</p>

<p>Use <code>-</code> instead of a filename to read/write from stdin/stdout.</p>

<h2 id="user-cancel">user-cancel</h2>

<pre><code> user-cancel</code></pre>

<p>This function cancels the current upload or download operation.</p>

<p>Unlike most other libguestfs calls, this function is signal safe and thread safe. You can call it from a signal handler or from another thread, without needing to do any locking.</p>

<p>The transfer that was in progress (if there is one) will stop shortly afterwards, and will return an error. The errno (see <a href="#guestfs_last_errno">&quot;guestfs_last_errno&quot;</a>) is set to <code>EINTR</code>, so you can test for this to find out if the operation was cancelled or failed because of another error.</p>

<p>No cleanup is performed: for example, if a file was being uploaded then after cancellation there may be a partially uploaded file. It is the caller&#39;s responsibility to clean up if necessary.</p>

<p>There are two common places that you might call <a href="#user-cancel">&quot;user-cancel&quot;</a>:</p>

<p>In an interactive text-based program, you might call it from a <code>SIGINT</code> signal handler so that pressing <code>^C</code> cancels the current operation. (You also need to call <a href="#guestfs_set_pgroup">&quot;guestfs_set_pgroup&quot;</a> so that child processes don&#39;t receive the <code>^C</code> signal).</p>

<p>In a graphical program, when the main thread is displaying a progress bar with a cancel button, wire up the cancel button to call this function.</p>

<h2 id="utimens">utimens</h2>

<pre><code> utimens path atsecs atnsecs mtsecs mtnsecs</code></pre>

<p>This command sets the timestamps of a file with nanosecond precision.</p>

<p><code>atsecs, atnsecs</code> are the last access time (atime) in secs and nanoseconds from the epoch.</p>

<p><code>mtsecs, mtnsecs</code> are the last modification time (mtime) in secs and nanoseconds from the epoch.</p>

<p>If the <code>*nsecs</code> field contains the special value <code>-1</code> then the corresponding timestamp is set to the current time. (The <code>*secs</code> field is ignored in this case).</p>

<p>If the <code>*nsecs</code> field contains the special value <code>-2</code> then the corresponding timestamp is left unchanged. (The <code>*secs</code> field is ignored in this case).</p>

<h2 id="utsname">utsname</h2>

<pre><code> utsname</code></pre>

<p>This returns the kernel version of the appliance, where this is available. This information is only useful for debugging. Nothing in the returned structure is defined by the API.</p>

<h2 id="version">version</h2>

<pre><code> version</code></pre>

<p>Return the libguestfs version number that the program is linked against.</p>

<p>Note that because of dynamic linking this is not necessarily the version of libguestfs that you compiled against. You can compile the program, and then at runtime dynamically link against a completely different <i>libguestfs.so</i> library.</p>

<p>This call was added in version <code>1.0.58</code>. In previous versions of libguestfs there was no way to get the version number. From C code you can use dynamic linker functions to find out if this symbol exists (if it doesn&#39;t, then it&#39;s an earlier version).</p>

<p>The call returns a structure with four elements. The first three (<code>major</code>, <code>minor</code> and <code>release</code>) are numbers and correspond to the usual version triplet. The fourth element (<code>extra</code>) is a string and is normally empty, but may be used for distro-specific information.</p>

<p>To construct the original version string: <code>$major.$minor.$release$extra</code></p>

<p>See also: <a href="guestfs.3.html#libguestfs-version-numbers">&quot;LIBGUESTFS VERSION NUMBERS&quot; in guestfs(3)</a>.</p>

<p><i>Note:</i> Don&#39;t use this call to test for availability of features. In enterprise distributions we backport features from later versions into earlier versions, making this an unreliable way to test for features. Use <a href="#available">&quot;available&quot;</a> or <a href="#feature-available">&quot;feature-available&quot;</a> instead.</p>

<h2 id="vfs-label">vfs-label</h2>

<pre><code> vfs-label mountable</code></pre>

<p>This returns the label of the filesystem on <code>mountable</code>.</p>

<p>If the filesystem is unlabeled, this returns the empty string.</p>

<p>To find a filesystem from the label, use <a href="#findfs-label">&quot;findfs-label&quot;</a>.</p>

<h2 id="vfs-type">vfs-type</h2>

<pre><code> vfs-type mountable</code></pre>

<p>This command gets the filesystem type corresponding to the filesystem on <code>mountable</code>.</p>

<p>For most filesystems, the result is the name of the Linux VFS module which would be used to mount this filesystem if you mounted it without specifying the filesystem type. For example a string such as <code>ext3</code> or <code>ntfs</code>.</p>

<h2 id="vfs-uuid">vfs-uuid</h2>

<h2 id="get-uuid">get-uuid</h2>

<pre><code> vfs-uuid mountable</code></pre>

<p>This returns the filesystem UUID of the filesystem on <code>mountable</code>.</p>

<p>If the filesystem does not have a UUID, this returns the empty string.</p>

<p>To find a filesystem from the UUID, use <a href="#findfs-uuid">&quot;findfs-uuid&quot;</a>.</p>

<h2 id="vg-activate">vg-activate</h2>

<pre><code> vg-activate true|false &#39;volgroups ...&#39;</code></pre>

<p>This command activates or (if <code>activate</code> is false) deactivates all logical volumes in the listed volume groups <code>volgroups</code>.</p>

<p>This command is the same as running <code>vgchange -a y|n volgroups...</code></p>

<p>Note that if <code>volgroups</code> is an empty list then <b>all</b> volume groups are activated or deactivated.</p>

<h2 id="vg-activate-all">vg-activate-all</h2>

<pre><code> vg-activate-all true|false</code></pre>

<p>This command activates or (if <code>activate</code> is false) deactivates all logical volumes in all volume groups.</p>

<p>This command is the same as running <code>vgchange -a y|n</code></p>

<h2 id="vgchange-uuid">vgchange-uuid</h2>

<pre><code> vgchange-uuid vg</code></pre>

<p>Generate a new random UUID for the volume group <code>vg</code>.</p>

<h2 id="vgchange-uuid-all">vgchange-uuid-all</h2>

<pre><code> vgchange-uuid-all</code></pre>

<p>Generate new random UUIDs for all volume groups.</p>

<h2 id="vgcreate">vgcreate</h2>

<pre><code> vgcreate volgroup &#39;physvols ...&#39;</code></pre>

<p>This creates an LVM volume group called <code>volgroup</code> from the non-empty list of physical volumes <code>physvols</code>.</p>

<h2 id="vglvuuids">vglvuuids</h2>

<pre><code> vglvuuids vgname</code></pre>

<p>Given a VG called <code>vgname</code>, this returns the UUIDs of all the logical volumes created in this volume group.</p>

<p>You can use this along with <a href="#lvs">&quot;lvs&quot;</a> and <a href="#lvuuid">&quot;lvuuid&quot;</a> calls to associate logical volumes and volume groups.</p>

<p>See also <a href="#vgpvuuids">&quot;vgpvuuids&quot;</a>.</p>

<h2 id="vgmeta">vgmeta</h2>

<pre><code> vgmeta vgname</code></pre>

<p><code>vgname</code> is an LVM volume group. This command examines the volume group and returns its metadata.</p>

<p>Note that the metadata is an internal structure used by LVM, subject to change at any time, and is provided for information only.</p>

<h2 id="vgpvuuids">vgpvuuids</h2>

<pre><code> vgpvuuids vgname</code></pre>

<p>Given a VG called <code>vgname</code>, this returns the UUIDs of all the physical volumes that this volume group resides on.</p>

<p>You can use this along with <a href="#pvs">&quot;pvs&quot;</a> and <a href="#pvuuid">&quot;pvuuid&quot;</a> calls to associate physical volumes and volume groups.</p>

<p>See also <a href="#vglvuuids">&quot;vglvuuids&quot;</a>.</p>

<h2 id="vgremove">vgremove</h2>

<pre><code> vgremove vgname</code></pre>

<p>Remove an LVM volume group <code>vgname</code>, (for example <code>VG</code>).</p>

<p>This also forcibly removes all logical volumes in the volume group (if any).</p>

<h2 id="vgrename">vgrename</h2>

<pre><code> vgrename volgroup newvolgroup</code></pre>

<p>Rename a volume group <code>volgroup</code> with the new name <code>newvolgroup</code>.</p>

<h2 id="vgs">vgs</h2>

<pre><code> vgs</code></pre>

<p>List all the volumes groups detected. This is the equivalent of the <a href="http://man.he.net/man8/vgs">vgs(8)</a> command.</p>

<p>This returns a list of just the volume group names that were detected (eg. <code>VolGroup00</code>).</p>

<p>See also <a href="#vgs-full">&quot;vgs-full&quot;</a>.</p>

<h2 id="vgs-full">vgs-full</h2>

<pre><code> vgs-full</code></pre>

<p>List all the volumes groups detected. This is the equivalent of the <a href="http://man.he.net/man8/vgs">vgs(8)</a> command. The &quot;full&quot; version includes all fields.</p>

<h2 id="vgscan">vgscan</h2>

<pre><code> vgscan</code></pre>

<p>This rescans all block devices and rebuilds the list of LVM physical volumes, volume groups and logical volumes.</p>

<h2 id="vguuid">vguuid</h2>

<pre><code> vguuid vgname</code></pre>

<p>This command returns the UUID of the LVM VG named <code>vgname</code>.</p>

<h2 id="wc-c">wc-c</h2>

<pre><code> wc-c path</code></pre>

<p>This command counts the characters in a file, using the <code>wc -c</code> external command.</p>

<h2 id="wc-l">wc-l</h2>

<pre><code> wc-l path</code></pre>

<p>This command counts the lines in a file, using the <code>wc -l</code> external command.</p>

<h2 id="wc-w">wc-w</h2>

<pre><code> wc-w path</code></pre>

<p>This command counts the words in a file, using the <code>wc -w</code> external command.</p>

<h2 id="wipefs">wipefs</h2>

<pre><code> wipefs device</code></pre>

<p>This command erases filesystem or RAID signatures from the specified <code>device</code> to make the filesystem invisible to libblkid.</p>

<p>This does not erase the filesystem itself nor any other data from the <code>device</code>.</p>

<p>Compare with <a href="#zero">&quot;zero&quot;</a> which zeroes the first few blocks of a device.</p>

<h2 id="write">write</h2>

<pre><code> write path content</code></pre>

<p>This call creates a file called <code>path</code>. The content of the file is the string <code>content</code> (which can contain any 8 bit data).</p>

<p>See also <a href="#write-append">&quot;write-append&quot;</a>.</p>

<h2 id="write-append">write-append</h2>

<pre><code> write-append path content</code></pre>

<p>This call appends <code>content</code> to the end of file <code>path</code>. If <code>path</code> does not exist, then a new file is created.</p>

<p>See also <a href="#write">&quot;write&quot;</a>.</p>

<h2 id="write-file">write-file</h2>

<pre><code> write-file path content size</code></pre>

<p>This call creates a file called <code>path</code>. The contents of the file is the string <code>content</code> (which can contain any 8 bit data), with length <code>size</code>.</p>

<p>As a special case, if <code>size</code> is <code>0</code> then the length is calculated using <code>strlen</code> (so in this case the content cannot contain embedded ASCII NULs).</p>

<p><i>NB.</i> Owing to a bug, writing content containing ASCII NUL characters does <i>not</i> work, even if the length is specified.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#write">&quot;write&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="xfs-admin">xfs-admin</h2>

<pre><code> xfs-admin device [extunwritten:true|false] [imgfile:true|false] [v2log:true|false] [projid32bit:true|false] [lazycounter:true|false] [label:..] [uuid:..]</code></pre>

<p>Change the parameters of the XFS filesystem on <code>device</code>.</p>

<p>Devices that are mounted cannot be modified. Administrators must unmount filesystems before this call can modify parameters.</p>

<p>Some of the parameters of a mounted filesystem can be examined and modified using the <a href="#xfs-info">&quot;xfs-info&quot;</a> and <a href="#xfs-growfs">&quot;xfs-growfs&quot;</a> calls.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="xfs-growfs">xfs-growfs</h2>

<pre><code> xfs-growfs path [datasec:true|false] [logsec:true|false] [rtsec:true|false] [datasize:N] [logsize:N] [rtsize:N] [rtextsize:N] [maxpct:N]</code></pre>

<p>Grow the XFS filesystem mounted at <code>path</code>.</p>

<p>The returned struct contains geometry information. Missing fields are returned as <code>-1</code> (for numeric fields) or empty string.</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="xfs-info">xfs-info</h2>

<pre><code> xfs-info pathordevice</code></pre>

<p><code>pathordevice</code> is a mounted XFS filesystem or a device containing an XFS filesystem. This command returns the geometry of the filesystem.</p>

<p>The returned struct contains geometry information. Missing fields are returned as <code>-1</code> (for numeric fields) or empty string.</p>

<h2 id="xfs-repair">xfs-repair</h2>

<pre><code> xfs-repair device [forcelogzero:true|false] [nomodify:true|false] [noprefetch:true|false] [forcegeometry:true|false] [maxmem:N] [ihashsize:N] [bhashsize:N] [agstride:N] [logdev:..] [rtdev:..]</code></pre>

<p>Repair corrupt or damaged XFS filesystem on <code>device</code>.</p>

<p>The filesystem is specified using the <code>device</code> argument which should be the device name of the disk partition or volume containing the filesystem. If given the name of a block device, <code>xfs_repair</code> will attempt to find the raw device associated with the specified block device and will use the raw device instead.</p>

<p>Regardless, the filesystem to be repaired must be unmounted, otherwise, the resulting filesystem may be inconsistent or corrupt.</p>

<p>The returned status indicates whether filesystem corruption was detected (returns <code>1</code>) or was not detected (returns <code>0</code>).</p>

<p>This command has one or more optional arguments. See <a href="#optional-arguments">&quot;OPTIONAL ARGUMENTS&quot;</a>.</p>

<h2 id="zegrep">zegrep</h2>

<pre><code> zegrep regex path</code></pre>

<p>This calls the external <code>zegrep</code> program and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#grep">&quot;grep&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="zegrepi">zegrepi</h2>

<pre><code> zegrepi regex path</code></pre>

<p>This calls the external <code>zegrep -i</code> program and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#grep">&quot;grep&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="zero">zero</h2>

<pre><code> zero device</code></pre>

<p>This command writes zeroes over the first few blocks of <code>device</code>.</p>

<p>How many blocks are zeroed isn&#39;t specified (but it&#39;s <i>not</i> enough to securely wipe the device). It should be sufficient to remove any partition tables, filesystem superblocks and so on.</p>

<p>If blocks are already zero, then this command avoids writing zeroes. This prevents the underlying device from becoming non-sparse or growing unnecessarily.</p>

<p>See also: <a href="#zero-device">&quot;zero-device&quot;</a>, <a href="#scrub-device">&quot;scrub-device&quot;</a>, <a href="#is-zero-device">&quot;is-zero-device&quot;</a></p>

<h2 id="zero-device">zero-device</h2>

<pre><code> zero-device device</code></pre>

<p>This command writes zeroes over the entire <code>device</code>. Compare with <a href="#zero">&quot;zero&quot;</a> which just zeroes the first few blocks of a device.</p>

<p>If blocks are already zero, then this command avoids writing zeroes. This prevents the underlying device from becoming non-sparse or growing unnecessarily.</p>

<h2 id="zero-free-space">zero-free-space</h2>

<pre><code> zero-free-space directory</code></pre>

<p>Zero the free space in the filesystem mounted on <i>directory</i>. The filesystem must be mounted read-write.</p>

<p>The filesystem contents are not affected, but any free space in the filesystem is freed.</p>

<p>Free space is not &quot;trimmed&quot;. You may want to call <a href="#fstrim">&quot;fstrim&quot;</a> either as an alternative to this, or after calling this, depending on your requirements.</p>

<h2 id="zerofree">zerofree</h2>

<pre><code> zerofree device</code></pre>

<p>This runs the <i>zerofree</i> program on <code>device</code>. This program claims to zero unused inodes and disk blocks on an ext2/3 filesystem, thus making it possible to compress the filesystem more effectively.</p>

<p>You should <b>not</b> run this program if the filesystem is mounted.</p>

<p>It is possible that using this program can damage the filesystem or data on the filesystem.</p>

<h2 id="zfgrep">zfgrep</h2>

<pre><code> zfgrep pattern path</code></pre>

<p>This calls the external <code>zfgrep</code> program and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#grep">&quot;grep&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="zfgrepi">zfgrepi</h2>

<pre><code> zfgrepi pattern path</code></pre>

<p>This calls the external <code>zfgrep -i</code> program and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#grep">&quot;grep&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="zfile">zfile</h2>

<pre><code> zfile meth path</code></pre>

<p>This command runs <i>file</i> after first decompressing <code>path</code> using <code>method</code>.</p>

<p><code>method</code> must be one of <code>gzip</code>, <code>compress</code> or <code>bzip2</code>.</p>

<p>Since 1.0.63, use <a href="#file">&quot;file&quot;</a> instead which can now process compressed files.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#file">&quot;file&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="zgrep">zgrep</h2>

<pre><code> zgrep regex path</code></pre>

<p>This calls the external <code>zgrep</code> program and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#grep">&quot;grep&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h2 id="zgrepi">zgrepi</h2>

<pre><code> zgrepi regex path</code></pre>

<p>This calls the external <code>zgrep -i</code> program and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer limit of somewhere between 2MB and 4MB. See <a href="guestfs.3.html#protocol-limits">&quot;PROTOCOL LIMITS&quot; in guestfs(3)</a>.</p>

<p><i>This function is deprecated.</i> In new code, use the <a href="#grep">&quot;grep&quot;</a> call instead.</p>

<p>Deprecated functions will not be removed from the API, but the fact that they are deprecated indicates that there are problems with correct use of these functions.</p>

<h1 id="exit-status">EXIT STATUS</h1>

<p>guestfish returns 0 if the commands completed without error, or 1 if there was an error.</p>

<h1 id="environment-variables">ENVIRONMENT VARIABLES</h1>

<dl>

<dt>EDITOR</dt>
<dd>

<p>The <code>edit</code> command uses <code>$EDITOR</code> as the editor. If not set, it uses <code>vi</code>.</p>

</dd>
<dt>GUESTFISH_DISPLAY_IMAGE</dt>
<dd>

<p>The <code>display</code> command uses <code>$GUESTFISH_DISPLAY_IMAGE</code> to display images. If not set, it uses <a href="http://man.he.net/man1/display">display(1)</a>.</p>

</dd>
<dt>GUESTFISH_INIT</dt>
<dd>

<p>Printed when guestfish starts. See <a href="#prompt">&quot;PROMPT&quot;</a>.</p>

</dd>
<dt>GUESTFISH_OUTPUT</dt>
<dd>

<p>Printed before guestfish output. See <a href="#prompt">&quot;PROMPT&quot;</a>.</p>

</dd>
<dt>GUESTFISH_PID</dt>
<dd>

<p>Used with the <i>--remote</i> option to specify the remote guestfish process to control. See section <a href="#remote-control-guestfish-over-a-socket">&quot;REMOTE CONTROL GUESTFISH OVER A SOCKET&quot;</a>.</p>

</dd>
<dt>GUESTFISH_PS1</dt>
<dd>

<p>Set the command prompt. See <a href="#prompt">&quot;PROMPT&quot;</a>.</p>

</dd>
<dt>GUESTFISH_RESTORE</dt>
<dd>

<p>Printed before guestfish exits. See <a href="#prompt">&quot;PROMPT&quot;</a>.</p>

</dd>
<dt>HEXEDITOR</dt>
<dd>

<p>The <a href="#hexedit">&quot;hexedit&quot;</a> command uses <code>$HEXEDITOR</code> as the external hex editor. If not specified, the external <a href="http://man.he.net/man1/hexedit">hexedit(1)</a> program is used.</p>

</dd>
<dt>HOME</dt>
<dd>

<p>If compiled with GNU readline support, various files in the home directory can be used. See <a href="#files">&quot;FILES&quot;</a>.</p>

</dd>
<dt>LIBGUESTFS_APPEND</dt>
<dd>

<p>Pass additional options to the guest kernel.</p>

</dd>
<dt>LIBGUESTFS_ATTACH_METHOD</dt>
<dd>

<p>This is the old way to set <code>LIBGUESTFS_BACKEND</code>.</p>

</dd>
<dt>LIBGUESTFS_BACKEND</dt>
<dd>

<p>Choose the default way to create the appliance. See <a href="guestfs.3.html#guestfs_set_backend">&quot;guestfs_set_backend&quot; in guestfs(3)</a>.</p>

</dd>
<dt>LIBGUESTFS_BACKEND_SETTINGS</dt>
<dd>

<p>A colon-separated list of backend-specific settings. See <a href="guestfs.3.html#backend">&quot;BACKEND&quot; in guestfs(3)</a>, <a href="guestfs.3.html#backend-settings">&quot;BACKEND SETTINGS&quot; in guestfs(3)</a>.</p>

</dd>
<dt>LIBGUESTFS_CACHEDIR</dt>
<dd>

<p>The location where libguestfs will cache its appliance, when using a supermin appliance. The appliance is cached and shared between all handles which have the same effective user ID.</p>

<p>If <code>LIBGUESTFS_CACHEDIR</code> is not set, then <code>TMPDIR</code> is used. If <code>TMPDIR</code> is not set, then <i>/var/tmp</i> is used.</p>

<p>See also <a href="#libguestfs_tmpdir">&quot;LIBGUESTFS_TMPDIR&quot;</a>, <a href="#set-cachedir">&quot;set-cachedir&quot;</a>.</p>

</dd>
<dt>LIBGUESTFS_DEBUG</dt>
<dd>

<p>Set <code>LIBGUESTFS_DEBUG=1</code> to enable verbose messages. This has the same effect as using the <b>-v</b> option.</p>

</dd>
<dt>LIBGUESTFS_HV</dt>
<dd>

<p>Set the default hypervisor (usually qemu) binary that libguestfs uses. If not set, then the qemu which was found at compile time by the configure script is used.</p>

</dd>
<dt>LIBGUESTFS_MEMSIZE</dt>
<dd>

<p>Set the memory allocated to the qemu process, in megabytes. For example:</p>

<pre><code> LIBGUESTFS_MEMSIZE=700</code></pre>

</dd>
<dt>LIBGUESTFS_PATH</dt>
<dd>

<p>Set the path that guestfish uses to search for kernel and initrd.img. See the discussion of paths in <a href="guestfs.3.html">guestfs(3)</a>.</p>

</dd>
<dt>LIBGUESTFS_QEMU</dt>
<dd>

<p>This is the old way to set <code>LIBGUESTFS_HV</code>.</p>

</dd>
<dt>LIBGUESTFS_TMPDIR</dt>
<dd>

<p>The location where libguestfs will store temporary files used by each handle.</p>

<p>If <code>LIBGUESTFS_TMPDIR</code> is not set, then <code>TMPDIR</code> is used. If <code>TMPDIR</code> is not set, then <i>/tmp</i> is used.</p>

<p>See also <a href="#libguestfs_cachedir">&quot;LIBGUESTFS_CACHEDIR&quot;</a>, <a href="#set-tmpdir">&quot;set-tmpdir&quot;</a>.</p>

</dd>
<dt>LIBGUESTFS_TRACE</dt>
<dd>

<p>Set <code>LIBGUESTFS_TRACE=1</code> to enable command traces.</p>

</dd>
<dt>PAGER</dt>
<dd>

<p>The <code>more</code> command uses <code>$PAGER</code> as the pager. If not set, it uses <code>more</code>.</p>

</dd>
<dt>PATH</dt>
<dd>

<p>Libguestfs and guestfish may run some external programs, and rely on <code>$PATH</code> being set to a reasonable value. If using the libvirt backend, libvirt will not work at all unless <code>$PATH</code> contains the path of qemu/KVM.</p>

</dd>
<dt>SUPERMIN_KERNEL</dt>
<dd>

</dd>
<dt>SUPERMIN_KERNEL_VERSION</dt>
<dd>

</dd>
<dt>SUPERMIN_MODULES</dt>
<dd>

<p>These three environment variables allow the kernel that libguestfs uses in the appliance to be selected. If <code>$SUPERMIN_KERNEL</code> is not set, then the most recent host kernel is chosen. For more information about kernel selection, see <a href="supermin.1.html">supermin(1)</a>.</p>

</dd>
<dt>TMPDIR</dt>
<dd>

<p>See <a href="#libguestfs_cachedir">&quot;LIBGUESTFS_CACHEDIR&quot;</a>, <a href="#libguestfs_tmpdir">&quot;LIBGUESTFS_TMPDIR&quot;</a>.</p>

</dd>
</dl>

<h1 id="files">FILES</h1>

<dl>

<dt>$XDG_CONFIG_HOME/libguestfs/libguestfs-tools.conf</dt>
<dd>

</dd>
<dt>$HOME/.libguestfs-tools.rc</dt>
<dd>

</dd>
<dt>$XDG_CONFIG_DIRS/libguestfs/libguestfs-tools.conf</dt>
<dd>

</dd>
<dt>/etc/libguestfs-tools.conf</dt>
<dd>

<p>This configuration file controls the default read-only or read-write mode (<i>--ro</i> or <i>--rw</i>).</p>

<p>See <a href="libguestfs-tools.conf(5).3.html">libguestfs-tools.conf(5)</a>.</p>

</dd>
<dt>$HOME/.guestfish</dt>
<dd>

<p>If compiled with GNU readline support, then the command history is saved in this file.</p>

</dd>
<dt>$HOME/.inputrc</dt>
<dd>

</dd>
<dt>/etc/inputrc</dt>
<dd>

<p>If compiled with GNU readline support, then these files can be used to configure readline. For further information, please see <a href="http://man.he.net/man3/readline">&quot;INITIALIZATION FILE&quot; in readline(3)</a>.</p>

<p>To write rules which only apply to guestfish, use:</p>

<pre><code> $if guestfish
 ...
 $endif</code></pre>

<p>Variables that you can set in inputrc that change the behaviour of guestfish in useful ways include:</p>

<dl>

<dt>completion-ignore-case (default: on)</dt>
<dd>

<p>By default, guestfish will ignore case when tab-completing paths on the disk. Use:</p>

<pre><code> set completion-ignore-case off</code></pre>

<p>to make guestfish case sensitive.</p>

</dd>
</dl>

</dd>
<dt>test1.img</dt>
<dd>

</dd>
<dt>test2.img (etc)</dt>
<dd>

<p>When using the <i>-N</i> or <i>--new</i> option, the prepared disk or filesystem will be created in the file <i>test1.img</i> in the current directory. The second use of <i>-N</i> will use <i>test2.img</i> and so on. Any existing file with the same name will be overwritten. You can use a different filename by using the <code>filename=</code> prefix.</p>

</dd>
</dl>

<h1 id="see-also">SEE ALSO</h1>

<p><a href="guestfs.3.html">guestfs(3)</a>, <a href="http://libguestfs.org/">http://libguestfs.org/</a>, <a href="virt-alignment-scan.1.html">virt-alignment-scan(1)</a>, <a href="virt-builder.1.html">virt-builder(1)</a>, <a href="virt-cat.1.html">virt-cat(1)</a>, <a href="virt-copy-in.1.html">virt-copy-in(1)</a>, <a href="virt-copy-out.1.html">virt-copy-out(1)</a>, <a href="virt-customize.1.html">virt-customize(1)</a>, <a href="virt-df.1.html">virt-df(1)</a>, <a href="virt-diff.1.html">virt-diff(1)</a>, <a href="virt-edit.1.html">virt-edit(1)</a>, <a href="virt-filesystems.1.html">virt-filesystems(1)</a>, <a href="virt-inspector.1.html">virt-inspector(1)</a>, <a href="virt-list-filesystems.1.html">virt-list-filesystems(1)</a>, <a href="virt-list-partitions.1.html">virt-list-partitions(1)</a>, <a href="virt-log.1.html">virt-log(1)</a>, <a href="virt-ls.1.html">virt-ls(1)</a>, <a href="virt-make-fs.1.html">virt-make-fs(1)</a>, <a href="virt-p2v.1.html">virt-p2v(1)</a>, <a href="virt-rescue.1.html">virt-rescue(1)</a>, <a href="virt-resize.1.html">virt-resize(1)</a>, <a href="virt-sparsify.1.html">virt-sparsify(1)</a>, <a href="virt-sysprep.1.html">virt-sysprep(1)</a>, <a href="virt-tar.1.html">virt-tar(1)</a>, <a href="virt-tar-in.1.html">virt-tar-in(1)</a>, <a href="virt-tar-out.1.html">virt-tar-out(1)</a>, <a href="virt-v2v.1.html">virt-v2v(1)</a>, <a href="virt-win-reg.1.html">virt-win-reg(1)</a>, <a href="libguestfs-tools.conf(5).3.html">libguestfs-tools.conf(5)</a>, <a href="http://man.he.net/man1/display">display(1)</a>, <a href="http://man.he.net/man1/hexedit">hexedit(1)</a>, <a href="supermin.1.html">supermin(1)</a>.</p>

<h1 id="authors">AUTHORS</h1>

<p>Richard W.M. Jones (<code>rjones at redhat dot com</code>)</p>

<h1 id="copyright">COPYRIGHT</h1>

<p>Copyright (C) 2009-2015 Red Hat Inc.</p>

<h1 id="license">LICENSE</h1>

<p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>

<p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</p>

<h1 id="bugs">BUGS</h1>

<p>To get a list of bugs against libguestfs, use this link: <a href="https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools">https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools</a></p>

<p>To report a new bug against libguestfs, use this link: <a href="https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools">https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools</a></p>

<p>When reporting a bug, please supply:</p>

<ul>

<li><p>The version of libguestfs.</p>

</li>
<li><p>Where you got libguestfs (eg. which Linux distro, compiled from source, etc)</p>

</li>
<li><p>Describe the bug accurately and give a way to reproduce it.</p>

</li>
<li><p>Run <a href="libguestfs-test-tool.1.html">libguestfs-test-tool(1)</a> and paste the <b>complete, unedited</b> output into the bug report.</p>

</li>
</ul>

</body>
</html>

