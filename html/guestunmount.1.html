
<html>
<head>
<title>guestunmount</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel='stylesheet' href='pod.css' type='text/css' />
</head>
<body>


<ul id="index">
  <li><a href="#name">NAME</a></li>
  <li><a href="#synopsis">SYNOPSIS</a></li>
  <li><a href="#description">DESCRIPTION</a>
    <ul>
      <li><a href="#from-programs">FROM PROGRAMS</a></li>
      <li><a href="#from-shell-scripts">FROM SHELL SCRIPTS</a></li>
    </ul>
  </li>
  <li><a href="#options">OPTIONS</a></li>
  <li><a href="#environment-variables">ENVIRONMENT VARIABLES</a></li>
  <li><a href="#exit-status">EXIT STATUS</a></li>
  <li><a href="#see-also">SEE ALSO</a></li>
  <li><a href="#authors">AUTHORS</a></li>
  <li><a href="#copyright">COPYRIGHT</a></li>
  <li><a href="#license">LICENSE</a></li>
  <li><a href="#bugs">BUGS</a></li>
</ul>

<h1 id="name">NAME</h1>

<p>guestunmount - Unmount a guestmounted filesystem</p>

<h1 id="synopsis">SYNOPSIS</h1>

<pre><code> guestunmount mountpoint

 guestunmount --fd=&lt;FD&gt; mountpoint</code></pre>

<h1 id="description">DESCRIPTION</h1>

<p>guestunmount is a utility to clean up mounted filesystems automatically. <a href="guestmount.1.html">guestmount(1)</a> mounts filesystems using libguestfs. This program unmounts the filesystem when a program or script has finished with it.</p>

<p>guestunmount is a wrapper around the FUSE <a href="http://man.he.net/man1/fusermount">fusermount(1)</a> program, which must exist on the current <code>PATH</code>.</p>

<p>There are two ways to use guestunmount. When called as:</p>

<pre><code> guestunmount mountpoint</code></pre>

<p>it unmounts <code>mountpoint</code> immediately.</p>

<p>When called as:</p>

<pre><code> guestunmount --fd=FD mountpoint</code></pre>

<p>it waits until the pipe <code>FD</code> is closed. This can be used to monitor another process and clean up its mountpoint when that process exits, as described below.</p>

<h2 id="from-programs">FROM PROGRAMS</h2>

<p>You can just call <code>guestunmount mountpoint</code> from the program, but a more sophisticated way to use guestunmount is to have it monitor your program so it can clean up the mount point if your program exits unexpectedly.</p>

<p>In the program, create a pipe (eg. by calling <a href="http://man.he.net/man2/pipe">pipe(2)</a>). Let <code>FD</code> be the file descriptor number of the read side of the pipe (ie. <code>pipefd[0]</code>).</p>

<p>After mounting the filesystem with <a href="guestmount.1.html">guestmount(1)</a> (on <code>mountpoint</code>), fork and run guestunmount like this:</p>

<pre><code> guestunmount --fd=FD mountpoint</code></pre>

<p>Close the read side of the pipe in the parent process.</p>

<p>Now, when the write side of the pipe (ie. <code>pipefd[1]</code>) is closed for any reason, either explicitly or because the parent process exits, guestunmount notices and unmounts the mountpoint.</p>

<p>If your operating system supports it, you should set the <code>FD_CLOEXEC</code> flag on the write side of the pipe. This is so that other child processes don&#39;t inherit the file descriptor and keep it open.</p>

<p>Guestunmount never daemonizes itself.</p>

<h2 id="from-shell-scripts">FROM SHELL SCRIPTS</h2>

<p>Since bash doesn&#39;t provide a way to create an unnamed pipe, use a trap to call guestunmount on exit like this:</p>

<pre><code> trap &quot;guestunmount mountpoint&quot; EXIT INT QUIT TERM</code></pre>

<h1 id="options">OPTIONS</h1>

<dl>

<dt><b>--fd=FD</b></dt>
<dd>

<p>Specify the pipe file descriptor to monitor, and delay cleanup until that pipe is closed.</p>

</dd>
<dt><b>--help</b></dt>
<dd>

<p>Display brief help and exit.</p>

</dd>
<dt><b>-q</b></dt>
<dd>

</dd>
<dt><b>--quiet</b></dt>
<dd>

<p>Don&#39;t display error messages from fusermount. The return status is still set (see <a href="#exit-status">&quot;EXIT STATUS&quot;</a> below).</p>

</dd>
<dt><b>--no-retry</b></dt>
<dd>

</dd>
<dt><b>--retry=N</b></dt>
<dd>

<p>By default, guestunmount will retry the fusermount operation up to <span style="white-space: nowrap;">5 times</span> (that is, it will run it up to <span style="white-space: nowrap;">6 times</span> = <span style="white-space: nowrap;">1 try</span> + <span style="white-space: nowrap;">5 retries</span>).</p>

<p>Use <i>--no-retry</i> to make guestunmount run fusermount only once.</p>

<p>Use <i>--retry=N</i> to make guestunmount retry <code>N</code> times instead of 5.</p>

<p>guestunmount performs an exponential back-off between retries, waiting <span style="white-space: nowrap;">1 second</span>, <span style="white-space: nowrap;">2 seconds</span>, <span style="white-space: nowrap;">4 seconds</span>, etc before each retry.</p>

</dd>
<dt><b>-V</b></dt>
<dd>

</dd>
<dt><b>--version</b></dt>
<dd>

<p>Display the program version and exit.</p>

</dd>
</dl>

<h1 id="environment-variables">ENVIRONMENT VARIABLES</h1>

<dl>

<dt><code>PATH</code></dt>
<dd>

<p>The <a href="http://man.he.net/man1/fusermount">fusermount(1)</a> program (supplied by FUSE) must be available on the current <code>PATH</code>.</p>

</dd>
</dl>

<h1 id="exit-status">EXIT STATUS</h1>

<p>This program returns 0 if successful, or one of the following error codes:</p>

<dl>

<dt><code>1</code></dt>
<dd>

<p>Program error, eg. could not allocate memory, could not run fusermount. See the error message printed for more information.</p>

</dd>
<dt><code>2</code></dt>
<dd>

<p>The mount point could not be unmounted even after retrying. See the error message printed for the underlying fusermount error.</p>

</dd>
<dt><code>3</code></dt>
<dd>

<p>The mount point is not mounted.</p>

</dd>
</dl>

<h1 id="see-also">SEE ALSO</h1>

<p><a href="guestmount.1.html">guestmount(1)</a>, <a href="http://man.he.net/man1/fusermount">fusermount(1)</a>, <a href="http://man.he.net/man2/pipe">pipe(2)</a>, <a href="guestfs.3.html#mount-local">&quot;MOUNT LOCAL&quot; in guestfs(3)</a>, <a href="http://libguestfs.org/">http://libguestfs.org/</a>, <a href="http://fuse.sf.net/">http://fuse.sf.net/</a>.</p>

<h1 id="authors">AUTHORS</h1>

<p>Richard W.M. Jones (<code>rjones at redhat dot com</code>)</p>

<h1 id="copyright">COPYRIGHT</h1>

<p>Copyright (C) 2013 Red Hat Inc.</p>

<h1 id="license">LICENSE</h1>

<p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>

<p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</p>

<h1 id="bugs">BUGS</h1>

<p>To get a list of bugs against libguestfs, use this link: <a href="https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools">https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools</a></p>

<p>To report a new bug against libguestfs, use this link: <a href="https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools">https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools</a></p>

<p>When reporting a bug, please supply:</p>

<ul>

<li><p>The version of libguestfs.</p>

</li>
<li><p>Where you got libguestfs (eg. which Linux distro, compiled from source, etc)</p>

</li>
<li><p>Describe the bug accurately and give a way to reproduce it.</p>

</li>
<li><p>Run <a href="libguestfs-test-tool.1.html">libguestfs-test-tool(1)</a> and paste the <b>complete, unedited</b> output into the bug report.</p>

</li>
</ul>

</body>
</html>

