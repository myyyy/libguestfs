
<html>
<head>
<title>guestfs-perl</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel='stylesheet' href='pod.css' type='text/css' />
</head>
<body>


<ul id="index">
  <li><a href="#name">NAME</a></li>
  <li><a href="#synopsis">SYNOPSIS</a></li>
  <li><a href="#description">DESCRIPTION</a>
    <ul>
      <li><a href="#errors">ERRORS</a></li>
    </ul>
  </li>
  <li><a href="#example-1:-create-a-disk-image">EXAMPLE 1: CREATE A DISK IMAGE</a></li>
  <li><a href="#example-2:-inspect-a-virtual-machine-disk-image">EXAMPLE 2: INSPECT A VIRTUAL MACHINE DISK IMAGE</a></li>
  <li><a href="#see-also">SEE ALSO</a></li>
  <li><a href="#authors">AUTHORS</a></li>
  <li><a href="#copyright">COPYRIGHT</a></li>
  <li><a href="#license">LICENSE</a></li>
  <li><a href="#bugs">BUGS</a></li>
</ul>

<h1 id="name">NAME</h1>

<p>guestfs-perl - How to use libguestfs from Perl</p>

<h1 id="synopsis">SYNOPSIS</h1>

<pre><code> use Sys::Guestfs;
 
 my $g = Sys::Guestfs-&gt;new ();
 $g-&gt;add_drive_opts (&#39;guest.img&#39;, format =&gt; &#39;raw&#39;);
 $g-&gt;launch ();
 $g-&gt;mount (&#39;/dev/sda1&#39;, &#39;/&#39;);
 $g-&gt;touch (&#39;/hello&#39;);
 $g-&gt;shutdown ();
 $g-&gt;close ();</code></pre>

<h1 id="description">DESCRIPTION</h1>

<p>This manual page documents how to call libguestfs from the Perl programming language. This page just documents the differences from the C API and gives some examples. If you are not familiar with using libguestfs, you also need to read <a href="guestfs.3.html">guestfs(3)</a>. To read the full Perl API, see <a href="Sys::Guestfs(3).3.html">Sys::Guestfs(3)</a>.</p>

<h2 id="errors">ERRORS</h2>

<p>Errors from libguestfs functions turn into calls to <code>croak</code> (see <a href="http://man.he.net/man3/Carp">Carp(3)</a>).</p>

<h1 id="example-1:-create-a-disk-image">EXAMPLE 1: CREATE A DISK IMAGE</h1>

<pre><code> #!/usr/bin/perl -w
 
 # Example showing how to create a disk image.
 
 use strict;
 use Sys::Guestfs;
 
 my $output = &quot;disk.img&quot;;
 
 my $g = new Sys::Guestfs ();
 
 # Create a raw-format sparse disk image, 512 MB in size.
 $g-&gt;disk_create ($output, &quot;raw&quot;, 512 * 1024 * 1024);
 
 # Set the trace flag so that we can see each libguestfs call.
 $g-&gt;set_trace (1);
 
 # Attach the disk image to libguestfs.
 $g-&gt;add_drive_opts ($output, format =&gt; &quot;raw&quot;, readonly =&gt; 0);
 
 # Run the libguestfs back-end.
 $g-&gt;launch ();
 
 # Get the list of devices.  Because we only added one drive
 # above, we expect that this list should contain a single
 # element.
 my @devices = $g-&gt;list_devices ();
 if (@devices != 1) {
     die &quot;error: expected a single device from list-devices&quot;;
 }
 
 # Partition the disk as one single MBR partition.
 $g-&gt;part_disk ($devices[0], &quot;mbr&quot;);
 
 # Get the list of partitions.  We expect a single element, which
 # is the partition we have just created.
 my @partitions = $g-&gt;list_partitions ();
 if (@partitions != 1) {
     die &quot;error: expected a single partition from list-partitions&quot;;
 }
 
 # Create a filesystem on the partition.
 $g-&gt;mkfs (&quot;ext4&quot;, $partitions[0]);
 
 # Now mount the filesystem so that we can add files.
 $g-&gt;mount ($partitions[0], &quot;/&quot;);
 
 # Create some files and directories.
 $g-&gt;touch (&quot;/empty&quot;);
 my $message = &quot;Hello, world\n&quot;;
 $g-&gt;write (&quot;/hello&quot;, $message);
 $g-&gt;mkdir (&quot;/foo&quot;);
 
 # This one uploads the local file /etc/resolv.conf into
 # the disk image.
 $g-&gt;upload (&quot;/etc/resolv.conf&quot;, &quot;/foo/resolv.conf&quot;);
 
 # Because we wrote to the disk and we want to detect write
 # errors, call $g-&gt;shutdown.  You don&#39;t need to do this:
 # $g-&gt;close will do it implicitly.
 $g-&gt;shutdown ();
 
 # Note also that handles are automatically closed if they are
 # reaped by reference counting.  You only need to call close
 # if you want to close the handle right away.
 $g-&gt;close ();</code></pre>

<h1 id="example-2:-inspect-a-virtual-machine-disk-image">EXAMPLE 2: INSPECT A VIRTUAL MACHINE DISK IMAGE</h1>

<pre><code> #!/usr/bin/perl -w
 
 # Example showing how to inspect a virtual machine disk.
 
 use strict;
 use Sys::Guestfs;
 
 if (@ARGV &lt; 1) {
     die &quot;usage: inspect_vm disk.img&quot;
 }
 
 my $disk = $ARGV[0];
 
 my $g = new Sys::Guestfs ();
 
 # Attach the disk image read-only to libguestfs.
 # You could also add an optional format =&gt; ... argument here.  This is
 # advisable since automatic format detection is insecure.
 $g-&gt;add_drive_opts ($disk, readonly =&gt; 1);
 
 # Run the libguestfs back-end.
 $g-&gt;launch ();
 
 # Ask libguestfs to inspect for operating systems.
 my @roots = $g-&gt;inspect_os ();
 if (@roots == 0) {
     die &quot;inspect_vm: no operating systems found&quot;;
 }
 
 for my $root (@roots) {
     printf &quot;Root device: %s\n&quot;, $root;
 
     # Print basic information about the operating system.
     printf &quot;  Product name: %s\n&quot;, $g-&gt;inspect_get_product_name ($root);
     printf &quot;  Version:      %d.%d\n&quot;,
         $g-&gt;inspect_get_major_version ($root),
         $g-&gt;inspect_get_minor_version ($root);
     printf &quot;  Type:         %s\n&quot;, $g-&gt;inspect_get_type ($root);
     printf &quot;  Distro:       %s\n&quot;, $g-&gt;inspect_get_distro ($root);
 
     # Mount up the disks, like guestfish -i.
     #
     # Sort keys by length, shortest first, so that we end up
     # mounting the filesystems in the correct order.
     my %mps = $g-&gt;inspect_get_mountpoints ($root);
     my @mps = sort { length $a &lt;=&gt; length $b } (keys %mps);
     for my $mp (@mps) {
         eval { $g-&gt;mount_ro ($mps{$mp}, $mp) };
         if ($@) {
             print &quot;$@ (ignored)\n&quot;
         }
     }
 
     # If /etc/issue.net file exists, print up to 3 lines.
     my $filename = &quot;/etc/issue.net&quot;;
     if ($g-&gt;is_file ($filename)) {
         printf &quot;--- %s ---\n&quot;, $filename;
         my @lines = $g-&gt;head_n (3, $filename);
         print &quot;$_\n&quot; foreach @lines;
     }
 
     # Unmount everything.
     $g-&gt;umount_all ()
 }</code></pre>

<h1 id="see-also">SEE ALSO</h1>

<p><a href="Sys::Guestfs(3).3.html">Sys::Guestfs(3)</a>, <a href="guestfs.3.html">guestfs(3)</a>, <a href="guestfs-examples.3.html">guestfs-examples(3)</a>, <a href="guestfs-erlang.3.html">guestfs-erlang(3)</a>, <a href="guestfs-golang.3.html">guestfs-golang(3)</a>, <a href="guestfs-java.3.html">guestfs-java(3)</a>, <a href="guestfs-lua.3.html">guestfs-lua(3)</a>, <a href="guestfs-ocaml.3.html">guestfs-ocaml(3)</a>, <a href="guestfs-python.3.html">guestfs-python(3)</a>, <a href="guestfs-recipes.1.html">guestfs-recipes(1)</a>, <a href="guestfs-ruby.3.html">guestfs-ruby(3)</a>, <a href="http://libguestfs.org/">http://libguestfs.org/</a>.</p>

<h1 id="authors">AUTHORS</h1>

<p>Richard W.M. Jones (<code>rjones at redhat dot com</code>)</p>

<h1 id="copyright">COPYRIGHT</h1>

<p>Copyright (C) 2011-2012 Red Hat Inc.</p>

<h1 id="license">LICENSE</h1>

<p>This manual page contains examples which we hope you will use in your programs. The examples may be freely copied, modified and distributed for any purpose without any restrictions.</p>

<h1 id="bugs">BUGS</h1>

<p>To get a list of bugs against libguestfs, use this link: <a href="https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools">https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools</a></p>

<p>To report a new bug against libguestfs, use this link: <a href="https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools">https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools</a></p>

<p>When reporting a bug, please supply:</p>

<ul>

<li><p>The version of libguestfs.</p>

</li>
<li><p>Where you got libguestfs (eg. which Linux distro, compiled from source, etc)</p>

</li>
<li><p>Describe the bug accurately and give a way to reproduce it.</p>

</li>
<li><p>Run <a href="libguestfs-test-tool.1.html">libguestfs-test-tool(1)</a> and paste the <b>complete, unedited</b> output into the bug report.</p>

</li>
</ul>

</body>
</html>

