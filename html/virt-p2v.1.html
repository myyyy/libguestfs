
<html>
<head>
<title>virt-p2v</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel='stylesheet' href='pod.css' type='text/css' />
</head>
<body>


<ul id="index">
  <li><a href="#name">NAME</a></li>
  <li><a href="#synopsis">SYNOPSIS</a></li>
  <li><a href="#description">DESCRIPTION</a></li>
  <li><a href="#network-setup">NETWORK SETUP</a></li>
  <li><a href="#gui-interactive-configuration">GUI INTERACTIVE CONFIGURATION</a>
    <ul>
      <li><a href="#ssh-configuration-dialog">SSH CONFIGURATION DIALOG</a></li>
      <li><a href="#disk-and-network-configuration-dialog">DISK AND NETWORK CONFIGURATION DIALOG</a></li>
      <li><a href="#conversion-running-dialog">CONVERSION RUNNING DIALOG</a></li>
    </ul>
  </li>
  <li><a href="#kernel-command-line-configuration">KERNEL COMMAND LINE CONFIGURATION</a></li>
  <li><a href="#options">OPTIONS</a></li>
  <li><a href="#how-virt-p2v-works">HOW VIRT-P2V WORKS</a></li>
  <li><a href="#see-also">SEE ALSO</a></li>
  <li><a href="#authors">AUTHORS</a></li>
  <li><a href="#copyright">COPYRIGHT</a></li>
  <li><a href="#license">LICENSE</a></li>
  <li><a href="#bugs">BUGS</a></li>
</ul>

<h1 id="name">NAME</h1>

<p>virt-p2v - Convert a physical machine to use KVM</p>

<h1 id="synopsis">SYNOPSIS</h1>

<pre><code> virt-p2v

 virt-p2v.iso</code></pre>

<h1 id="description">DESCRIPTION</h1>

<p>Virt-p2v converts a physical machine to run virtualized on KVM, managed by libvirt, OpenStack, oVirt, Red Hat Enterprise Virtualisation (RHEV), or one of the other targets supported by <a href="virt-v2v.1.html">virt-v2v(1)</a>.</p>

<p>Normally you don&#39;t run the virt-p2v program directly. Instead you have to boot the physical machine using the bootable CD-ROM, ISO or PXE image. This bootable image contains the virt-p2v binary and runs it automatically. Booting from a CD-ROM/etc is required because the disks which are being converted must be quiescent. It is not safe to try to convert a running physical machine where other programs may be modifying the disk content at the same time.</p>

<p>This manual page documents running the virt-p2v program. To create the bootable image you should look at <a href="virt-p2v-make-disk.1.html">virt-p2v-make-disk(1)</a> or <a href="virt-p2v-make-kickstart.1.html">virt-p2v-make-kickstart(1)</a>.</p>

<h1 id="network-setup">NETWORK SETUP</h1>

<p>Virt-p2v runs on the physical machine which you want to convert. It has to talk to another server called the &quot;conversion server&quot; which must have <a href="virt-v2v.1.html">virt-v2v(1)</a> installed on it. It always talks to the conversion server over SSH:</p>

<pre><code> &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                  &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;
 &#x2502; virt-p2v     &#x2502;                  &#x2502; virt-v2v        &#x2502;
 &#x2502; (physical    &#x2502;  ssh connection  &#x2502; (conversion     &#x2502;
 &#x2502;  server)   &#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x25B6; server)       &#x2502;
 &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</code></pre>

<p>The virt-v2v program on the conversion server does the actual conversion (physical to virtual, and virtual to virtual conversions are sufficiently similar that we use the same program to do both).</p>

<p>The SSH connection is always initiated from the physical server. All data is transferred over the SSH connection. In terms of firewall and network configuration, you only need to ensure that the physical server has access to a port (usually TCP port 22) on the conversion server. Note that the physical machine may reconnect several times during the conversion process.</p>

<p>The reverse port forwarding feature of ssh (ie. <code>ssh -R</code>) is required by virt-p2v, and it will not work if this is disabled on the conversion server. (<code>AllowTcpForwarding</code> must be <code>yes</code> in the <a href="http://search.cpan.org/perldoc?sshd_config(5)">sshd_config(5)</a> file on the conversion server).</p>

<p>The conversion server does not need to be a physical machine. It could be a virtual machine, as long as it has sufficient memory and disk space to do the conversion, and as long as the physical machine can connect directly to its SSH port. (See also <a href="virt-v2v.1.html#resource-requirements">&quot;RESOURCE REQUIREMENTS&quot; in virt-v2v(1)</a>).</p>

<p>Because all of the data on the physical server&#39;s hard drive(s) has to be copied over the network, the speed of conversion is largely determined by the speed of the network between the two machines.</p>

<h1 id="gui-interactive-configuration">GUI INTERACTIVE CONFIGURATION</h1>

<p>When you start virt-p2v, you&#39;ll see a graphical configuration dialog that walks you through connection to the conversion server, asks for the password, which local hard disks you want to convert, and other things like the name of the guest to create and the number of virtual CPUs to give it.</p>

<h2 id="ssh-configuration-dialog">SSH CONFIGURATION DIALOG</h2>

<p>When virt-p2v starts up in GUI mode, the first dialog looks like this:</p>

<pre><code> &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;
 &#x2502;                      virt-p2v                          &#x2502;
 &#x2502;                                                        &#x2502;
 &#x2502; Conversion server: [_________________________________] &#x2502;
 &#x2502;                                                        &#x2502;
 &#x2502;          SSH port: [22_______________________________] &#x2502;
 &#x2502;                                                        &#x2502;
 &#x2502;         User name: [root_____________________________] &#x2502;
 &#x2502;                                                        &#x2502;
 &#x2502;          Password: [_________________________________] &#x2502;
 &#x2502;                                                        &#x2502;</code></pre>

<p>In the fields above, you must enter the hostname, SSH port number, remote user name and password of the conversion server. The conversion server must have an up to date version of virt-v2v.</p>

<p>Normally you must log in to the conversion server as root, but if you check the following box:</p>

<pre><code> &#x2502;                                                        &#x2502;
 &#x2502;                    [ ] Use sudo when running virt-v2v  &#x2502;
 &#x2502;                                                        &#x2502;</code></pre>

<p>then you can log in as another user, and virt-p2v will use the <a href="http://man.he.net/man8/sudo">sudo(8)</a> command to elevate privileges to root. Note that sudo must not require a password.</p>

<p>It is also possible to run virt-v2v on the conversion server entirely as non-root, but output modes may be limited. Consult the <a href="virt-v2v.1.html">virt-v2v(1)</a> manual page for details.</p>

<p>At the bottom of the dialog are these buttons:</p>

<pre><code> &#x2502;                                                        &#x2502;
 &#x2502;                [ Test connection ]                     &#x2502;
 &#x2502;                                                        &#x2502;
 &#x2502; [ Configure network ] [ About virt-p2v  ] [ Next     ] &#x2502;
 &#x2502;                                                        &#x2502;
 &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</code></pre>

<p>You must press the <code>Test connection</code> button first to test the SSH connection to the conversion server. If that is successful (ie. you have supplied the correct server name, user name, password, etc., and a suitable version of virt-v2v is available remotely) then press the <code>Next</code> button to move to the next dialog.</p>

<p>You can use the <code>Configure network</code> button if you need to assign a static IP address to the physical machine, or use Wifi, bonding or other network features.</p>

<h2 id="disk-and-network-configuration-dialog">DISK AND NETWORK CONFIGURATION DIALOG</h2>

<p>The second configuration dialog lets you configure the details of conversion, including what to convert and where to send the guest.</p>

<p>In the left hand column, starting at the top, the target properties let you select the name of the guest (ie. after conversion) and how many virtual CPUs and how much RAM to give it. The defaults come from the physical machine, and you can usually leave them unchanged:</p>

<pre><code> &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500; &#x2500; &#x2500; &#x2500; &#x2500;
 &#x2502; Target properties:
 &#x2502;
 &#x2502;        Name: [hostname______________]
 &#x2502;
 &#x2502;     # vCPUs: [4_____________________]
 &#x2502;
 &#x2502; Memory (MB): [16384_________________]
 &#x2502;</code></pre>

<p>The second panel on the left controls the virt-v2v output options. To understand these options it is a really good idea to read the <a href="virt-v2v.1.html">virt-v2v(1)</a> manual page. You can leave the options at the default to create a guest as a disk image plus libvirt XML file located in <i>/var/tmp</i> on the conversion host. This is a good idea if you are a first-time virt-p2v user.</p>

<pre><code> &#x2502;
 &#x2502; Virt-v2v output options:
 &#x2502;
 &#x2502;          Output to (-o): [local             &#x25BC;]
 &#x2502;
 &#x2502;      Output conn. (-oc): [___________________]
 &#x2502;
 &#x2502;    Output storage (-os): [/var/tmp___________]
 &#x2502;
 &#x2502;     Output format (-of): [___________________]
 &#x2502;
 &#x2502; Output allocation (-oa): [sparse            &#x25BC;]
 &#x2502;</code></pre>

<p>All output options and paths are relative to the conversion server (<i>not</i> to the physical server).</p>

<p>The final option in this panel enables server-side debugging. This produces a lot of output, but is essential if you are tracking down virt-p2v or virt-v2v problems, and can generally be left enabled:</p>

<pre><code> &#x2502;
 &#x2502; [&#x2714;] Enable server-side debugging
 &#x2502;</code></pre>

<p>Finally in the left hand column is an information box giving the version of virt-p2v (on the physical server) and virt-v2v (on the conversion server). You should supply this information when reporting bugs.</p>

<p>In the right hand column are three panels which control what hard disks, removable media devices, and network interfaces, will be created in the output guest. Normally leaving these at the default settings is fine.</p>

<pre><code> &#x2500; &#x2500; &#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;
     Fixed hard disks                       &#x2502;
                                            &#x2502;
     Convert  Device  Size (GB)  Model      &#x2502;
     [&#x2714;]      sda     1024       HITACHI    &#x2502;
     [&#x2714;]      sdb     119        HITACHI    &#x2502;
                                            &#x2502;</code></pre>

<p>Normally you would want to convert all hard disks. If you want virt-p2v to completely ignore a local hard disk, uncheck it. The hard disk that contains the operating system must be selected. If a hard disk is part of a RAID array or LVM volume group (VG), then either all hard disks in that array/VG must be selected, or none of them.</p>

<pre><code>                                            &#x2502;
     Removable media                        &#x2502;
                                            &#x2502;
     Convert  Device                        &#x2502;
     [&#x2714;]      sr0                           &#x2502;
                                            &#x2502;</code></pre>

<p>If the physical machine has CD or DVD drives, then you can use the Removable media panel to create corresponding drives on the guest after conversion. Note that any data CDs/DVDs which are mounted in the drives are <i>not</i> copied over.</p>

<pre><code>                                            &#x2502;
     Network interfaces                     &#x2502;
                                            &#x2502;
     Convert  Device Connect to ...         |
     [&#x2714;]      em1    [default_____________] &#x2502;
     [ ]      wlp3s0 [default_____________] &#x2502;
                                            &#x2502;</code></pre>

<p>In the Network interfaces panel, select the network interfaces that should be created in the guest after conversion. You can also connect these to target hypervisor networks (for further information about this feature, see <a href="virt-v2v.1.html#networks-and-bridges">&quot;NETWORKS AND BRIDGES&quot; in virt-v2v(1)</a>).</p>

<p>When you are ready to begin the conversion, press the <code>Start conversion</code> button:</p>

<pre><code>                                            &#x2502;
             [ Back ]  [ Start conversion ] &#x2502;
                                            &#x2502;
 &#x2500; &#x2500; &#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</code></pre>

<h2 id="conversion-running-dialog">CONVERSION RUNNING DIALOG</h2>

<p>When conversion is running you will see this dialog:</p>

<pre><code> &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;
 &#x2502;                      virt-p2v                          &#x2502;
 &#x2502;                                                        &#x2502;
 &#x2502;  &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;  &#x2502;
 &#x2502;  &#x2502;                                                 &#x25B2;&#x2502;  &#x2502;
 &#x2502;  &#x2502;                                                  &#x2502;  &#x2502;
 &#x2502;  &#x2502;                                                  &#x2502;  &#x2502;
 &sim;  &sim;                                                  &sim;  &sim;
 &#x2502;  &#x2502;                                                  &#x2502;  &#x2502;
 &#x2502;  &#x2502;                                                  &#x2502;  &#x2502;
 &#x2502;  &#x2502;                                                 &#x25BC;&#x2502;  &#x2502;
 &#x2502;  &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;  &#x2502;
 &#x2502;                                                        &#x2502;
 &#x2502; Log files ... to /tmp/virt-p2v-xxx                     &#x2502;
 &#x2502;                                                        &#x2502;
 &#x2502; Doing conversion ...                                   &#x2502;
 &#x2502;                                                        &#x2502;
 &#x2502;                                 [ Cancel conversion ]  &#x2502;
 &#x2502;                                                        &#x2502;
 &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</code></pre>

<p>In the main scrolling area you will see log messages from the virt-v2v process.</p>

<p>Below the main area, virt-p2v shows you the location of the directory on the conversion server that contains log files and other debugging information. Below that is the current status and a button for cancelling conversion.</p>

<p>Once conversion has finished, you should shut down the physical machine. If conversion is successful, you should never reboot it.</p>

<h1 id="kernel-command-line-configuration">KERNEL COMMAND LINE CONFIGURATION</h1>

<p>If you don&#39;t want to configure things using the graphical UI, an alternative is to configure through the kernel command line. This is especially convenient if you are converting a lot of physical machines which are booted using PXE.</p>

<p>Where exactly you set command line arguments depends on your PXE implementation, but for pxelinux you put them in the <code>APPEND</code> field in the <i>pxelinux.cfg</i> file. For example:</p>

<pre><code> DEFAULT p2v
 TIMEOUT 20
 PROMPT 0
 LABEL p2v
   KERNEL vmlinuz0
   APPEND initrd=initrd0.img [....] p2v.server=conv.example.com p2v.password=secret p2v.o=libvirt</code></pre>

<p>You have to set some or all of the following command line arguments:</p>

<dl>

<dt><b>p2v.server=SERVER</b></dt>
<dd>

<p>The name or IP address of the conversion server.</p>

<p>This is always required if you are using the kernel configuration method. If virt-p2v does not find this on the kernel command line then it switches to the GUI (interactive) configuration method.</p>

</dd>
<dt><b>p2v.port=NN</b></dt>
<dd>

<p>The SSH port number on the conversion server (default: <code>22</code>).</p>

</dd>
<dt><b>p2v.username=USERNAME</b></dt>
<dd>

<p>The SSH username that we log in as on the conversion server (default: <code>root</code>).</p>

</dd>
<dt><b>p2v.password=PASSWORD</b></dt>
<dd>

<p>The SSH password that we use to log in to the conversion server.</p>

<p>The default is to try with no password. If this fails then virt-p2v will ask the user to type the password (probably several times during conversion).</p>

<p>Note that virt-p2v does not support authentication using key distribution at this time.</p>

</dd>
<dt><b>p2v.sudo</b></dt>
<dd>

<p>Use <code>p2v.sudo</code> to tell virt-p2v to use <a href="http://man.he.net/man8/sudo">sudo(8)</a> to gain root privileges on the conversion server after logging in as a non-root user (default: do not use sudo).</p>

</dd>
<dt><b>p2v.name=GUESTNAME</b></dt>
<dd>

<p>The name of the guest that is created. The default is to try to derive a name from the physical machine&#39;s hostname (if possible) else use a randomly generated name.</p>

</dd>
<dt><b>p2v.vcpus=NN</b></dt>
<dd>

<p>The number of virtual CPUs to give to the guest. The default is to use the same as the number of physical CPUs.</p>

</dd>
<dt><b>p2v.memory=NN(M|G)</b></dt>
<dd>

<p>The size of the guest memory. You must specify the unit as either megabytes or gigabytes by using (eg) <code>p2v.memory=1024M</code> or <code>p2v.memory=1G</code>.</p>

<p>The default is to use the same amount of RAM as on the physical machine.</p>

</dd>
<dt><b>p2v.debug</b></dt>
<dd>

<p>Use this to enable full debugging of virt-v2v.</p>

<p>If asked to diagnose a problem with virt-p2v, you should add <code>p2v.debug</code> to the kernel command line, and examine the log file which is left in <i>/tmp</i> on the conversion server.</p>

</dd>
<dt><b>p2v.disks=sdX,sdY,..</b></dt>
<dd>

<p>A list of physical hard disks to convert, for example:</p>

<pre><code> p2v.disks=sda,sdc</code></pre>

<p>The default is to convert all local hard disks that are found.</p>

</dd>
<dt><b>p2v.removable=srX,srY,..</b></dt>
<dd>

<p>A list of removable media to convert. The default is to create virtual removable devices for every physical removable device found. Note that the content of removable media is never copied over.</p>

</dd>
<dt><b>p2v.interfaces=em1,..</b></dt>
<dd>

<p>A list of network interfaces to convert. The default is to create virtual network interfaces for every physical network interface found.</p>

</dd>
<dt><b>p2v.network=interface:target,...</b></dt>
<dd>

<p>Controls how network interfaces are connected to virtual networks on the target hypervisor. The default is to connect all network interfaces to the target <code>default</code> network.</p>

<p>You give a comma-separated list of <code>interface:target</code> pairs, plus optionally a default target. For example:</p>

<pre><code> p2v.network=em1:rhevm</code></pre>

<p>maps interface <code>em1</code> to target network <code>rhevm</code>.</p>

<pre><code> p2v.network=em1:rhevm,em2:management,other</code></pre>

<p>maps interface <code>em1</code> to <code>rhevm</code>, and <code>em2</code> to <code>management</code>, and any other interface that is found to <code>other</code>.</p>

</dd>
<dt><b>p2v.o=[libvirt|local|...]</b></dt>
<dd>

<p>Set the output mode. This is the same as the virt-v2v <i>-o</i> option. See <a href="virt-v2v.1.html#options">&quot;OPTIONS&quot; in virt-v2v(1)</a>.</p>

<p>If not specified, the default is <code>local</code>, and the converted guest is written to <i>/var/tmp</i>.</p>

</dd>
<dt><b>p2v.oa=sparse|preallocated</b></dt>
<dd>

<p>Set the output allocation mode. This is the same as the virt-v2v <i>-oa</i> option. See <a href="virt-v2v.1.html#options">&quot;OPTIONS&quot; in virt-v2v(1)</a>.</p>

</dd>
<dt><b>p2v.oc=...</b></dt>
<dd>

<p>Set the output connection libvirt URI. This is the same as the virt-v2v <i>-oc</i> option. See <a href="virt-v2v.1.html#options">&quot;OPTIONS&quot; in virt-v2v(1)</a> and <a href="http://libvirt.org/uri.html">http://libvirt.org/uri.html</a></p>

</dd>
<dt><b>p2v.of=raw|qcow2|...</b></dt>
<dd>

<p>Set the output format. This is the same as the virt-v2v <i>-of</i> option. See <a href="virt-v2v.1.html#options">&quot;OPTIONS&quot; in virt-v2v(1)</a>.</p>

</dd>
<dt><b>p2v.os=...</b></dt>
<dd>

<p>Set the output storage. This is the same as the virt-v2v <i>-os</i> option. See <a href="virt-v2v.1.html#options">&quot;OPTIONS&quot; in virt-v2v(1)</a>.</p>

<p>If not specified, the default is <i>/var/tmp</i> (on the conversion server).</p>

</dd>
<dt><b>p2v.pre=COMMAND</b></dt>
<dd>

</dd>
<dt><b>p2v.pre=&quot;COMMAND ARG ...&quot;</b></dt>
<dd>

<p>Select a pre-conversion command to run. Any command or script can be specified here. If the command contains spaces, you must quote the whole command with double quotes. The default is not to run any command.</p>

</dd>
<dt><b>p2v.post=poweroff</b></dt>
<dd>

</dd>
<dt><b>p2v.post=reboot</b></dt>
<dd>

</dd>
<dt><b>p2v.post=COMMAND</b></dt>
<dd>

</dd>
<dt><b>p2v.post=&quot;COMMAND ARG ...&quot;</b></dt>
<dd>

<p>Select a post-conversion command to run if conversion is successful. This can be any command or script. If the command contains spaces, you must quote the whole command with double quotes.</p>

<p><i>If</i> virt-p2v is running as root, <i>and</i> the command line was set from <i>/proc/cmdline</i> (not <i>--cmdline</i>), then the default is to run the <a href="http://man.he.net/man8/poweroff">poweroff(8)</a> command. Otherwise the default is not to run any command.</p>

</dd>
<dt><b>p2v.fail=COMMAND</b></dt>
<dd>

</dd>
<dt><b>p2v.fail=&quot;COMMAND ARG ...&quot;</b></dt>
<dd>

<p>Select a post-conversion command to run if conversion fails. Any command or script can be specified here. If the command contains spaces, you must quote the whole command with double quotes. The default is not to run any command.</p>

</dd>
<dt><b>ip=dhcp</b></dt>
<dd>

<p>Use DHCP for configuring the network interface (this is the default).</p>

</dd>
</dl>

<h1 id="options">OPTIONS</h1>

<dl>

<dt><b>--help</b></dt>
<dd>

<p>Display help.</p>

</dd>
<dt><b>--cmdline=CMDLINE</b></dt>
<dd>

<p>This is used for debugging. Instead of parsing the kernel command line from <i>/proc/cmdline</i>, parse the string parameter <code>CMDLINE</code>.</p>

</dd>
<dt><b>-v</b></dt>
<dd>

</dd>
<dt><b>--verbose</b></dt>
<dd>

<p>Enable debugging (on the conversion server).</p>

</dd>
<dt><b>-V</b></dt>
<dd>

</dd>
<dt><b>--version</b></dt>
<dd>

<p>Display version number and exit.</p>

</dd>
</dl>

<h1 id="how-virt-p2v-works">HOW VIRT-P2V WORKS</h1>

<p><b>Note this section is not normative.</b> We may change how virt-p2v works at any time in the future.</p>

<p>As described above, virt-p2v runs on a physical machine, interrogates the user or the kernel command line for configuration, and then establishes one or more ssh connections to the virt-v2v conversion server. The ssh connections are interactive shell sessions to the remote host, but the commands sent are generated entirely by virt-p2v itself, not by the user. For data transfer, virt-p2v will use the reverse port forward feature of ssh (ie. <code>ssh -R</code>).</p>

<p>It will first make one or more test connections, which are used to query the remote version of virt-v2v and its features. The test connections are closed before conversion begins.</p>

<pre><code> &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                      &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;
 &#x2502; virt-p2v     &#x2502;                      &#x2502; virt-v2v        &#x2502;
 &#x2502; (physical    &#x2502;  control connection  &#x2502; (conversion     &#x2502;
 &#x2502;  server)   &#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x25B6; server)       &#x2502;
 &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                      &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</code></pre>

<p>Once virt-p2v is ready to start conversion, it will open a single ssh control connection. It first sends a mkdir command to create a temporary directory on the conversion server. The directory name is randomly chosen and is displayed in the GUI. It has the form:</p>

<pre><code> /tmp/virt-p2v-YYYYMMDD-XXXXXXXX</code></pre>

<p>where <code>YYYYMMDD</code> is the current date, and the X&#39;s are random characters.</p>

<p>Into this directory are written various files which include:</p>

<dl>

<dt><i>name</i></dt>
<dd>

<p><i>before conversion</i></p>

<p>The name (usually the hostname) of the physical machine.</p>

</dd>
<dt><i>physical.xml</i></dt>
<dd>

<p><i>before conversion</i></p>

<p>Libvirt XML describing the physical machine. It is used to pass data about the physical source host to <a href="virt-v2v.1.html">virt-v2v(1)</a> via the <i>-i libvirtxml</i> option.</p>

<p>Note this is not &quot;real&quot; libvirt XML (and must <b>never</b> be loaded into libvirt, which would reject it anyhow). Also it is not the same as the libvirt XML which virt-v2v generates in certain output modes.</p>

</dd>
<dt><i>status</i></dt>
<dd>

<p><i>after conversion</i></p>

<p>The final status of the conversion. <code>0</code> if the conversion was successful. Non-zero if the conversion failed.</p>

</dd>
<dt><i>time</i></dt>
<dd>

<p><i>before conversion</i></p>

<p>The start date/time of conversion.</p>

</dd>
<dt><i>virt-v2v-conversion-log.txt</i></dt>
<dd>

<p><i>during/after conversion</i></p>

<p>The conversion log. This is just the output of the virt-v2v command on the conversion server. If conversion fails, you should examine this log file, and you may be asked to supply the <b>complete</b>, <b>unedited</b> log file in any bug reports or support tickets.</p>

</dd>
</dl>

<p>Before conversion actually begins, virt-p2v then makes one or more further ssh connections to the server for data transfer. The transfer protocol used currently is NBD (Network Block Device), which is proxied over ssh. The server is <a href="http://man.he.net/man1/qemu-nbd">qemu-nbd(1)</a>. There is one ssh connection per physical hard disk on the source machine (the common case &mdash; a single hard disk &mdash; is shown below):</p>

<pre><code> &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;                      &#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;
 &#x2502; virt-p2v     &#x2502;                      &#x2502; virt-v2v        &#x2502;
 &#x2502; (physical    &#x2502;  control connection  &#x2502; (conversion     &#x2502;
 &#x2502;  server)   &#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x25B6; server)       &#x2502;
 &#x2502;              &#x2502;                      &#x2502;                 &#x2502;
 &#x2502;              &#x2502;  data connection     &#x2502;                 &#x2502;
 &#x2502;            &#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x254D;&#x25B6;               &#x2502;
 &#x2502;qemu-nbd &larr; &#x2500;&#x2518; &#x2502;                      &#x2502;&#x2514;&#x2500; &larr; NBD         &#x2502;
 &#x2502;/dev/sda      &#x2502;                      &#x2502;     requests    &#x2502;
 &sim;              &sim;                      &sim;                 &sim;
 &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;                      &#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</code></pre>

<p>Although the ssh data connection is originated from the physical server and terminates on the conversion server, in fact NBD requests flow in the opposite direction. This is because the reverse port forward feature of ssh (<code>ssh -R</code>) is used to open a port on the loopback interface of the conversion server which is proxied back by ssh to the qemu-nbd server running on the physical machine. The effect is that virt-v2v via libguestfs can open nbd connections which directly read the hard disk(s) of the physical server.</p>

<p>Two layers of protection are used to ensure that there are no writes to the hard disks: Firstly, the qemu-nbd <i>-r</i> (readonly) option is used. Secondly libguestfs creates an overlay on top of the NBD connection which stores writes in a temporary file on the conversion file.</p>

<p>The final step is to send the <span style="white-space: nowrap;"><code>virt-v2v -i libvirtxml physical.xml ...</code></span> command to the conversion server over the control connection. This references the <i>physical.xml</i> file (see above), which in turn references the NBD listening port(s) of the data connection(s).</p>

<p>Output from the virt-v2v command (messages, debugging etc) is saved both in the log file on the conversion server, and sent over the control connection to be displayed in the graphical UI.</p>

<h1 id="see-also">SEE ALSO</h1>

<p><a href="virt-p2v-make-disk.1.html">virt-p2v-make-disk(1)</a>, <a href="virt-p2v-make-kickstart.1.html">virt-p2v-make-kickstart(1)</a>, <a href="virt-v2v.1.html">virt-v2v(1)</a>, <a href="http://man.he.net/man1/qemu-nbd">qemu-nbd(1)</a>, <a href="http://man.he.net/man1/ssh">ssh(1)</a>, <a href="http://man.he.net/man8/sshd">sshd(8)</a>, <a href="http://search.cpan.org/perldoc?sshd_config(5)">sshd_config(5)</a>, <a href="http://libguestfs.org/">http://libguestfs.org/</a>.</p>

<h1 id="authors">AUTHORS</h1>

<p>Matthew Booth</p>

<p>John Eckersberg</p>

<p>Richard W.M. Jones <a href="http://people.redhat.com/~rjones/">http://people.redhat.com/~rjones/</a></p>

<p>Mike Latimer</p>

<p>Pino Toscano</p>

<p>Tingting Zheng</p>

<h1 id="copyright">COPYRIGHT</h1>

<p>Copyright (C) 2009-2015 Red Hat Inc.</p>

<h1 id="license">LICENSE</h1>

<p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>

<p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</p>

<h1 id="bugs">BUGS</h1>

<p>To get a list of bugs against libguestfs, use this link: <a href="https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools">https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools</a></p>

<p>To report a new bug against libguestfs, use this link: <a href="https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools">https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools</a></p>

<p>When reporting a bug, please supply:</p>

<ul>

<li><p>The version of libguestfs.</p>

</li>
<li><p>Where you got libguestfs (eg. which Linux distro, compiled from source, etc)</p>

</li>
<li><p>Describe the bug accurately and give a way to reproduce it.</p>

</li>
<li><p>Run <a href="libguestfs-test-tool.1.html">libguestfs-test-tool(1)</a> and paste the <b>complete, unedited</b> output into the bug report.</p>

</li>
</ul>

</body>
</html>

