
<html>
<head>
<title>guestfs-python</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel='stylesheet' href='pod.css' type='text/css' />
</head>
<body>


<ul id="index">
  <li><a href="#name">NAME</a></li>
  <li><a href="#synopsis">SYNOPSIS</a></li>
  <li><a href="#description">DESCRIPTION</a>
    <ul>
      <li><a href="#python_return_dict-true">python_return_dict=True</a></li>
      <li><a href="#exceptions">EXCEPTIONS</a></li>
      <li><a href="#more-documentation">MORE DOCUMENTATION</a></li>
    </ul>
  </li>
  <li><a href="#example-1:-create-a-disk-image">EXAMPLE 1: CREATE A DISK IMAGE</a></li>
  <li><a href="#example-2:-inspect-a-virtual-machine-disk-image">EXAMPLE 2: INSPECT A VIRTUAL MACHINE DISK IMAGE</a></li>
  <li><a href="#see-also">SEE ALSO</a></li>
  <li><a href="#authors">AUTHORS</a></li>
  <li><a href="#copyright">COPYRIGHT</a></li>
  <li><a href="#license">LICENSE</a></li>
  <li><a href="#bugs">BUGS</a></li>
</ul>

<h1 id="name">NAME</h1>

<p>guestfs-python - How to use libguestfs from Python</p>

<h1 id="synopsis">SYNOPSIS</h1>

<pre><code> import guestfs
 g = guestfs.GuestFS (python_return_dict=True)
 g.add_drive_opts (&quot;disk.img&quot;, format=&quot;raw&quot;, readonly=1)
 g.launch ()</code></pre>

<h1 id="description">DESCRIPTION</h1>

<p>This manual page documents how to call libguestfs from the Python programming language. This page just documents the differences from the C API and gives some examples. If you are not familiar with using libguestfs, you also need to read <a href="guestfs.3.html">guestfs(3)</a>.</p>

<h2 id="python_return_dict-true">python_return_dict=True</h2>

<p>All new code should construct the handle using:</p>

<pre><code> g = guestfs.GuestFS (python_return_dict=True)</code></pre>

<p>This indicates that your program wants to receive Python dicts for methods in the API that return hashtables.</p>

<p>In a future version of libguestfs, this will become the default.</p>

<h2 id="exceptions">EXCEPTIONS</h2>

<p>Errors from libguestfs functions are mapped into <code>RuntimeException</code> with a single string argument which is the error message.</p>

<h2 id="more-documentation">MORE DOCUMENTATION</h2>

<p>Type:</p>

<pre><code> $ python
 &gt;&gt;&gt; import guestfs
 &gt;&gt;&gt; help (guestfs)</code></pre>

<h1 id="example-1:-create-a-disk-image">EXAMPLE 1: CREATE A DISK IMAGE</h1>

<pre><code> # Example showing how to create a disk image.
 
 import guestfs
 
 output = &quot;disk.img&quot;
 
 # All new Python code should pass python_return_dict=True
 # to the constructor.  It indicates that your program wants
 # to receive Python dicts for methods in the API that return
 # hashtables.
 g = guestfs.GuestFS (python_return_dict=True)
 
 # Create a raw-format sparse disk image, 512 MB in size.
 g.disk_create (output, &quot;raw&quot;, 512 * 1024 * 1024);
 
 # Set the trace flag so that we can see each libguestfs call.
 g.set_trace (1)
 
 # Attach the disk image to libguestfs.
 g.add_drive_opts (output, format = &quot;raw&quot;, readonly = 0)
 
 # Run the libguestfs back-end.
 g.launch ()
 
 # Get the list of devices.  Because we only added one drive
 # above, we expect that this list should contain a single
 # element.
 devices = g.list_devices ()
 assert (len (devices) == 1)
 
 # Partition the disk as one single MBR partition.
 g.part_disk (devices[0], &quot;mbr&quot;)
 
 # Get the list of partitions.  We expect a single element, which
 # is the partition we have just created.
 partitions = g.list_partitions ()
 assert (len (partitions) == 1)
 
 # Create a filesystem on the partition.
 g.mkfs (&quot;ext4&quot;, partitions[0])
 
 # Now mount the filesystem so that we can add files.
 g.mount (partitions[0], &quot;/&quot;)
 
 # Create some files and directories.
 g.touch (&quot;/empty&quot;)
 message = &quot;Hello, world\n&quot;
 g.write (&quot;/hello&quot;, message)
 g.mkdir (&quot;/foo&quot;)
 
 # This one uploads the local file /etc/resolv.conf into
 # the disk image.
 g.upload (&quot;/etc/resolv.conf&quot;, &quot;/foo/resolv.conf&quot;)
 
 # Because we wrote to the disk and we want to detect write
 # errors, call g.shutdown.  You don&#39;t need to do this:
 # g.close will do it implicitly.
 g.shutdown ()
 
 # Note also that handles are automatically closed if they are
 # reaped by reference counting.  You only need to call close
 # if you want to close the handle right away.
 g.close ()</code></pre>

<h1 id="example-2:-inspect-a-virtual-machine-disk-image">EXAMPLE 2: INSPECT A VIRTUAL MACHINE DISK IMAGE</h1>

<pre><code> # Example showing how to inspect a virtual machine disk.
 
 import sys
 import guestfs
 
 assert (len (sys.argv) == 2)
 disk = sys.argv[1]
 
 # All new Python code should pass python_return_dict=True
 # to the constructor.  It indicates that your program wants
 # to receive Python dicts for methods in the API that return
 # hashtables.
 g = guestfs.GuestFS (python_return_dict=True)
 
 # Attach the disk image read-only to libguestfs.
 g.add_drive_opts (disk, readonly=1)
 
 # Run the libguestfs back-end.
 g.launch ()
 
 # Ask libguestfs to inspect for operating systems.
 roots = g.inspect_os ()
 if len (roots) == 0:
     raise (Error (&quot;inspect_vm: no operating systems found&quot;))
 
 for root in roots:
     print &quot;Root device: %s&quot; % root
 
     # Print basic information about the operating system.
     print &quot;  Product name: %s&quot; % (g.inspect_get_product_name (root))
     print &quot;  Version:      %d.%d&quot; % \
         (g.inspect_get_major_version (root),
          g.inspect_get_minor_version (root))
     print &quot;  Type:         %s&quot; % (g.inspect_get_type (root))
     print &quot;  Distro:       %s&quot; % (g.inspect_get_distro (root))
 
     # Mount up the disks, like guestfish -i.
     #
     # Sort keys by length, shortest first, so that we end up
     # mounting the filesystems in the correct order.
     mps = g.inspect_get_mountpoints (root)
     def compare (a, b): return len(a) - len(b)
     for device in sorted (mps.keys(), compare):
         try:
             g.mount_ro (mps[device], device)
         except RuntimeError as msg:
             print &quot;%s (ignored)&quot; % msg
 
     # If /etc/issue.net file exists, print up to 3 lines.
     filename = &quot;/etc/issue.net&quot;
     if g.is_file (filename):
         print &quot;--- %s ---&quot; % filename
         lines = g.head_n (3, filename)
         for line in lines: print line
 
     # Unmount everything.
     g.umount_all ()</code></pre>

<h1 id="see-also">SEE ALSO</h1>

<p><a href="guestfs.3.html">guestfs(3)</a>, <a href="guestfs-examples.3.html">guestfs-examples(3)</a>, <a href="guestfs-erlang.3.html">guestfs-erlang(3)</a>, <a href="guestfs-golang.3.html">guestfs-golang(3)</a>, <a href="guestfs-java.3.html">guestfs-java(3)</a>, <a href="guestfs-lua.3.html">guestfs-lua(3)</a>, <a href="guestfs-ocaml.3.html">guestfs-ocaml(3)</a>, <a href="guestfs-perl.3.html">guestfs-perl(3)</a>, <a href="guestfs-recipes.1.html">guestfs-recipes(1)</a>, <a href="guestfs-ruby.3.html">guestfs-ruby(3)</a>, <a href="http://libguestfs.org/">http://libguestfs.org/</a>.</p>

<h1 id="authors">AUTHORS</h1>

<p>Richard W.M. Jones (<code>rjones at redhat dot com</code>)</p>

<h1 id="copyright">COPYRIGHT</h1>

<p>Copyright (C) 2010-2012 Red Hat Inc.</p>

<h1 id="license">LICENSE</h1>

<p>This manual page contains examples which we hope you will use in your programs. The examples may be freely copied, modified and distributed for any purpose without any restrictions.</p>

<h1 id="bugs">BUGS</h1>

<p>To get a list of bugs against libguestfs, use this link: <a href="https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools">https://bugzilla.redhat.com/buglist.cgi?component=libguestfs&amp;product=Virtualization+Tools</a></p>

<p>To report a new bug against libguestfs, use this link: <a href="https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools">https://bugzilla.redhat.com/enter_bug.cgi?component=libguestfs&amp;product=Virtualization+Tools</a></p>

<p>When reporting a bug, please supply:</p>

<ul>

<li><p>The version of libguestfs.</p>

</li>
<li><p>Where you got libguestfs (eg. which Linux distro, compiled from source, etc)</p>

</li>
<li><p>Describe the bug accurately and give a way to reproduce it.</p>

</li>
<li><p>Run <a href="libguestfs-test-tool.1.html">libguestfs-test-tool(1)</a> and paste the <b>complete, unedited</b> output into the bug report.</p>

</li>
</ul>

</body>
</html>

